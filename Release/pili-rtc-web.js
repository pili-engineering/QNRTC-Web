var QNRTC=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=116)}([function(e,t,r){var n=r(2);n(n.S+n.F*!r(6),"Object",{defineProperty:r(7).f})},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(1),i=r(25),o=r(10),a=r(11),s=r(20),c=function(e,t,r){var u,d,f,l,h=e&c.F,p=e&c.G,v=e&c.S,m=e&c.P,g=e&c.B,y=p?n:v?n[t]||(n[t]={}):(n[t]||{}).prototype,b=p?i:i[t]||(i[t]={}),S=b.prototype||(b.prototype={});for(u in p&&(r=t),r)f=((d=!h&&y&&void 0!==y[u])?y:r)[u],l=g&&d?s(f,n):m&&"function"==typeof f?s(Function.call,f):f,y&&a(y,u,f,e&c.U),b[u]!=f&&o(b,u,l),m&&S[u]!=f&&(S[u]=f)};n.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){var n=r(61)("wks"),i=r(26),o=r(1).Symbol,a="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){e.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(8),i=r(85),o=r(45),a=Object.defineProperty;t.f=r(6)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(5);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){"use strict";var n,i,o,a,s=r(29),c=r(1),u=r(20),d=r(76),f=r(2),l=r(5),h=r(27),p=r(47),v=r(77),m=r(98),g=r(99).set,y=r(132)(),b=r(100),S=r(133),w=r(134),_=r(135),E=c.TypeError,T=c.process,R=T&&T.versions,C=R&&R.v8||"",x=c.Promise,k="process"==d(T),P=function(){},I=i=b.f,O=!!function(){try{var e=x.resolve(1),t=(e.constructor={})[r(3)("species")]=function(e){e(P,P)};return(k||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==C.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),M=function(e){var t;return!(!l(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var r=e._c;y(function(){for(var n=e._v,i=1==e._s,o=0,a=function(t){var r,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{s?(i||(2==e._h&&N(e),e._h=1),!0===s?r=n:(d&&d.enter(),r=s(n),d&&(d.exit(),a=!0)),r===t.promise?u(E("Promise-chain cycle")):(o=M(r))?o.call(r,c,u):c(r)):u(n)}catch(e){d&&!a&&d.exit(),u(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&D(e)})}},D=function(e){g.call(c,function(){var t,r,n,i=e._v,o=L(e);if(o&&(t=S(function(){k?T.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=k||L(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},N=function(e){g.call(c,function(){var t;k?T.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},B=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw E("Promise can't be resolved itself");(t=M(e))?y(function(){var n={_w:r,_d:!1};try{t.call(e,u(B,n,1),u(j,n,1))}catch(e){j.call(n,e)}}):(r._v=e,r._s=1,A(r,!1))}catch(e){j.call({_w:r,_d:!1},e)}}};O||(x=function(e){p(this,x,"Promise","_h"),h(e),n.call(this);try{e(u(B,this,1),u(j,this,1))}catch(e){j.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(48)(x.prototype,{then:function(e,t){var r=I(m(this,x));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=k?T.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=u(B,e,1),this.reject=u(j,e,1)},b.f=I=function(e){return e===x||e===a?new o(e):i(e)}),f(f.G+f.W+f.F*!O,{Promise:x}),r(36)(x,"Promise"),r(57)("Promise"),a=r(25).Promise,f(f.S+f.F*!O,"Promise",{reject:function(e){var t=I(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!O),"Promise",{resolve:function(e){return _(s&&this===a?x:this,e)}}),f(f.S+f.F*!(O&&r(78)(function(e){x.all(e).catch(P)})),"Promise",{all:function(e){var t=this,r=I(t),n=r.resolve,i=r.reject,o=S(function(){var r=[],o=0,a=1;v(e,!1,function(e){var s=o++,c=!1;r.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,r[s]=e,--a||n(r))},i)}),--a||n(r)});return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=I(t),n=r.reject,i=S(function(){v(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},function(e,t,r){var n=r(7),i=r(46);e.exports=r(6)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(1),i=r(10),o=r(14),a=r(26)("src"),s=Function.toString,c=(""+s).split("toString");r(25).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var u="function"==typeof r;u&&(o(r,"name")||i(r,"name",t)),e[t]!==r&&(u&&(o(r,a)||i(r,a,e[t]?""+e[t]:c.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||s.call(this)})},function(e,t){!function(t){"use strict";var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof e,d=t.regeneratorRuntime;if(d)u&&(e.exports=d);else{(d=t.regeneratorRuntime=u?e.exports:{}).wrap=S;var f="suspendedStart",l="suspendedYield",h="executing",p="completed",v={},m={};m[a]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(O([])));y&&y!==n&&i.call(y,a)&&(m=y);var b=T.prototype=_.prototype=Object.create(m);E.prototype=b.constructor=T,T.constructor=E,T[c]=E.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,T):(e.__proto__=T,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},d.awrap=function(e){return{__await:e}},R(C.prototype),C.prototype[s]=function(){return this},d.AsyncIterator=C,d.async=function(e,t,r,n){var i=new C(S(e,t,r,n));return d.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},R(b),b[c]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},d.values=O,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function S(e,t,r,n){var i=t&&t.prototype instanceof _?t:_,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n=f;return function(i,o){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw o;return M()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=x(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=w(e,t,r);if("normal"===c.type){if(n=r.done?p:l,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=p,r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function w(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function _(){}function E(){}function T(){}function R(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function C(e){var t;this._invoke=function(r,n){function o(){return new Promise(function(t,o){!function t(r,n,o,a){var s=w(e[r],e,n);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},a)}a(s.arg)}(r,n,t,o)})}return t=t?t.then(o,o):o()}}function x(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,x(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=w(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,v;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return o.next=o}}return{next:M}}function M(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(0),Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"setLevel",value:function(e){this.level=e}},{key:"log",value:function(){var e;if("log"===this.level){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).info.apply(e,["%cLOG","color: #66ccff; font-weight: bold;"].concat(r))}}},{key:"debug",value:function(){var e;if("log"===this.level||"debug"===this.level){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).info.apply(e,["%cDEBUG","color: #A28148; font-weight: bold;"].concat(r))}}},{key:"warning",value:function(){var e;if("disable"!==this.level){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).warn.apply(e,["%cWARNING","color: #E44F44; font-weight: bold;"].concat(r))}}}]),e}();t.LogModel=i,t.log=new i("log")},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(40),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){"use strict";var n=r(2),i=r(71)(0),o=r(54)([].forEach,!0);n(n.P+n.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,r){"use strict";var n=!0,i=!0;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}e.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){var t="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return a(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function a(e,t,r){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&s(i,r.prototype),i}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r(28),r(30),r(52),r(23),r(33),r(93),r(153),r(34),r(156),r(43),r(44),r(22),r(53),r(0),Object.defineProperty(t,"__esModule",{value:!0});var u=r(58),d=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=i(this,c(t).call(this,r)),u.qos.addEvent(18,{error_code:e,error_msg:r}),n.code=e,n.error=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,o(Error)),t}();t.QNRTCError=d,t.UNEXPECTED_ERROR=function(e){return new d(11e3,"piliRTC: unexpected error ".concat(e))},t.AUTH_ENTER_ROOM_ERROR=function(e){return new d(11001,"enterRoom error, can not get accessToken. Error: ".concat(e,"\n please check enterRoom arguments"))},t.PUBLISH_ERROR=function(e,t){return new d(e,"publish error, signaling code: ".concat(e,", msg: ").concat(t))},t.CREATE_MERGE_JOB_ERROR=function(e,t){return new d(e,"create merge job error, signaling code: ".concat(e,", msg: ").concat(t))},t.PUBLISH_ICE_ERROR=function(){return new d(11002,"publish faild, ice not ready")},t.SUB_ICE_ERROR=function(){return new d(11003,"subscribe faild, ice not ready")},t.SUB_ERROR_NO_STREAM=function(e){return new d(11004,"subscribe faild, can not find this player in streams, userId: ".concat(e))},t.SUB_P2P_ERROR=function(e){return new d(11005,"subscribe faild, can not create p2p connection, ".concat(e))},t.PUB_P2P_ERROR=function(e){return new d(11006,"publish faild, can not create p2p connection, ".concat(e))},t.UNSUPPORT_FMT=function(e){return new d(11007,"media format not support, ".concat(e))},t.JOIN_ROOM_ERROR=function(e,t){return new d(e,"joinRoom error, code: ".concat(e,", ").concat(t))},t.SUB_ERROR=function(e,t){return new d(e,"subscribe error, signaling code: ".concat(e,", msg: ").concat(t))},t.UNPUBLISH_ERROR=function(e,t){return new d(e,"unpublish error, code: ${code}, msg: ${msg}")},t.UNSUB_ERROR=function(e,t){return new d(e,"unsubscribe error, code: ${code}, msg: ${msg}")},t.CONTROL_ERROR=function(e,t){return new d(e,"send control error, code: ".concat(e,", msg: ").concat(t))},t.NOT_SUPPORT_ERROR=function(e){return new d(11008,"not support! ".concat(e))},t.PLUGIN_NOT_AVALIABLE=function(e){return new d(11009,"plugin not avaliable! ".concat(e))},t.DEVICE_NOT_ALLOWED=function(e){return new d(11010,"NotAllowedError: no permission to access media device. ".concat(e))},t.SUB_ERROR_NO_USER=function(e){return new d(11011,"subscribe faild, can not find this user in room, userId: ".concat(e))},t.NO_MERGE_JOB=function(e){return new d(11012,"can not set merge layout stream, no merge job id ".concat(e))},t.SCREEN_PERMISSION_DENIED=function(){return new d(11013,"can not sharing screen/window on chrome")},t.AUTO_SWITCH_ERROR=function(e){return new d(20001,"deviceManager auto switch error. ".concat(e))}},function(e,t,r){"use strict";r(83),r(74),r(22),r(0),Object.defineProperty(t,"__esModule",{value:!0});var n=r(160),i=r(13),o=r(162);function a(){try{return!!RTCPeerConnection&&(!!WebSocket&&!!navigator.mediaDevices.getUserMedia)}catch(e){return!1}}t.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,t.isChrome=!!window.chrome,t.isIOS=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),t.browser=n.detect()||{},t.browserReport=function(){if(!t.browser)return{support:a()};switch(t.browser.name){case"chrome":return{support:o.gte(t.browser.version,"55.0.0"),mediaStreamDest:o.gte(t.browser.version,"55.0.0"),replaceTrack:o.gte(t.browser.version,"65.0.0"),screenSharing:o.gte(t.browser.version,"55.0.0"),connectionState:!1,stats:!1,ondevicechange:o.gte(t.browser.version,"57.0.0"),minMaxWithIdeal:o.gte(t.browser.version,"56.0.0"),unifiedPlan:o.gte(t.browser.version,"69.0.0")};case"safari":return{support:o.gte(t.browser.version,"11.0.0"),replaceTrack:o.gte(t.browser.version,"11.0.0"),stats:!0,ondevicechange:!1,connectionState:!0,mediaStreamDest:!1,screenSharing:!1,minMaxWithIdeal:!1};case"firefox":return{support:a(),replaceTrack:!0,stats:!0,ondevicechange:o.gte(t.browser.version,"52.0.0"),connectionState:!0,mediaStreamDest:!0,screenSharing:!0,minMaxWithIdeal:!0}}return{support:a()}}(),i.log.log("browser report",t.browserReport,t.browser)},function(e,t,r){var n=r(27);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(39);e.exports=function(e){return Object(n(e))}},function(e,t,r){"use strict";var n=r(2),i=r(64)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(a||!r(54)(o)),"Array",{indexOf:function(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,r){for(var n=r(33),i=r(37),o=r(11),a=r(1),s=r(10),c=r(42),u=r(3),d=u("iterator"),f=u("toStringTag"),l=c.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(h),v=0;v<p.length;v++){var m,g=p[v],y=h[g],b=a[g],S=b&&b.prototype;if(S&&(S[d]||s(S,d,l),S[f]||s(S,f,g),c[g]=l,y))for(m in n)S[m]||o(S,m,n[m],!0)}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}r(28),r(30),r(22),r(23),r(16),r(70),r(9),r(102),r(0),Object.defineProperty(t,"__esModule",{value:!0}),i(r(151)),i(r(152)),i(r(113)),i(r(181)),i(r(182)),t.getPayloadFromJwt=function(e){var t=e.split(".")[1];if(!t)throw new Error("parse jwt error, can not find payload string.");var r=atob(t);return JSON.parse(r)},t.getRoomAccessFromToken=function(e){var t=e.split(":")[2],r=atob(t);return JSON.parse(r)},t.arrayCheck=function(e,t,r){for(var n=0;n<e.length;n+=1)if(e[n][r]===t[r])return!0;return!1},t.removeElementFromArray=function(e,t,r){for(var n=[],i=null,o=0;o<e.length;o+=1)e[o][t]!==r?n.push(e[o]):i=e[o];return{removeElement:i,newArray:n}},t.getElementFromObject=function(e,t,r){for(var n in e){var i=e[n];if(i[t]===r)return{key:n,obj:i}}return null},t.getElementFromArray=function(e,t,r){if(!r)return null;for(var n=0;n<e.length;n+=1){var i=e[n];if(i[t]===r)return i}return null},t.sendMsgWaitResponse=function(e,t,r,n){return e.sendWsMsg(t,r),new Promise(function(t){e.once(n,t)})},t.noop=function(){},t.removeUndefinedKey=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r>=4)return t;for(var i in t)void 0===t[i]&&delete t[i],"object"===n(t[i])&&(t[i]=e(t[i],r+1));return t},t.nextTick=function(e){Promise.resolve().then(e)},t.getMissingUserEvent=function(e,t,r,n,i){var o={join:[],leave:[],publish:[],unpublish:[],mute:[]},a=t.map(function(e){return e.streamid}),s=r.map(function(e){return e.streamid});return a.forEach(function(r,n){t[n].playerid!==e&&-1===s.indexOf(r)&&o.unpublish.push(t[n])}),s.forEach(function(n,i){if(r[i].playerid!==e){var s=a.indexOf(n);-1===s?(o.publish.push(r[i]),o.mute.push({playerid:r[i].playerid,streamid:r[i].streamid,"mute-audio":r[i]["mute-audio"],"mute-video":r[i]["mute-video"]})):r[i]["mute-audio"]===t[s]["mute-audio"]&&r[i]["mute-video"]===t[s]["mute-video"]||o.mute.push({playerid:r[i].playerid,streamid:r[i].streamid,"mute-audio":r[i]["mute-audio"],"mute-video":r[i]["mute-video"]})}}),n.forEach(function(t){t!==e&&-1===i.indexOf(t)&&o.leave.push({playerid:t})}),i.forEach(function(t){t!==e&&-1===n.indexOf(t)&&o.join.push({playerid:t})}),o}},function(e,t){var r=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=r)},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){r(86)("asyncIterator")},function(e,t){e.exports=!1},function(e,t,r){"use strict";var n=r(1),i=r(14),o=r(6),a=r(2),s=r(11),c=r(62).KEY,u=r(4),d=r(61),f=r(36),l=r(26),h=r(3),p=r(87),v=r(86),m=r(119),g=r(68),y=r(8),b=r(5),S=r(38),w=r(45),_=r(46),E=r(32),T=r(121),R=r(51),C=r(7),x=r(37),k=R.f,P=C.f,I=T.f,O=n.Symbol,M=n.JSON,A=M&&M.stringify,D=h("_hidden"),L=h("toPrimitive"),N={}.propertyIsEnumerable,j=d("symbol-registry"),B=d("symbols"),F=d("op-symbols"),U=Object.prototype,G="function"==typeof O,W=n.QObject,V=!W||!W.prototype||!W.prototype.findChild,H=o&&u(function(){return 7!=E(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=k(U,t);n&&delete U[t],P(e,t,r),n&&e!==U&&P(U,t,n)}:P,X=function(e){var t=B[e]=E(O.prototype);return t._k=e,t},z=G&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O},K=function(e,t,r){return e===U&&K(F,t,r),y(e),t=w(t,!0),y(r),i(B,t)?(r.enumerable?(i(e,D)&&e[D][t]&&(e[D][t]=!1),r=E(r,{enumerable:_(0,!1)})):(i(e,D)||P(e,D,_(1,{})),e[D][t]=!0),H(e,t,r)):P(e,t,r)},q=function(e,t){y(e);for(var r,n=m(t=S(t)),i=0,o=n.length;o>i;)K(e,r=n[i++],t[r]);return e},J=function(e){var t=N.call(this,e=w(e,!0));return!(this===U&&i(B,e)&&!i(F,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,D)&&this[D][e])||t)},$=function(e,t){if(e=S(e),t=w(t,!0),e!==U||!i(B,t)||i(F,t)){var r=k(e,t);return!r||!i(B,t)||i(e,D)&&e[D][t]||(r.enumerable=!0),r}},Z=function(e){for(var t,r=I(S(e)),n=[],o=0;r.length>o;)i(B,t=r[o++])||t==D||t==c||n.push(t);return n},Y=function(e){for(var t,r=e===U,n=I(r?F:S(e)),o=[],a=0;n.length>a;)!i(B,t=n[a++])||r&&!i(U,t)||o.push(B[t]);return o};G||(s((O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=l(arguments.length>0?arguments[0]:void 0),t=function(r){this===U&&t.call(F,r),i(this,D)&&i(this[D],e)&&(this[D][e]=!1),H(this,e,_(1,r))};return o&&V&&H(U,e,{configurable:!0,set:t}),X(e)}).prototype,"toString",function(){return this._k}),R.f=$,C.f=K,r(41).f=T.f=Z,r(50).f=J,r(67).f=Y,o&&!r(29)&&s(U,"propertyIsEnumerable",J,!0),p.f=function(e){return X(h(e))}),a(a.G+a.W+a.F*!G,{Symbol:O});for(var Q="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Q.length>ee;)h(Q[ee++]);for(var te=x(h.store),re=0;te.length>re;)v(te[re++]);a(a.S+a.F*!G,"Symbol",{for:function(e){return i(j,e+="")?j[e]:j[e]=O(e)},keyFor:function(e){if(!z(e))throw TypeError(e+" is not a symbol!");for(var t in j)if(j[t]===e)return t},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+a.F*!G,"Object",{create:function(e,t){return void 0===t?E(e):q(E(e),t)},defineProperty:K,defineProperties:q,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:Y}),M&&a(a.S+a.F*(!G||u(function(){var e=O();return"[null]"!=A([e])||"{}"!=A({a:e})||"{}"!=A(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!z(e))return g(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!z(t))return t}),n[1]=t,A.apply(M,n)}}),O.prototype[L]||r(10)(O.prototype,L,O.prototype.valueOf),f(O,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(8),i=r(120),o=r(66),a=r(65)("IE_PROTO"),s=function(){},c=function(){var e,t=r(59)("iframe"),n=o.length;for(t.style.display="none",r(89).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){"use strict";var n=r(127),i=r(91),o=r(42),a=r(38);e.exports=r(72)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t,r){var n=r(2);n(n.P,"Function",{bind:r(94)})},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}r(0),Object.defineProperty(t,"__esModule",{value:!0}),n(r(109)),n(r(168)),n(r(169)),n(r(170))},function(e,t,r){var n=r(7).f,i=r(14),o=r(3)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(88),i=r(66);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(63),i=r(39);e.exports=function(e){return n(i(e))}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(88),i=r(66).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t){e.exports={}},function(e,t,r){"use strict";r(130);var n=r(8),i=r(73),o=r(6),a=/./.toString,s=function(e){r(11)(RegExp.prototype,"toString",e,!0)};r(4)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?s(function(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)}):"toString"!=a.name&&s(function(){return a.call(this)})},function(e,t,r){var n=Date.prototype,i=n.toString,o=n.getTime;new Date(NaN)+""!="Invalid Date"&&r(11)(n,"toString",function(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"})},function(e,t,r){var n=r(5);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(11);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var n=r(40),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(50),i=r(46),o=r(38),a=r(45),s=r(14),c=r(85),u=Object.getOwnPropertyDescriptor;t.f=r(6)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(2);n(n.S,"Object",{create:r(32)})},function(e,t,r){var n=r(2);n(n.S,"Object",{setPrototypeOf:r(90).set})},function(e,t,r){"use strict";var n=r(4);e.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,r){var n=r(2);n(n.S+n.F,"Object",{assign:r(126)})},function(e,t,r){var n=r(2);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,r){"use strict";var n=r(1),i=r(7),o=r(6),a=r(3)("species");e.exports=function(e){var t=n[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(104),r(55),r(83),r(12),r(34),r(56),r(0),r(9);var i=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var o=r(60),a=r(19),s=r(163),c=r(35),u=r(24),d=r(171),f=r(172),l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventLock=!1,this.mediaLock=!1,this.lastStreamStat={},this.version="1.0",this.eventItems=[],this.mediaItems=[],this.lastEventSendTime=Date.now(),this.lastMediaSendTime=Date.now(),this.qosStorage=d.createInstance({name:"qos"}),window.addEventListener("beforeunload",this.handlePageLeave.bind(this))}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"init",value:function(e,t){return i(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.userBase={app_id:e.appId,room_name:e.roomName,user_id:e.userId},r=function(){return new Promise(function(e){(new f).get(function(t,r){e(t)})})},t.next=4,r();case 4:return n=t.sent,this.base={qos_version:this.version,device_id:n,bundle_id:location.href,app_version:"",sdk_version:o.version,device_model:"".concat(a.browser.name).concat(a.browser.version),os_platform:a.browser.os,os_version:""},t.next=8,this.getQosFeature();case 8:case"end":return t.stop()}},t,this)}))}},{key:"setSessionId",value:function(e){return i(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.sessionId){t.next=5;break}return t.next=3,this.sendEventData(!0);case 3:return t.next=5,this.sendMediaData(!0);case 5:this.sessionId=e;case 6:case"end":return t.stop()}},t,this)}))}},{key:"getQosFeature",value:function(){return i(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.qosStorage.getItem("feature");case 2:if(this.featureStorageData=e.sent,this.featureStorageData&&this.featureStorageData.data||(this.featureStorageData={date:Date.now(),data:c.qosFeatureInit}),!(Date.now()-this.featureStorageData.date>864e5)){e.next=9;break}return e.next=7,this.sendFeatureData(this.featureStorageData.data);case 7:this.featureStorageData.data=c.qosFeatureInit,this.featureStorageData.date=Date.now();case 9:case"end":return e.stop()}},e,this)}))}},{key:"addEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({event_id:e,timestamp:Date.now()},t);this.eventItems.push(r),this.sendEventData().then(u.noop).catch(u.noop)}},{key:"addMediaTask",value:function(e){var t=this;if(e.streamId&&null!==this.lastStreamStat[e.streamId]&&!this.lastStreamStat[e.streamId]){this.lastStreamStat[e.streamId]=null;var r=window.setInterval(function(){if(e&&!e.isDestroyed&&e.streamId){var n=e.getStats(),i=t.lastStreamStat[e.streamId],o=i?8e3*(n.audioBytes-i.audioBytes)/1e4:n.audioBitrate,a=i?8e3*(n.videoBytes-i.videoBytes)/1e4:n.videoBitrate,s=i?(n.audioPacketLoss-i.audioPacketLoss)/(n.audioPackets-i.audioPackets):n.audioPacketLoss/n.audioPackets,c=i?(n.videoPacketLoss-i.videoPacketLoss)/(n.videoPackets-i.videoPackets):n.videoPacketLoss/n.videoPackets,d={timestamp:Date.now(),local_user_id:t.userBase.user_id,remote_user_id:e.connId?e.userId:"",stream_id:e.streamId,conn_id:e.connId||"",afps:0,vfps:0,abps:o,vbps:a,audio_packet_loss_rate:s,video_packet_loss_rate:c};t.lastStreamStat[e.streamId]=n,t.mediaItems.push(d),t.sendMediaData().then(u.noop).catch(u.noop)}else window.clearInterval(r)},1e4)}}},{key:"addFeature",value:function(e){this.featureStorageData&&this.featureStorageData.data&&(this.featureStorageData.data[e]=1,this.qosStorage.setItem("feature",this.featureStorageData).then(u.noop).catch(u.noop))}},{key:"sendFeatureData",value:function(e){return i(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign({base:this.base,user_base:this.userBase},e),n=this.getBufferFromMessage(r),t.next=4,fetch("https://pili-rtc-qos.qiniuapi.com/v1/rtcfeature",{method:"POST",headers:{"Content-Type":"application/x-gzip"},body:n});case 4:case"end":return t.stop()}},t,this)}))}},{key:"sendMediaData",value:function(e){return i(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return");case 2:if(this.mediaStorageData){t.next=9;break}return t.next=5,this.qosStorage.getItem("media");case 5:if(t.t0=t.sent,t.t0){t.next=8;break}t.t0=[];case 8:this.mediaStorageData=t.t0;case 9:if(!(this.mediaItems.length>=10||e)){t.next=15;break}return this.mediaStorageData=this.mediaStorageData||[],this.mediaStorageData=this.mediaStorageData.concat(this.mediaItems),t.next=14,this.qosStorage.setItem("media",this.mediaStorageData);case 14:this.mediaItems=[];case 15:if(e||!(this.mediaStorageData.length<200||Date.now()-this.lastMediaSendTime<6e5)){t.next=17;break}return t.abrupt("return");case 17:if(this.mediaLock){t.next=34;break}return this.mediaLock=!0,r={session_id:this.sessionId,items:this.mediaStorageData},n=this.getBufferFromMessage(r),t.prev=21,t.next=24,fetch("https://pili-rtc-qos.qiniuapi.com/v1/rtctask",{method:"POST",headers:{"Content-Type":"application/x-gzip"},body:n});case 24:return this.lastMediaSendTime=Date.now(),this.mediaItems=[],this.mediaStorageData=[],t.next=29,this.qosStorage.removeItem("media");case 29:t.next=33;break;case 31:t.prev=31,t.t1=t.catch(21);case 33:this.mediaLock=!1;case 34:case"end":return t.stop()}},t,this,[[21,31]])}))}},{key:"sendEventData",value:function(e){return i(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.base&&this.userBase&&this.sessionId){t.next=2;break}return t.abrupt("return");case 2:if(this.eventStorageData){t.next=9;break}return t.next=5,this.qosStorage.getItem("event");case 5:if(t.t0=t.sent,t.t0){t.next=8;break}t.t0=[];case 8:this.eventStorageData=t.t0;case 9:if(!(this.eventItems.length>=10||e)){t.next=15;break}return this.eventStorageData=this.eventStorageData||[],this.eventStorageData=this.eventStorageData.concat(this.eventItems),t.next=14,this.qosStorage.setItem("event",this.eventStorageData);case 14:this.eventItems=[];case 15:if(e||!(this.eventStorageData.length<200||Date.now()-this.lastEventSendTime<6e5)){t.next=17;break}return t.abrupt("return");case 17:if(this.eventLock){t.next=34;break}return this.eventLock=!0,r={base:this.base,user_base:this.userBase,session_id:this.sessionId,items:this.eventStorageData},n=this.getBufferFromMessage(r),t.prev=21,t.next=24,fetch("https://pili-rtc-qos.qiniuapi.com/v1/rtcevent",{method:"POST",headers:{"Content-Type":"application/x-gzip"},body:n});case 24:return this.lastEventSendTime=Date.now(),this.eventItems=[],this.eventStorageData=[],t.next=29,this.qosStorage.removeItem("event");case 29:t.next=33;break;case 31:t.prev=31,t.t1=t.catch(21);case 33:this.eventLock=!1;case 34:case"end":return t.stop()}},t,this,[[21,31]])}))}},{key:"getBufferFromMessage",value:function(e){for(var t=s.zip(JSON.stringify(e)),r=new Uint8Array(t.length),n=0;n<t.length;n+=1)r[n]=t[n];return r.buffer}},{key:"handlePageLeave",value:function(){this.sendMediaData(!0).then(u.noop).catch(u.noop),this.sendEventData(!0).then(u.noop).catch(u.noop),this.qosStorage.setItem("feature",this.featureStorageData).then(u.noop).catch(u.noop)}}]),e}();t.QOSModel=l,t.qos=new l},function(e,t,r){var n=r(5),i=r(1).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0}),t.version="1.2.4",t.build_rtc_env="production"},function(e,t,r){var n=r(25),i=r(1),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(29)?"pure":"global",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(26)("meta"),i=r(5),o=r(14),a=r(7).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(4)(function(){return c(Object.preventExtensions({}))}),d=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},f=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return u&&f.NEED&&c(e)&&!o(e,n)&&d(e),e}}},function(e,t,r){var n=r(31);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(38),i=r(15),o=r(49);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),d=o(a,u);if(e&&r!=r){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}}},function(e,t,r){var n=r(61)("keys"),i=r(26);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(31);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(21),i=r(37);r(123)("keys",function(){return function(e){return i(n(e))}})},function(e,t,r){"use strict";var n=r(2),i=r(71)(1);n(n.P+n.F*!r(54)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,r){var n=r(20),i=r(63),o=r(21),a=r(15),s=r(124);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,d=4==e,f=6==e,l=5==e||f,h=t||s;return function(t,s,p){for(var v,m,g=o(t),y=i(g),b=n(s,p,3),S=a(y.length),w=0,_=r?h(t,S):c?h(t,0):void 0;S>w;w++)if((l||w in y)&&(m=b(v=y[w],w,g),e))if(r)_[w]=m;else if(m)switch(e){case 3:return!0;case 5:return v;case 6:return w;case 2:_.push(v)}else if(d)return!1;return f?-1:u||d?d:_}}},function(e,t,r){"use strict";var n=r(29),i=r(2),o=r(11),a=r(10),s=r(42),c=r(128),u=r(36),d=r(92),f=r(3)("iterator"),l=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,r,p,v,m,g){c(r,t,p);var y,b,S,w=function(e){if(!l&&e in R)return R[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},_=t+" Iterator",E="values"==v,T=!1,R=e.prototype,C=R[f]||R["@@iterator"]||v&&R[v],x=C||w(v),k=v?E?w("entries"):x:void 0,P="Array"==t&&R.entries||C;if(P&&(S=d(P.call(new e)))!==Object.prototype&&S.next&&(u(S,_,!0),n||"function"==typeof S[f]||a(S,f,h)),E&&C&&"values"!==C.name&&(T=!0,x=function(){return C.call(this)}),n&&!g||!l&&!T&&R[f]||a(R,f,x),s[t]=x,s[_]=h,v)if(y={values:E?x:w("values"),keys:m?x:w("keys"),entries:k},g)for(b in y)b in R||o(R,b,y[b]);else i(i.P+i.F*(l||T),t,y);return y}},function(e,t,r){"use strict";var n=r(8);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){r(75)("match",1,function(e,t,r){return[function(r){"use strict";var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))},r]})},function(e,t,r){"use strict";var n=r(10),i=r(11),o=r(4),a=r(39),s=r(3);e.exports=function(e,t,r){var c=s(e),u=r(a,c,""[e]),d=u[0],f=u[1];o(function(){var t={};return t[c]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,d),n(RegExp.prototype,c,2==t?function(e,t){return f.call(e,this,t)}:function(e){return f.call(e,this)}))}},function(e,t,r){var n=r(31),i=r(3)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,r){var n=r(20),i=r(131),o=r(96),a=r(8),s=r(15),c=r(97),u={},d={};(t=e.exports=function(e,t,r,f,l){var h,p,v,m,g=l?function(){return e}:c(e),y=n(r,f,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(h=s(e.length);h>b;b++)if((m=t?y(a(p=e[b])[0],p[1]):y(e[b]))===u||m===d)return m}else for(v=g.call(e);!(p=v.next()).done;)if((m=i(v,y,p.value,t))===u||m===d)return m}).BREAK=u,t.RETURN=d},function(e,t,r){var n=r(3)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(e){}return r}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n;
/*!
 * EventEmitter v5.2.4 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function i(){}var o=i.prototype,a=t.EventEmitter;function s(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},o.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},o.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===s(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=s(i[n],t))&&i[n].splice(r,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):a.call(this,n,i));return this},o.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var r,n,i,o,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(r=a[o].slice(0),i=0;i<r.length;i++)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=a,i},void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n)}(this||{})},function(e,t,r){var n=r(5),i=r(31),o=r(3)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(5),i=r(90).set;e.exports=function(e,t,r){var o,a=t.constructor;return a!==r&&"function"==typeof a&&(o=a.prototype)!==r.prototype&&n(o)&&i&&i(e,o),e}},function(e,t,r){var n=r(7).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(6)&&n(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(43),r(44),r(23),r(16),r(12),r(104),r(34),r(0),r(9);var i=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var o=r(115),a=r(19),s=r(110),c=r(24),u=r(112),d=r(35),f=r(13),l=r(18),h=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.enableAudio=!0,this.enableVideo=!0,this.muteAudio=!1,this.muteVideo=!1,this.isDestroyed=!1,this._connectStatus=d.StreamConnectStatus.Idle,this.streamId=r,this.userId=n,t&&this.setMediaStream(t)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"play",value:function(e,t){var r=this;this.container=e,this.playMute=t,this.video&&(this.video.srcObject=null,this.video.remove()),this.video=document.createElement("video"),this.video.style.width="100%",this.video.style.height="100%",this.video.style["object-fit"]="contain",this.videoTrack&&(this.videoTrack.onmute=this.handleVideoMute.bind(this),this.videoTrack.onended=this.handleTrackEnd.bind(this),this.videoTrack.onunmute=this.handleVideoMute.bind(this)),this.audioTrack&&(this.audioTrack.onended=this.handleTrackEnd.bind(this)),this.video.className="qnrtc-stream-player",e.appendChild(this.video),this.video.autoplay=!0,this.video.setAttribute("playsinline",!0),this.video.muted=!!t,this.mediaStream&&(this.video.srcObject=this.mediaStream,a.isIOS&&(this.video.setAttribute("controls",!0),setTimeout(function(){r.video&&r.video.srcObject&&r.video.removeAttribute("controls")})))}},{key:"getCurrentFrameDataURL",value:function(){return this.video?c.getFrameFromVideo(this.video):"data:,"}},{key:"onAudioBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;this.audioManager&&this.audioManager.onAudioBuffer(e,t)}},{key:"getCurrentTimeDomainData",value:function(){var e=new Uint8Array(2048);return this.audioManager?(this.audioManager.analyserNode.getByteTimeDomainData(e),e):e}},{key:"getCurrentFrequencyData",value:function(){var e=new Uint8Array(2048);return this.audioManager?(this.audioManager.analyserNode.getByteFrequencyData(e),e):e}},{key:"setAudioBufferData",value:function(e,t){this.audioManager&&this.audioManager.updateAudioBuffer(e,t)}},{key:"getStats",value:function(){return this.stats?this.stats:u.defaultStatsReport}},{key:"setMicVolume",value:function(e){this.audioManager&&this.audioManager.gainNode.gain.setValueAtTime(e,o.audioContext.currentTime)}},{key:"setMute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.muteAudio=e,this.muteVideo=t,this.videoTrack&&(this.videoTrack.enabled=!this.muteVideo),this.audioTrack&&(this.audioTrack.enabled=!this.muteAudio)}},{key:"setEnable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.enableAudio=e,this.enableVideo=t,this.videoTrack&&!this.enableVideo&&(this.videoTrack=void 0),this.audioTrack&&!this.enableAudio&&(this.audioTrack=void 0)}},{key:"setMediaStream",value:function(e,t){return i(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&(this.originMediaStream=e,this.originMediaStream.getTracks().forEach(function(e){"video"===e.kind&&n.enableVideo&&(n.videoTrack&&n.videoTrack!==e&&n.videoTrack.stop(),n.videoTrack=e,n.handleMuteResub(),n.muteVideo&&(n.videoTrack.enabled=!1)),"audio"===e.kind&&n.enableAudio&&(n.audioTrack&&n.audioTrack!==e&&n.audioTrack.stop(),n.audioTrack=e,n.muteAudio&&(n.audioTrack.enabled=!1))})),!this.enableAudio){r.next=11;break}return this.audioManager&&this.audioManager.release(),this.audioManager=new o.AudioManager,r.next=6,this.audioManager.initAudioContext();case 6:return r.next=8,this.mixMediaStreamWithWebAudio();case 8:this.mediaStream=r.sent,r.next=12;break;case 11:this.mediaStream=this.originMediaStream;case 12:a.browserReport.replaceTrack&&t?(this.videoSender&&this.videoTrack&&this.videoSender.replaceTrack&&this.videoSender.replaceTrack(this.videoTrack),this.audioSender&&this.audioTrack&&this.audioSender.replaceTrack&&this.audioSender.replaceTrack(this.audioTrack)):this.sessionRepublish&&this.sessionRepublish().then().catch(function(e){f.log.warning(e)}),this.video&&this.container&&this.play(this.container,this.playMute);case 14:case"end":return r.stop()}},r,this)}))}},{key:"bindWithPeerConnection",value:function(e,t){this.pc&&(this.releaseStat(),c.releasePC(this.pc)),this.pc=e,this.connId=t,t||(this.audioTrack&&this.mediaStream&&(this.audioSender=this.pc.addTrack(this.audioTrack,this.mediaStream)),this.videoTrack&&this.mediaStream&&(this.videoSender=this.pc.addTrack(this.videoTrack,this.mediaStream))),this.statInterval=setInterval(this.handleStat.bind(this),1e3)}},{key:"getPeerConnection",value:function(){return this.pc}},{key:"getAudioEncodings",value:function(){return this.audioSender?this.audioSender.getParameters().encodings:void 0}},{key:"getVideoEncodings",value:function(){return this.videoSender?this.videoSender.getParameters().encodings:void 0}},{key:"setRecordConfig",value:function(e){this.recordConfig=e}},{key:"initTrackEvent",value:function(){var e=this;this.pc&&this.originMediaStream&&(this.pc.ontrack=function(t){if(e.originMediaStream){var r=t.streams[0];f.log.debug("user ".concat(e.userId," get new stream"),r),r.id!==e.originMediaStream.id&&e.setMediaStream(r).then().catch(function(e){throw l.UNEXPECTED_ERROR("ontrack update error: ".concat(e.toString()))})}})}},{key:"processSDP",value:function(e){if(!this.recordConfig)return e;var t={audio:this.recordConfig.audio&&this.recordConfig.audio.bitrate||32,video:this.recordConfig.video&&this.recordConfig.video.bitrate||600,screen:this.recordConfig.screen&&this.recordConfig.screen.bitrate||600};return e=s.BandwidthHandler.setApplicationSpecificBandwidth(e,t,d.REC_SCREEN_ENABLE(this.recordConfig)),e=s.BandwidthHandler.setVideoBitrates(e,{min:t.video,max:t.video})}},{key:"resubscribe",value:function(){var e=this;this.resubTimeout=void 0,this.sessionResubscribe&&this.userId&&this.connId&&(c.releasePC(this.pc),this.releaseStat(),this.releaseStream(),this.sessionResubscribe(this.userId).then(function(){e.video&&e.play(e.container,e.playMute)}).catch(function(e){throw e}))}},{key:"handleTrackEnd",value:function(){this.connId&&(f.log.warning("track state is ended. resub",this.userId,this.videoTrack,this.audioTrack),this.resubscribe())}},{key:"handleVideoMute",value:function(){this.videoTrack&&this.video&&(f.log.warning("video track onmute: ",this.videoTrack.muted,"user: ",this.userId),this.handleMuteResub())}},{key:"handleMuteResub",value:function(){this.videoTrack&&(this.videoTrack.muted&&this.connId&&(this.resubTimeout||(this.resubTimeout=window.setTimeout(this.resubscribe.bind(this),3e4))),this.videoTrack.muted||this.resubTimeout&&(window.clearTimeout(this.resubTimeout),this.resubTimeout=void 0))}},{key:"setReconnect",value:function(e,t){e&&(this.sessionRepublish=e),t&&(this.sessionResubscribe=t)}},{key:"release",value:function(){this.isDestroyed||(this.isDestroyed=!0,this.resubTimeout&&(window.clearTimeout(this.resubTimeout),this.resubTimeout=void 0),this.releaseStream(),this.video&&(this.video.srcObject=null,this.video.remove(),this.video=void 0))}},{key:"releasePC",value:function(){this.pc&&(this.releaseStat(),c.releasePC(this.pc))}},{key:"releaseStat",value:function(){this.stats=void 0,this.statInterval&&(clearInterval(this.statInterval),this.statInterval=void 0)}},{key:"releaseStream",value:function(){this.connectStatus=d.StreamConnectStatus.Idle,this.pc&&(this.pc.ontrack=void 0,this.audioSender&&(this.pc.removeTrack(this.audioSender),this.audioSender=void 0),this.videoSender&&(this.pc.removeTrack(this.videoSender),this.videoSender=void 0)),this.releaseTrack()}},{key:"releaseTrack",value:function(){this.mediaStream&&(this.mediaStream.getTracks().forEach(function(e){e.onended=void 0,e.stop()}),this.mediaStream=void 0),this.originMediaStream&&(this.originMediaStream.getTracks().forEach(function(e){e.onended=void 0,e.stop()}),this.originMediaStream=void 0)}},{key:"handleStat",value:function(){return i(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pc){e.next=3;break}return this.stats=u.defaultStatsReport,e.abrupt("return");case 3:return e.next=5,c.getPCStats(this.pc,this.connId?"recv":"send");case 5:if(t=e.sent,this.stats){e.next=9;break}return this.stats=t,e.abrupt("return");case 9:this.stats=c.getRateStats(t,this.stats);case 10:case"end":return e.stop()}},e,this)}))}},{key:"mixMediaStreamWithWebAudio",value:function(){return i(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioManager){e.next=2;break}throw l.UNEXPECTED_ERROR("can not find audio manager");case 2:if(this.audioTrack?this.audioManager.setMediaStreamSource(this.originMediaStream):this.audioManager.setAudioBufferSource(),!this.connId){e.next=5;break}return e.abrupt("return",this.originMediaStream);case 5:if(!a.browserReport.mediaStreamDest){e.next=11;break}return this.audioTrack=this.audioManager.audioStream.stream.getTracks()[0],this.videoTrack&&(this.videoTrack=this.videoTrack.clone(),this.audioManager.audioStream.stream.addTrack(this.videoTrack)),e.abrupt("return",this.audioManager.audioStream.stream);case 11:return e.abrupt("return",this.originMediaStream);case 12:case"end":return e.stop()}},e,this)}))}},{key:"connectStatus",get:function(){return this._connectStatus},set:function(e){var t=this;if(e!==this._connectStatus){var r=this._connectStatus;this._connectStatus=e,c.nextTick(function(){t.onConnectStatusChange&&t.onConnectStatusChange(r,t._connectStatus)})}}},{key:"isPlaying",get:function(){return!!this.mediaStream&&((!this.audioTrack||"ended"!==this.audioTrack.readyState)&&(!this.videoTrack||"ended"!==this.videoTrack.readyState))}}]),e}();t.Stream=h},function(e,t,r){e.exports=!r(6)&&!r(4)(function(){return 7!=Object.defineProperty(r(59)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(1),i=r(25),o=r(29),a=r(87),s=r(7).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,r){t.f=r(3)},function(e,t,r){var n=r(14),i=r(38),o=r(64)(!1),a=r(65)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(1).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(5),i=r(8),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(20)(Function.call,r(51).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return o(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:o}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(14),i=r(21),o=r(65)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){"use strict";var n=r(129)(!0);r(72)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t,r){"use strict";var n=r(27),i=r(5),o=r(95),a=[].slice,s={};e.exports=Function.bind||function(e){var t=n(this),r=a.call(arguments,1),c=function(){var n=r.concat(a.call(arguments));return this instanceof c?function(e,t,r){if(!(t in s)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";s[t]=Function("F,a","return new F("+n.join(",")+")")}return s[t](e,r)}(t,n.length,n):o(t,n,e)};return i(t.prototype)&&(c.prototype=t.prototype),c}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(42),i=r(3)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(76),i=r(3)("iterator"),o=r(42);e.exports=r(25).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){var n=r(8),i=r(27),o=r(3)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||void 0==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n,i,o,a=r(20),s=r(95),c=r(89),u=r(59),d=r(1),f=d.process,l=d.setImmediate,h=d.clearImmediate,p=d.MessageChannel,v=d.Dispatch,m=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){y.call(e.data)};l&&h||(l=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return g[++m]=function(){s("function"==typeof e?e:Function(e),t)},n(m),m},h=function(e){delete g[e]},"process"==r(31)(f)?n=function(e){f.nextTick(a(y,e,1))}:v&&v.now?n=function(e){v.now(a(y,e,1))}:p?(o=(i=new p).port2,i.port1.onmessage=b,n=a(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+"","*")},d.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:l,clear:h}},function(e,t,r){"use strict";var n=r(27);e.exports.f=function(e){return new function(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)}(e)}},function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=n.parseRtpMap(a),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?n.parseFmtp(c[0]):{},s.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,o=void 0!==t?t:2;return i=e||n.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},e.exports=n},function(e,t,r){r(75)("split",2,function(e,t,n){"use strict";var i=r(81),o=n,a=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var s=void 0===/()??/.exec("")[1];n=function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!i(e))return o.call(r,e,t);var n,c,u,d,f,l=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,v=void 0===t?4294967295:t>>>0,m=new RegExp(e.source,h+"g");for(s||(n=new RegExp("^"+m.source+"$(?!\\s)",h));(c=m.exec(r))&&!((u=c.index+c[0].length)>p&&(l.push(r.slice(p,c.index)),!s&&c.length>1&&c[0].replace(n,function(){for(f=1;f<arguments.length-2;f++)void 0===arguments[f]&&(c[f]=void 0)}),c.length>1&&c.index<r.length&&a.apply(l,c.slice(1)),d=c[0].length,p=u,l.length>=v));)m.lastIndex===c.index&&m.lastIndex++;return p===r.length?!d&&m.test("")||l.push(""):l.push(r.slice(p)),l.length>v?l.slice(0,v):l}}else"0".split(void 0,0).length&&(n=function(e,t){return void 0===e&&0===t?[]:o.call(this,e,t)});return[function(r,i){var o=e(this),a=void 0==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},n]})},function(e,t,r){var n=r(5);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,r){r(157)("Uint8",1,function(e){return function(t,r,n){return e(this,t,r,n)}})},function(e,t,r){for(var n,i=r(1),o=r(10),a=r(26),s=a("typed_array"),c=a("view"),u=!(!i.ArrayBuffer||!i.DataView),d=u,f=0,l="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(n=i[l[f++]])?(o(n.prototype,s,!0),o(n.prototype,c,!0)):d=!1;e.exports={ABV:u,CONSTR:d,TYPED:s,VIEW:c}},function(e,t,r){var n=r(40),i=r(15);e.exports=function(e){if(void 0===e)return 0;var t=n(e),r=i(t);if(t!==r)throw RangeError("Wrong length!");return r}},function(e,t,r){"use strict";var n=r(21),i=r(49),o=r(15);e.exports=function(e){for(var t=n(this),r=o(t.length),a=arguments.length,s=i(a>1?arguments[1]:void 0,r),c=a>2?arguments[2]:void 0,u=void 0===c?r:i(c,r);u>s;)t[s++]=e;return t}},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],d=!1,f=-1;function l(){d&&c&&(d=!1,c.length?u=c.concat(u):f=-1,u.length&&h())}function h(){if(!d){var e=s(l);d=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||d||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0}),t.REC_AUDIO_ENABLE=function(e){return!!e&&!!e.audio&&e.audio.enabled},t.REC_VIDEO_ENABLE=function(e){return!!e&&!!e.video&&e.video.enabled},t.REC_SCREEN_ENABLE=function(e){return!!e&&!!e.screen&&e.screen.enabled}},function(e,t,r){"use strict";r(102),r(74),r(173),r(22),r(174),r(43),r(44),r(23),r(16),r(0),Object.defineProperty(t,"__esModule",{value:!0});var n=r(175);function i(e,t,r){return function(e,t,r,n,i){for(var o=-1!==r?r:e.length,a=t;a<o;++a)if(0===e[a].indexOf(n)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null}(e,0,-1,t,r)}function o(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null}t.addFmtpToAnswer=function(e){var t=e.split("\n");return(t=t.slice(0,31).concat(["a=fmtp:97 profile-level-id=42e01f;level-asymmetry-allowed=0;packetization-mode=1"]).concat(t.slice(31,t.length))).join("\r\n")},t.BandwidthHandler={setApplicationSpecificBandwidth:function(e,t,r){return function(e,t,r){if(!t)return e;r&&(t.screen?t.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail."));var i="audio",o="video";n.parse(e).media.forEach(function(e){"audio"!==e.type||!e.mid&&0!==e.mid||(i=e.mid.toString()),"video"!==e.type||!e.mid&&0!==e.mid||(o=e.mid.toString())});var a="a=mid:".concat(o,"\r\n"),s="a=mid:".concat(o,"\r\nb=AS:"),c="a=mid:".concat(i,"\r\n"),u="a=mid:".concat(i,"\r\nb=AS:");return(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.screen&&r&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(a,s+t.screen+"\r\n")),t.audio&&(e=e.replace(c,u+t.audio+"\r\n")),t.video&&!r&&(e=e.replace(a,s+t.video+"\r\n")),e}(e,t,r)},setVideoBitrates:function(e,t){return function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.min,a=r.max,s=e.split("\r\n"),c=i(s,"a=rtpmap","VP8/90000");if(c&&(t=o(s[c])),!t)return e;var u,d=i(s,"a=rtpmap","rtx/90000");if(d&&(u=o(s[d])),!d||!u)return e;var f=i(s,"a=fmtp:"+u.toString());if(null!==f){var l="\r\n";l+="a=fmtp:"+t+" x-google-min-bitrate="+(n||"228")+"; x-google-max-bitrate="+(a||"228"),s[f]=s[f].concat(l),e=s.join("\r\n")}return e}(e,t)},setOpusAttributes:function(e,t){return function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.split("\r\n"),a=i(n,"a=rtpmap","opus/48000");if(a&&(t=o(n[a])),!t)return e;var s=i(n,"a=fmtp:"+t.toString());if(null===s)return e;var c="";return c+="; stereo="+(void 0!==r.stereo?r.stereo:"1"),c+="; sprop-stereo="+(void 0!==r["sprop-stereo"]?r["sprop-stereo"]:"1"),void 0!==r.maxaveragebitrate&&(c+="; maxaveragebitrate="+(r.maxaveragebitrate||1048576)),void 0!==r.maxplaybackrate&&(c+="; maxplaybackrate="+(r.maxplaybackrate||1048576)),void 0!==r.cbr&&(c+="; cbr="+(void 0!==r.cbr?r.cbr:"1")),void 0!==r.useinbandfec&&(c+="; useinbandfec="+r.useinbandfec),void 0!==r.usedtx&&(c+="; usedtx="+r.usedtx),void 0!==r.maxptime&&(c+="\r\na=maxptime:"+r.maxptime),n[s]=n[s].concat(c),e=n.join("\r\n")}(e,t)}}},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,r){"use strict";r(178),r(22),r(16),r(55),r(28),r(30),r(33),r(23),r(12),r(56),r(0),r(9);var n=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultStatsReport={pctype:"send",bandwidth:0,videoPacketLossRate:0,audioPacketLossRate:0,videoBitrate:0,audioBitrate:0,videoBytes:0,audioBytes:0,videoPackets:0,videoPacketLoss:0,audioPackets:0,audioPacketLoss:0,timestamp:Date.now()},t.getStats=function(e,r){return n(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,o,a,s,c,u,d,f,l,h,p,v,m;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(i=t.defaultStatsReport).pctype=r,i.timestamp=Date.now(),n.next=5,e.getStats();case 5:for(o=n.sent,a=!0,s=!1,c=void 0,n.prev=9,u=o.values()[Symbol.iterator]();!(a=(d=u.next()).done);a=!0)f=d.value,("send"===r&&"outbound-rtp"===f.type&&!f.isRemote||"recv"===r&&"inbound-rtp"===f.type&&!f.isRemote)&&(l=o.get(f.remoteId),h="send"===r?f.packetsSent:f.packetsReceived,p="send"===r?f.bytesSent:f.bytesReceived,v=0,l&&(m="send"===r?l.packetsReceived:l.packetsSent,v="send"===r?l.packetsLost:m-h),"audio"===f.mediaType?(i.audioBytes=p,i.audioPackets=h,i.audioPacketLoss=v):(i.videoBytes=p,i.videoPackets=h,i.videoPacketLoss=v));n.next=17;break;case 13:n.prev=13,n.t0=n.catch(9),s=!0,c=n.t0;case 17:n.prev=17,n.prev=18,a||null==u.return||u.return();case 20:if(n.prev=20,!s){n.next=23;break}throw c;case 23:return n.finish(20);case 24:return n.finish(17);case 25:return n.abrupt("return",i);case 26:case"end":return n.stop()}},n,this,[[9,13,17,25],[18,,20,24]])}))},t.getStatsLegacy=function(e,r){return n(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=function(){return new Promise(function(n,i){e.getPeerStats=window.getStats,e.getPeerStats(void 0,function(e){var i=Object.assign({},t.defaultStatsReport);i.pctype=r,i.timestamp=Date.now(),i.bandwidth=e.bandwidth.availableSendBandwidth,"send"===r?(i.videoBytes=e.video.bytesSent,i.audioBytes=e.audio.bytesSent):(i.videoBytes=e.video.bytesReceived,i.audioBytes=e.audio.bytesReceived),e.results.forEach(function(e){if("ssrc"===e.type&&"Channel-audio-1"===e.transportId){var t="audio"===e.mediaType,n=-1!==e.id.indexOf("_send"),o=e.packetsLost,a=e.packetsSent,s=e.packetsReceived;t&&n&&"send"===r?(i.audioPacketLoss=Number(o)||0,i.audioPackets=Number(a)||0):!t&&n&&"send"===r?(i.videoPacketLoss=Number(o)||0,i.videoPackets=Number(a)||0):t&&!n&&"recv"===r?(i.audioPacketLoss=Number(o)||0,i.audioPackets=Number(s)||0):t||n||"recv"!==r||(i.videoPacketLoss=Number(o)||0,i.videoPackets=Number(s)||0)}}),n(i)})})},n.next=3,i();case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},n,this)}))}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r(28),r(30),r(16),r(12),r(0),r(9);var i=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var o=r(35),a=r(24),s=r(114),c=r(18),u=r(19);function d(e){if(u.browserReport.minMaxWithIdeal)return e;return["video","screen"].forEach(function(t){"object"===n(e[t])&&"object"===n(e[t].width)&&e[t].width.ideal&&delete e[t].width.ideal,"object"===n(e[t])&&"object"===n(e[t].height)&&e[t].height.ideal&&delete e[t].height.ideal}),e}t.transferSignalingUserToUser=function(e){return{userId:e.playerid,published:!1}},t.transferRecordOptionToMediaConstraints=function(e){return i(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",{audio:{},video:{}});case 2:if(!o.REC_SCREEN_ENABLE(e)){t.next=13;break}if(!o.REC_VIDEO_ENABLE(e)){t.next=5;break}throw c.UNEXPECTED_ERROR("can not get mediaStream with video and screen are all enabled");case 5:if(u.browserReport.screenSharing){t.next=7;break}throw c.NOT_SUPPORT_ERROR("your browser can not share screen");case 7:if(!u.isChrome){t.next=13;break}return t.next=10,s.isChromeExtensionAvailable();case 10:if(t.sent){t.next=13;break}throw c.PLUGIN_NOT_AVALIABLE("");case 13:if(r=!(!e.audio||!e.audio.enabled||e.audio.buffer)&&{sampleRate:e.audio.sampleRate,sampleSize:e.audio.sampleSize,channelCount:e.audio.channelCount,autoGainControl:e.audio.autoGainControl,echoCancellation:e.audio.echoCancellation,noiseSuppression:e.audio.noiseSuppression},!e.audio||!e.audio.buffer||u.browserReport.mediaStreamDest){t.next=16;break}throw c.NOT_SUPPORT_ERROR("not support audio buffer input");case 16:if(n=!(!e.video||!e.video.enabled)&&{frameRate:e.video.frameRate,height:e.video.height,width:e.video.width},!e.screen){t.next=22;break}return t.next=20,s.getScreenConstraints(!1,e.screen);case 20:return i=t.sent,t.abrupt("return",d(a.removeUndefinedKey({audio:r,video:i})));case 22:return t.abrupt("return",d(a.removeUndefinedKey({audio:r,video:n})));case 23:case"end":return t.stop()}},t,this)}))},t.getNumberRangeMax=function(e){if(e)return"number"==typeof e?e:e.exact?e.exact:e.max?e.max:e.ideal?e.ideal:e.min?e.min:void 0}},function(e,t,r){"use strict";r(12),r(0),r(9);var n=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var i=r(19),o=r(113),a=r(13),s=r(18);window.addEventListener("message",function(e){e.origin===window.location.origin&&function(e){if("PermissionDeniedError"===e){if(d="PermissionDeniedError",u)return u("PermissionDeniedError");throw s.SCREEN_PERMISSION_DENIED()}"qnrtc:rtcmulticonnection-extension-loaded"===e&&(d="desktop");"rtcmulticonnection-extension-loaded"===e&&(a.log.warning("your chrome screen sharing plugin is not the latest version, or you have other screen sharing plugins."),!1);e.sourceId&&u&&u(c=e.sourceId,!0===e.canRequestAudioTrack)}(e.data)});var c,u,d="screen";function f(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u=e,t?window.postMessage("qnrtc:get-sourceId-screen","*"):r?window.postMessage("qnrtc:get-sourceId-window","*"):window.postMessage("qnrtc:get-sourceId","*")}function l(e){if(c)return e(c);u=e,window.postMessage("qnrtc:audio-plus-tab","*")}function h(e,t){return n(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.source,a=function(){return new Promise(function(r,a){var c={mozMediaSource:n||"window",mediaSource:n||"window",height:t.height,width:t.width};if(i.isFirefox)r(c);else{var u={mandatory:{chromeMediaSource:d,maxWidth:o.getNumberRangeMax(t.width),maxHeight:o.getNumberRangeMax(t.height)},optional:[]};"desktop"!==d?r(u):e?l(function(e,t){u.mandatory.chromeMediaSourceId=e,t&&(u.canRequestAudioTrack=!0),"PermissionDeniedError"!==e?r(u):a(s.SCREEN_PERMISSION_DENIED())}):f(function(e){u.mandatory.chromeMediaSourceId=e,"PermissionDeniedError"!==e?r(u):a(s.SCREEN_PERMISSION_DENIED())},"screen"===n,"window"===n)}})},r.next=4,a();case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r,this)}))}t.isChromeExtensionAvailable=function(){return n(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){return new Promise(function(e,t){"desktop"!==d?(window.postMessage("qnrtc:are-you-there","*"),setTimeout(function(){e("screen"!==d)},2e3)):e(!0)})},e.next=3,t();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}))},t.getScreenConstraintsWithAudio=function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(!0,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))},t.getScreenConstraints=h},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(34),r(12),r(0),r(9);var i=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var o=r(19),a=window.AudioContext||window.webkitAudioContext||window.Object;t.audioContext=new a,t.FFT_SIZE=2048,t.BUFFER_SIZE=4096,t.BUFFER_SAMPLE_RATE=t.audioContext.sampleRate,t.decodeAudioData=function(e){return i(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("suspended"!==t.audioContext.state){r.next=3;break}return r.next=3,t.audioContext.resume();case 3:return n=function(){return new Promise(function(r,n){t.audioContext.decodeAudioData(e,function(e){r(e)},function(e){n(e)})})},r.next=6,n();case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}))};var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"onAudioBuffer",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.BUFFER_SIZE;this.audioBufferCallback=e,this.audioBufferSize=r}},{key:"initAudioContext",value:function(){return i(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("suspended"!==t.audioContext.state){e.next=3;break}return e.next=3,t.audioContext.resume();case 3:this.analyserNode=t.audioContext.createAnalyser(),this.analyserNode.fftSize=t.FFT_SIZE,this.gainNode=t.audioContext.createGain(),o.browserReport.mediaStreamDest&&(this.audioStream=t.audioContext.createMediaStreamDestination()),this.initScriptNode(t.BUFFER_SIZE);case 8:case"end":return e.stop()}},e,this)}))}},{key:"setMediaStreamSource",value:function(e){this.audioSource=t.audioContext.createMediaStreamSource(e),this.connect()}},{key:"setAudioBufferSource",value:function(){this.audioSource=t.audioContext.createBufferSource(),this.connect()}},{key:"updateAudioBuffer",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.BUFFER_SAMPLE_RATE;this.audioSource instanceof AudioBufferSourceNode&&(this.audioSource.buffer=e,this.audioSource.start())}},{key:"release",value:function(){this.audioSource.disconnect(),this.gainNode.disconnect()}},{key:"connect",value:function(){this.audioSource.connect(this.analyserNode),this.audioSource.connect(this.scriptNode),this.audioSource.connect(this.gainNode),this.audioStream&&this.gainNode.connect(this.audioStream)}},{key:"handleAudioBuffer",value:function(e){var t=e.inputBuffer;this.audioBufferCallback&&this.audioBufferCallback(t)}},{key:"initScriptNode",value:function(e){this.scriptNode=t.audioContext.createScriptProcessor(e,1,1),this.scriptNode.onaudioprocess=this.handleAudioBuffer.bind(this),this.scriptNode.connect(t.audioContext.destination)}}]),e}();t.AudioManager=s},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}r(0),Object.defineProperty(t,"__esModule",{value:!0}),r(117),n(r(60)),n(r(118)),n(r(35)),n(r(185)),n(r(84));var i=r(13);t.log=i.log;var o=r(19);t.browserReport=o.browserReport;var a=r(115);t.decodeAudioData=a.decodeAudioData;var s=r(114);t.isChromeExtensionAvailable=s.isChromeExtensionAvailable},function(e,t,r){"use strict";window.getStats=function(e,t,r){var n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var i={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:((navigator.connection||{}).type||"unknown").toString().toLowerCase(),systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){s=!0}},o={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(i.isOfferer=e.googInitiator)}},a=this;if(arguments[0]instanceof n){if(a=arguments[0],navigator.mozGetUserMedia&&(e=arguments[1],t=arguments[2],r=arguments[3]),!(e instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack."}else if(!(e instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";var s=!1;o.datachannel=function(e){"datachannel"===e.type&&(i.datachannel={state:e.state})},o.googCertificate=function(e){"googCertificate"==e.type&&(i.encryption=e.googFingerprintAlgorithm)};var c=["opus","isac","ilbc"];o.checkAudioTracks=function(e){if(e.googCodecName&&"audio"===e.mediaType&&-1!==c.indexOf(e.googCodecName.toLowerCase())){var t=e.id.split("_").pop();if(-1===i.audio[t].codecs.indexOf(e.googCodecName)&&i.audio[t].codecs.push(e.googCodecName),e.bytesSent){var r=0;if(e.bytesSent){i.internal.audio[t].prevBytesSent||(i.internal.audio[t].prevBytesSent=e.bytesSent);var n=e.bytesSent-i.internal.audio[t].prevBytesSent;i.internal.audio[t].prevBytesSent=e.bytesSent,r=n/1024}i.audio[t].availableBandwidth=r.toFixed(1)}if(e.bytesReceived){r=0;if(e.bytesReceived){i.internal.audio[t].prevBytesReceived||(i.internal.audio[t].prevBytesReceived=e.bytesReceived);n=e.bytesReceived-i.internal.audio[t].prevBytesReceived;i.internal.audio[t].prevBytesReceived=e.bytesReceived,r=n/1024}i.audio[t].availableBandwidth=r.toFixed(1)}-1===i.audio[t].tracks.indexOf(e.googTrackId)&&i.audio[t].tracks.push(e.googTrackId)}};var u=["vp9","vp8","h264"];o.checkVideoTracks=function(e){if(e.googCodecName&&"video"===e.mediaType&&-1!==u.indexOf(e.googCodecName.toLowerCase())){var t=e.id.split("_").pop();if(-1===i.video[t].codecs.indexOf(e.googCodecName)&&i.video[t].codecs.push(e.googCodecName),e.bytesSent){var r=0;i.internal.video[t].prevBytesSent||(i.internal.video[t].prevBytesSent=e.bytesSent);var n=e.bytesSent-i.internal.video[t].prevBytesSent;i.internal.video[t].prevBytesSent=e.bytesSent,r=n/1024}if(e.bytesReceived){r=0;i.internal.video[t].prevBytesReceived||(i.internal.video[t].prevBytesReceived=e.bytesReceived);n=e.bytesReceived-i.internal.video[t].prevBytesReceived;i.internal.video[t].prevBytesReceived=e.bytesReceived,r=n/1024}i.video[t].availableBandwidth=r.toFixed(1),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(i.resolutions[t].width=e.googFrameWidthReceived,i.resolutions[t].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(i.resolutions[t].width=e.googFrameWidthSent,i.resolutions[t].height=e.googFrameHeightSent),-1===i.video[t].tracks.indexOf(e.googTrackId)&&i.video[t].tracks.push(e.googTrackId)}},o.bweforvideo=function(e){"VideoBwe"===e.type&&(i.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,i.bandwidth.googActualEncBitrate=e.googActualEncBitrate,i.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,i.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,i.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,i.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,i.bandwidth.googBucketDelay=e.googBucketDelay,i.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},o.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type){if("true"==e.googActiveConnection)Object.keys(i.internal.candidates).forEach(function(t){var r=i.internal.candidates[t];-1!==r.ipAddress.indexOf(e.googLocalAddress)&&(i.connectionType.local.candidateType=r.candidateType,i.connectionType.local.ipAddress=r.ipAddress,i.connectionType.local.networkType=r.networkType,i.connectionType.local.transport=r.transport),-1!==r.ipAddress.indexOf(e.googRemoteAddress)&&(i.connectionType.remote.candidateType=r.candidateType,i.connectionType.remote.ipAddress=r.ipAddress,i.connectionType.remote.networkType=r.networkType,i.connectionType.remote.transport=r.transport)}),i.connectionType.transport=e.googTransportType,(t=i.internal.candidates[e.localCandidateId])&&t.ipAddress&&(i.connectionType.systemIpAddress=t.ipAddress),(r=i.internal.candidates[e.remoteCandidateId])&&r.ipAddress&&(i.connectionType.systemIpAddress=r.ipAddress);if("candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=i.internal.candidates[e.remoteCandidateId],r=i.internal.candidates[e.remoteCandidateId]}};var d={},f={},l={},h={};o.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(d[e.id]||(d[e.id]=[]),f[e.id]||(f[e.id]=[]),l[e.id]||(l[e.id]=[]),h[e.id]||(h[e.id]=[]),e.candidateType&&-1===d[e.id].indexOf(e.candidateType)&&d[e.id].push(e.candidateType),e.transport&&-1===f[e.id].indexOf(e.transport)&&f[e.id].push(e.transport),e.ipAddress&&-1===l[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&l[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===h[e.id].indexOf(e.networkType)&&h[e.id].push(e.networkType),i.internal.candidates[e.id]={candidateType:d[e.id],ipAddress:l[e.id],portNumber:e.portNumber,networkType:h[e.id],priority:e.priority,transport:f[e.id],timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.local.candidateType=d[e.id],i.connectionType.local.ipAddress=l[e.id],i.connectionType.local.networkType=h[e.id],i.connectionType.local.transport=f[e.id])};var p={},v={},m={},g={};o.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(p[e.id]||(p[e.id]=[]),v[e.id]||(v[e.id]=[]),m[e.id]||(m[e.id]=[]),g[e.id]||(g[e.id]=[]),e.candidateType&&-1===p[e.id].indexOf(e.candidateType)&&p[e.id].push(e.candidateType),e.transport&&-1===v[e.id].indexOf(e.transport)&&v[e.id].push(e.transport),e.ipAddress&&-1===m[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&m[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===g[e.id].indexOf(e.networkType)&&g[e.id].push(e.networkType),i.internal.candidates[e.id]={candidateType:p[e.id],ipAddress:m[e.id],portNumber:e.portNumber,networkType:g[e.id],priority:e.priority,transport:v[e.id],timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.remote.candidateType=p[e.id],i.connectionType.remote.ipAddress=m[e.id],i.connectionType.remote.networkType=g[e.id],i.connectionType.remote.transport=v[e.id])},o.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(i[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(i[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))};var y={audio:{send:[],recv:[]},video:{send:[],recv:[]}};o.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===y[e.mediaType][t].indexOf(e.ssrc)&&y[e.mediaType][t].push(e.ssrc),i[e.mediaType][t].streams=y[e.mediaType][t].length}},function n(){!function(t){void 0!==window.InstallTrigger?a.getStats(e,function(e){var r=[];e.forEach(function(e){r.push(e)}),t(r)},t):a.getStats(function(e){var r=[];e.result().forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),t(r)})}(function(e){e.forEach(function(e){Object.keys(o).forEach(function(t){"function"==typeof o[t]&&o[t](e)}),"local-candidate"!==e.type&&"remote-candidate"!==e.type&&e.type});try{-1!==a.iceConnectionState.search(/failed/gi)&&(s=!0)}catch(e){s=!0}!0===s&&(i.datachannel&&(i.datachannel.state="close"),i.ended=!0),i.results=e,i.audio&&i.video&&(i.bandwidth.speed=i.audio.bytesSent-i.bandwidth.helper.audioBytesSent+(i.video.bytesSent-i.bandwidth.helper.videoBytesSent),i.bandwidth.helper.audioBytesSent=i.audio.bytesSent,i.bandwidth.helper.videoBytesSent=i.video.bytesSent),t(i),s||void 0!=typeof r&&r&&setTimeout(n,r||1e3)})}()}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r(28),r(30),r(122),r(52),r(53),r(69),r(70),r(22),r(55),r(16),r(23),r(33),r(93),r(34),r(43),r(44),r(74),r(56),r(12),r(0),r(9);var u=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),r(136);var d,f=r(80),l=r(148),h=r(150),p=r(183),v=r(84),m=r(58),g=r(13),y=r(184),b=r(24),S=r(19),w=r(18),_=r(35);!function(e){e[e.Idle=0]="Idle",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.Reconnecting=3]="Reconnecting"}(d=t.RoomState||(t.RoomState={}));var E=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?c(e):t}(this,a(t).call(this))).mergeJobMerger={},e.mergeJobs=[],e.streamInfo=[],e.users=[],e.subscribedUsers={},e._roomState=d.Idle,m.qos.addEvent(1),b.getLocalIp().then(function(t){return e.localIp=t}).catch(function(e){g.log.warning("get local ip error",e)}),window.session=c(c(e)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,f),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(t,[{key:"joinRoomWithToken",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.roomState===d.Reconnecting){r.next=4;break}if(this.roomState===d.Idle){r.next=3;break}throw w.UNEXPECTED_ERROR("roomState is not idle! Do not repeat join room, please run leaveRoom first");case 3:this.roomState=d.Connecting;case 4:if(r.prev=4,m.qos.addEvent(3,{room_token:e}),this.joinStartTime=Date.now(),this.roomToken=e,n=b.getRoomAccessFromToken(e),this.roomAccess=n,this.userId=n.userId,this.roomName=n.roomName,this.appId=n.appId,g.log.log("join room, token:",e),g.log.debug("join room, roomName: ".concat(this.roomName,", userId: ").concat(this.userId)),this.roomName.match(/^[a-zA-Z0-9_-]{3,64}$/)){r.next=18;break}throw this.roomState=d.Idle,w.UNEXPECTED_ERROR("invalid roomname. roomname must match /^[a-zA-Z0-9_-]{3,64}$/");case 18:if(this.userId.match(/^[a-zA-Z0-9_-]{3,50}$/)){r.next=21;break}throw this.roomState=d.Idle,w.UNEXPECTED_ERROR("invalid userId. userId must match /^[a-zA-Z0-9_-]{3,50}$/");case 21:return i=Date.now(),o={auth_start_time:i,auth_dns_time:0,auth_end_time:i-this.joinStartTime,auth_server_ip:h.RTC_HOST,auth_error_code:0,auth_error_message:"",auth_take_time:0,local_ip:this.localIp,room_token:e,access_token:""},r.prev=23,r.next=26,h.getAccessToken(n,e);case 26:this.accessToken=r.sent,r.next=34;break;case 29:throw r.prev=29,r.t0=r.catch(23),r.t0.code?(o.auth_error_code=-1,o.auth_error_message=r.t0.toString()):(o.auth_error_code=r.t0.code,o.auth_error_message=r.t0.error),m.qos.addEvent(4,o),r.t0;case 34:return o.auth_end_time=Date.now()-i,o.auth_take_time=Date.now()-i,o.access_token=this.accessToken,m.qos.addEvent(4,o),r.next=40,this.joinRoomWithAccess(this.accessToken,t);case 40:return r.abrupt("return",r.sent);case 43:throw r.prev=43,r.t1=r.catch(4),this.roomState=d.Idle,r.t1;case 47:case"end":return r.stop()}},r,this,[[4,43],[23,29]])}))}},{key:"joinRoomWithAccess",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,o,a,s,c=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=b.getPayloadFromJwt(e),m.qos.init(this.roomAccess,n).then(b.noop).catch(b.noop),this.signaling=new p.SignalingWS(n.signalingurl,e),this.signaling.on("on-player-in",this.handlePlayerIn.bind(this)),this.signaling.on("on-player-out",this.handlePlayerOut.bind(this)),this.signaling.on("on-add-stream",this.handleAddStream.bind(this)),this.signaling.on("on-remove-stream",this.handleRemoveStream.bind(this)),this.signaling.on("disconnect",this.handleDisconnect.bind(this)),this.signaling.on("mute-stream",this.handleMute.bind(this)),this.signaling.on("ws-disconnect",this.reconnect.bind(this)),g.log.log("init signaling websocket"),this.signaling.initWs(),i=Date.now(),o={auth_start_time:i,auth_dns_time:0,auth_end_time:i-this.joinStartTime,auth_server_ip:this.signaling.ws.url,auth_error_code:0,auth_error_message:"",auth_take_time:0,local_ip:this.localIp,access_token:e},a=function(){return new Promise(function(e,t){c.signaling.once("auth-res-init",function(r){var n=r;n.error&&t(w.JOIN_ROOM_ERROR(n.code,n.error)),e(n)})})},r.prev=15,r.next=18,a();case 18:return s=r.sent,o.auth_take_time=Date.now()-i,this.roomState=d.Connected,this.handleAuth(s,t),m.qos.addEvent(5,o),g.log.log("room current users",this.users),r.abrupt("return",this.users);case 27:throw r.prev=27,r.t0=r.catch(15),r.t0.code?(o.auth_error_code=r.t0.code,o.auth_error_message=r.t0.error):(o.auth_error_code=-3,o.auth_error_message=r.t0.toString()),m.qos.addEvent(5,o),r.t0;case 32:case"end":return r.stop()}},r,this,[[15,27]])}))}},{key:"publish",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(){return new Promise(function(t){e.onConnectStatusChange=function(r,n){n===_.StreamConnectStatus.Connect&&(g.log.debug("publish status change resolve",e),t())}})},t.next=3,Promise.race([r(),this._publish(e)]);case 3:return e.onConnectStatusChange=void 0,t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}))}},{key:"_publish",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,o,a,s,c,u,f=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.roomState===d.Connected){r.next=2;break}throw w.UNEXPECTED_ERROR("not connected to the room, please run joinRoom first");case 2:return n=this.signaling,g.log.debug("start publish",e,t),this.stream=e,e.connectStatus=_.StreamConnectStatus.Connecting,r.prev=6,i=Date.now(),r.next=10,b.sendMsgWaitResponse(n,"pub",{"enable-audio":e.enableAudio,"enable-video":e.enableVideo,presid:t},"pub-res");case 10:if(o=r.sent,e.userId=this.userId,e.streamId=o.streamid,a=b.getPublishQos(e,o.code,Date.now()-i),!o.error){r.next=22;break}if(10052!==o.code){r.next=20;break}return e.connectStatus=_.StreamConnectStatus.Idle,r.next=19,this._publish(e,t);case 19:return r.abrupt("return",r.sent);case 20:throw m.qos.addEvent(7,a),w.PUBLISH_ERROR(o.code,o.error);case 22:return this.signaling.sendWsMsg("mute-stream",{streamid:e.streamId,"mute-audio":e.muteAudio,"mute-video":e.muteVideo}),s=Date.now(),r.next=26,this.createLocalConnection(e);case 26:return e.connectStatus=_.StreamConnectStatus.Connect,a.ice_take_time=Date.now()-s,a.ice_connect_state=this.localRTCPeerConnection.iceConnectionState,m.qos.addEvent(7,a),(c=b.getElementFromArray(this.users,"userId",this.stream.userId))&&(c.published=!0,c.stream=this.stream),(u=this.getAllMerger()).length>0&&!t?u.forEach(function(e){e.handleAddStream(f.stream.userId)}):u.length>0&&t&&u.forEach(function(e){e.handleRemoveStream(f.stream.userId),e.handleAddStream(f.stream.userId)}),m.qos.addMediaTask(this.stream),r.abrupt("return",this.stream);case 38:throw r.prev=38,r.t0=r.catch(6),e.connectStatus=_.StreamConnectStatus.Idle,r.t0;case 42:case"end":return r.stop()}},r,this,[[6,38]])}))}},{key:"republish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.roomState===d.Connected){r.next=3;break}return g.log.warning("room state is not connected, can not republish"),r.abrupt("return");case 3:if(this.stream&&!this.stream.isDestroyed){r.next=5;break}return r.abrupt("return");case 5:if(t||this.stream.connectStatus!==_.StreamConnectStatus.Connecting){r.next=8;break}return g.log.debug("cancel republish"),r.abrupt("return");case 8:return g.log.debug("republish"),this.stream.releasePC(),r.next=12,this._publish(this.stream,e||this.stream.streamId);case 12:this.emit("republish");case 13:case"end":return r.stop()}},r,this)}))}},{key:"unpublish",value:function(e){var t=this;if(this.roomState!==d.Connected)throw w.UNEXPECTED_ERROR("not connected to the room");var r=function(e){var r=Date.now();b.sendMsgWaitResponse(t.signaling,"unpub",{streamid:e},"unpub-res").then(function(t){m.qos.addEvent(8,{result_code:t.code,stream_id:e,signal_take_time:Date.now()-r}),t.error&&g.log.warning(w.UNPUBLISH_ERROR(t.code,t.error))})};if(!this.stream){if(e)return void r(e);throw w.UNEXPECTED_ERROR("can not find publish stream, please run publish first")}g.log.debug("unpublish");var n=this.stream.streamId;this.stream.connectStatus=_.StreamConnectStatus.Idle;var i=b.getElementFromArray(this.users,"userId",this.stream.userId);i&&(i.published=!1,i.stream=void 0),this.stream.release(),this.stream=void 0;var o=this.getAllMerger();o.length>0&&this.userId&&o.forEach(function(e){e.handleRemoveStream(t.userId)}),r(n)}},{key:"createMergeJob",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.roomState===d.Connected){r.next=2;break}throw w.UNEXPECTED_ERROR("can not createMergeJob, room state is not connected");case 2:return n=Object.assign({},_.defaultMergeJob,t,{id:e}),g.log.debug("send create merge job",n,e),this.signaling.mergeJobIndex+=1,r.next=7,b.sendMsgWaitResponse(this.signaling,"create-merge-job",n,"create-merge-job-res-".concat(this.signaling.mergeJobIndex));case 7:if(0===(i=r.sent).code){r.next=10;break}throw w.CREATE_MERGE_JOB_ERROR(i.code,i.error);case 10:-1===this.mergeJobs.indexOf(e)&&this.mergeJobs.push(e);case 11:case"end":return r.stop()}},r,this)}))}},{key:"setMergeStreamLayout",value:function(e,t){if(this.roomState!==d.Connected)throw w.UNEXPECTED_ERROR("can not setMergeOption, room state is not connected");if(t.id&&-1===this.mergeJobs.indexOf(t.id))throw w.NO_MERGE_JOB(t.id);var r=null;if(e===this.userId){if(!this.stream||this.stream.isDestroyed)return void g.log.warning("can not setMergeOption, user ".concat(e," is published ?"));r=this.stream.streamId}else{var n=b.getElementFromArray(this.streamInfo,"playerid",e),i=b.getElementFromArray(this.users,"userId",e);if(!n||!i||!i.published)return void g.log.warning("can not setMergeOption, user ".concat(e," is published ?"));r=n.streamid}var o=t;o.hidden=!!t.hidden,o.muted=!!t.muted,!1===t.visible&&(o.hidden=!0),m.qos.addFeature("merge_stream"),this.signaling.sendWsMsg("set-merge-opt",Object.assign({streamid:r},o)),g.log.debug("set merge stream, userId: ".concat(e,", data:"),t)}},{key:"stopMergeStream",value:function(e){if(this.roomState!==d.Connected)throw w.UNEXPECTED_ERROR("can not stopMergeOption, room state is not connected");if(e){this.mergeJobMerger[e]&&(this.mergeJobMerger[e].release(),delete this.mergeJobMerger[e]);var t=this.mergeJobs.indexOf(e);if(-1===t)throw w.NO_MERGE_JOB(e);this.mergeJobs=this.mergeJobs.slice(0,t).concat(this.mergeJobs.slice(t+1,this.mergeJobs.length))}else this.merger&&(this.merger.release(),this.merger=void 0);this.signaling.sendWsMsg("stop-merge",{id:e}),g.log.debug("stop merge stream")}},{key:"setDefaultMergeStream",value:function(e,t,r){this.merger&&!r&&(this.merger.release(),this.merger=void 0),r&&this.mergeJobMerger[r]&&(this.mergeJobMerger[r].release(),delete this.mergeJobMerger[r]),r?this.mergeJobMerger[r]=new y.Merger(e,t,this,r):this.merger=new y.Merger(e,t,this)}},{key:"subscribe",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.subscribedUsers[e]||(this.subscribedUsers[e]=new v.Stream(void 0,void 0,e)),n=this.subscribedUsers[e],i=function(){return new Promise(function(e){n.onConnectStatusChange=function(t,r){r===_.StreamConnectStatus.Connect&&e()}})},r.next=5,Promise.race([i(),this._subscribe(e,t)]);case 5:return n.onConnectStatusChange=void 0,r.abrupt("return",n);case 7:case"end":return r.stop()}},r,this)}))}},{key:"_subscribe",value:function(e,t,r){return u(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,o,a,s,c,u,f,l,h,p;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.roomState===d.Connected){n.next=2;break}throw w.UNEXPECTED_ERROR("can not connected to the room, please joinRoom first");case 2:if(e!==this.userId){n.next=4;break}throw w.SUB_ERROR(10044,"can not subscribe yourself");case 4:if(i=b.getElementFromArray(this.streamInfo,"playerid",e),o=b.getElementFromArray(this.users,"userId",e),t||i&&o){n.next=8;break}throw w.SUB_ERROR_NO_STREAM(e);case 8:if(o){n.next=10;break}throw w.SUB_ERROR_NO_USER(e);case 10:if(this.subscribedUsers[e]){n.next=14;break}this.subscribedUsers[e]=new v.Stream(void 0,void 0,e),n.next=17;break;case 14:if(r||!this.subscribedUsers[e].connId){n.next=17;break}return g.log.warning("duplicate subscriptions, userId",e),n.abrupt("return",this.subscribedUsers[e]);case 17:if(a=i?i.streamid:void 0,c={},u=0,g.log.debug("subscribe",e),!i){n.next=38;break}return f=Date.now(),this.subscribedUsers[e].connectStatus=_.StreamConnectStatus.Connecting,n.next=25,b.sendMsgWaitResponse(this.signaling,"sub",{streamid:a},"sub-res-".concat(a));case 25:if(c=n.sent,u=Date.now()-f,!c.error){n.next=37;break}if((l=b.getSubscribeQos(null,c.code,u)).user_id=e,l.stream_id=a,l.conn_id=c.connid,m.qos.addEvent(9,l),10052!==c.code){n.next=37;break}return n.next=36,this._subscribe(e,t,r);case 36:return n.abrupt("return",n.sent);case 37:s=c.connid;case 38:if(this.subscribedUsers[e].streamId=a,this.subscribedUsers[e].connId=s,this.subscribedUsers[e].continuous=t,!i){n.next=61;break}return this.subscribedUsers[e].setMute(i["mute-audio"],i["mute-video"]),this.subscribedUsers[e].setEnable(i["enable-audio"],i["enable-video"]),h=b.getSubscribeQos(this.subscribedUsers[e],c.code,u),p=Date.now(),n.prev=46,n.next=49,this.createRemoteConnection(e);case 49:this.subscribedUsers[e].connectStatus=_.StreamConnectStatus.Connect,r&&this.emit("resubscribe",e),h.ice_take_time=Date.now()-p,this.subscribedUsers[e]&&this.subscribedUsers[e].pc&&(h.ice_connect_state=this.subscribedUsers[e].pc.iceConnectionState),m.qos.addEvent(9,h),m.qos.addMediaTask(this.subscribedUsers[e]),n.next=61;break;case 57:throw n.prev=57,n.t0=n.catch(46),this.subscribedUsers[e].connectStatus=_.StreamConnectStatus.Idle,n.t0;case 61:return o.stream=this.subscribedUsers[e],n.abrupt("return",this.subscribedUsers[e]);case 63:case"end":return n.stop()}},n,this,[[46,57]])}))}},{key:"resubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i,o,a,s,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.roomState===d.Connected){r.next=3;break}return g.log.warning("room state is not connected, can not resubscribe"),r.abrupt("return");case 3:if(n=b.getElementFromArray(this.streamInfo,"playerid",e),(i=this.subscribedUsers[e])&&n){r.next=7;break}return r.abrupt("return");case 7:if(t||i.connectStatus!==_.StreamConnectStatus.Connecting){r.next=10;break}return g.log.debug("cancel resubscribe, userId",e),r.abrupt("return");case 10:return i.continuous?g.log.debug("continous subscribe, userId",e):g.log.debug("resubscribe, userId",e),o=Date.now(),i.releasePC(),i.connectStatus=_.StreamConnectStatus.Connecting,r.prev=14,r.next=17,b.sendMsgWaitResponse(this.signaling,"sub",{streamid:n.streamid},"sub-res-".concat(n.streamid));case 17:if(a=r.sent,s=b.getSubscribeQos(i,a.code,Date.now()-o),!a.error){r.next=27;break}if(10052!==a.code){r.next=25;break}return i.connectStatus=_.StreamConnectStatus.Idle,r.next=24,this.resubscribe(e,t);case 24:return r.abrupt("return",r.sent);case 25:throw m.qos.addEvent(9,s),w.SUB_ERROR(a.code,a.error);case 27:return i.connId=a.connid,i.streamId=n.streamid,c=Date.now(),i.setMute(n["mute-audio"],n["mute-video"]),i.setEnable(n["enable-audio"],n["enable-video"]),r.next=34,this.createRemoteConnection(e);case 34:i.connectStatus=_.StreamConnectStatus.Connect,this.emit("resubscribe",e),s.ice_take_time=Date.now()-c,this.subscribedUsers[e]&&this.subscribedUsers[e].pc&&(s.ice_connect_state=this.subscribedUsers[e].pc.iceConnectionState),m.qos.addEvent(9,s),r.next=45;break;case 41:throw r.prev=41,r.t0=r.catch(14),i.connectStatus=_.StreamConnectStatus.Idle,r.t0;case 45:case"end":return r.stop()}},r,this,[[14,41]])}))}},{key:"unsubscribe",value:function(e){var t=this.subscribedUsers[e];if(t&&this.roomState===d.Connected){var r=t.streamId;g.log.debug("unsubscribe",e),t.connectStatus=_.StreamConnectStatus.Idle,this.subscribedUsers[e].release();var n=b.getElementFromArray(this.users,"userId",e);n&&(n.stream=void 0),delete this.subscribedUsers[e];var i=Date.now();b.sendMsgWaitResponse(this.signaling,"unsub",{streamid:r,connid:t.connId},"unsub-res-".concat(r)).then(function(n){m.qos.addEvent(10,{user_id:e,result_code:n.code,stream_id:r,conn_id:t.connId,signal_take_time:Date.now()-i}),n.error&&g.log.warning(w.UNSUB_ERROR(n.code,n.error))})}else g.log.warning(w.UNEXPECTED_ERROR("can not find connid or can not connected to the room, please run subscribe first"))}},{key:"mute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.roomState!==d.Connected||!this.stream)throw w.UNEXPECTED_ERROR("no strem or signaling model, please run publish first");g.log.log("muteAudio",e,"muteVideo",t),this.stream.setMute(e,t),this.signaling.sendWsMsg("mute-stream",{streamid:this.stream.streamId,"mute-audio":e,"mute-video":t}),m.qos.addEvent(11,{mute_flag:e?1:0}),m.qos.addEvent(12,{mute_flag:t?1:0}),e&&m.qos.addFeature("mute_audio"),t&&m.qos.addFeature("mute_video")}},{key:"kickoutUser",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return g.log.log("kickoutUser",e),m.qos.addFeature("kickout_user"),t.next=4,this.control("kickplayer",e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"leaveRoom",value:function(){this.roomState!==d.Connected&&g.log.warning("can not leave room, your room state is not connected"),g.log.log("leave room"),m.qos.addEvent(6,{leave_reason_code:0}),this.signaling.sendWsMsg("disconnect",{}),this.releaseRoom()}},{key:"createRemoteConnection",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,o,a,s,c,f,l,h,p,v=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.roomState===d.Connected){t.next=2;break}throw w.UNEXPECTED_ERROR("can not connected to the room, please run joinRoom first");case 2:if(r={},S.browserReport.unifiedPlan&&(r.sdpSemantics="unified-plan"),n=new RTCPeerConnection(r),(o=this.subscribedUsers[e]).setReconnect(void 0,this.resubscribe.bind(this)),o.streamId){t.next=9;break}throw w.UNEXPECTED_ERROR("no streamId");case 9:return a=function(){return u(v,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(b.checkPcConnect(o.pc)){t.next=10;break}return g.log.warning("subscribe p2p disconected, userId: ".concat(e,", reconnecting")),t.prev=2,t.next=5,this.resubscribe(e);case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),this.emit("error",t.t0);case 10:case"end":return t.stop()}},t,this,[[2,7]])}))},s=new Promise(function(e){n.ontrack=function(t){e(t.streams[0])}}),c=new Promise(function(t,r){if(!v.signaling)throw w.UNEXPECTED_ERROR("no signaling model");v.signaling.once("webrtc-icestate-connid-".concat(o.connId),function(n){n.connected?(g.log.debug("ice: success.","subscribe",e),t(n.connected)):r(!1)})}),f=b.createP2PConnection(n,this.signaling,{stream:o,connid:o.connId}),t.prev=13,t.next=16,Promise.all([s,c,f]);case 16:return l=t.sent,h=i(l,1),p=h[0],t.next=21,o.setMediaStream(p);case 21:b.handlePcRemoteIceStateChange(this.signaling,o),S.browserReport.connectionState?n.onconnectionstatechange=a:n.oniceconnectionstatechange=a,o.initTrackEvent(),t.next=33;break;case 26:return t.prev=26,t.t0=t.catch(13),g.log.warning(t.t0),!1===t.t0&&g.log.warning("subscribe ice not connected, resubscribe, userId",o.userId),o.connectStatus=_.StreamConnectStatus.Idle,t.next=33,this.resubscribe(o.userId);case 33:case"end":return t.stop()}},t,this,[[13,26]])}))}},{key:"createLocalConnection",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,i,o,a,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.stream&&this.roomState===d.Connected){t.next=2;break}throw w.UNEXPECTED_ERROR("no stream or not connected to the room, please run publish first");case 2:return e.setReconnect(this.republish.bind(this)),r={},S.browserReport.unifiedPlan&&(r.sdpSemantics="unified-plan"),this.localRTCPeerConnection=new RTCPeerConnection(r),n=this.localRTCPeerConnection,i=function(){return u(s,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b.checkPcConnect(this.localRTCPeerConnection)){e.next=10;break}return g.log.warning("publish p2p diconnected, reconnecting"),e.prev=2,e.next=5,this.republish();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),this.emit("error",e.t0);case 10:case"end":return e.stop()}},e,this,[[2,7]])}))},o=new Promise(function(t,r){s.stream?s.signaling.once("webrtc-icestate-stream-".concat(s.stream.streamId),function(n){n.connected?(g.log.debug("ice: success.","publish",e.userId),t(n.connected)):r(!1)}):t(!1)}),a=b.createP2PConnection(n,this.signaling,{stream:this.stream,connid:""}),t.prev=10,t.next=13,Promise.all([o,a]);case 13:return b.handlePcRemoteIceStateChange(this.signaling,this.stream),S.browserReport.connectionState?n.onconnectionstatechange=i:n.oniceconnectionstatechange=i,t.abrupt("return");case 18:return t.prev=18,t.t0=t.catch(10),g.log.warning(t.t0),!1===t.t0&&g.log.warning("publish ice not connected, republish"),this.stream.connectStatus=_.StreamConnectStatus.Idle,t.next=25,this.republish();case 25:case"end":return t.stop()}},t,this,[[10,18]])}))}},{key:"control",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.roomState===d.Connected){r.next=2;break}throw w.UNEXPECTED_ERROR("can not connected to the room, please run joinRoom first");case 2:return n=Date.now(),r.next=5,b.sendMsgWaitResponse(this.signaling,"control",{command:e,playerid:t},"control-res-".concat(e,"-").concat(t));case 5:if(i=r.sent,m.qos.addEvent(14,{user_id:t,result_code:i.code,signal_take_time:Date.now()-n}),!i.error){r.next=9;break}throw w.CONTROL_ERROR(i.code,i.error);case 9:case"end":return r.stop()}},r,this)}))}},{key:"handlePlayerOut",value:function(e){var t=b.removeElementFromArray(this.users,"userId",e.playerid);this.users=t.newArray,t.removeElement&&(this.subscribedUsers[e.playerid]&&(this.subscribedUsers[e.playerid].release(),delete this.subscribedUsers[e.playerid]),g.log.debug("user-leave",t.removeElement),this.emit("user-leave",t.removeElement))}},{key:"handlePlayerIn",value:function(e){var t=b.transferSignalingUserToUser(e);this.users.push(t),this.users=l(this.users,"userId"),g.log.debug("user-join",t),this.emit("user-join",t)}},{key:"handleAddStream",value:function(e){var t=this,r=Object.assign({},e,{"mute-audio":!1,"mute-video":!1});this.streamInfo.push(r),this.streamInfo=l(this.streamInfo,"streamid");var n=b.getElementFromArray(this.users,"userId",r.playerid);n&&(this.subscribedUsers[n.userId]&&this.subscribedUsers[n.userId].continuous&&this.resubscribe(n.userId).then().catch(function(e){t.emit("error",e)}),n.published=!0,g.log.debug("user-publish",n),this.emit("user-publish",n))}},{key:"handleRemoveStream",value:function(e){var t=b.removeElementFromArray(this.streamInfo,"streamid",e.streamid);if(this.streamInfo=t.newArray,t.removeElement){var r=b.getElementFromArray(this.users,"userId",t.removeElement.playerid);r&&(this.subscribedUsers[r.userId]&&(this.subscribedUsers[r.userId].continuous?(this.subscribedUsers[r.userId].connectStatus=_.StreamConnectStatus.Idle,this.subscribedUsers[r.userId].releaseTrack()):(this.subscribedUsers[r.userId].release(),delete this.subscribedUsers[r.userId])),r.published=!1,r.stream=void 0,g.log.debug("user-unpublish",r,e.unpubed),this.emit("user-unpublish",r))}}},{key:"handleMute",value:function(e){var t={userId:e.playerid,streamId:e.streamid,muteAudio:e["mute-audio"],muteVideo:e["mute-video"]},r=b.getElementFromArray(this.streamInfo,"streamid",e.streamid),n=b.getElementFromArray(this.subscriptionArray,"userId",e.playerid);r&&(r["mute-audio"]=t.muteAudio,r["mute-video"]=t.muteVideo),n&&n.setMute(t.muteAudio,t.muteVideo),g.log.log("user-mute",t),this.emit("mute",t)}},{key:"handleDisconnect",value:function(e){switch(this.emit("disconnect"),e.code){case 10006:this.emit("kicked",e.kickedid)}m.qos.addEvent(6,{leave_reason_code:e.code}),this.releaseRoom()}},{key:"handleAuth",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.reconntoken=e.reconntoken,e.streams=e.streams||[],e.players=e.players||[];var n={join:[],leave:[],publish:[],unpublish:[],mute:[]};if(r)this.streamInfo=e.streams||[],this.users=e.players.map(function(e){var r=b.getElementFromArray(t.streamInfo,"playerid",e.playerid),n=b.transferSignalingUserToUser(e);return r&&(n.published=!0,t.subscribedUsers[n.userId]&&(t.subscribedUsers[n.userId].streamId=r.streamid,t.subscribedUsers[n.userId].setEnable(r["enable-audio"],r["enable-video"]),t.subscribedUsers[n.userId].setMute(r["mute-audio"],r["mute-video"]))),n})||[];else{var i=this.users.map(function(e){return e.userId}),o=e.players.map(function(e){return e.playerid});(n=b.getMissingUserEvent(this.userId,this.streamInfo,e.streams,i,o)).unpublish.forEach(this.handleRemoveStream.bind(this)),n.leave.forEach(this.handlePlayerOut.bind(this)),n.join.forEach(this.handlePlayerIn.bind(this)),n.publish.forEach(this.handleAddStream.bind(this)),n.mute.forEach(this.handleMute.bind(this))}this.stunAddr=e["stun-server-addr"]}},{key:"reconnect",value:function(){var e=this;if(this.roomState!==d.Idle){this.roomState=d.Reconnecting;var t=this.signaling;t.reconnect(this.reconntoken),t.removeAllListeners("auth-res"),t.once("auth-res",function(t){if(t.error)e.joinRoomWithToken(e.roomToken,!1).then().catch(function(t){e.emit("error",t)});else{e.roomState=d.Connected,e.handleAuth(t);var r=t["my-pubs"],n=t["my-subs"];for(var i in!e.stream||b.checkPcConnect(e.localRTCPeerConnection)&&e.stream.connectStatus!==_.StreamConnectStatus.Connecting||(r&&r.length>0?e.republish(r[0].streamid,!0).then().catch(function(t){e.emit("error",t)}):e.republish(void 0,!0).then().catch(function(t){e.emit("error",t)})),(!e.stream||e.stream.isDestroyed)&&r&&r.length>0&&(g.log.log("update remote unpublish state"),e.unpublish(r[0].streamid)),e.subscribedUsers){var o=e.subscribedUsers[i];if(o.userId&&(!b.checkPcConnect(o.getPeerConnection())||o.connectStatus===_.StreamConnectStatus.Connecting)){var a=b.getElementFromArray(n||[],"connid",o.connId);a?(o.streamId=a.streamid,e._subscribe(o.userId,o.continuous,a.connid).then().catch(function(t){e.emit("error",t)})):e.resubscribe(o.userId,!0).then().catch(function(t){e.emit("error",t)})}}}})}}},{key:"getAllMerger",value:function(){var e=[];for(var t in this.merger&&e.push(this.merger),this.mergeJobMerger)e.push(this.mergeJobMerger[t]);return e}},{key:"releaseRoom",value:function(){for(var e in m.qos.addEvent(2),m.qos.sendMediaData(!0).then().catch(),m.qos.sendEventData(!0).then().catch(),this.signaling&&(this.signaling.release(),this.signaling=void 0),this.getAllMerger().map(function(e){e.release()}),this.merger=void 0,this.mergeJobMerger={},this.roomState=d.Idle,this.streamInfo=[],this.users=[],this.stream&&!this.stream.isDestroyed&&this.stream.release(),this.stream=void 0,this.userId=void 0,this.subscribedUsers)this.subscribedUsers[e].release();this.subscribedUsers={}}},{key:"subscriptionArray",get:function(){var e=this;return Object.keys(this.subscribedUsers).map(function(t){return e.subscribedUsers[t]})}},{key:"roomState",get:function(){return this._roomState},set:function(e){this._roomState!==e&&(this._roomState=e,g.log.debug("roomState change",this._roomState),this.emit("room-state-change",this._roomState),m.qos.addEvent(15,{room_state:this._roomState}))}}]),t}();t.QNRTCSession=E},function(e,t,r){var n=r(37),i=r(67),o=r(50);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(7),i=r(8),o=r(37);e.exports=r(6)?Object.defineProperties:function(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n=r(38),i=r(41).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){var n=r(2);n(n.S,"Array",{isArray:r(68)})},function(e,t,r){var n=r(2),i=r(25),o=r(4);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",a)}},function(e,t,r){var n=r(125);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(5),i=r(68),o=r(3)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){"use strict";var n=r(37),i=r(67),o=r(50),a=r(21),s=r(63),c=Object.assign;e.exports=!c||r(4)(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=c({},e)[r]||Object.keys(c({},t)).join("")!=n})?function(e,t){for(var r=a(e),c=arguments.length,u=1,d=i.f,f=o.f;c>u;)for(var l,h=s(arguments[u++]),p=d?n(h).concat(d(h)):n(h),v=p.length,m=0;v>m;)f.call(h,l=p[m++])&&(r[l]=h[l]);return r}:c},function(e,t,r){var n=r(3)("unscopables"),i=Array.prototype;void 0==i[n]&&r(10)(i,n,{}),e.exports=function(e){i[n][e]=!0}},function(e,t,r){"use strict";var n=r(32),i=r(46),o=r(36),a={};r(10)(a,r(3)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(40),i=r(39);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,r){r(6)&&"g"!=/./g.flags&&r(7).f(RegExp.prototype,"flags",{configurable:!0,get:r(73)})},function(e,t,r){var n=r(8);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(1),i=r(99).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==r(31)(a);e.exports=function(){var e,t,r,u=function(){var n,i;for(c&&(n=a.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);r=function(){d.then(u)}}else r=function(){i.call(n,u)};else{var f=!0,l=document.createTextNode("");new o(u).observe(l,{characterData:!0}),r=function(){l.data=f=!f}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(1).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(8),i=r(5),o=r(100);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){"use strict";(function(t){var n=r(137);e.exports=n({window:t.window})}).call(this,r(79))},function(e,t,r){"use strict";var n=r(17);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=n.log,c=n.detectBrowser(i),u=r(138)||null,d=r(140)||null,f=r(144)||null,l=r(146)||null,h=r(147)||null,p={browserDetails:c,commonShim:h,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),p;s("adapter.js shimming chrome."),p.browserShim=u,h.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimMediaStream(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimAddTrackRemoveTrack(i),u.shimGetSendersWithDtmf(i),u.shimSenderReceiverGetStats(i),u.fixNegotiationNeeded(i),h.shimRTCIceCandidate(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;case"firefox":if(!f||!f.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),p;s("adapter.js shimming firefox."),p.browserShim=f,h.shimCreateObjectURL(i),f.shimGetUserMedia(i),f.shimSourceObject(i),f.shimPeerConnection(i),f.shimOnTrack(i),f.shimRemoveStream(i),f.shimSenderGetStats(i),f.shimReceiverGetStats(i),f.shimRTCDataChannel(i),h.shimRTCIceCandidate(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),p;s("adapter.js shimming edge."),p.browserShim=d,h.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;case"safari":if(!l||!o.shimSafari)return s("Safari shim is not included in this adapter release."),p;s("adapter.js shimming safari."),p.browserShim=l,h.shimCreateObjectURL(i),l.shimRTCIceServerUrls(i),l.shimCreateOfferLegacy(i),l.shimCallbacksAPI(i),l.shimLocalStreamsAPI(i),l.shimRemoteStreamsAPI(i),l.shimTrackEventTransceiver(i),l.shimGetUserMedia(i),h.shimRTCIceCandidate(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return p}},function(e,t,r){"use strict";var n=r(17),i=n.log;function o(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(i){i.endsWith("Id")?e(t,t.get(r[i]),n):i.endsWith("Ids")&&r[i].forEach(function(r){e(t,t.get(r),n)})}))}(e,r,i)})}),i}e.exports={shimGetUserMedia:r(139),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(t?n=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(r?n=!0:r=e),e.track===i}),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n,r._reverseStreams[n.id]=t,t=n}i.apply(r,[t])};var o=e.RTCPeerConnection.prototype.removeStream;function a(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var o=n._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);n._streams[r.id]=a,n._reverseStreams[a.id]=r,n.addStream(a)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=a(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return a(e,t)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=n.detectBrowser(e);!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,r){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}}));var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return r.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){r.apply(i,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||("function"==typeof t?navigator.getDisplayMedia=function(e){return t(e).then(function(t){return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e.video.frameRate||3}},navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(e,t,r){"use strict";var n=r(17),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),(o={})[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,u=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==c.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),n(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){a(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(s(e))})})};var c=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return c(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,r){"use strict";var n=r(17),i=r(141),o=r(142);e.exports={shimGetUserMedia:r(143),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,r){"use strict";var n=r(17);e.exports=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},function(e,t,r){"use strict";var n=r(101);function i(e,t,r,i,o){var a=n.writeRtpDescription(e.kind,t);if(a+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),a}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function a(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var d=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},d.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},d.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},d.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},d.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},d.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var u=n.writeCandidate(s);a.candidate=Object.assign(a.candidate,n.parseCandidate(u)),a.candidate.candidate=u,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=n.getMediaSections(i._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+d.join("");var f=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),f&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,r,i){var a=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},d.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var s=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,d=a.dtlsTransport,f=a.localCapabilities,l=a.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var h=n.getIceParameters(e,r),p=n.getDtlsParameters(e,r);s&&(p.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,h,s?"controlling":"controlled"),"new"===d.state&&d.start(p));var v=o(f,l);i._transceive(a,v.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var d=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,d.signalingState)||d._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+d.signalingState));var f={};d.remoteStreams.forEach(function(e){f[e.id]=e});var l=[],h=n.splitSections(i.sdp),p=h.shift(),v=n.matchPrefix(p,"a=ice-lite").length>0,m=n.matchPrefix(p,"a=group:BUNDLE ").length>0;d.usingBundle=m;var g=n.matchPrefix(p,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,h.forEach(function(a,c){var u=n.splitLines(a),h=n.getKind(a),g=n.isRejected(a)&&0===n.matchPrefix(a,"a=bundle-only").length,y=u[0].substr(2).split(" ")[2],b=n.getDirection(a,p),S=n.parseMsid(a),w=n.getMid(a)||n.generateIdentifier();if(g||"application"===h&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))d.transceivers[c]={mid:w,kind:h,protocol:y,rejected:!0};else{var _,E,T,R,C,x,k,P,I;!g&&d.transceivers[c]&&d.transceivers[c].rejected&&(d.transceivers[c]=d._createTransceiver(h,!0));var O,M,A=n.parseRtpParameters(a);g||(O=n.getIceParameters(a,p),(M=n.getDtlsParameters(a,p)).role="client"),k=n.parseRtpEncodingParameters(a);var D=n.parseRtcpParameters(a),L=n.matchPrefix(a,"a=end-of-candidates",p).length>0,N=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!g&&m&&c>0&&d.transceivers[c]&&(d._disposeIceAndDtlsTransports(c),d.transceivers[c].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[c].iceTransport=d.transceivers[0].iceTransport,d.transceivers[c].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[c].rtpSender&&d.transceivers[c].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[c].rtpReceiver&&d.transceivers[c].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==i.type||g){if("answer"===i.type&&!g){E=(_=d.transceivers[c]).iceGatherer,T=_.iceTransport,R=_.dtlsTransport,C=_.rtpReceiver,x=_.sendEncodingParameters,P=_.localCapabilities,d.transceivers[c].recvEncodingParameters=k,d.transceivers[c].remoteCapabilities=A,d.transceivers[c].rtcpParameters=D,N.length&&"new"===T.state&&(!v&&!L||m&&0!==c?N.forEach(function(e){s(_.iceTransport,e)}):T.setRemoteCandidates(N)),m&&0!==c||("new"===T.state&&T.start(E,O,"controlling"),"new"===R.state&&R.start(M)),!o(_.localCapabilities,_.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,d._transceive(_,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!C||"sendrecv"!==b&&"sendonly"!==b?delete _.rtpReceiver:(I=C.track,S?(f[S.stream]||(f[S.stream]=new e.MediaStream),r(I,f[S.stream]),l.push([I,C,f[S.stream]])):(f.default||(f.default=new e.MediaStream),r(I,f.default),l.push([I,C,f.default])))}}else{(_=d.transceivers[c]||d._createTransceiver(h)).mid=w,_.iceGatherer||(_.iceGatherer=d._createIceGatherer(c,m)),N.length&&"new"===_.iceTransport.state&&(!L||m&&0!==c?N.forEach(function(e){s(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(N)),P=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),x=_.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,B=!1;if("sendrecv"===b||"sendonly"===b){if(B=!_.rtpReceiver,C=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,h),B)I=C.track,S&&"-"===S.stream||(S?(f[S.stream]||(f[S.stream]=new e.MediaStream,Object.defineProperty(f[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(I,"id",{get:function(){return S.track}}),j=f[S.stream]):(f.default||(f.default=new e.MediaStream),j=f.default)),j&&(r(I,j),_.associatedRemoteMediaStreams.push(j)),l.push([I,C,j])}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===_.rtpReceiver.track.id});r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=P,_.remoteCapabilities=A,_.rtpReceiver=C,_.rtcpParameters=D,_.sendEncodingParameters=x,_.recvEncodingParameters=k,d._transceive(d.transceivers[c],!1,B)}}}),void 0===d._dtlsRole&&(d._dtlsRole="offer"===i.type?"active":"passive"),d._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(f).forEach(function(t){var r=f[t];if(r.getTracks().length){if(-1===d.remoteStreams.indexOf(r)){d.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){d._dispatchEvent("addstream",n)})}l.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&u(d,t,n,[r])})}}),l.forEach(function(e){e[2]||u(d,e[0],e[1],[])}),e.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},d.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=r.transceivers.filter(function(e){return"audio"===e.kind}).length,a=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(r._createTransceiver("audio"),o--),a>0&&(r._createTransceiver("video"),a--);var u=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(u+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(d)},d.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var a=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},d.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<r.transceivers.length;u++)if(r.transceivers[u].mid===e.sdpMid){a=u;break}var d=r.transceivers[a];if(!d)return o(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var f=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return i();if(f.component&&1!==f.component)return i();if((0===a||a>0&&d.iceTransport!==r.transceivers[0].iceTransport)&&!s(d.iceTransport,f))return o(c("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(f.type?l:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var h=0;h<r.transceivers.length&&(r.transceivers[h].rejected||(r.transceivers[h].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[h]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));h++);i()})},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[r]),t.set(r,e[r])}),t})}}});var f=["createOffer","createAnswer"];return f.forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),d}},function(e,t,r){"use strict";e.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,r){"use strict";var n=r(17);e.exports={shimGetUserMedia:r(145),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],o=0;o<r.iceServers.length;o++){var a=r.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(r.iceServers[o])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return o.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,n)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(!e||!e.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===e.video?e.video={mediaSource:t}:e.video.mediaSource=t,navigator.mediaDevices.getUserMedia(e)})}}},function(e,t,r){"use strict";var n=r(17),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,n,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){o(a(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){s(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var d=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},o&&o.prototype.getSettings){var l=o.prototype.getSettings;o.prototype.getSettings=function(){var e=l.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}r.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(i,o)}}},function(e,t,r){"use strict";var n=r(17);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}}},function(e,t,r){"use strict";var n=r(101),i=r(17);e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,function(e){var t=n.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=n.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var e,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),o=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(i),a=function(e,r){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=n.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i}(arguments[0],i);e=0===o&&0===a?Number.POSITIVE_INFINITY:0===o||0===a?Math.max(o,a):Math.min(o,a);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return e}}),this._sctp=s}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}}},function(e,t,r){(function(e,r){var n=200,i="Expected a function",o="__lodash_hash_undefined__",a=1,s=2,c=1/0,u=9007199254740991,d="[object Arguments]",f="[object Array]",l="[object Boolean]",h="[object Date]",p="[object Error]",v="[object Function]",m="[object GeneratorFunction]",g="[object Map]",y="[object Number]",b="[object Object]",S="[object RegExp]",w="[object Set]",_="[object String]",E="[object Symbol]",T="[object ArrayBuffer]",R="[object DataView]",C=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,x=/^\w*$/,k=/^\./,P=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,I=/\\(\\)?/g,O=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[d]=A[f]=A[T]=A[l]=A[R]=A[h]=A[p]=A[v]=A[g]=A[y]=A[b]=A[S]=A[w]=A[_]=A["[object WeakMap]"]=!1;var D="object"==typeof e&&e&&e.Object===Object&&e,L="object"==typeof self&&self&&self.Object===Object&&self,N=D||L||Function("return this")(),j="object"==typeof t&&t&&!t.nodeType&&t,B=j&&"object"==typeof r&&r&&!r.nodeType&&r,F=B&&B.exports===j&&D.process,U=function(){try{return F&&F.binding("util")}catch(e){}}(),G=U&&U.isTypedArray;function W(e,t){return!!(e?e.length:0)&&function(e,t,r){if(t!=t)return function(e,t,r,n){var i=e.length,o=r+(n?1:-1);for(;n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,X,r);var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,0)>-1}function V(e,t,r){for(var n=-1,i=e?e.length:0;++n<i;)if(r(t,e[n]))return!0;return!1}function H(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function X(e){return e!=e}function z(e,t){return e.has(t)}function K(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function q(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function J(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var $=Array.prototype,Z=Function.prototype,Y=Object.prototype,Q=N["__core-js_shared__"],ee=function(){var e=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),te=Z.toString,re=Y.hasOwnProperty,ne=Y.toString,ie=RegExp("^"+te.call(re).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oe=N.Symbol,ae=N.Uint8Array,se=Y.propertyIsEnumerable,ce=$.splice,ue=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),de=Ge(N,"DataView"),fe=Ge(N,"Map"),le=Ge(N,"Promise"),he=Ge(N,"Set"),pe=Ge(N,"WeakMap"),ve=Ge(Object,"create"),me=Je(de),ge=Je(fe),ye=Je(le),be=Je(he),Se=Je(pe),we=oe?oe.prototype:void 0,_e=we?we.valueOf:void 0,Ee=we?we.toString:void 0;function Te(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Re(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xe(e){var t=-1,r=e?e.length:0;for(this.__data__=new Ce;++t<r;)this.add(e[t])}function ke(e){this.__data__=new Re(e)}function Pe(e,t){var r=Qe(e)||Ye(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!t&&!re.call(e,o)||i&&("length"==o||Ve(o,n))||r.push(o);return r}function Ie(e,t){for(var r=e.length;r--;)if(Ze(e[r][0],t))return r;return-1}function Oe(e,t){for(var r=0,n=(t=He(t,e)?[t]:je(t)).length;null!=e&&r<n;)e=e[qe(t[r++])];return r&&r==n?e:void 0}function Me(e,t){return null!=e&&t in Object(e)}function Ae(e,t,r,n,i){return e===t||(null==e||null==t||!nt(e)&&!it(t)?e!=e&&t!=t:function(e,t,r,n,i,o){var c=Qe(e),u=Qe(t),v=f,m=f;c||(v=(v=We(e))==d?b:v);u||(m=(m=We(t))==d?b:m);var C=v==b&&!K(e),x=m==b&&!K(t),k=v==m;if(k&&!C)return o||(o=new ke),c||at(e)?Fe(e,t,r,n,i,o):function(e,t,r,n,i,o,c){switch(r){case R:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case T:return!(e.byteLength!=t.byteLength||!n(new ae(e),new ae(t)));case l:case h:case y:return Ze(+e,+t);case p:return e.name==t.name&&e.message==t.message;case S:case _:return e==t+"";case g:var u=q;case w:var d=o&s;if(u||(u=J),e.size!=t.size&&!d)return!1;var f=c.get(e);if(f)return f==t;o|=a,c.set(e,t);var v=Fe(u(e),u(t),n,i,o,c);return c.delete(e),v;case E:if(_e)return _e.call(e)==_e.call(t)}return!1}(e,t,v,r,n,i,o);if(!(i&s)){var P=C&&re.call(e,"__wrapped__"),I=x&&re.call(t,"__wrapped__");if(P||I){var O=P?e.value():e,M=I?t.value():t;return o||(o=new ke),r(O,M,n,i,o)}}if(!k)return!1;return o||(o=new ke),function(e,t,r,n,i,o){var a=i&s,c=st(e),u=c.length,d=st(t).length;if(u!=d&&!a)return!1;for(var f=u;f--;){var l=c[f];if(!(a?l in t:re.call(t,l)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var p=!0;o.set(e,t),o.set(t,e);for(var v=a;++f<u;){l=c[f];var m=e[l],g=t[l];if(n)var y=a?n(g,m,l,t,e,o):n(m,g,l,e,t,o);if(!(void 0===y?m===g||r(m,g,n,i,o):y)){p=!1;break}v||(v="constructor"==l)}if(p&&!v){var b=e.constructor,S=t.constructor;b!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,r,n,i,o)}(e,t,Ae,r,n,i))}function De(e){return!(!nt(e)||function(e){return!!ee&&ee in e}(e))&&(tt(e)||K(e)?ie:O).test(Je(e))}function Le(e){return"function"==typeof e?e:null==e?ct:"object"==typeof e?Qe(e)?function(e,t){if(He(e)&&Xe(t))return ze(qe(e),t);return function(r){var n=function(e,t,r){var n=null==e?void 0:Oe(e,t);return void 0===n?r:n}(r,e);return void 0===n&&n===t?function(e,t){return null!=e&&function(e,t,r){var n,i=-1,o=(t=He(t,e)?[t]:je(t)).length;for(;++i<o;){var a=qe(t[i]);if(!(n=null!=e&&r(e,a)))break;e=e[a]}if(n)return n;return!!(o=e?e.length:0)&&rt(o)&&Ve(a,o)&&(Qe(e)||Ye(e))}(e,t,Me)}(r,e):Ae(t,n,void 0,a|s)}}(e[0],e[1]):function(e){var t=function(e){var t=st(e),r=t.length;for(;r--;){var n=t[r],i=e[n];t[r]=[n,i,Xe(i)]}return t}(e);if(1==t.length&&t[0][2])return ze(t[0][0],t[0][1]);return function(r){return r===e||function(e,t,r,n){var i=r.length,o=i,c=!n;if(null==e)return!o;for(e=Object(e);i--;){var u=r[i];if(c&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<o;){var d=(u=r[i])[0],f=e[d],l=u[1];if(c&&u[2]){if(void 0===f&&!(d in e))return!1}else{var h=new ke;if(n)var p=n(f,l,d,e,t,h);if(!(void 0===p?Ae(l,f,n,a|s,h):p))return!1}}return!0}(r,e,t)}}(e):function(e){return He(e)?function(e){return function(t){return null==t?void 0:t[e]}}(qe(e)):function(e){return function(t){return Oe(t,e)}}(e)}(e)}function Ne(e){if(!function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||Y;return e===r}(e))return ue(e);var t=[];for(var r in Object(e))re.call(e,r)&&"constructor"!=r&&t.push(r);return t}function je(e){return Qe(e)?e:Ke(e)}Te.prototype.clear=function(){this.__data__=ve?ve(null):{}},Te.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Te.prototype.get=function(e){var t=this.__data__;if(ve){var r=t[e];return r===o?void 0:r}return re.call(t,e)?t[e]:void 0},Te.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:re.call(t,e)},Te.prototype.set=function(e,t){return this.__data__[e]=ve&&void 0===t?o:t,this},Re.prototype.clear=function(){this.__data__=[]},Re.prototype.delete=function(e){var t=this.__data__,r=Ie(t,e);return!(r<0||(r==t.length-1?t.pop():ce.call(t,r,1),0))},Re.prototype.get=function(e){var t=this.__data__,r=Ie(t,e);return r<0?void 0:t[r][1]},Re.prototype.has=function(e){return Ie(this.__data__,e)>-1},Re.prototype.set=function(e,t){var r=this.__data__,n=Ie(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},Ce.prototype.clear=function(){this.__data__={hash:new Te,map:new(fe||Re),string:new Te}},Ce.prototype.delete=function(e){return Ue(this,e).delete(e)},Ce.prototype.get=function(e){return Ue(this,e).get(e)},Ce.prototype.has=function(e){return Ue(this,e).has(e)},Ce.prototype.set=function(e,t){return Ue(this,e).set(e,t),this},xe.prototype.add=xe.prototype.push=function(e){return this.__data__.set(e,o),this},xe.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.clear=function(){this.__data__=new Re},ke.prototype.delete=function(e){return this.__data__.delete(e)},ke.prototype.get=function(e){return this.__data__.get(e)},ke.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Re){var i=r.__data__;if(!fe||i.length<n-1)return i.push([e,t]),this;r=this.__data__=new Ce(i)}return r.set(e,t),this};var Be=he&&1/J(new he([,-0]))[1]==c?function(e){return new he(e)}:function(){};function Fe(e,t,r,n,i,o){var c=i&s,u=e.length,d=t.length;if(u!=d&&!(c&&d>u))return!1;var f=o.get(e);if(f&&o.get(t))return f==t;var l=-1,h=!0,p=i&a?new xe:void 0;for(o.set(e,t),o.set(t,e);++l<u;){var v=e[l],m=t[l];if(n)var g=c?n(m,v,l,t,e,o):n(v,m,l,e,t,o);if(void 0!==g){if(g)continue;h=!1;break}if(p){if(!H(t,function(e,t){if(!p.has(t)&&(v===e||r(v,e,n,i,o)))return p.add(t)})){h=!1;break}}else if(v!==m&&!r(v,m,n,i,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function Ue(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function Ge(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return De(r)?r:void 0}var We=function(e){return ne.call(e)};function Ve(e,t){return!!(t=null==t?u:t)&&("number"==typeof e||M.test(e))&&e>-1&&e%1==0&&e<t}function He(e,t){if(Qe(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ot(e))||(x.test(e)||!C.test(e)||null!=t&&e in Object(t))}function Xe(e){return e==e&&!nt(e)}function ze(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}(de&&We(new de(new ArrayBuffer(1)))!=R||fe&&We(new fe)!=g||le&&"[object Promise]"!=We(le.resolve())||he&&We(new he)!=w||pe&&"[object WeakMap]"!=We(new pe))&&(We=function(e){var t=ne.call(e),r=t==b?e.constructor:void 0,n=r?Je(r):void 0;if(n)switch(n){case me:return R;case ge:return g;case ye:return"[object Promise]";case be:return w;case Se:return"[object WeakMap]"}return t});var Ke=$e(function(e){e=function(e){return null==e?"":function(e){if("string"==typeof e)return e;if(ot(e))return Ee?Ee.call(e):"";var t=e+"";return"0"==t&&1/e==-c?"-0":t}(e)}(e);var t=[];return k.test(e)&&t.push(""),e.replace(P,function(e,r,n,i){t.push(n?i.replace(I,"$1"):r||e)}),t});function qe(e){if("string"==typeof e||ot(e))return e;var t=e+"";return"0"==t&&1/e==-c?"-0":t}function Je(e){if(null!=e){try{return te.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function $e(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(i);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new($e.Cache||Ce),r}function Ze(e,t){return e===t||e!=e&&t!=t}function Ye(e){return function(e){return it(e)&&et(e)}(e)&&re.call(e,"callee")&&(!se.call(e,"callee")||ne.call(e)==d)}$e.Cache=Ce;var Qe=Array.isArray;function et(e){return null!=e&&rt(e.length)&&!tt(e)}function tt(e){var t=nt(e)?ne.call(e):"";return t==v||t==m}function rt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function nt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function it(e){return!!e&&"object"==typeof e}function ot(e){return"symbol"==typeof e||it(e)&&ne.call(e)==E}var at=G?function(e){return function(t){return e(t)}}(G):function(e){return it(e)&&rt(e.length)&&!!A[ne.call(e)]};function st(e){return et(e)?Pe(e):Ne(e)}function ct(e){return e}r.exports=function(e,t){return e&&e.length?function(e,t,r){var i=-1,o=W,a=e.length,s=!0,c=[],u=c;if(r)s=!1,o=V;else if(a>=n){var d=t?null:Be(e);if(d)return J(d);s=!1,o=z,u=new xe}else u=t?[]:c;e:for(;++i<a;){var f=e[i],l=t?t(f):f;if(f=r||0!==f?f:0,s&&l==l){for(var h=u.length;h--;)if(u[h]===l)continue e;t&&u.push(l),c.push(f)}else o(u,l,r)||(u!==c&&u.push(l),c.push(f))}return c}(e,Le(t)):[]}}).call(this,r(79),r(149)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";r(12),r(0),r(9);var n=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var i=r(24),o=r(60),a=r(13),s=r(58),c=r(18);t.RTC_HOST="production"===o.build_rtc_env?"https://rtc.qiniuapi.com":"http://10.200.20.28:3002",t.getAccessToken=function(e,r){return n(this,void 0,void 0,regeneratorRuntime.mark(function n(){var o,u,d,f,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=e.appId,u=e.roomName,d=e.userId,f="".concat(t.RTC_HOST,"/v3/apps/").concat(o,"/rooms/").concat(u,"/auth?user=").concat(d,"&token=").concat(r);case 2:return n.prev=3,n.next=6,i.request(f);case 6:return l=n.sent,s.qos.setSessionId(l.sessionId),n.abrupt("return",l.accessToken);case 11:if(n.prev=11,n.t0=n.catch(3),!1!==n.t0.retry){n.next=15;break}throw c.AUTH_ENTER_ROOM_ERROR(n.t0.message);case 15:a.log.warning("can not get accessToken, retry.",c.AUTH_ENTER_ROOM_ERROR(n.t0));case 16:n.next=2;break;case 18:case"end":return n.stop()}},n,this,[[3,11]])}))}},function(e,t,r){"use strict";r(43),r(44),r(12),r(0),r(9);var n=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.request=function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:if(!((r=t.sent).status>=400&&r.status<500)){t.next=5;break}throw{retry:!1,message:r.status.toString()};case 5:if(200===r.status){t.next=7;break}throw{retry:!0,message:r.status.toString()};case 7:return t.next=9,r.json();case 9:return n=t.sent,t.abrupt("return",n);case 11:case"end":return t.stop()}},t,this)}))}},function(e,t,r){"use strict";r(34),r(56),r(55),r(12),r(0),r(9);var n=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var i=r(24),o=r(13),a=r(18),s=r(19),c=r(110),u=r(112);t.releasePC=function(e){if(e){try{e.close()}catch(e){}e.onconnectionstatechange=null,e.oniceconnectionstatechange=null,e=void 0}},t.checkPcConnect=function(e){return!!e&&(!s.browserReport.connectionState||"closed"!==e.connectionState&&"disconnected"!==e.connectionState)&&"failed"!==e.iceConnectionState&&"closed"!==e.iceConnectionState&&"disconnected"!==e.iceConnectionState},t.handlePcRemoteIceStateChange=function(e,t){var r=t.connId?"webrtc-icestate-connid-".concat(t.connId):"webrtc-icestate-stream-".concat(t.streamId);e.on(r,function(n){n.connected||(t&&!t.isDestroyed&&t.pc&&t.pc.close(),e.removeAllListeners(r))})},t.createP2PConnection=function(e,t,r){return n(this,void 0,void 0,regeneratorRuntime.mark(function n(){var u,d,f,l,h,p,v,m;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=r.connid,d=r.stream,f=!!e.addTransceiver,d.bindWithPeerConnection(e,u),f&&(l=new MediaStream,0===e.getTransceivers().length&&(d.enableAudio&&e.addTransceiver("audio",{direction:u?"recvonly":"sendonly",sendEncodings:u?void 0:d.getAudioEncodings(),streams:u?[l]:void 0}),d.enableVideo&&e.addTransceiver("video",{direction:u?"recvonly":"sendonly",sendEncodings:u?void 0:d.getVideoEncodings(),streams:u?[l]:void 0}))),h={offerToReceiveAudio:u&&!f?d.enableAudio:void 0,offerToReceiveVideo:u&&!f?d.enableVideo:void 0},n.next=7,e.createOffer(h);case 7:return(p=n.sent).sdp=d.processSDP(p.sdp),o.log.log("".concat(r.connid?"subscribe:":"publish:"," create offer"),p,"userId ".concat(r.stream.userId)),n.next=12,e.setLocalDescription(p);case 12:return n.next=14,i.sendMsgWaitResponse(t,"webrtc-offer",{streamid:d.streamId,connid:u,sdp:e.localDescription.sdp},"webrtc-answer-streamid-".concat(d.streamId,"-connid-").concat(u||""));case 14:return v=n.sent,s.isFirefox&&(v.sdp=c.addFmtpToAnswer(v.sdp)),m={type:"answer",sdp:v.sdp},o.log.log("".concat(r.connid?"subscribe:":"publish:"," get answer"),m,"userId ".concat(r.stream.userId)),n.prev=18,n.next=21,e.setRemoteDescription(m);case 21:n.next=26;break;case 23:throw n.prev=23,n.t0=n.catch(18),a.UNSUPPORT_FMT(n.t0.message);case 26:return n.abrupt("return",p);case 27:case"end":return n.stop()}},n,this,[[18,23]])}))},t.getPCStats=function(e,t){return n(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!s.browserReport.stats){r.next=6;break}return r.next=3,u.getStats(e,t);case 3:return r.abrupt("return",r.sent);case 6:return r.next=8,u.getStatsLegacy(e,t);case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}},r,this)}))},t.getRateStats=function(e,t){if(!t)return e;var r=Object.assign({},e),n=e.videoPackets-t.videoPackets,i=e.videoPacketLoss-t.videoPacketLoss;i>0&&(r.videoPacketLossRate=i/n,r.videoPacketLossRate>1&&(r.videoPacketLossRate=1));var o=e.audioPackets-t.audioPackets,a=e.audioPacketLoss-t.audioPacketLoss;a>0&&(r.audioPacketLossRate=a/o,r.audioPacketLossRate>1&&(r.audioPacketLossRate=1));var s=(Date.now()-t.timestamp)/1e3;return r.videoBitrate=8*(e.videoBytes-t.videoBytes)/s,r.audioBitrate=8*(e.audioBytes-t.audioBytes)/s,r.videoBitrate<0||r.audioBitrate<0?t:r},t.getLocalIp=function(){return n(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){var r=new RTCPeerConnection({iceServers:[]}),n=function(){};r.createDataChannel(""),r.createOffer().then(r.setLocalDescription.bind(r),n),r.onicecandidate=function(t){if(r.onicecandidate=n,r.close(),t&&t.candidate&&t.candidate.candidate){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(t.candidate.candidate);i&&i[1]?e(i[1]):e("")}else e("")}}));case 1:case"end":return e.stop()}},e,this)}))}},function(e,t,r){"use strict";var n=r(154),i=r(103);e.exports=r(155)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){"use strict";var n=r(7).f,i=r(32),o=r(48),a=r(20),s=r(47),c=r(77),u=r(72),d=r(91),f=r(57),l=r(6),h=r(62).fastKey,p=r(103),v=l?"_s":"size",m=function(e,t){var r,n=h(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,u){var d=e(function(e,n){s(e,d,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,void 0!=n&&c(n,r,e[u],e)});return o(d.prototype,{clear:function(){for(var e=p(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var r=p(this,t),n=m(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[v]--}return!!n},forEach:function(e){p(this,t);for(var r,n=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!m(p(this,t),e)}}),l&&n(d.prototype,"size",{get:function(){return p(this,t)[v]}}),d},def:function(e,t,r){var n,i,o=m(e,t);return o?o.v=r:(e._l=o={i:i=h(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:m,setStrong:function(e,t,r){u(e,t,function(e,r){this._t=p(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))},r?"entries":"values",!r,!0),f(t)}}},function(e,t,r){"use strict";var n=r(1),i=r(2),o=r(11),a=r(48),s=r(62),c=r(77),u=r(47),d=r(5),f=r(4),l=r(78),h=r(36),p=r(82);e.exports=function(e,t,r,v,m,g){var y=n[e],b=y,S=m?"set":"add",w=b&&b.prototype,_={},E=function(e){var t=w[e];o(w,e,"delete"==e?function(e){return!(g&&!d(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!d(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof b&&(g||w.forEach&&!f(function(){(new b).entries().next()}))){var T=new b,R=T[S](g?{}:-0,1)!=T,C=f(function(){T.has(1)}),x=l(function(e){new b(e)}),k=!g&&f(function(){for(var e=new b,t=5;t--;)e[S](t,t);return!e.has(-0)});x||((b=t(function(t,r){u(t,b,e);var n=p(new y,t,b);return void 0!=r&&c(r,m,n[S],n),n})).prototype=w,w.constructor=b),(C||k)&&(E("delete"),E("has"),m&&E("get")),(k||R)&&E(S),g&&w.clear&&delete w.clear}else b=v.getConstructor(t,e,m,S),a(b.prototype,r),s.NEED=!0;return h(b,e),_[e]=b,i(i.G+i.W+i.F*(b!=y),_),g||v.setStrong(b,e,m),b}},function(e,t,r){var n=r(2),i=r(32),o=r(27),a=r(8),s=r(5),c=r(4),u=r(94),d=(r(1).Reflect||{}).construct,f=c(function(){function e(){}return!(d(function(){},[],e)instanceof e)}),l=!c(function(){d(function(){})});n(n.S+n.F*(f||l),"Reflect",{construct:function(e,t){o(e),a(t);var r=arguments.length<3?e:o(arguments[2]);if(l&&!f)return d(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(u.apply(e,n))}var c=r.prototype,h=i(s(c)?c:Object.prototype),p=Function.apply.call(e,h,t);return s(p)?p:h}})},function(e,t,r){"use strict";if(r(6)){var n=r(29),i=r(1),o=r(4),a=r(2),s=r(105),c=r(158),u=r(20),d=r(47),f=r(46),l=r(10),h=r(48),p=r(40),v=r(15),m=r(106),g=r(49),y=r(45),b=r(14),S=r(76),w=r(5),_=r(21),E=r(96),T=r(32),R=r(92),C=r(41).f,x=r(97),k=r(26),P=r(3),I=r(71),O=r(64),M=r(98),A=r(33),D=r(42),L=r(78),N=r(57),j=r(107),B=r(159),F=r(7),U=r(51),G=F.f,W=U.f,V=i.RangeError,H=i.TypeError,X=i.Uint8Array,z=Array.prototype,K=c.ArrayBuffer,q=c.DataView,J=I(0),$=I(2),Z=I(3),Y=I(4),Q=I(5),ee=I(6),te=O(!0),re=O(!1),ne=A.values,ie=A.keys,oe=A.entries,ae=z.lastIndexOf,se=z.reduce,ce=z.reduceRight,ue=z.join,de=z.sort,fe=z.slice,le=z.toString,he=z.toLocaleString,pe=P("iterator"),ve=P("toStringTag"),me=k("typed_constructor"),ge=k("def_constructor"),ye=s.CONSTR,be=s.TYPED,Se=s.VIEW,we=I(1,function(e,t){return Ce(M(e,e[ge]),t)}),_e=o(function(){return 1===new X(new Uint16Array([1]).buffer)[0]}),Ee=!!X&&!!X.prototype.set&&o(function(){new X(1).set({})}),Te=function(e,t){var r=p(e);if(r<0||r%t)throw V("Wrong offset!");return r},Re=function(e){if(w(e)&&be in e)return e;throw H(e+" is not a typed array!")},Ce=function(e,t){if(!(w(e)&&me in e))throw H("It is not a typed array constructor!");return new e(t)},xe=function(e,t){return ke(M(e,e[ge]),t)},ke=function(e,t){for(var r=0,n=t.length,i=Ce(e,n);n>r;)i[r]=t[r++];return i},Pe=function(e,t,r){G(e,t,{get:function(){return this._d[r]}})},Ie=function(e){var t,r,n,i,o,a,s=_(e),c=arguments.length,d=c>1?arguments[1]:void 0,f=void 0!==d,l=x(s);if(void 0!=l&&!E(l)){for(a=l.call(s),n=[],t=0;!(o=a.next()).done;t++)n.push(o.value);s=n}for(f&&c>2&&(d=u(d,arguments[2],2)),t=0,r=v(s.length),i=Ce(this,r);r>t;t++)i[t]=f?d(s[t],t):s[t];return i},Oe=function(){for(var e=0,t=arguments.length,r=Ce(this,t);t>e;)r[e]=arguments[e++];return r},Me=!!X&&o(function(){he.call(new X(1))}),Ae=function(){return he.apply(Me?fe.call(Re(this)):Re(this),arguments)},De={copyWithin:function(e,t){return B.call(Re(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Y(Re(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return j.apply(Re(this),arguments)},filter:function(e){return xe(this,$(Re(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return Q(Re(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Re(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){J(Re(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return re(Re(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Re(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ue.apply(Re(this),arguments)},lastIndexOf:function(e){return ae.apply(Re(this),arguments)},map:function(e){return we(Re(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(Re(this),arguments)},reduceRight:function(e){return ce.apply(Re(this),arguments)},reverse:function(){for(var e,t=Re(this).length,r=Math.floor(t/2),n=0;n<r;)e=this[n],this[n++]=this[--t],this[t]=e;return this},some:function(e){return Z(Re(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return de.call(Re(this),e)},subarray:function(e,t){var r=Re(this),n=r.length,i=g(e,n);return new(M(r,r[ge]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,v((void 0===t?n:g(t,n))-i))}},Le=function(e,t){return xe(this,fe.call(Re(this),e,t))},Ne=function(e){Re(this);var t=Te(arguments[1],1),r=this.length,n=_(e),i=v(n.length),o=0;if(i+t>r)throw V("Wrong length!");for(;o<i;)this[t+o]=n[o++]},je={entries:function(){return oe.call(Re(this))},keys:function(){return ie.call(Re(this))},values:function(){return ne.call(Re(this))}},Be=function(e,t){return w(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Fe=function(e,t){return Be(e,t=y(t,!0))?f(2,e[t]):W(e,t)},Ue=function(e,t,r){return!(Be(e,t=y(t,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(e,t,r):(e[t]=r.value,e)};ye||(U.f=Fe,F.f=Ue),a(a.S+a.F*!ye,"Object",{getOwnPropertyDescriptor:Fe,defineProperty:Ue}),o(function(){le.call({})})&&(le=he=function(){return ue.call(this)});var Ge=h({},De);h(Ge,je),l(Ge,pe,je.values),h(Ge,{slice:Le,set:Ne,constructor:function(){},toString:le,toLocaleString:Ae}),Pe(Ge,"buffer","b"),Pe(Ge,"byteOffset","o"),Pe(Ge,"byteLength","l"),Pe(Ge,"length","e"),G(Ge,ve,{get:function(){return this[be]}}),e.exports=function(e,t,r,c){var u=e+((c=!!c)?"Clamped":"")+"Array",f="get"+e,h="set"+e,p=i[u],g=p||{},y=p&&R(p),b=!p||!s.ABV,_={},E=p&&p.prototype,x=function(e,r){G(e,r,{get:function(){return function(e,r){var n=e._d;return n.v[f](r*t+n.o,_e)}(this,r)},set:function(e){return function(e,r,n){var i=e._d;c&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),i.v[h](r*t+i.o,n,_e)}(this,r,e)},enumerable:!0})};b?(p=r(function(e,r,n,i){d(e,p,u,"_d");var o,a,s,c,f=0,h=0;if(w(r)){if(!(r instanceof K||"ArrayBuffer"==(c=S(r))||"SharedArrayBuffer"==c))return be in r?ke(p,r):Ie.call(p,r);o=r,h=Te(n,t);var g=r.byteLength;if(void 0===i){if(g%t)throw V("Wrong length!");if((a=g-h)<0)throw V("Wrong length!")}else if((a=v(i)*t)+h>g)throw V("Wrong length!");s=a/t}else s=m(r),o=new K(a=s*t);for(l(e,"_d",{b:o,o:h,l:a,e:s,v:new q(o)});f<s;)x(e,f++)}),E=p.prototype=T(Ge),l(E,"constructor",p)):o(function(){p(1)})&&o(function(){new p(-1)})&&L(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=r(function(e,r,n,i){var o;return d(e,p,u),w(r)?r instanceof K||"ArrayBuffer"==(o=S(r))||"SharedArrayBuffer"==o?void 0!==i?new g(r,Te(n,t),i):void 0!==n?new g(r,Te(n,t)):new g(r):be in r?ke(p,r):Ie.call(p,r):new g(m(r))}),J(y!==Function.prototype?C(g).concat(C(y)):C(g),function(e){e in p||l(p,e,g[e])}),p.prototype=E,n||(E.constructor=p));var k=E[pe],P=!!k&&("values"==k.name||void 0==k.name),I=je.values;l(p,me,!0),l(E,be,u),l(E,Se,!0),l(E,ge,p),(c?new p(1)[ve]==u:ve in E)||G(E,ve,{get:function(){return u}}),_[u]=p,a(a.G+a.W+a.F*(p!=g),_),a(a.S,u,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*o(function(){g.of.call(p,1)}),u,{from:Ie,of:Oe}),"BYTES_PER_ELEMENT"in E||l(E,"BYTES_PER_ELEMENT",t),a(a.P,u,De),N(u),a(a.P+a.F*Ee,u,{set:Ne}),a(a.P+a.F*!P,u,je),n||E.toString==le||(E.toString=le),a(a.P+a.F*o(function(){new p(1).slice()}),u,{slice:Le}),a(a.P+a.F*(o(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!o(function(){E.toLocaleString.call([1,2])})),u,{toLocaleString:Ae}),D[u]=P?k:I,n||P||l(E,pe,I)}}else e.exports=function(){}},function(e,t,r){"use strict";var n=r(1),i=r(6),o=r(29),a=r(105),s=r(10),c=r(48),u=r(4),d=r(47),f=r(40),l=r(15),h=r(106),p=r(41).f,v=r(7).f,m=r(107),g=r(36),y="prototype",b="Wrong index!",S=n.ArrayBuffer,w=n.DataView,_=n.Math,E=n.RangeError,T=n.Infinity,R=S,C=_.abs,x=_.pow,k=_.floor,P=_.log,I=_.LN2,O=i?"_b":"buffer",M=i?"_l":"byteLength",A=i?"_o":"byteOffset";function D(e,t,r){var n,i,o,a=new Array(r),s=8*r-t-1,c=(1<<s)-1,u=c>>1,d=23===t?x(2,-24)-x(2,-77):0,f=0,l=e<0||0===e&&1/e<0?1:0;for((e=C(e))!=e||e===T?(i=e!=e?1:0,n=c):(n=k(P(e)/I),e*(o=x(2,-n))<1&&(n--,o*=2),(e+=n+u>=1?d/o:d*x(2,1-u))*o>=2&&(n++,o/=2),n+u>=c?(i=0,n=c):n+u>=1?(i=(e*o-1)*x(2,t),n+=u):(i=e*x(2,u-1)*x(2,t),n=0));t>=8;a[f++]=255&i,i/=256,t-=8);for(n=n<<t|i,s+=t;s>0;a[f++]=255&n,n/=256,s-=8);return a[--f]|=128*l,a}function L(e,t,r){var n,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,c=r-1,u=e[c--],d=127&u;for(u>>=7;s>0;d=256*d+e[c],c--,s-=8);for(n=d&(1<<-s)-1,d>>=-s,s+=t;s>0;n=256*n+e[c],c--,s-=8);if(0===d)d=1-a;else{if(d===o)return n?NaN:u?-T:T;n+=x(2,t),d-=a}return(u?-1:1)*n*x(2,d-t)}function N(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function j(e){return[255&e]}function B(e){return[255&e,e>>8&255]}function F(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function U(e){return D(e,52,8)}function G(e){return D(e,23,4)}function W(e,t,r){v(e[y],t,{get:function(){return this[r]}})}function V(e,t,r,n){var i=h(+r);if(i+t>e[M])throw E(b);var o=e[O]._b,a=i+e[A],s=o.slice(a,a+t);return n?s:s.reverse()}function H(e,t,r,n,i,o){var a=h(+r);if(a+t>e[M])throw E(b);for(var s=e[O]._b,c=a+e[A],u=n(+i),d=0;d<t;d++)s[c+d]=u[o?d:t-d-1]}if(a.ABV){if(!u(function(){S(1)})||!u(function(){new S(-1)})||u(function(){return new S,new S(1.5),new S(NaN),"ArrayBuffer"!=S.name})){for(var X,z=(S=function(e){return d(this,S),new R(h(e))})[y]=R[y],K=p(R),q=0;K.length>q;)(X=K[q++])in S||s(S,X,R[X]);o||(z.constructor=S)}var J=new w(new S(2)),$=w[y].setInt8;J.setInt8(0,2147483648),J.setInt8(1,2147483649),!J.getInt8(0)&&J.getInt8(1)||c(w[y],{setInt8:function(e,t){$.call(this,e,t<<24>>24)},setUint8:function(e,t){$.call(this,e,t<<24>>24)}},!0)}else S=function(e){d(this,S,"ArrayBuffer");var t=h(e);this._b=m.call(new Array(t),0),this[M]=t},w=function(e,t,r){d(this,w,"DataView"),d(e,S,"DataView");var n=e[M],i=f(t);if(i<0||i>n)throw E("Wrong offset!");if(i+(r=void 0===r?n-i:l(r))>n)throw E("Wrong length!");this[O]=e,this[A]=i,this[M]=r},i&&(W(S,"byteLength","_l"),W(w,"buffer","_b"),W(w,"byteLength","_l"),W(w,"byteOffset","_o")),c(w[y],{getInt8:function(e){return V(this,1,e)[0]<<24>>24},getUint8:function(e){return V(this,1,e)[0]},getInt16:function(e){var t=V(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=V(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return N(V(this,4,e,arguments[1]))},getUint32:function(e){return N(V(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return L(V(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return L(V(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){H(this,1,e,j,t)},setUint8:function(e,t){H(this,1,e,j,t)},setInt16:function(e,t){H(this,2,e,B,t,arguments[2])},setUint16:function(e,t){H(this,2,e,B,t,arguments[2])},setInt32:function(e,t){H(this,4,e,F,t,arguments[2])},setUint32:function(e,t){H(this,4,e,F,t,arguments[2])},setFloat32:function(e,t){H(this,4,e,G,t,arguments[2])},setFloat64:function(e,t){H(this,8,e,U,t,arguments[2])}});g(S,"ArrayBuffer"),g(w,"DataView"),s(w[y],a.VIEW,!0),t.ArrayBuffer=S,t.DataView=w},function(e,t,r){"use strict";var n=r(21),i=r(49),o=r(15);e.exports=[].copyWithin||function(e,t){var r=n(this),a=o(r.length),s=i(e,a),c=i(t,a),u=arguments.length>2?arguments[2]:void 0,d=Math.min((void 0===u?a:i(u,a))-c,a-s),f=1;for(c<s&&s<c+d&&(f=-1,c+=d-1,s+=d-1);d-- >0;)c in r?r[s]=r[c]:delete r[s],s+=f,c+=f;return r}},function(e,t,r){(function(t){function n(e){var t=a([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]]).filter(function(t){return t.rule&&t.rule.test(e)})[0];return t?t.name:null}function i(){return"undefined"==typeof navigator&&void 0!==t?{name:"node",version:t.version.slice(1),os:r(161).type().toLowerCase()}:null}function o(e){var t=a([["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\ ([0-9\.]+)/]]);if(!e)return null;var r=t.map(function(t){var r=t.rule.exec(e),n=r&&r[1].split(/[._]/).slice(0,3);return n&&n.length<3&&(n=n.concat(1==n.length?[0,0]:[0])),r&&{name:t.name,version:n.join(".")}}).filter(Boolean)[0]||null;return r&&(r.os=n(e)),/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/i.test(e)&&((r=r||{}).bot=!0),r}function a(e){return e.map(function(e){return{name:e[0],rule:e[1]}})}e.exports={detect:function(){var e=i();return e||("undefined"!=typeof navigator?o(navigator.userAgent):null)},detectOS:n,getNodeVersion:i,parseUserAgent:o}}).call(this,r(108))},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,r){(function(r){var n;t=e.exports=q,n="object"==typeof r&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],s=t.src=[],c=0,u=c++;s[u]="0|[1-9]\\d*";var d=c++;s[d]="[0-9]+";var f=c++;s[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var l=c++;s[l]="("+s[u]+")\\.("+s[u]+")\\.("+s[u]+")";var h=c++;s[h]="("+s[d]+")\\.("+s[d]+")\\.("+s[d]+")";var p=c++;s[p]="(?:"+s[u]+"|"+s[f]+")";var v=c++;s[v]="(?:"+s[d]+"|"+s[f]+")";var m=c++;s[m]="(?:-("+s[p]+"(?:\\."+s[p]+")*))";var g=c++;s[g]="(?:-?("+s[v]+"(?:\\."+s[v]+")*))";var y=c++;s[y]="[0-9A-Za-z-]+";var b=c++;s[b]="(?:\\+("+s[y]+"(?:\\."+s[y]+")*))";var S=c++,w="v?"+s[l]+s[m]+"?"+s[b]+"?";s[S]="^"+w+"$";var _="[v=\\s]*"+s[h]+s[g]+"?"+s[b]+"?",E=c++;s[E]="^"+_+"$";var T=c++;s[T]="((?:<|>)?=?)";var R=c++;s[R]=s[d]+"|x|X|\\*";var C=c++;s[C]=s[u]+"|x|X|\\*";var x=c++;s[x]="[v=\\s]*("+s[C]+")(?:\\.("+s[C]+")(?:\\.("+s[C]+")(?:"+s[m]+")?"+s[b]+"?)?)?";var k=c++;s[k]="[v=\\s]*("+s[R]+")(?:\\.("+s[R]+")(?:\\.("+s[R]+")(?:"+s[g]+")?"+s[b]+"?)?)?";var P=c++;s[P]="^"+s[T]+"\\s*"+s[x]+"$";var I=c++;s[I]="^"+s[T]+"\\s*"+s[k]+"$";var O=c++;s[O]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var M=c++;s[M]="(?:~>?)";var A=c++;s[A]="(\\s*)"+s[M]+"\\s+",a[A]=new RegExp(s[A],"g");var D=c++;s[D]="^"+s[M]+s[x]+"$";var L=c++;s[L]="^"+s[M]+s[k]+"$";var N=c++;s[N]="(?:\\^)";var j=c++;s[j]="(\\s*)"+s[N]+"\\s+",a[j]=new RegExp(s[j],"g");var B=c++;s[B]="^"+s[N]+s[x]+"$";var F=c++;s[F]="^"+s[N]+s[k]+"$";var U=c++;s[U]="^"+s[T]+"\\s*("+_+")$|^$";var G=c++;s[G]="^"+s[T]+"\\s*("+w+")$|^$";var W=c++;s[W]="(\\s*)"+s[T]+"\\s*("+_+"|"+s[x]+")",a[W]=new RegExp(s[W],"g");var V=c++;s[V]="^\\s*("+s[x]+")\\s+-\\s+("+s[x]+")\\s*$";var H=c++;s[H]="^\\s*("+s[k]+")\\s+-\\s+("+s[k]+")\\s*$";var X=c++;s[X]="(<|>)?=?\\s*\\*";for(var z=0;z<c;z++)n(z,s[z]),a[z]||(a[z]=new RegExp(s[z]));function K(e,t){if(e instanceof q)return e;if("string"!=typeof e)return null;if(e.length>i)return null;if(!(t?a[E]:a[S]).test(e))return null;try{return new q(e,t)}catch(e){return null}}function q(e,t){if(e instanceof q){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof q))return new q(e,t);n("SemVer",e,t),this.loose=t;var r=e.trim().match(t?a[E]:a[S]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}t.parse=K,t.valid=function(e,t){var r=K(e,t);return r?r.version:null},t.clean=function(e,t){var r=K(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null},t.SemVer=q,q.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},q.prototype.toString=function(){return this.version},q.prototype.compare=function(e){return n("SemVer.compare",this.version,this.loose,e),e instanceof q||(e=new q(e,this.loose)),this.compareMain(e)||this.comparePre(e)},q.prototype.compareMain=function(e){return e instanceof q||(e=new q(e,this.loose)),$(this.major,e.major)||$(this.minor,e.minor)||$(this.patch,e.patch)},q.prototype.comparePre=function(e){if(e instanceof q||(e=new q(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return $(r,i)}while(++t)},q.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,r,n){"string"==typeof r&&(n=r,r=void 0);try{return new q(e,r).inc(t,n).version}catch(e){return null}},t.diff=function(e,t){if(ee(e,t))return null;var r=K(e),n=K(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},t.compareIdentifiers=$;var J=/^[0-9]+$/;function $(e,t){var r=J.test(e),n=J.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function Z(e,t,r){return new q(e,r).compare(new q(t,r))}function Y(e,t,r){return Z(e,t,r)>0}function Q(e,t,r){return Z(e,t,r)<0}function ee(e,t,r){return 0===Z(e,t,r)}function te(e,t,r){return 0!==Z(e,t,r)}function re(e,t,r){return Z(e,t,r)>=0}function ne(e,t,r){return Z(e,t,r)<=0}function ie(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=ee(e,r,n);break;case"!=":i=te(e,r,n);break;case">":i=Y(e,r,n);break;case">=":i=re(e,r,n);break;case"<":i=Q(e,r,n);break;case"<=":i=ne(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function oe(e,t){if(e instanceof oe){if(e.loose===t)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.loose=t,this.parse(e),this.semver===ae?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return $(t,e)},t.major=function(e,t){return new q(e,t).major},t.minor=function(e,t){return new q(e,t).minor},t.patch=function(e,t){return new q(e,t).patch},t.compare=Z,t.compareLoose=function(e,t){return Z(e,t,!0)},t.rcompare=function(e,t,r){return Z(t,e,r)},t.sort=function(e,r){return e.sort(function(e,n){return t.compare(e,n,r)})},t.rsort=function(e,r){return e.sort(function(e,n){return t.rcompare(e,n,r)})},t.gt=Y,t.lt=Q,t.eq=ee,t.neq=te,t.gte=re,t.lte=ne,t.cmp=ie,t.Comparator=oe;var ae={};function se(e,t){if(e instanceof se)return e.loose===t?e:new se(e.raw,t);if(e instanceof oe)return new se(e.value,t);if(!(this instanceof se))return new se(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ce(e){return!e||"x"===e.toLowerCase()||"*"===e}function ue(e,t,r,n,i,o,a,s,c,u,d,f,l){return((t=ce(r)?"":ce(n)?">="+r+".0.0":ce(i)?">="+r+"."+n+".0":">="+t)+" "+(s=ce(c)?"":ce(u)?"<"+(+c+1)+".0.0":ce(d)?"<"+c+"."+(+u+1)+".0":f?"<="+c+"."+u+"."+d+"-"+f:"<="+s)).trim()}function de(e,t){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(r=0;r<e.length;r++)if(n(e[r].semver),e[r].semver!==ae&&e[r].semver.prerelease.length>0){var i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}function fe(e,t,r){try{t=new se(t,r)}catch(e){return!1}return t.test(e)}function le(e,t,r,n){var i,o,a,s,c;switch(e=new q(e,n),t=new se(t,n),r){case">":i=Y,o=ne,a=Q,s=">",c=">=";break;case"<":i=Q,o=re,a=Y,s="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(fe(e,t,n))return!1;for(var u=0;u<t.set.length;++u){var d=null,f=null;if(t.set[u].forEach(function(e){e.semver===ae&&(e=new oe(">=0.0.0")),d=d||e,f=f||e,i(e.semver,d.semver,n)?d=e:a(e.semver,f.semver,n)&&(f=e)}),d.operator===s||d.operator===c)return!1;if((!f.operator||f.operator===s)&&o(e,f.semver))return!1;if(f.operator===c&&a(e,f.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.loose?a[U]:a[G],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new q(r[2],this.loose):this.semver=ae},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.loose),this.semver===ae||("string"==typeof e&&(e=new q(e,this.loose)),ie(e,this.operator,this.semver,this.loose))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var r;if(""===this.operator)return r=new se(e.value,t),fe(this.value,r,t);if(""===e.operator)return r=new se(this.value,t),fe(e.semver,r,t);var n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=ie(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=ie(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||o&&a||s||c},t.Range=se,se.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},se.prototype.toString=function(){return this.range},se.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),n("range",e,t);var r=t?a[H]:a[V];e=e.replace(r,ue),n("hyphen replace",e),e=e.replace(a[W],"$1$2$3"),n("comparator trim",e,a[W]),e=(e=(e=e.replace(a[A],"$1~")).replace(a[j],"$1^")).split(/\s+/).join(" ");var i=t?a[U]:a[G],o=e.split(" ").map(function(e){return function(e,t){return n("comp",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t);var r=t?a[F]:a[B];return e.replace(r,function(t,r,i,o,a){var s;return n("caret",e,t,r,i,o,a),ce(r)?s="":ce(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ce(o)?s="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":a?(n("replaceCaret pr",a),"-"!==a.charAt(0)&&(a="-"+a),s="0"===r?"0"===i?">="+r+"."+i+"."+o+a+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+a+" <"+(+r+1)+".0.0"):(n("no pr"),s="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",s),s})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){var r=t?a[L]:a[D];return e.replace(r,function(t,r,i,o,a){var s;return n("tilde",e,t,r,i,o,a),ce(r)?s="":ce(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ce(o)?s=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":a?(n("replaceTilde pr",a),"-"!==a.charAt(0)&&(a="-"+a),s=">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0"):s=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",s),s})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim();var r=t?a[I]:a[P];return e.replace(r,function(t,r,i,o,a,s){n("xRange",e,t,r,i,o,a,s);var c=ce(i),u=c||ce(o),d=u||ce(a),f=d;return"="===r&&f&&(r=""),c?t=">"===r||"<"===r?"<0.0.0":"*":r&&f?(u&&(o=0),d&&(a=0),">"===r?(r=">=",u?(i=+i+1,o=0,a=0):d&&(o=+o+1,a=0)):"<="===r&&(r="<",u?i=+i+1:o=+o+1),t=r+i+"."+o+"."+a):u?t=">="+i+".0.0 <"+(+i+1)+".0.0":d&&(t=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(a[X],"")}(e,t),n("stars",e),e}(e,t)}).join(" ").split(/\s+/);return this.loose&&(o=o.filter(function(e){return!!e.match(i)})),o=o.map(function(e){return new oe(e,t)})},se.prototype.intersects=function(e,t){if(!(e instanceof se))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(r){return e.set.some(function(e){return e.every(function(e){return r.intersects(e,t)})})})})},t.toComparators=function(e,t){return new se(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},se.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new q(e,this.loose));for(var t=0;t<this.set.length;t++)if(de(this.set[t],e))return!0;return!1},t.satisfies=fe,t.maxSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&-1!==i.compare(e)||(i=new q(n=e,r)))}),n},t.minSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&1!==i.compare(e)||(i=new q(n=e,r)))}),n},t.validRange=function(e,t){try{return new se(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,r){return le(e,t,"<",r)},t.gtr=function(e,t,r){return le(e,t,">",r)},t.outside=le,t.prerelease=function(e,t){var r=K(e,t);return r&&r.prerelease.length?r.prerelease:null},t.intersects=function(e,t,r){return e=new se(e,r),t=new se(t,r),e.intersects(t)},t.coerce=function(e){if(e instanceof q)return e;if("string"!=typeof e)return null;var t=e.match(a[O]);return null==t?null:K((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,r(108))},function(e,t,r){!function(){"use strict";var t=r(164),n=r(165),i=31,o=139,a={deflate:8},s={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},c={fat:0,amiga:1,vmz:2,unix:3,"vm/cms":4,atari:5,hpfs:6,macintosh:7,"z-system":8,cplm:9,"tops-20":10,ntfs:11,qdos:12,acorn:13,vfat:14,vms:15,beos:16,tandem:17,theos:18},u="unix",d=6;function f(e,t){t.push(255&e)}function l(e,t){t.push(255&e),t.push(e>>>8)}function h(e,t){l(65535&e,t),l(e>>>16,t)}function p(e){return e.shift()}function v(e){return e.shift()|e.shift()<<8}function m(e){var t=v(e),r=v(e);return r>32768?((r-=32768)<<16|t)+32768*Math.pow(2,16):r<<16|t}function g(e){for(var t=[];0!==e[0];)t.push(String.fromCharCode(e.shift()));return e.shift(),t.join("")}e.exports={zip:function(e,r){var l,p=0,v=[];return r||(r={}),l=r.level||d,"string"==typeof e&&(e=Array.prototype.map.call(e,function(e){return e.charCodeAt(0)})),f(i,v),f(o,v),f(a.deflate,v),r.name&&(p|=s.FNAME),f(p,v),h(r.timestamp||parseInt(Date.now()/1e3,10),v),f(1===l?4:9===l?2:0,v),f(c[u],v),r.name&&(function(e,t){var r,n=e.length;for(r=0;r<n;r+=1)f(e.charCodeAt(r),t)}(r.name.substring(r.name.lastIndexOf("/")+1),v),f(0,v)),n.deflate(e,l).forEach(function(e){f(e,v)}),h(parseInt(t(e),16),v),h(e.length,v),v},unzip:function(e,r){var u,d,f,l,h=Array.prototype.slice.call(e,0);if(p(h)!==i||p(h)!==o)throw"Not a GZIP file";if(u=p(h),!(u=Object.keys(a).some(function(e){return d=e,a[e]===u})))throw"Unsupported compression method";if(f=p(h),m(h),p(h),u=p(h),Object.keys(c).some(function(e){if(c[e]===u)return!0}),f&s.FEXTRA&&function(e,t){var r,n=[];for(r=0;r<t;r+=1)n.push(e.shift())}(h,u=v(h)),f&s.FNAME&&g(h),f&s.FCOMMENT&&g(h),f&s.FHCRC&&v(h),"deflate"===d&&(l=n.inflate(h.splice(0,h.length-8))),f&s.FTEXT&&(l=Array.prototype.map.call(l,function(e){return String.fromCharCode(e)}).join("")),m(h)!==parseInt(t(l),16))throw"Checksum does not match";if(m(h)!==l.length)throw"Size of decompressed file not correct";return l},get DEFAULT_LEVEL(){return d}}}()},function(e,t){!function(){"use strict";var t=[],r=3988292384;function n(e){var t,n,i,o,a=-1;for(t=0,i=e.length;t<i;t+=1){for(o=255&(a^e[t]),n=0;n<8;n+=1)1==(1&o)?o=o>>>1^r:o>>>=1;a=a>>>8^o}return-1^a}function i(e,r){var n,o,a;if(void 0!==i.crc&&r&&e||(i.crc=-1,e)){for(n=i.crc,o=0,a=e.length;o<a;o+=1)n=n>>>8^t[255&(n^e[o])];return i.crc=n,-1^n}}!function(){var e,n,i;for(n=0;n<256;n+=1){for(e=n,i=0;i<8;i+=1)1&e?e=r^e>>>1:e>>>=1;t[n]=e>>>0}}(),e.exports=function(e,t){e="string"==typeof e?function(e){return Array.prototype.map.call(e,function(e){return e.charCodeAt(0)})}(e):e;return((t?n(e):i(e))>>>0).toString(16)},e.exports.direct=n,e.exports.table=i}()},function(e,t,r){!function(){"use strict";e.exports={inflate:r(166),deflate:r(167)}}()},function(e,t){!function(){var t,r,n,i,o,a,s,c,u,d,f,l,h,p,v,m,g,y=32768,b=0,S=1,w=2,_=9,E=6,T=null,R=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],C=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],k=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function O(){this.next=null,this.list=null}function M(){this.e=0,this.b=0,this.n=0,this.t=null}function A(e,t,r,n,i,o){var a;this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var s,c,u,d,f,l,h,p,v,m,g,y,b,S,w,_,E=[],T=[],R=new M,C=[],x=[],k=[];for(_=this.root=null,f=0;f<this.BMAX+1;f++)E[f]=0;for(f=0;f<this.BMAX+1;f++)T[f]=0;for(f=0;f<this.BMAX;f++)C[f]=null;for(f=0;f<this.N_MAX;f++)x[f]=0;for(f=0;f<this.BMAX+1;f++)k[f]=0;s=t>256?e[256]:this.BMAX,p=e,v=0,f=t;do{E[p[v]]++,v++}while(--f>0);if(E[0]===t)return this.root=null,this.m=0,void(this.status=0);for(l=1;l<=this.BMAX&&0===E[l];l++);for(h=l,o<l&&(o=l),f=this.BMAX;0!==f&&0===E[f];f--);for(u=f,o>f&&(o=f),b=1<<l;l<f;l++,b<<=1)if((b-=E[l])<0)return this.status=2,void(this.m=o);if((b-=E[f])<0)return this.status=2,void(this.m=o);for(E[f]+=b,k[1]=l=0,p=E,v=1,y=2;--f>0;)k[y++]=l+=p[v++];p=e,v=0,f=0;do{0!==(l=p[v++])&&(x[k[l]++]=f)}while(++f<t);for(t=k[u],k[0]=f=0,p=x,v=0,d=-1,g=T[0]=0,m=null,S=0;h<=u;h++)for(a=E[h];a-- >0;){for(;h>g+T[1+d];){if(g+=T[1+d],d++,S=(S=u-g)>o?o:S,(c=1<<(l=h-g))>a+1)for(c-=a+1,y=h;++l<S&&!((c<<=1)<=E[++y]);)c-=E[y];for(g+l>s&&g<s&&(l=s-g),S=1<<l,T[1+d]=l,m=[],w=0;w<S;w++)m[w]=new M;(_=_?_.next=new O:this.root=new O).next=null,_.list=m,C[d]=m,d>0&&(k[d]=f,R.b=T[d],R.e=16+l,R.t=m,l=(f&(1<<g)-1)>>g-T[d],C[d-1][l].e=R.e,C[d-1][l].b=R.b,C[d-1][l].n=R.n,C[d-1][l].t=R.t)}for(R.b=h-g,v>=t?R.e=99:p[v]<r?(R.e=p[v]<256?16:15,R.n=p[v++]):(R.e=i[p[v]-r],R.n=n[p[v++]-r]),c=1<<h-g,l=f>>g;l<S;l+=c)m[l].e=R.e,m[l].b=R.b,m[l].n=R.n,m[l].t=R.t;for(l=1<<h-1;0!=(f&l);l>>=1)f^=l;for(f^=l;(f&(1<<g)-1)!==k[d];)g-=T[d],d--}this.m=T[1],this.status=0!==b&&1!==u?1:0}function D(e){for(;s<e;)a|=(m.length===g?-1:255&m[g++])<<s,s+=8}function L(e){return a&R[e]}function N(e){a>>=e,s-=e}function j(e,n,i){var o,a,s;if(0===i)return 0;for(s=0;;){for(D(p),o=(a=l.list[L(p)]).e;o>16;){if(99===o)return-1;N(a.b),D(o-=16),o=(a=a.t[L(o)]).e}if(N(a.b),16!==o){if(15===o)break;for(D(o),d=a.n+L(o),N(o),D(v),o=(a=h.list[L(v)]).e;o>16;){if(99===o)return-1;N(a.b),D(o-=16),o=(a=a.t[L(o)]).e}for(N(a.b),D(o),f=r-a.n-L(o),N(o);d>0&&s<i;)d--,f&=y-1,r&=y-1,e[n+s++]=t[r++]=t[f++];if(s===i)return i}else if(r&=y-1,e[n+s++]=t[r++]=a.n,s===i)return i}return c=-1,s}function B(e,n,i){var o;if(N(o=7&s),D(16),o=L(16),N(16),D(16),o!==(65535&~a))return-1;for(N(16),d=o,o=0;d>0&&o<i;)d--,r&=y-1,D(8),e[n+o++]=t[r++]=L(8),N(8);return 0===d&&(c=-1),o}function F(e,t,r){if(!T){var a,s,c=[];for(a=0;a<144;a++)c[a]=8;for(;a<256;a++)c[a]=9;for(;a<280;a++)c[a]=7;for(;a<288;a++)c[a]=8;if(0!==(s=new A(c,288,257,C,x,i=7)).status)return console.error("HufBuild error: "+s.status),-1;for(T=s.root,i=s.m,a=0;a<30;a++)c[a]=5;if((s=new A(c,30,0,k,P,o=5)).status>1)return T=null,console.error("HufBuild error: "+s.status),-1;n=s.root,o=s.m}return l=T,h=n,p=i,v=o,j(e,t,r)}function U(e,t,r){var n,i,o,a,s,c,u,d,f,m=[];for(n=0;n<316;n++)m[n]=0;if(D(5),u=257+L(5),N(5),D(5),d=1+L(5),N(5),D(4),c=4+L(4),N(4),u>286||d>30)return-1;for(i=0;i<c;i++)D(3),m[I[i]]=L(3),N(3);for(;i<19;i++)m[I[i]]=0;if(0!==(f=new A(m,19,19,null,null,p=7)).status)return-1;for(l=f.root,p=f.m,a=u+d,n=o=0;n<a;)if(D(p),N(i=(s=l.list[L(p)]).b),(i=s.n)<16)m[n++]=o=i;else if(16===i){if(D(2),i=3+L(2),N(2),n+i>a)return-1;for(;i-- >0;)m[n++]=o}else if(17===i){if(D(3),i=3+L(3),N(3),n+i>a)return-1;for(;i-- >0;)m[n++]=0;o=0}else{if(D(7),i=11+L(7),N(7),n+i>a)return-1;for(;i-- >0;)m[n++]=0;o=0}if(f=new A(m,u,257,C,x,p=_),0===p&&(f.status=1),0!==f.status&&1!==f.status)return-1;for(l=f.root,p=f.m,n=0;n<d;n++)m[n]=m[n+u];return f=new A(m,d,0,k,P,v=E),h=f.root,0===(v=f.m)&&u>257?-1:0!==f.status?-1:j(e,t,r)}function G(e,n,i){var o,a;for(o=0;o<i;){if(u&&-1===c)return o;if(d>0){if(c!==b)for(;d>0&&o<i;)d--,f&=y-1,r&=y-1,e[n+o++]=t[r++]=t[f++];else{for(;d>0&&o<i;)d--,r&=y-1,D(8),e[n+o++]=t[r++]=L(8),N(8);0===d&&(c=-1)}if(o===i)return o}if(-1===c){if(u)break;D(1),0!==L(1)&&(u=!0),N(1),D(2),c=L(2),N(2),l=null,d=0}switch(c){case b:a=B(e,n+o,i-o);break;case S:a=l?j(e,n+o,i-o):F(e,n+o,i-o);break;case w:a=l?j(e,n+o,i-o):U(e,n+o,i-o);break;default:a=-1}if(-1===a)return u?0:-1;o+=a}return o}e.exports=function(e){var n,i=[];t||(t=[]),r=0,a=0,s=0,c=-1,u=!1,d=f=0,l=null,m=e,g=0;do{n=G(i,i.length,1024)}while(n>0);return m=null,i}}()},function(e,t){!function(){var t,r,n,i,o,a,s,c,u,d,f,l,h,p,v,m,g,y,b,S,w,_,E,T,R,C,x,k,P,I,O,M,A,D,L,N,j,B,F,U,G,W,V,H,X,z,K,q,J,$,Z,Y,Q,ee,te,re,ne=32768,ie=0,oe=1,ae=2,se=6,ce=!1,ue=8192,de=2*ne,fe=3,le=258,he=8192,pe=he,ve=32768,me=ve-1,ge=ne-1,ye=0,be=4096,Se=le+fe+1,we=ne-Se,_e=1,Ee=15,Te=7,Re=29,Ce=256,xe=256,ke=Ce+1+Re,Pe=30,Ie=19,Oe=16,Me=17,Ae=18,De=2*ke+1,Le=parseInt((15+fe-1)/fe,10),Ne=null;function je(){this.fc=0,this.dl=0}function Be(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function Fe(e,t,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n}he>32768&&console.error("error: INBUFSIZ is too small"),ne<<1>65536&&console.error("error: WSIZE is too large"),258!==le&&console.error("error: Code too clever");var Ue=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ge=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],We=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],He=[new Fe(0,0,0,0),new Fe(4,4,8,4),new Fe(4,5,16,8),new Fe(4,6,32,32),new Fe(4,4,16,16),new Fe(8,16,32,32),new Fe(8,16,128,128),new Fe(8,32,128,256),new Fe(32,128,258,1024),new Fe(32,258,258,4096)];function Xe(e){e.next=t,t=e}function ze(e){return f[ne+e]}function Ke(e,t){return f[ne+e]=t}function qe(e){Ne[a+o++]=e,a+o===ue&&function(){var e,i;if(0!==o){for(e=function(){var e;return null!==t?(e=t,t=t.next):e=new function(){this.next=null,this.len=0,this.ptr=[],this.off=0},e.next=null,e.len=e.off=0,e}(),null===r?r=n=e:n=n.next=e,e.len=o-a,i=0;i<e.len;i++)e.ptr[i]=Ne[a+i];o=a=0}}()}function Je(e){e&=65535,a+o<ue-2?(Ne[a+o++]=255&e,Ne[a+o++]=e>>>8):(qe(255&e),qe(e>>>8))}function $e(){v=(v<<Le^255&c[w+fe-1])&me,m=ze(v),f[w&ge]=m,Ke(v,w)}function Ze(e,t){mt(t[e].fc,t[e].dl)}function Ye(e){return 255&(e<256?H[e]:H[256+(e>>7)])}function Qe(e,t,r){return e[t].fc<e[r].fc||e[t].fc===e[r].fc&&W[t]<=W[r]}function et(e,t,r){var n;for(n=0;n<r&&re<te.length;n++)e[t+n]=255&te[re++];return n}function tt(e){var t,r,n,i,o=R,a=w,s=S,u=w>we?w-we:ye,d=w+le,l=c[a+s-1],h=c[a+s];S>=k&&(o>>=2);do{if(c[(t=e)+s]===h&&c[t+s-1]===l&&c[t]===c[a]&&c[++t]===c[a+1]){for(a+=2,t++;a<d;){for(i=!1,n=0;n<8;n+=1)if(t+=1,c[a+=1]!==c[t]){i=!0;break}if(i)break}if(r=le-(d-a),a=d-le,r>s){if(_=e,s=r,ce){if(r>=le)break}else if(r>=P)break;l=c[a+s-1],h=c[a+s]}}}while((e=f[e&ge])>u&&0!=--o);return s}function rt(){var e,t,r=de-T-w;if(-1===r)r--;else if(w>=ne+we){for(e=0;e<ne;e++)c[e]=c[e+ne];for(_-=ne,w-=ne,p-=ne,e=0;e<ve;e++)Ke(e,(t=ze(e))>=ne?t-ne:ye);for(e=0;e<ne;e++)t=f[e],f[e]=t>=ne?t-ne:ye;r+=ne}E||((e=et(c,w+T,r))<=0?E=!0:T+=e)}function nt(){E||(l=0,h=0,function(){var e,t,r,n,i;if(0!==A[0].dl)return;for(L.dyn_tree=I,L.static_tree=M,L.extra_bits=Ue,L.extra_base=Ce+1,L.elems=ke,L.max_length=Ee,L.max_code=0,N.dyn_tree=O,N.static_tree=A,N.extra_bits=Ge,N.extra_base=0,N.elems=Pe,N.max_length=Ee,N.max_code=0,j.dyn_tree=D,j.static_tree=null,j.extra_bits=We,j.extra_base=0,j.elems=Ie,j.max_length=Te,j.max_code=0,r=0,n=0;n<Re-1;n++)for(X[n]=r,e=0;e<1<<Ue[n];e++)V[r++]=n;for(V[r-1]=n,i=0,n=0;n<16;n++)for(z[n]=i,e=0;e<1<<Ge[n];e++)H[i++]=n;for(i>>=7;n<Pe;n++)for(z[n]=i<<7,e=0;e<1<<Ge[n]-7;e++)H[256+i++]=n;for(t=0;t<=Ee;t++)B[t]=0;e=0;for(;e<=143;)M[e++].dl=8,B[8]++;for(;e<=255;)M[e++].dl=9,B[9]++;for(;e<=279;)M[e++].dl=7,B[7]++;for(;e<=287;)M[e++].dl=8,B[8]++;for(ct(M,ke+1),e=0;e<Pe;e++)A[e].dl=5,A[e].fc=gt(e,5);at()}(),function(){var e;for(e=0;e<ve;e++)f[ne+e]=0;if(C=He[x].max_lazy,k=He[x].good_length,ce||(P=He[x].nice_length),R=He[x].max_chain,w=0,p=0,(T=et(c,0,2*ne))<=0)return E=!0,void(T=0);for(E=!1;T<Se&&!E;)rt();for(v=0,e=0;e<fe-1;e++)v=(v<<Le^255&c[e])&me}(),r=null,o=0,a=0,x<=3?(S=fe-1,b=0):(b=fe-1,y=!1),s=!1)}function it(e,t,n){var o;return i||(nt(),i=!0,0!==T)?(o=ot(e,t,n))===n?n:s?o:(x<=3?function(){for(;0!==T&&null===r;){var e;if($e(),m!==ye&&w-m<=we&&(b=tt(m))>T&&(b=T),b>=fe)if(e=ht(w-_,b-fe),T-=b,b<=C){b--;do{w++,$e()}while(0!=--b);w++}else w+=b,b=0,v=((v=255&c[w])<<Le^255&c[w+1])&me;else e=ht(0,255&c[w]),T--,w++;for(e&&(lt(0),p=w);T<Se&&!E;)rt()}}():function(){for(;0!==T&&null===r;){if($e(),S=b,g=_,b=fe-1,m!==ye&&S<C&&w-m<=we&&((b=tt(m))>T&&(b=T),b===fe&&w-_>be&&b--),S>=fe&&b<=S){var e;e=ht(w-1-g,S-fe),T-=S-1,S-=2;do{w++,$e()}while(0!=--S);y=!1,b=fe-1,w++,e&&(lt(0),p=w)}else y?(ht(0,255&c[w-1])&&(lt(0),p=w),w++,T--):(y=!0,w++,T--);for(;T<Se&&!E;)rt()}}(),0===T&&(y&&ht(0,255&c[w-1]),lt(1),s=!0),o+ot(e,o+t,n-o)):(s=!0,0)}function ot(e,t,n){var i,s,c;for(i=0;null!==r&&i<n;){for((s=n-i)>r.len&&(s=r.len),c=0;c<s;c++)e[t+i+c]=r.ptr[r.off+c];var u;if(r.off+=s,r.len-=s,i+=s,0===r.len)u=r,r=r.next,Xe(u)}if(i===n)return i;if(a<o){for((s=n-i)>o-a&&(s=o-a),c=0;c<s;c++)e[t+i+c]=Ne[a+c];i+=s,o===(a+=s)&&(o=a=0)}return i}function at(){var e;for(e=0;e<ke;e++)I[e].fc=0;for(e=0;e<Pe;e++)O[e].fc=0;for(e=0;e<Ie;e++)D[e].fc=0;I[xe].fc=1,Q=ee=0,q=J=$=0,Z=0,Y=1}function st(e,t){for(var r=F[t],n=t<<1;n<=U&&(n<U&&Qe(e,F[n+1],F[n])&&n++,!Qe(e,r,F[n]));)F[t]=F[n],t=n,n<<=1;F[t]=r}function ct(e,t){var r,n,i=[],o=0;for(r=1;r<=Ee;r++)o=o+B[r-1]<<1,i[r]=o;for(n=0;n<=t;n++){var a=e[n].dl;0!==a&&(e[n].fc=gt(i[a]++,a))}}function ut(e){var t,r,n=e.dyn_tree,i=e.static_tree,o=e.elems,a=-1,s=o;for(U=0,G=De,t=0;t<o;t++)0!==n[t].fc?(F[++U]=a=t,W[t]=0):n[t].dl=0;for(;U<2;){var c=F[++U]=a<2?++a:0;n[c].fc=1,W[c]=0,Q--,null!==i&&(ee-=i[c].dl)}for(e.max_code=a,t=U>>1;t>=1;t--)st(n,t);do{t=F[_e],F[_e]=F[U--],st(n,_e),r=F[_e],F[--G]=t,F[--G]=r,n[s].fc=n[t].fc+n[r].fc,W[t]>W[r]+1?W[s]=W[t]:W[s]=W[r]+1,n[t].dl=n[r].dl=s,F[_e]=s++,st(n,_e)}while(U>=2);F[--G]=F[_e],function(e){var t,r,n,i,o,a,s=e.dyn_tree,c=e.extra_bits,u=e.extra_base,d=e.max_code,f=e.max_length,l=e.static_tree,h=0;for(i=0;i<=Ee;i++)B[i]=0;for(s[F[G]].dl=0,t=G+1;t<De;t++)(i=s[s[r=F[t]].dl].dl+1)>f&&(i=f,h++),s[r].dl=i,r>d||(B[i]++,o=0,r>=u&&(o=c[r-u]),a=s[r].fc,Q+=a*(i+o),null!==l&&(ee+=a*(l[r].dl+o)));if(0!==h){do{for(i=f-1;0===B[i];)i--;B[i]--,B[i+1]+=2,B[f]--,h-=2}while(h>0);for(i=f;0!==i;i--)for(r=B[i];0!==r;)(n=F[--t])>d||(s[n].dl!==i&&(Q+=(i-s[n].dl)*s[n].fc,s[n].fc=i),r--)}}(e),ct(n,a)}function dt(e,t){var r,n,i=-1,o=e[0].dl,a=0,s=7,c=4;for(0===o&&(s=138,c=3),e[t+1].dl=65535,r=0;r<=t;r++)n=o,o=e[r+1].dl,++a<s&&n===o||(a<c?D[n].fc+=a:0!==n?(n!==i&&D[n].fc++,D[Oe].fc++):a<=10?D[Me].fc++:D[Ae].fc++,a=0,i=n,0===o?(s=138,c=3):n===o?(s=6,c=3):(s=7,c=4))}function ft(e,t){var r,n,i=-1,o=e[0].dl,a=0,s=7,c=4;for(0===o&&(s=138,c=3),r=0;r<=t;r++)if(n=o,o=e[r+1].dl,!(++a<s&&n===o)){if(a<c)do{Ze(n,D)}while(0!=--a);else 0!==n?(n!==i&&(Ze(n,D),a--),Ze(Oe,D),mt(a-3,2)):a<=10?(Ze(Me,D),mt(a-3,3)):(Ze(Ae,D),mt(a-11,7));a=0,i=n,0===o?(s=138,c=3):n===o?(s=6,c=3):(s=7,c=4)}}function lt(e){var t,r,n,i,o;if(i=w-p,K[$]=Z,ut(L),ut(N),n=function(){var e;for(dt(I,L.max_code),dt(O,N.max_code),ut(j),e=Ie-1;e>=3&&0===D[Ve[e]].dl;e--);return Q+=3*(e+1)+5+5+4,e}(),(r=ee+3+7>>3)<=(t=Q+3+7>>3)&&(t=r),i+4<=t&&p>=0)for(mt((ie<<1)+e,3),yt(),Je(i),Je(~i),o=0;o<i;o++)qe(c[p+o]);else r===t?(mt((oe<<1)+e,3),pt(M,A)):(mt((ae<<1)+e,3),function(e,t,r){var n;for(mt(e-257,5),mt(t-1,5),mt(r-4,4),n=0;n<r;n++)mt(D[Ve[n]].dl,3);ft(I,e-1),ft(O,t-1)}(L.max_code+1,N.max_code+1,n+1),pt(I,O));at(),0!==e&&yt()}function ht(e,t){if(d[q++]=t,0===e?I[t].fc++:(e--,I[V[t]+Ce+1].fc++,O[Ye(e)].fc++,u[J++]=e,Z|=Y),Y<<=1,0==(7&q)&&(K[$++]=Z,Z=0,Y=1),x>2&&0==(4095&q)){var r,n=8*q,i=w-p;for(r=0;r<Pe;r++)n+=O[r].fc*(5+Ge[r]);if(n>>=3,J<parseInt(q/2,10)&&n<parseInt(i/2,10))return!0}return q===he-1||J===pe}function pt(e,t){var r,n,i,o,a=0,s=0,c=0,f=0;if(0!==q)do{0==(7&a)&&(f=K[c++]),n=255&d[a++],0==(1&f)?Ze(n,e):(Ze((i=V[n])+Ce+1,e),0!==(o=Ue[i])&&mt(n-=X[i],o),Ze(i=Ye(r=u[s++]),t),0!==(o=Ge[i])&&mt(r-=z[i],o)),f>>=1}while(a<q);Ze(xe,e)}var vt=16;function mt(e,t){h>vt-t?(Je(l|=e<<h),l=e>>vt-h,h+=t-vt):(l|=e<<h,h+=t)}function gt(e,t){var r=0;do{r|=1&e,e>>=1,r<<=1}while(--t>0);return r>>1}function yt(){h>8?Je(l):h>0&&qe(l),l=0,h=0}e.exports=function(e,o){var a,s;te=e,re=0,void 0===o&&(o=se),function(e){var o;if(e?e<1?e=1:e>9&&(e=9):e=se,x=e,i=!1,E=!1,null===Ne){for(t=r=n=null,Ne=[],c=[],u=[],d=[],f=[],I=[],o=0;o<De;o++)I[o]=new je;for(O=[],o=0;o<2*Pe+1;o++)O[o]=new je;for(M=[],o=0;o<ke+2;o++)M[o]=new je;for(A=[],o=0;o<Pe;o++)A[o]=new je;for(D=[],o=0;o<2*Ie+1;o++)D[o]=new je;L=new Be,N=new Be,j=new Be,B=[],F=[],W=[],V=[],H=[],X=[],z=[],K=[]}}(o),s=[];do{a=it(s,s.length,1024)}while(a>0);return te=null,s},e.exports.DEFAULT_LEVEL=se}()},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0}),t.qosFeatureInit={camera_beauty:0,editor_watermark:0,hard_encode:0,hard_decode:0,soft_encode:0,soft_decode:0,manual_focus:0,kickout_user:0,mute_audio:0,mute_video:0,merge_stream:0}},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Idle=0]="Idle",e[e.Connecting=1]="Connecting",e[e.Connect=2]="Connect"}(t.StreamConnectStatus||(t.StreamConnectStatus={}))},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMergeJob={publishUrl:"",height:720,width:1080,fps:25,kbps:1e3,audioOnly:!1,stretchMode:"aspectFill"}},function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!c&&u)return r(s,!0);if(a)return a(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return o(r||e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,r,n){(function(e){"use strict";var t,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(d),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),t=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,t=function(){c.port2.postMessage(0)}}var u=[];function d(){var e,t;n=!0;for(var r=u.length;r;){for(t=u,u=[],e=-1;++e<r;)t[e]();r=u.length}n=!1}r.exports=function(e){1!==u.push(e)||n||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var n=e(1);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&h(this,e)}function d(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(e,t,r){n(function(){var n;try{n=t(r)}catch(t){return o.reject(e,t)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)})}function l(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var a=p(function(){t(i,n)});"error"===a.status&&n(a.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(i);if(this.state!==c){var n=this.state===s?e:t;f(r,n,this.outcome)}else this.queue.push(new d(r,e,t));return r},d.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){o.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=p(l,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)h(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},u.reject=function(e){var t=new this(i);return o.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,c=-1,u=new this(i);++c<r;)d(e[c],c);return u;function d(e,i){t.resolve(e).then(function(e){a[i]=e,++s!==r||n||(n=!0,o.resolve(u,a))},function(e){n||(n=!0,o.reject(u,e))})}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=-1,s=new this(i);++a<r;)c(e[a]);return s;function c(e){t.resolve(e).then(function(e){n||(n=!0,o.resolve(s,e))},function(e){n||(n=!0,o.reject(s,e))})}}},{1:1}],3:[function(e,r,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var r="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,n=new r,i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",l=void 0,h={},p=Object.prototype.toString,v="readonly",m="readwrite";function g(e){return"boolean"==typeof l?a.resolve(l):function(e){return new a(function(t){var r=e.transaction(f,m),n=o([""]);r.objectStore(f).put(n,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return l=e})}function y(e){var t=h[e.name],r={};r.promise=new a(function(e,t){r.resolve=e,r.reject=t}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise}function b(e){var t=h[e.name],r=t.deferredOperations.pop();if(r)return r.resolve(),r.promise}function S(e,t){var r=h[e.name],n=r.deferredOperations.pop();if(n)return n.reject(t),n.promise}function w(e,t){return new a(function(r,n){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);y(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var a=i.open.apply(i,o);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(f)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),b(e)}})}function _(e){return w(e,!1)}function E(e){return w(e,!0)}function T(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function R(e){var t=function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}(atob(e.data));return o([t],{type:e.type})}function C(e){return e&&e.__local_forage_encoded_blob}function x(e){var t=this,r=t._initReady().then(function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(r,e,e),r}function k(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return a.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),E(e)}).then(function(){return function(e){y(e);for(var t=h[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,_(e).then(function(t){return e.db=t,T(e)?E(e):t}).then(function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n}).catch(function(t){throw S(e,t),t})}(e).then(function(){k(e,t,r,n-1)})}).catch(r);r(i)}}var P={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var i=h[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},h[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=x);var o=[];function s(){return a.resolve()}for(var c=0;c<i.forages.length;c++){var u=i.forages[c];u!==t&&o.push(u._initReady().catch(s))}var d=i.forages.slice(0);return a.all(o).then(function(){return r.db=i.db,_(r)}).then(function(e){return r.db=e,T(r,t._defaultConfig.version)?E(r):e}).then(function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<d.length;n++){var o=d[n];o!==t&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}})},_support:function(){try{if(!i)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=new a(function(t,n){r.ready().then(function(){k(r._dbInfo,v,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=a.openCursor(),c=1;s.onsuccess=function(){var r=s.result;if(r){var n=r.value;C(n)&&(n=R(n));var i=e(n,r.key,c++);void 0!==i?t(i):r.continue()}else t()},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},getItem:function(e,t){var r=this;e=u(e);var n=new a(function(t,n){r.ready().then(function(){k(r._dbInfo,v,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=a.get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),C(e)&&(e=R(e)),t(e)},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},setItem:function(e,t,r){var n=this;e=u(e);var i=new a(function(r,i){var o;n.ready().then(function(){return o=n._dbInfo,"[object Blob]"===p.call(t)?g(o.db).then(function(e){return e?t:function(e){return new a(function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)})}(t)}):t}).then(function(t){k(n._dbInfo,m,function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),r(t)},a.onabort=a.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return s(i,r),i},removeItem:function(e,t){var r=this;e=u(e);var n=new a(function(t,n){r.ready().then(function(){k(r._dbInfo,m,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=a.delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},clear:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){k(t._dbInfo,m,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName),a=o.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return s(r,e),r},length:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){k(t._dbInfo,v,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName),a=o.count();a.onsuccess=function(){e(a.result)},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return s(r,e),r},key:function(e,t){var r=this,n=new a(function(t,n){e<0?t(null):r.ready().then(function(){k(r._dbInfo,v,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=!1,c=a.openCursor();c.onsuccess=function(){var r=c.result;r?0===e?t(r.key):s?t(r.key):(s=!0,r.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){k(t._dbInfo,v,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName),a=o.openCursor(),s=[];a.onsuccess=function(){var t=a.result;t?(s.push(t.key),t.continue()):e(s)},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return s(r,e),r},dropInstance:function(e,t){t=d.apply(this,arguments);var r,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){var o=e.name===n.name&&this._dbInfo.db,c=o?a.resolve(this._dbInfo.db):_(e).then(function(t){var r=h[e.name],n=r.forages;r.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t});r=e.storeName?c.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;y(e);var n=h[e.name],o=n.forages;t.close();for(var s=0;s<o.length;s++){var c=o[s];c._dbInfo.db=null,c._dbInfo.version=r}var u=new a(function(t,n){var o=i.open(e.name,r);o.onerror=function(e){var t=o.result;t.close(),n(e)},o.onupgradeneeded=function(){var t=o.result;t.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}});return u.then(function(e){n.db=e;for(var t=0;t<o.length;t++){var r=o[t];r._dbInfo.db=e,b(r._dbInfo)}}).catch(function(t){throw(S(e,t)||a.resolve()).catch(function(){}),t})}}):c.then(function(t){y(e);var r=h[e.name],n=r.forages;t.close();for(var o=0;o<n.length;o++){var s=n[o];s._dbInfo.db=null}var c=new a(function(t,r){var n=i.deleteDatabase(e.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),r(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}});return c.then(function(e){r.db=e;for(var t=0;t<n.length;t++){var i=n[t];b(i._dbInfo)}}).catch(function(t){throw(S(e,t)||a.resolve()).catch(function(){}),t})})}else r=a.reject("Invalid arguments");return s(r,t),r}},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O="~~local_forage_type~",M=/^~~local_forage_type~([^~]+)~/,A="__lfsc__:",D=A.length,L="arbf",N="blob",j="si08",B="ui08",F="uic8",U="si16",G="si32",W="ur16",V="ui32",H="fl32",X="fl64",z=D+L.length,K=Object.prototype.toString;function q(e){var t,r,n,i,o,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),d=new Uint8Array(u);for(t=0;t<s;t+=4)r=I.indexOf(e[t]),n=I.indexOf(e[t+1]),i=I.indexOf(e[t+2]),o=I.indexOf(e[t+3]),d[c++]=r<<2|n>>4,d[c++]=(15&n)<<4|i>>2,d[c++]=(3&i)<<6|63&o;return u}function J(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=I[r[t]>>2],n+=I[(3&r[t])<<4|r[t+1]>>4],n+=I[(15&r[t+1])<<2|r[t+2]>>6],n+=I[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var $={serialize:function(e,t){var r="";if(e&&(r=K.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===K.call(e.buffer))){var n,i=A;e instanceof ArrayBuffer?(n=e,i+=L):(n=e.buffer,"[object Int8Array]"===r?i+=j:"[object Uint8Array]"===r?i+=B:"[object Uint8ClampedArray]"===r?i+=F:"[object Int16Array]"===r?i+=U:"[object Uint16Array]"===r?i+=W:"[object Int32Array]"===r?i+=G:"[object Uint32Array]"===r?i+=V:"[object Float32Array]"===r?i+=H:"[object Float64Array]"===r?i+=X:t(new Error("Failed to get type for BinaryArray"))),t(i+J(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r=O+e.type+"~"+J(this.result);t(A+N+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if(e.substring(0,D)!==A)return JSON.parse(e);var t,r=e.substring(z),n=e.substring(D,z);if(n===N&&M.test(r)){var i=r.match(M);t=i[1],r=r.substring(i[0].length)}var a=q(r);switch(n){case L:return a;case N:return o([a],{type:t});case j:return new Int8Array(a);case B:return new Uint8Array(a);case F:return new Uint8ClampedArray(a);case U:return new Int16Array(a);case W:return new Uint16Array(a);case G:return new Int32Array(a);case V:return new Uint32Array(a);case H:return new Float32Array(a);case X:return new Float64Array(a);default:throw new Error("Unkown type: "+n)}},stringToBuffer:q,bufferToString:J};function Z(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function Y(e,t,r,n,i,o){e.executeSql(r,n,i,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?o(e,a):Z(e,t,function(){e.executeSql(r,n,i,o)},o)},o):o(e,a)},o)}var Q={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new a(function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction(function(i){Z(i,r,function(){t._dbInfo=r,e()},function(e,t){n(t)})},n)});return r.serializer=$,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new a(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){Y(r,i,"SELECT * FROM "+i.storeName,[],function(r,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var c=o.item(s),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,s+1)))return void t(u)}t()},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},getItem:function(e,t){var r=this;e=u(e);var n=new a(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){Y(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},setItem:function(e,t,r){return function e(t,r,n,i){var o=this;t=u(t);var c=new a(function(a,s){o.ready().then(function(){void 0===r&&(r=null);var c=r,u=o._dbInfo;u.serializer.serialize(r,function(r,d){d?s(d):u.db.transaction(function(e){Y(e,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[t,r],function(){a(c)},function(e,t){s(t)})},function(r){if(r.code===r.QUOTA_ERR){if(i>0)return void a(e.apply(o,[t,c,n,i-1]));s(r)}})})}).catch(s)});return s(c,n),c}.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=u(e);var n=new a(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){Y(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},clear:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){Y(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})}).catch(r)});return s(r,e),r},length:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){Y(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){var n=r.rows.item(0).c;e(n)},function(e,t){r(t)})})}).catch(r)});return s(r,e),r},key:function(e,t){var r=this,n=new a(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){Y(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){Y(t,n,"SELECT key FROM "+n.storeName,[],function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)},function(e,t){r(t)})})}).catch(r)});return s(r,e),r},dropInstance:function(e,t){t=d.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;return s(n=e.name?new a(function(t){var n;n=e.name===r.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(function(e){return new a(function(t,r){e.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(r,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o).name);t({db:e,storeNames:i})},function(e,t){r(t)})},function(e){r(e)})})}(n))}).then(function(e){return new a(function(t,r){e.db.transaction(function(n){function i(e){return new a(function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){r(t)})})}for(var o=[],s=0,c=e.storeNames.length;s<c;s++)o.push(i(e.storeNames[s]));a.all(o).then(function(){t()}).catch(function(e){r(e)})},function(e){r(e)})})}):a.reject("Invalid arguments"),t),n}};function ee(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function te(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var re={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=ee(e,this._defaultConfig),te()?(this._dbInfo=t,t.serializer=$,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=r.ready().then(function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),a++)))return u}}});return s(n,t),n},getItem:function(e,t){var r=this;e=u(e);var n=r.ready().then(function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n});return s(n,t),n},setItem:function(e,t,r){var n=this;e=u(e);var i=n.ready().then(function(){void 0===t&&(t=null);var r=t;return new a(function(i,o){var a=n._dbInfo;a.serializer.serialize(t,function(t,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+e,t),i(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}})})});return s(i,r),i},removeItem:function(e,t){var r=this;e=u(e);var n=r.ready().then(function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return s(n,t),n},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}});return s(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return s(t,e),t},key:function(e,t){var r=this,n=r.ready().then(function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return s(n,t),n},keys:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n});return s(r,e),r},dropInstance:function(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,i=this;return s(n=e.name?new a(function(t){e.storeName?t(ee(e,i._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}):a.reject("Invalid arguments"),t),n}},ne=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},ie=function(e,t){for(var r=e.length,n=0;n<r;){if(ne(e[n],t))return!0;n++}return!1},oe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ae={},se={},ce={INDEXEDDB:P,WEBSQL:Q,LOCALSTORAGE:re},ue=[ce.INDEXEDDB._driver,ce.WEBSQL._driver,ce.LOCALSTORAGE._driver],de=["dropInstance"],fe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(de),le={description:"",driver:ue.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function he(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function pe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(oe(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var ve=function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ce)if(ce.hasOwnProperty(r)){var n=ce[r],i=n._driver;this[r]=i,ae[i]||this.defineDriver(n)}this._defaultConfig=pe({},le),this._config=pe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new a(function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(i);for(var o=fe.concat("_initStorage"),c=0,u=o.length;c<u;c++){var d=o[c],f=!ie(de,d);if((f||e[d])&&"function"!=typeof e[d])return void r(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=a.reject(t);return s(r,arguments[arguments.length-1]),r}},r=0,n=de.length;r<n;r++){var i=de[r];e[i]||(e[i]=t(i))}}();var l=function(r){ae[n]&&console.info("Redefining LocalForage driver: "+n),ae[n]=e,se[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(l,r):l(!!e._support):l(!0)}catch(e){r(e)}});return c(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=ae[e]?a.resolve(ae[e]):a.reject(new Error("Driver not found."));return c(n,t,r),n},e.prototype.getSerializer=function(e){var t=a.resolve($);return c(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(r,e,e),r},e.prototype.setDriver=function(e,t,r){var n=this;oe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){n._config.driver=n.driver()}function s(e){return n._extend(e),o(),n._ready=n._initStorage(n._config),n._ready}var u=null!==this._driverSet?this._driverSet.catch(function(){return a.resolve()}):a.resolve();return this._driverSet=u.then(function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then(function(e){n._driver=e._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(s).catch(r)}o();var c=new Error("No available storage method found.");return n._driverSet=a.reject(c),n._driverSet}()}}(i)})}).catch(function(){o();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet}),c(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!se[e]},e.prototype._extend=function(e){pe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=fe.length;e<t;e++)he(this,fe[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),me=new ve;t.exports=me},{3:3}]},{},[4])(4)}).call(this,r(79))},function(e,t){!function(t,r,n){"use strict";"function"==typeof window.define&&window.define.amd?window.define(n):void 0!==e&&e.exports?e.exports=n():r.exports?r.exports=n():r.Fingerprint2=n()}(0,this,function(){"use strict";var e=function(t){if(!(this instanceof e))return new e(t);this.options=this.extend(t,{swfContainerId:"fingerprintjs2",swfPath:"flash/compiled/FontList.swf",detectScreenOrientation:!0,sortPluginsFor:[/palemoon/i],userDefinedFonts:[],excludeDoNotTrack:!0,excludePixelRatio:!0}),this.nativeForEach=Array.prototype.forEach,this.nativeMap=Array.prototype.map};return e.prototype={extend:function(e,t){if(null==e)return t;for(var r in e)null!=e[r]&&t[r]!==e[r]&&(t[r]=e[r]);return t},get:function(e){var t=this,r={data:[],addPreprocessedComponent:function(e){var n=e.value;"function"==typeof t.options.preprocessor&&(n=t.options.preprocessor(e.key,n)),r.data.push({key:e.key,value:n})}};r=this.userAgentKey(r),r=this.languageKey(r),r=this.colorDepthKey(r),r=this.deviceMemoryKey(r),r=this.pixelRatioKey(r),r=this.hardwareConcurrencyKey(r),r=this.screenResolutionKey(r),r=this.availableScreenResolutionKey(r),r=this.timezoneOffsetKey(r),r=this.sessionStorageKey(r),r=this.localStorageKey(r),r=this.indexedDbKey(r),r=this.addBehaviorKey(r),r=this.openDatabaseKey(r),r=this.cpuClassKey(r),r=this.platformKey(r),r=this.doNotTrackKey(r),r=this.pluginsKey(r),r=this.canvasKey(r),r=this.webglKey(r),r=this.webglVendorAndRendererKey(r),r=this.adBlockKey(r),r=this.hasLiedLanguagesKey(r),r=this.hasLiedResolutionKey(r),r=this.hasLiedOsKey(r),r=this.hasLiedBrowserKey(r),r=this.touchSupportKey(r),r=this.customEntropyFunction(r),this.fontsKey(r,function(r){var n=[];t.each(r.data,function(e){var t=e.value;t&&"function"==typeof t.join&&(t=t.join(";")),n.push(t)});var i=t.x64hash128(n.join("~~~"),31);return e(i,r.data)})},customEntropyFunction:function(e){return"function"==typeof this.options.customFunction&&e.addPreprocessedComponent({key:"custom",value:this.options.customFunction()}),e},userAgentKey:function(e){return this.options.excludeUserAgent||e.addPreprocessedComponent({key:"user_agent",value:this.getUserAgent()}),e},getUserAgent:function(){return navigator.userAgent},languageKey:function(e){return this.options.excludeLanguage||e.addPreprocessedComponent({key:"language",value:navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage||""}),e},colorDepthKey:function(e){return this.options.excludeColorDepth||e.addPreprocessedComponent({key:"color_depth",value:window.screen.colorDepth||-1}),e},deviceMemoryKey:function(e){return this.options.excludeDeviceMemory||e.addPreprocessedComponent({key:"device_memory",value:this.getDeviceMemory()}),e},getDeviceMemory:function(){return navigator.deviceMemory||-1},pixelRatioKey:function(e){return this.options.excludePixelRatio||e.addPreprocessedComponent({key:"pixel_ratio",value:this.getPixelRatio()}),e},getPixelRatio:function(){return window.devicePixelRatio||""},screenResolutionKey:function(e){return this.options.excludeScreenResolution?e:this.getScreenResolution(e)},getScreenResolution:function(e){var t;return t=this.options.detectScreenOrientation&&window.screen.height>window.screen.width?[window.screen.height,window.screen.width]:[window.screen.width,window.screen.height],e.addPreprocessedComponent({key:"resolution",value:t}),e},availableScreenResolutionKey:function(e){return this.options.excludeAvailableScreenResolution?e:this.getAvailableScreenResolution(e)},getAvailableScreenResolution:function(e){var t;return window.screen.availWidth&&window.screen.availHeight&&(t=this.options.detectScreenOrientation?window.screen.availHeight>window.screen.availWidth?[window.screen.availHeight,window.screen.availWidth]:[window.screen.availWidth,window.screen.availHeight]:[window.screen.availHeight,window.screen.availWidth]),void 0!==t&&e.addPreprocessedComponent({key:"available_resolution",value:t}),e},timezoneOffsetKey:function(e){return this.options.excludeTimezoneOffset||e.addPreprocessedComponent({key:"timezone_offset",value:(new Date).getTimezoneOffset()}),e},sessionStorageKey:function(e){return!this.options.excludeSessionStorage&&this.hasSessionStorage()&&e.addPreprocessedComponent({key:"session_storage",value:1}),e},localStorageKey:function(e){return!this.options.excludeSessionStorage&&this.hasLocalStorage()&&e.addPreprocessedComponent({key:"local_storage",value:1}),e},indexedDbKey:function(e){return!this.options.excludeIndexedDB&&this.hasIndexedDB()&&e.addPreprocessedComponent({key:"indexed_db",value:1}),e},addBehaviorKey:function(e){return!this.options.excludeAddBehavior&&document.body&&document.body.addBehavior&&e.addPreprocessedComponent({key:"add_behavior",value:1}),e},openDatabaseKey:function(e){return!this.options.excludeOpenDatabase&&window.openDatabase&&e.addPreprocessedComponent({key:"open_database",value:1}),e},cpuClassKey:function(e){return this.options.excludeCpuClass||e.addPreprocessedComponent({key:"cpu_class",value:this.getNavigatorCpuClass()}),e},platformKey:function(e){return this.options.excludePlatform||e.addPreprocessedComponent({key:"navigator_platform",value:this.getNavigatorPlatform()}),e},doNotTrackKey:function(e){return this.options.excludeDoNotTrack||e.addPreprocessedComponent({key:"do_not_track",value:this.getDoNotTrack()}),e},canvasKey:function(e){return!this.options.excludeCanvas&&this.isCanvasSupported()&&e.addPreprocessedComponent({key:"canvas",value:this.getCanvasFp()}),e},webglKey:function(e){return!this.options.excludeWebGL&&this.isWebGlSupported()&&e.addPreprocessedComponent({key:"webgl",value:this.getWebglFp()}),e},webglVendorAndRendererKey:function(e){return!this.options.excludeWebGLVendorAndRenderer&&this.isWebGlSupported()&&e.addPreprocessedComponent({key:"webgl_vendor",value:this.getWebglVendorAndRenderer()}),e},adBlockKey:function(e){return this.options.excludeAdBlock||e.addPreprocessedComponent({key:"adblock",value:this.getAdBlock()}),e},hasLiedLanguagesKey:function(e){return this.options.excludeHasLiedLanguages||e.addPreprocessedComponent({key:"has_lied_languages",value:this.getHasLiedLanguages()}),e},hasLiedResolutionKey:function(e){return this.options.excludeHasLiedResolution||e.addPreprocessedComponent({key:"has_lied_resolution",value:this.getHasLiedResolution()}),e},hasLiedOsKey:function(e){return this.options.excludeHasLiedOs||e.addPreprocessedComponent({key:"has_lied_os",value:this.getHasLiedOs()}),e},hasLiedBrowserKey:function(e){return this.options.excludeHasLiedBrowser||e.addPreprocessedComponent({key:"has_lied_browser",value:this.getHasLiedBrowser()}),e},fontsKey:function(e,t){return this.options.excludeJsFonts?this.flashFontsKey(e,t):this.jsFontsKey(e,t)},flashFontsKey:function(e,t){return this.options.excludeFlashFonts?t(e):this.hasSwfObjectLoaded()&&this.hasMinFlashInstalled()?void 0===this.options.swfPath?t(e):void this.loadSwfAndDetectFonts(function(r){e.addPreprocessedComponent({key:"swf_fonts",value:r.join(";")}),t(e)}):t(e)},jsFontsKey:function(e,t){var r=this;return setTimeout(function(){var n=["monospace","sans-serif","serif"],i=["Andale Mono","Arial","Arial Black","Arial Hebrew","Arial MT","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Bitstream Vera Sans Mono","Book Antiqua","Bookman Old Style","Calibri","Cambria","Cambria Math","Century","Century Gothic","Century Schoolbook","Comic Sans","Comic Sans MS","Consolas","Courier","Courier New","Geneva","Georgia","Helvetica","Helvetica Neue","Impact","Lucida Bright","Lucida Calligraphy","Lucida Console","Lucida Fax","LUCIDA GRANDE","Lucida Handwriting","Lucida Sans","Lucida Sans Typewriter","Lucida Sans Unicode","Microsoft Sans Serif","Monaco","Monotype Corsiva","MS Gothic","MS Outlook","MS PGothic","MS Reference Sans Serif","MS Sans Serif","MS Serif","MYRIAD","MYRIAD PRO","Palatino","Palatino Linotype","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Tahoma","Times","Times New Roman","Times New Roman PS","Trebuchet MS","Verdana","Wingdings","Wingdings 2","Wingdings 3"];r.options.extendedJsFonts&&(i=i.concat(["Abadi MT Condensed Light","Academy Engraved LET","ADOBE CASLON PRO","Adobe Garamond","ADOBE GARAMOND PRO","Agency FB","Aharoni","Albertus Extra Bold","Albertus Medium","Algerian","Amazone BT","American Typewriter","American Typewriter Condensed","AmerType Md BT","Andalus","Angsana New","AngsanaUPC","Antique Olive","Aparajita","Apple Chancery","Apple Color Emoji","Apple SD Gothic Neo","Arabic Typesetting","ARCHER","ARNO PRO","Arrus BT","Aurora Cn BT","AvantGarde Bk BT","AvantGarde Md BT","AVENIR","Ayuthaya","Bandy","Bangla Sangam MN","Bank Gothic","BankGothic Md BT","Baskerville","Baskerville Old Face","Batang","BatangChe","Bauer Bodoni","Bauhaus 93","Bazooka","Bell MT","Bembo","Benguiat Bk BT","Berlin Sans FB","Berlin Sans FB Demi","Bernard MT Condensed","BernhardFashion BT","BernhardMod BT","Big Caslon","BinnerD","Blackadder ITC","BlairMdITC TT","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bodoni MT","Bodoni MT Black","Bodoni MT Condensed","Bodoni MT Poster Compressed","Bookshelf Symbol 7","Boulder","Bradley Hand","Bradley Hand ITC","Bremen Bd BT","Britannic Bold","Broadway","Browallia New","BrowalliaUPC","Brush Script MT","Californian FB","Calisto MT","Calligrapher","Candara","CaslonOpnface BT","Castellar","Centaur","Cezanne","CG Omega","CG Times","Chalkboard","Chalkboard SE","Chalkduster","Charlesworth","Charter Bd BT","Charter BT","Chaucer","ChelthmITC Bk BT","Chiller","Clarendon","Clarendon Condensed","CloisterBlack BT","Cochin","Colonna MT","Constantia","Cooper Black","Copperplate","Copperplate Gothic","Copperplate Gothic Bold","Copperplate Gothic Light","CopperplGoth Bd BT","Corbel","Cordia New","CordiaUPC","Cornerstone","Coronet","Cuckoo","Curlz MT","DaunPenh","Dauphin","David","DB LCD Temp","DELICIOUS","Denmark","DFKai-SB","Didot","DilleniaUPC","DIN","DokChampa","Dotum","DotumChe","Ebrima","Edwardian Script ITC","Elephant","English 111 Vivace BT","Engravers MT","EngraversGothic BT","Eras Bold ITC","Eras Demi ITC","Eras Light ITC","Eras Medium ITC","EucrosiaUPC","Euphemia","Euphemia UCAS","EUROSTILE","Exotc350 Bd BT","FangSong","Felix Titling","Fixedsys","FONTIN","Footlight MT Light","Forte","FrankRuehl","Fransiscan","Freefrm721 Blk BT","FreesiaUPC","Freestyle Script","French Script MT","FrnkGothITC Bk BT","Fruitger","FRUTIGER","Futura","Futura Bk BT","Futura Lt BT","Futura Md BT","Futura ZBlk BT","FuturaBlack BT","Gabriola","Galliard BT","Gautami","Geeza Pro","Geometr231 BT","Geometr231 Hv BT","Geometr231 Lt BT","GeoSlab 703 Lt BT","GeoSlab 703 XBd BT","Gigi","Gill Sans","Gill Sans MT","Gill Sans MT Condensed","Gill Sans MT Ext Condensed Bold","Gill Sans Ultra Bold","Gill Sans Ultra Bold Condensed","Gisha","Gloucester MT Extra Condensed","GOTHAM","GOTHAM BOLD","Goudy Old Style","Goudy Stout","GoudyHandtooled BT","GoudyOLSt BT","Gujarati Sangam MN","Gulim","GulimChe","Gungsuh","GungsuhChe","Gurmukhi MN","Haettenschweiler","Harlow Solid Italic","Harrington","Heather","Heiti SC","Heiti TC","HELV","Herald","High Tower Text","Hiragino Kaku Gothic ProN","Hiragino Mincho ProN","Hoefler Text","Humanst 521 Cn BT","Humanst521 BT","Humanst521 Lt BT","Imprint MT Shadow","Incised901 Bd BT","Incised901 BT","Incised901 Lt BT","INCONSOLATA","Informal Roman","Informal011 BT","INTERSTATE","IrisUPC","Iskoola Pota","JasmineUPC","Jazz LET","Jenson","Jester","Jokerman","Juice ITC","Kabel Bk BT","Kabel Ult BT","Kailasa","KaiTi","Kalinga","Kannada Sangam MN","Kartika","Kaufmann Bd BT","Kaufmann BT","Khmer UI","KodchiangUPC","Kokila","Korinna BT","Kristen ITC","Krungthep","Kunstler Script","Lao UI","Latha","Leelawadee","Letter Gothic","Levenim MT","LilyUPC","Lithograph","Lithograph Light","Long Island","Lydian BT","Magneto","Maiandra GD","Malayalam Sangam MN","Malgun Gothic","Mangal","Marigold","Marion","Marker Felt","Market","Marlett","Matisse ITC","Matura MT Script Capitals","Meiryo","Meiryo UI","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","MingLiU-ExtB","Minion","Minion Pro","Miriam","Miriam Fixed","Mistral","Modern","Modern No. 20","Mona Lisa Solid ITC TT","Mongolian Baiti","MONO","MoolBoran","Mrs Eaves","MS LineDraw","MS Mincho","MS PMincho","MS Reference Specialty","MS UI Gothic","MT Extra","MUSEO","MV Boli","Nadeem","Narkisim","NEVIS","News Gothic","News GothicMT","NewsGoth BT","Niagara Engraved","Niagara Solid","Noteworthy","NSimSun","Nyala","OCR A Extended","Old Century","Old English Text MT","Onyx","Onyx BT","OPTIMA","Oriya Sangam MN","OSAKA","OzHandicraft BT","Palace Script MT","Papyrus","Parchment","Party LET","Pegasus","Perpetua","Perpetua Titling MT","PetitaBold","Pickwick","Plantagenet Cherokee","Playbill","PMingLiU","PMingLiU-ExtB","Poor Richard","Poster","PosterBodoni BT","PRINCETOWN LET","Pristina","PTBarnum BT","Pythagoras","Raavi","Rage Italic","Ravie","Ribbon131 Bd BT","Rockwell","Rockwell Condensed","Rockwell Extra Bold","Rod","Roman","Sakkal Majalla","Santa Fe LET","Savoye LET","Sceptre","Script","Script MT Bold","SCRIPTINA","Serifa","Serifa BT","Serifa Th BT","ShelleyVolante BT","Sherwood","Shonar Bangla","Showcard Gothic","Shruti","Signboard","SILKSCREEN","SimHei","Simplified Arabic","Simplified Arabic Fixed","SimSun","SimSun-ExtB","Sinhala Sangam MN","Sketch Rockwell","Skia","Small Fonts","Snap ITC","Snell Roundhand","Socket","Souvenir Lt BT","Staccato222 BT","Steamer","Stencil","Storybook","Styllo","Subway","Swis721 BlkEx BT","Swiss911 XCm BT","Sylfaen","Synchro LET","System","Tamil Sangam MN","Technical","Teletype","Telugu Sangam MN","Tempus Sans ITC","Terminal","Thonburi","Traditional Arabic","Trajan","TRAJAN PRO","Tristan","Tubular","Tunga","Tw Cen MT","Tw Cen MT Condensed","Tw Cen MT Condensed Extra Bold","TypoUpright BT","Unicorn","Univers","Univers CE 55 Medium","Univers Condensed","Utsaah","Vagabond","Vani","Vijaya","Viner Hand ITC","VisualUI","Vivaldi","Vladimir Script","Vrinda","Westminster","WHITNEY","Wide Latin","ZapfEllipt BT","ZapfHumnst BT","ZapfHumnst Dm BT","Zapfino","Zurich BlkEx BT","Zurich Ex BT","ZWAdobeF"])),i=(i=i.concat(r.options.userDefinedFonts)).filter(function(e,t){return i.indexOf(e)===t});var o=document.getElementsByTagName("body")[0],a=document.createElement("div"),s=document.createElement("div"),c={},u={},d=function(){var e=document.createElement("span");return e.style.position="absolute",e.style.left="-9999px",e.style.fontSize="72px",e.style.fontStyle="normal",e.style.fontWeight="normal",e.style.letterSpacing="normal",e.style.lineBreak="auto",e.style.lineHeight="normal",e.style.textTransform="none",e.style.textAlign="left",e.style.textDecoration="none",e.style.textShadow="none",e.style.whiteSpace="normal",e.style.wordBreak="normal",e.style.wordSpacing="normal",e.innerHTML="mmmmmmmmmmlli",e},f=function(e){for(var t=!1,r=0;r<n.length;r++)if(t=e[r].offsetWidth!==c[n[r]]||e[r].offsetHeight!==u[n[r]])return t;return t},l=function(){for(var e=[],t=0,r=n.length;t<r;t++){var i=d();i.style.fontFamily=n[t],a.appendChild(i),e.push(i)}return e}();o.appendChild(a);for(var h=0,p=n.length;h<p;h++)c[n[h]]=l[h].offsetWidth,u[n[h]]=l[h].offsetHeight;var v=function(){for(var e,t,r,o={},a=0,c=i.length;a<c;a++){for(var u=[],f=0,l=n.length;f<l;f++){var h=(e=i[a],t=n[f],r=void 0,(r=d()).style.fontFamily="'"+e+"',"+t,r);s.appendChild(h),u.push(h)}o[i[a]]=u}return o}();o.appendChild(s);for(var m=[],g=0,y=i.length;g<y;g++)f(v[i[g]])&&m.push(i[g]);o.removeChild(s),o.removeChild(a),e.addPreprocessedComponent({key:"js_fonts",value:m}),t(e)},1)},pluginsKey:function(e){return this.options.excludePlugins||(this.isIE()?this.options.excludeIEPlugins||e.addPreprocessedComponent({key:"ie_plugins",value:this.getIEPlugins()}):e.addPreprocessedComponent({key:"regular_plugins",value:this.getRegularPlugins()})),e},getRegularPlugins:function(){var e=[];if(navigator.plugins)for(var t=0,r=navigator.plugins.length;t<r;t++)navigator.plugins[t]&&e.push(navigator.plugins[t]);return this.pluginsShouldBeSorted()&&(e=e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),this.map(e,function(e){var t=this.map(e,function(e){return[e.type,e.suffixes].join("~")}).join(",");return[e.name,e.description,t].join("::")},this)},getIEPlugins:function(){var e=[];return(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window)&&(e=this.map(["AcroPDF.PDF","Adodb.Stream","AgControl.AgControl","DevalVRXCtrl.DevalVRXCtrl.1","MacromediaFlashPaper.MacromediaFlashPaper","Msxml2.DOMDocument","Msxml2.XMLHTTP","PDF.PdfCtrl","QuickTime.QuickTime","QuickTimeCheckObject.QuickTimeCheck.1","RealPlayer","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","Scripting.Dictionary","SWCtl.SWCtl","Shell.UIHelper","ShockwaveFlash.ShockwaveFlash","Skype.Detection","TDCCtl.TDCCtl","WMPlayer.OCX","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1"],function(e){try{return new window.ActiveXObject(e),e}catch(e){return null}})),navigator.plugins&&(e=e.concat(this.getRegularPlugins())),e},pluginsShouldBeSorted:function(){for(var e=!1,t=0,r=this.options.sortPluginsFor.length;t<r;t++){var n=this.options.sortPluginsFor[t];if(navigator.userAgent.match(n)){e=!0;break}}return e},touchSupportKey:function(e){return this.options.excludeTouchSupport||e.addPreprocessedComponent({key:"touch_support",value:this.getTouchSupport()}),e},hardwareConcurrencyKey:function(e){return this.options.excludeHardwareConcurrency||e.addPreprocessedComponent({key:"hardware_concurrency",value:this.getHardwareConcurrency()}),e},hasSessionStorage:function(){try{return!!window.sessionStorage}catch(e){return!0}},hasLocalStorage:function(){try{return!!window.localStorage}catch(e){return!0}},hasIndexedDB:function(){try{return!!window.indexedDB}catch(e){return!0}},getHardwareConcurrency:function(){return navigator.hardwareConcurrency?navigator.hardwareConcurrency:"unknown"},getNavigatorCpuClass:function(){return navigator.cpuClass?navigator.cpuClass:"unknown"},getNavigatorPlatform:function(){return navigator.platform?navigator.platform:"unknown"},getDoNotTrack:function(){return navigator.doNotTrack?navigator.doNotTrack:navigator.msDoNotTrack?navigator.msDoNotTrack:window.doNotTrack?window.doNotTrack:"unknown"},getTouchSupport:function(){var e=0,t=!1;void 0!==navigator.maxTouchPoints?e=navigator.maxTouchPoints:void 0!==navigator.msMaxTouchPoints&&(e=navigator.msMaxTouchPoints);try{document.createEvent("TouchEvent"),t=!0}catch(e){}return[e,t,"ontouchstart"in window]},getCanvasFp:function(){var e=[],t=document.createElement("canvas");t.width=2e3,t.height=200,t.style.display="inline";var r=t.getContext("2d");return r.rect(0,0,10,10),r.rect(2,2,6,6),e.push("canvas winding:"+(!1===r.isPointInPath(5,5,"evenodd")?"yes":"no")),r.textBaseline="alphabetic",r.fillStyle="#f60",r.fillRect(125,1,62,20),r.fillStyle="#069",this.options.dontUseFakeFontInCanvas?r.font="11pt Arial":r.font="11pt no-real-font-123",r.fillText("Cwm fjordbank glyphs vext quiz, ð",2,15),r.fillStyle="rgba(102, 204, 0, 0.2)",r.font="18pt Arial",r.fillText("Cwm fjordbank glyphs vext quiz, ð",4,45),r.globalCompositeOperation="multiply",r.fillStyle="rgb(255,0,255)",r.beginPath(),r.arc(50,50,50,0,2*Math.PI,!0),r.closePath(),r.fill(),r.fillStyle="rgb(0,255,255)",r.beginPath(),r.arc(100,50,50,0,2*Math.PI,!0),r.closePath(),r.fill(),r.fillStyle="rgb(255,255,0)",r.beginPath(),r.arc(75,100,50,0,2*Math.PI,!0),r.closePath(),r.fill(),r.fillStyle="rgb(255,0,255)",r.arc(75,75,75,0,2*Math.PI,!0),r.arc(75,75,25,0,2*Math.PI,!0),r.fill("evenodd"),t.toDataURL&&e.push("canvas fp:"+t.toDataURL()),e.join("~")},getWebglFp:function(){var e,t=function(t){return e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),"["+t[0]+", "+t[1]+"]"};if(!(e=this.getWebglCanvas()))return null;var r=[],n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);var i=new Float32Array([-.2,-.9,0,.4,-.26,0,0,.732134444,0]);e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),n.itemSize=3,n.numItems=3;var o=e.createProgram(),a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,"attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}"),e.compileShader(a);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,"precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}"),e.compileShader(s),e.attachShader(o,a),e.attachShader(o,s),e.linkProgram(o),e.useProgram(o),o.vertexPosAttrib=e.getAttribLocation(o,"attrVertex"),o.offsetUniform=e.getUniformLocation(o,"uniformOffset"),e.enableVertexAttribArray(o.vertexPosArray),e.vertexAttribPointer(o.vertexPosAttrib,n.itemSize,e.FLOAT,!1,0,0),e.uniform2f(o.offsetUniform,1,1),e.drawArrays(e.TRIANGLE_STRIP,0,n.numItems);try{r.push(e.canvas.toDataURL())}catch(e){}r.push("extensions:"+(e.getSupportedExtensions()||[]).join(";")),r.push("webgl aliased line width range:"+t(e.getParameter(e.ALIASED_LINE_WIDTH_RANGE))),r.push("webgl aliased point size range:"+t(e.getParameter(e.ALIASED_POINT_SIZE_RANGE))),r.push("webgl alpha bits:"+e.getParameter(e.ALPHA_BITS)),r.push("webgl antialiasing:"+(e.getContextAttributes().antialias?"yes":"no")),r.push("webgl blue bits:"+e.getParameter(e.BLUE_BITS)),r.push("webgl depth bits:"+e.getParameter(e.DEPTH_BITS)),r.push("webgl green bits:"+e.getParameter(e.GREEN_BITS)),r.push("webgl max anisotropy:"+function(e){var t=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic");if(t){var r=e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);return 0===r&&(r=2),r}return null}(e)),r.push("webgl max combined texture image units:"+e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),r.push("webgl max cube map texture size:"+e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE)),r.push("webgl max fragment uniform vectors:"+e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)),r.push("webgl max render buffer size:"+e.getParameter(e.MAX_RENDERBUFFER_SIZE)),r.push("webgl max texture image units:"+e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)),r.push("webgl max texture size:"+e.getParameter(e.MAX_TEXTURE_SIZE)),r.push("webgl max varying vectors:"+e.getParameter(e.MAX_VARYING_VECTORS)),r.push("webgl max vertex attribs:"+e.getParameter(e.MAX_VERTEX_ATTRIBS)),r.push("webgl max vertex texture image units:"+e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)),r.push("webgl max vertex uniform vectors:"+e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS)),r.push("webgl max viewport dims:"+t(e.getParameter(e.MAX_VIEWPORT_DIMS))),r.push("webgl red bits:"+e.getParameter(e.RED_BITS)),r.push("webgl renderer:"+e.getParameter(e.RENDERER)),r.push("webgl shading language version:"+e.getParameter(e.SHADING_LANGUAGE_VERSION)),r.push("webgl stencil bits:"+e.getParameter(e.STENCIL_BITS)),r.push("webgl vendor:"+e.getParameter(e.VENDOR)),r.push("webgl version:"+e.getParameter(e.VERSION));try{var c=e.getExtension("WEBGL_debug_renderer_info");c&&(r.push("webgl unmasked vendor:"+e.getParameter(c.UNMASKED_VENDOR_WEBGL)),r.push("webgl unmasked renderer:"+e.getParameter(c.UNMASKED_RENDERER_WEBGL)))}catch(e){}return e.getShaderPrecisionFormat?(r.push("webgl vertex shader high float precision:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision),r.push("webgl vertex shader high float precision rangeMin:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).rangeMin),r.push("webgl vertex shader high float precision rangeMax:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).rangeMax),r.push("webgl vertex shader medium float precision:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision),r.push("webgl vertex shader medium float precision rangeMin:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).rangeMin),r.push("webgl vertex shader medium float precision rangeMax:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).rangeMax),r.push("webgl vertex shader low float precision:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_FLOAT).precision),r.push("webgl vertex shader low float precision rangeMin:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_FLOAT).rangeMin),r.push("webgl vertex shader low float precision rangeMax:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_FLOAT).rangeMax),r.push("webgl fragment shader high float precision:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision),r.push("webgl fragment shader high float precision rangeMin:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).rangeMin),r.push("webgl fragment shader high float precision rangeMax:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).rangeMax),r.push("webgl fragment shader medium float precision:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision),r.push("webgl fragment shader medium float precision rangeMin:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).rangeMin),r.push("webgl fragment shader medium float precision rangeMax:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).rangeMax),r.push("webgl fragment shader low float precision:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT).precision),r.push("webgl fragment shader low float precision rangeMin:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT).rangeMin),r.push("webgl fragment shader low float precision rangeMax:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT).rangeMax),r.push("webgl vertex shader high int precision:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_INT).precision),r.push("webgl vertex shader high int precision rangeMin:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_INT).rangeMin),r.push("webgl vertex shader high int precision rangeMax:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_INT).rangeMax),r.push("webgl vertex shader medium int precision:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_INT).precision),r.push("webgl vertex shader medium int precision rangeMin:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_INT).rangeMin),r.push("webgl vertex shader medium int precision rangeMax:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_INT).rangeMax),r.push("webgl vertex shader low int precision:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_INT).precision),r.push("webgl vertex shader low int precision rangeMin:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_INT).rangeMin),r.push("webgl vertex shader low int precision rangeMax:"+e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_INT).rangeMax),r.push("webgl fragment shader high int precision:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT).precision),r.push("webgl fragment shader high int precision rangeMin:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT).rangeMin),r.push("webgl fragment shader high int precision rangeMax:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT).rangeMax),r.push("webgl fragment shader medium int precision:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT).precision),r.push("webgl fragment shader medium int precision rangeMin:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT).rangeMin),r.push("webgl fragment shader medium int precision rangeMax:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT).rangeMax),r.push("webgl fragment shader low int precision:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT).precision),r.push("webgl fragment shader low int precision rangeMin:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT).rangeMin),r.push("webgl fragment shader low int precision rangeMax:"+e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT).rangeMax),r.join("~")):r.join("~")},getWebglVendorAndRenderer:function(){try{var e=this.getWebglCanvas(),t=e.getExtension("WEBGL_debug_renderer_info");return e.getParameter(t.UNMASKED_VENDOR_WEBGL)+"~"+e.getParameter(t.UNMASKED_RENDERER_WEBGL)}catch(e){return null}},getAdBlock:function(){var e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox";var t=!1;try{document.body.appendChild(e),t=0===document.getElementsByClassName("adsbox")[0].offsetHeight,document.body.removeChild(e)}catch(e){t=!1}return t},getHasLiedLanguages:function(){if(void 0!==navigator.languages)try{if(navigator.languages[0].substr(0,2)!==navigator.language.substr(0,2))return!0}catch(e){return!0}return!1},getHasLiedResolution:function(){return window.screen.width<window.screen.availWidth||window.screen.height<window.screen.availHeight},getHasLiedOs:function(){var e,t=navigator.userAgent.toLowerCase(),r=navigator.oscpu,n=navigator.platform.toLowerCase();if(e=t.indexOf("windows phone")>=0?"Windows Phone":t.indexOf("win")>=0?"Windows":t.indexOf("android")>=0?"Android":t.indexOf("linux")>=0?"Linux":t.indexOf("iphone")>=0||t.indexOf("ipad")>=0?"iOS":t.indexOf("mac")>=0?"Mac":"Other",("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&"Windows Phone"!==e&&"Android"!==e&&"iOS"!==e&&"Other"!==e)return!0;if(void 0!==r){if((r=r.toLowerCase()).indexOf("win")>=0&&"Windows"!==e&&"Windows Phone"!==e)return!0;if(r.indexOf("linux")>=0&&"Linux"!==e&&"Android"!==e)return!0;if(r.indexOf("mac")>=0&&"Mac"!==e&&"iOS"!==e)return!0;if((-1===r.indexOf("win")&&-1===r.indexOf("linux")&&-1===r.indexOf("mac"))!=("Other"===e))return!0}return n.indexOf("win")>=0&&"Windows"!==e&&"Windows Phone"!==e||(n.indexOf("linux")>=0||n.indexOf("android")>=0||n.indexOf("pike")>=0)&&"Linux"!==e&&"Android"!==e||(n.indexOf("mac")>=0||n.indexOf("ipad")>=0||n.indexOf("ipod")>=0||n.indexOf("iphone")>=0)&&"Mac"!==e&&"iOS"!==e||(-1===n.indexOf("win")&&-1===n.indexOf("linux")&&-1===n.indexOf("mac"))!=("Other"===e)||void 0===navigator.plugins&&"Windows"!==e&&"Windows Phone"!==e},getHasLiedBrowser:function(){var e,t=navigator.userAgent.toLowerCase(),r=navigator.productSub;if(("Chrome"==(e=t.indexOf("firefox")>=0?"Firefox":t.indexOf("opera")>=0||t.indexOf("opr")>=0?"Opera":t.indexOf("chrome")>=0?"Chrome":t.indexOf("safari")>=0?"Safari":t.indexOf("trident")>=0?"Internet Explorer":"Other")||"Safari"===e||"Opera"===e)&&"20030107"!==r)return!0;var n,i=eval.toString().length;if(37===i&&"Safari"!==e&&"Firefox"!==e&&"Other"!==e)return!0;if(39===i&&"Internet Explorer"!==e&&"Other"!==e)return!0;if(33===i&&"Chrome"!==e&&"Opera"!==e&&"Other"!==e)return!0;try{throw"a"}catch(e){try{e.toSource(),n=!0}catch(e){n=!1}}return!(!n||"Firefox"===e||"Other"===e)},isCanvasSupported:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},isWebGlSupported:function(){if(!this.isCanvasSupported())return!1;var e=this.getWebglCanvas();return!!window.WebGLRenderingContext&&!!e},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName||!("Netscape"!==navigator.appName||!/Trident/.test(navigator.userAgent))},hasSwfObjectLoaded:function(){return void 0!==window.swfobject},hasMinFlashInstalled:function(){return window.swfobject.hasFlashPlayerVersion("9.0.0")},addFlashDivNode:function(){var e=document.createElement("div");e.setAttribute("id",this.options.swfContainerId),document.body.appendChild(e)},loadSwfAndDetectFonts:function(e){var t="___fp_swf_loaded";window[t]=function(t){e(t)};var r=this.options.swfContainerId;this.addFlashDivNode();var n={onReady:t};window.swfobject.embedSWF(this.options.swfPath,r,"1","1","9.0.0",!1,n,{allowScriptAccess:"always",menu:"false"},{})},getWebglCanvas:function(){var e=document.createElement("canvas"),t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){}return t||(t=null),t},each:function(e,t,r){if(null!==e)if(this.nativeForEach&&e.forEach===this.nativeForEach)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,i=e.length;n<i;n++)if(t.call(r,e[n],n,e)==={})return}else for(var o in e)if(e.hasOwnProperty(o)&&t.call(r,e[o],o,e)==={})return},map:function(e,t,r){var n=[];return null==e?n:this.nativeMap&&e.map===this.nativeMap?e.map(t,r):(this.each(e,function(e,i,o){n[n.length]=t.call(r,e,i,o)}),n)},x64Add:function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},x64Multiply:function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},x64Rotl:function(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},x64LeftShift:function(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},x64Xor:function(e,t){return[e[0]^t[0],e[1]^t[1]]},x64Fmix:function(e){return e=this.x64Xor(e,[0,e[0]>>>1]),e=this.x64Multiply(e,[4283543511,3981806797]),e=this.x64Xor(e,[0,e[0]>>>1]),e=this.x64Multiply(e,[3301882366,444984403]),this.x64Xor(e,[0,e[0]>>>1])},x64hash128:function(e,t){e=e||"",t=t||0;for(var r=e.length%16,n=e.length-r,i=[0,t],o=[0,t],a=[0,0],s=[0,0],c=[2277735313,289559509],u=[1291169091,658871167],d=0;d<n;d+=16)a=[255&e.charCodeAt(d+4)|(255&e.charCodeAt(d+5))<<8|(255&e.charCodeAt(d+6))<<16|(255&e.charCodeAt(d+7))<<24,255&e.charCodeAt(d)|(255&e.charCodeAt(d+1))<<8|(255&e.charCodeAt(d+2))<<16|(255&e.charCodeAt(d+3))<<24],s=[255&e.charCodeAt(d+12)|(255&e.charCodeAt(d+13))<<8|(255&e.charCodeAt(d+14))<<16|(255&e.charCodeAt(d+15))<<24,255&e.charCodeAt(d+8)|(255&e.charCodeAt(d+9))<<8|(255&e.charCodeAt(d+10))<<16|(255&e.charCodeAt(d+11))<<24],a=this.x64Multiply(a,c),a=this.x64Rotl(a,31),a=this.x64Multiply(a,u),i=this.x64Xor(i,a),i=this.x64Rotl(i,27),i=this.x64Add(i,o),i=this.x64Add(this.x64Multiply(i,[0,5]),[0,1390208809]),s=this.x64Multiply(s,u),s=this.x64Rotl(s,33),s=this.x64Multiply(s,c),o=this.x64Xor(o,s),o=this.x64Rotl(o,31),o=this.x64Add(o,i),o=this.x64Add(this.x64Multiply(o,[0,5]),[0,944331445]);switch(a=[0,0],s=[0,0],r){case 15:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+14)],48));case 14:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+13)],40));case 13:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+12)],32));case 12:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+11)],24));case 11:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+10)],16));case 10:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+9)],8));case 9:s=this.x64Xor(s,[0,e.charCodeAt(d+8)]),s=this.x64Multiply(s,u),s=this.x64Rotl(s,33),s=this.x64Multiply(s,c),o=this.x64Xor(o,s);case 8:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+7)],56));case 7:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+6)],48));case 6:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+5)],40));case 5:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+4)],32));case 4:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+3)],24));case 3:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+2)],16));case 2:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+1)],8));case 1:a=this.x64Xor(a,[0,e.charCodeAt(d)]),a=this.x64Multiply(a,c),a=this.x64Rotl(a,31),a=this.x64Multiply(a,u),i=this.x64Xor(i,a)}return i=this.x64Xor(i,[0,e.length]),o=this.x64Xor(o,[0,e.length]),i=this.x64Add(i,o),o=this.x64Add(o,i),i=this.x64Fmix(i),o=this.x64Fmix(o),i=this.x64Add(i,o),o=this.x64Add(o,i),("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)+("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)}},e.VERSION="1.8.0",e})},function(e,t,r){var n=r(1),i=r(82),o=r(7).f,a=r(41).f,s=r(81),c=r(73),u=n.RegExp,d=u,f=u.prototype,l=/a/g,h=/a/g,p=new u(l)!==l;if(r(6)&&(!p||r(4)(function(){return h[r(3)("match")]=!1,u(l)!=l||u(h)==h||"/a/i"!=u(l,"i")}))){u=function(e,t){var r=this instanceof u,n=s(e),o=void 0===t;return!r&&n&&e.constructor===u&&o?e:i(p?new d(n&&!o?e.source:e,t):d((n=e instanceof u)?e.source:e,n&&o?c.call(e):t),r?this:f,u)};for(var v=function(e){e in u||o(u,e,{configurable:!0,get:function(){return d[e]},set:function(t){d[e]=t}})},m=a(d),g=0;m.length>g;)v(m[g++]);f.constructor=u,u.prototype=f,r(11)(n,"RegExp",u)}r(57)("RegExp")},function(e,t,r){r(75)("replace",2,function(e,t,r){return[function(n,i){"use strict";var o=e(this),a=void 0==n?void 0:n[t];return void 0!==a?a.call(n,o,i):r.call(String(o),n,i)},r]})},function(e,t,r){var n=r(176),i=r(177);t.write=i,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=n(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=r(111),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return i(c,n,a)}}),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},function(e,t,r){var n=r(111),i=/%[sdv%]/g,o=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?n.push(r[t.name][a]):n.push(r[t.names[o]])}else n.push(r[t.name]);return function(e){var t=1,r=arguments,n=r.length;return e.replace(i,function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||a,i=t.innerOrder||s,c=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(o(t,r,e))})})}),e.media.forEach(function(e){c.push(o("m",n.m[0],e)),i.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(o(t,r,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,t,r){"use strict";var n=r(1),i=r(14),o=r(31),a=r(82),s=r(45),c=r(4),u=r(41).f,d=r(51).f,f=r(7).f,l=r(179).trim,h=n.Number,p=h,v=h.prototype,m="Number"==o(r(32)(v)),g="trim"in String.prototype,y=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var r,n,i,o=(t=g?t.trim():l(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=t.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+t}for(var a,c=t.slice(2),u=0,d=c.length;u<d;u++)if((a=c.charCodeAt(u))<48||a>i)return NaN;return parseInt(c,n)}}return+t};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof h&&(m?c(function(){v.valueOf.call(r)}):"Number"!=o(r))?a(new p(y(t)),r,h):y(t)};for(var b,S=r(6)?u(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;S.length>w;w++)i(p,b=S[w])&&!i(h,b)&&f(h,b,d(p,b));h.prototype=v,v.constructor=h,r(11)(n,"Number",h)}},function(e,t,r){var n=r(2),i=r(39),o=r(4),a=r(180),s="["+a+"]",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),d=function(e,t,r){var i={},s=o(function(){return!!a[e]()||"âÂ"!="âÂ"[e]()}),c=i[e]=s?t(f):a[e];r&&(i[r]=c),n(n.P+n.F*s,"String",i)},f=d.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=d},function(e,t){e.exports="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029\ufeff"},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0});var n=r(109);t.getPublishQos=function(e,t,r){var i;return e.recordConfig&&e.recordConfig.audio,i=n.REC_SCREEN_ENABLE(e.recordConfig)?e.recordConfig.screen:e.recordConfig&&e.recordConfig.video||{},{enable_audio:e.enableAudio,enable_video:e.enableVideo,audio_device_id:"",video_device_id:"",preview_video_width:e.video?e.video.videoWidth:0,preview_video_height:e.video?e.video.videoHeight:0,preview_video_fps:i.frameRate,encode_video_width:e.video?e.video.videoWidth:0,encode_video_height:e.video?e.video.videoHeight:0,encode_video_fps:i.frameRate,video_bitrate:i.bitrate,result_code:t,stream_id:e.streamId,signal_take_time:r,ice_take_time:0,ice_connect_state:""}},t.getSubscribeQos=function(e,t,r){return{user_id:e?e.userId:"",result_code:t,stream_id:e?e.streamId:"",conn_id:e?e.connId:"",signal_take_time:r,ice_take_time:0,ice_connect_state:0,first_play_take_time:0}}},function(e,t,r){"use strict";r(0),Object.defineProperty(t,"__esModule",{value:!0}),t.getFrameFromVideo=function(e){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var r=t.getContext("2d");return r?(r.drawImage(e,0,0,e.videoWidth,e.videoHeight),t.toDataURL()):"data:,"}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r(28),r(30),r(52),r(53),r(16),r(22),r(0),Object.defineProperty(t,"__esModule",{value:!0});var c=r(80),u=r(18),d=r(13),f=["ping","auth-res","pub-res","unpub-res","webrtc-answer","webrtc-candidate","on-player-in","on-player-out","on-add-stream","on-remove-stream","disconnect","mute-stream"],l=function(e){function t(e,r,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=o(this,a(t).call(this))).mergeJobIndex=0,i.mergeJobResIndex=0,i.onWsOpen=function(){i.emit("ws:onopen"),d.log.log("signaling: websocket open"),i.wsOpen=!0,i.reconnecting=!1;var e={token:i.accessToken,playerdata:i.playerData,reconntoken:i.reconnectToken};i.sendWsMsg("auth",e)},i.onWsMsg=function(e){var t=e.data;i.emit("ws:onmessage",t);var r=t.indexOf("=");if(!(r>0&&r<t.length-1))throw u.UNEXPECTED_ERROR("signaling model can not parse message: ".concat(t));var n=t.substring(0,r),o=JSON.parse(t.substring(r+1));i.receiveWsMsg(n,o)},i.onWsError=function(e){d.log.warning("signaling: websocket error",e),i.emit("ws:onerror"),i.disconnect()},i.onWsClose=function(e){d.log.warning("signaling: websocket close",e),i.emit("ws:onclose"),i.disconnect()},i.sendWsMsg=function(e,t){var r=JSON.stringify(t);try{i.ws.send("".concat(e,"=").concat(r)),i.emit("send",e,t)}catch(e){d.log.warning("signaling: websocket send error",e),i.emit("ws:onerror"),i.disconnect()}},i.disconnect=function(){i.reconnecting||(i.wsOpen=!1,i.reconnecting=!0,i.emit("ws-disconnect"))},i.reconnect=function(e){e&&(i.reconnectToken=e),d.log.debug("signaling: websocket reconnecting"),i.ws.close(),i.initWs(),setTimeout(function(){i.reconnecting=!1,i.wsOpen||i.disconnect()},3e3)},i.handlePing=function(){i.sendWsMsg("pong",{}),i.reconnectTimeoutID&&clearTimeout(i.reconnectTimeoutID),i.reconnectTimeoutID=setTimeout(i.disconnect,6e3)},i.receiveWsMsg=function(e,t){switch(i.emit("receive",e,t),e){case"ping":i.handlePing();break;case"auth-res":i.emit(e,t),i.emit("auth-res-init",t);case"pub-res":case"unpub-res":case"webrtc-candidate":case"on-player-in":case"on-player-out":case"on-add-stream":case"on-remove-stream":case"disconnect":case"mute-stream":i.emit(e,t);break;case"create-merge-job-res":i.mergeJobResIndex+=1,i.emit("".concat(e,"-").concat(i.mergeJobResIndex),t);case"webrtc-answer":i.emit(e,t),i.emit("".concat(e,"-streamid-").concat(t.streamid,"-connid-").concat(t.connid),t);case"webrtc-icestate":i.emit(e,t),t.connid?i.emit("".concat(e,"-connid-").concat(t.connid),t):i.emit("".concat(e,"-stream-").concat(t.streamid),t);break;case"sub-res":case"unsub-res":i.emit(e,t),i.emit("".concat(e,"-").concat(t.streamid),t);break;case"control-res":i.emit(e,t),i.emit("".concat(e,"-").concat(t.command,"-").concat(t.playerid),t)}},i.url=e,i.accessToken=r,i.playerData=n,i.wsOpen=!1,i.reconnecting=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,c),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"initWs",value:function(){try{this.ws=new WebSocket(this.url)}catch(e){throw u.UNEXPECTED_ERROR("init signaling websocket faild!\nError: ".concat(e))}this.ws.onopen=this.onWsOpen,this.ws.onclose=this.onWsClose,this.ws.onerror=this.onWsError,this.ws.onmessage=this.onWsMsg}},{key:"release",value:function(){var e=this;this.ws.close(),f.forEach(function(t){return e.removeAllListeners(t)})}}]),t}();t.SignalingWS=l},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(33),r(69),r(23),r(16),r(0),Object.defineProperty(t,"__esModule",{value:!0});var i=r(35),o=r(13),a=function(){function e(t,r,n,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layoutLevel=0,this.handleUnpublish=function(e){a.handleRemoveStream(e.userId)},this.handlePublish=function(e){a.handleAddStream(e.userId)},this.width=t,this.height=r,this.jobId=i,this.session=n,this.initLayout(),this.session.on("user-unpublish",this.handleUnpublish),this.session.on("user-publish",this.handlePublish),o.log.log("init default merger, init layout: ",this.layout)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"initLayout",value:function(){this.updateStreamInfo();var e=this.streamInfo.length;this.layoutLevel=0,this.layout={"level-0":{items:{"item-0":{x:0,y:0,isExpand:!1,isExpanded:!1,index:0}},itemWidth:this.width,itemHeight:this.height,maxItems:1,currentItems:0,splitWidthFlag:this.width<this.height}};var t=this.width>=this.height;if(0!==e){for(;Math.pow(2,this.layoutLevel)<e;)this.updateLayoutLevel(t),t=!t;this.setLevelLayoutStream()}}},{key:"updateLayoutLevel",value:function(e){var t=this,r=this.layout["level-".concat(this.layoutLevel)],n=r.itemWidth,i=r.itemHeight;this.layoutLevel+=1;var a=Math.pow(2,this.layoutLevel),s=e?n/2:n,c=e?i:i/2;if(1===this.layoutLevel)this.layout["level-".concat(this.layoutLevel)]={items:{"item-0":{x:0,y:0,isExpand:!1,isExpanded:!1,index:0},"item-1":{x:this.width>=this.height?s:0,y:this.width<this.height?c:0,isExpand:!1,isExpanded:!1,index:1}},maxItems:a,currentItems:0,itemWidth:s,itemHeight:c,splitWidthFlag:e};else{this.layout["level-".concat(this.layoutLevel)]={items:{},maxItems:a,currentItems:0,itemWidth:s,itemHeight:c,splitWidthFlag:e};var u=this.layout["level-".concat(this.layoutLevel)].items;Object.keys(this.layout["level-".concat(this.layoutLevel-1)].items).forEach(function(r){var n=t.layout["level-".concat(t.layoutLevel-1)].items[r],i=2*n.index;u["item-".concat(i)]={x:n.x,y:n.y,isExpand:!1,isExpanded:!1,index:i},u["item-".concat(i+1)]=e?{x:n.x+s,y:n.y,isExpand:!1,isExpanded:!1,index:i+1}:{x:n.x,y:n.y+c,isExpand:!1,isExpanded:!1,index:i+1}})}o.log.log("merger: increase layout level, current level: ".concat(this.layoutLevel),this.layout)}},{key:"setLevelLayoutStream",value:function(){for(var e=this.streamInfo.length,t=this.layout["level-".concat(this.layoutLevel)],r=t.maxItems-e,n=0,i=0;i<t.maxItems;i+=1)r>0?i%2==0?(t.items["item-".concat(i)].isExpand=!0,t.items["item-".concat(i)].userId=this.streamInfo[n].playerid,this.sendMergeOpt(this.layoutLevel,i),n+=1):(t.items["item-".concat(i)].isExpanded=!0,r-=1):(t.items["item-".concat(i)].userId=this.streamInfo[n].playerid,this.sendMergeOpt(this.layoutLevel,i),n+=1);t.currentItems=e}},{key:"sendMergeOpt",value:function(e,t){var r=this.layout["level-".concat(e)],n=r.items["item-".concat(t)];if(n.userId&&!n.isExpanded){var i=r.itemWidth,o=r.itemHeight;n.isExpand&&(r.splitWidthFlag?i*=2:o*=2);var a={x:n.x,y:n.y,w:i,h:o,z:0,id:this.jobId};this.session.setMergeStreamLayout(n.userId,a)}}},{key:"handleRemoveStream",value:function(e){this.updateStreamInfo();var t=this.layout["level-".concat(this.layoutLevel)];if(this.layoutLevel>0&&this.streamInfo.length<=this.layout["level-".concat(this.layoutLevel-1)].maxItems)this.layoutLevel-=1,o.log.log("merger: reduce layout level, current level: ".concat(this.layoutLevel),this.layout),this.setLevelLayoutStream();else for(var r in t.items){var n=t.items[r];if(n.userId===e){n.index%2==0?(t.items["item-".concat(n.index+1)]?(n.isExpand=!0,n.userId=t.items["item-".concat(n.index+1)].userId,t.items["item-".concat(n.index+1)].isExpanded=!0,t.items["item-".concat(n.index+1)].userId=void 0):n.userId=void 0,this.sendMergeOpt(this.layoutLevel,n.index)):(n.isExpanded=!0,n.userId=void 0,t.items["item-".concat(n.index-1)].isExpand=!0,this.sendMergeOpt(this.layoutLevel,n.index-1));break}}}},{key:"handleAddStream",value:function(e){this.updateStreamInfo();var t=this.layout["level-".concat(this.layoutLevel)];if(this.streamInfo.length<=t.maxItems){for(var r in t.items){var n=t.items[r];if(!n.userId){n.userId=e,n.isExpanded&&(n.isExpanded=!1,t.items["item-".concat(n.index-1)].isExpand=!1,this.sendMergeOpt(this.layoutLevel,n.index-1)),this.sendMergeOpt(this.layoutLevel,n.index);break}}t.currentItems=this.streamInfo.length}else this.updateLayoutLevel(!t.splitWidthFlag),this.setLevelLayoutStream()}},{key:"updateStreamInfo",value:function(){this.streamInfo=[],this.session.stream&&this.session.stream.connectStatus===i.StreamConnectStatus.Connect&&this.streamInfo.push({playerid:this.session.userId}),this.streamInfo=this.streamInfo.concat(this.session.streamInfo)}},{key:"release",value:function(){this.session.off("user-publish",this.handlePublish),this.session.off("user-unpublish",this.handleUnpublish)}}]),e}();t.Merger=a},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?c(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r(28),r(30),r(52),r(53),r(186),r(43),r(44),r(187),r(22),r(16),r(23),r(33),r(69),r(70),r(83),r(12),r(34),r(0),r(9);var u=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var d=r(80),f=r(84),l=r(35),h=r(24),p=r(58),v=r(19),m=r(13),g=r(18),y=r(24),b=r(18),S={audio:{enabled:!0},video:{enabled:!0,width:640,height:480,bitrate:600,frameRate:20}},w=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=o(this,a(t).call(this))).autoSwitch=!0,e.constraints={audio:{},video:{}},e.deviceMap={},v.browserReport.support?(e.updateDeivceInfo(),v.browserReport.ondevicechange||(e.deviceInterval=setInterval(e.updateDeivceInfo.bind(c(c(e))),1e3)),v.browserReport.ondevicechange&&(navigator.mediaDevices.ondevicechange=e.updateDeivceInfo.bind(c(c(e)))),e):o(e)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,d),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"changeDevice",value:function(e,t){var r=h.getElementFromArray(this.deviceInfo,"deviceId",t);if(r){switch(e){case"audio":this.audioDevice=r;break;case"video":this.videoDevice=r}m.log.log("device-update",this.deviceInfo),this.emit("device-update"),this.getUserMedia().then().catch(function(e){throw e})}}},{key:"getLocalStream",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.transferRecordOptionToMediaConstraints(e);case 2:return this.constraints=t.sent,this.config=e||S,t.prev=4,t.next=7,this.getUserMedia(!0);case 7:r=t.sent,t.next=17;break;case 10:if(t.prev=10,t.t0=t.catch(4),"NotAllowedError"!==t.t0.name){t.next=16;break}throw b.DEVICE_NOT_ALLOWED("");case 16:throw t.t0;case 17:return!this.stream||this.stream.isDestroyed?this.stream=new f.Stream:this.stream.releaseTrack(),this.stream.setEnable(l.REC_AUDIO_ENABLE(this.config),l.REC_VIDEO_ENABLE(this.config)||l.REC_SCREEN_ENABLE(this.config)),t.next=21,this.stream.setMediaStream(r,!!this.stream.userId);case 21:return this.stream.setRecordConfig(this.config),t.next=24,this.updateDeivceInfo();case 24:return this.stream.audioTrack&&this.deviceInfo&&(n=null,this.stream.audioTrack.getSettings&&(n=this.stream.audioTrack.getSettings().deviceId),i=h.getElementFromArray(this.deviceInfo,"deviceId",n),this.audioDevice=i||{deviceId:"@default"}),this.stream.videoTrack&&this.deviceInfo&&(o=null,this.stream.videoTrack.getSettings&&(o=this.stream.videoTrack.getSettings().deviceId),a=h.getElementFromArray(this.deviceInfo,"deviceId",o),this.videoDevice=a||{deviceId:"@default"}),this.volume&&this.stream.setMicVolume(this.volume),t.abrupt("return",this.stream);case 28:case"end":return t.stop()}},t,this,[[4,10]])}))}},{key:"setVolume",value:function(e){this.volume=e,this.stream&&!this.stream.isDestroyed&&this.stream.setMicVolume(e)}},{key:"getUserMedia",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.audioDevice&&this.constraints.audio&&l.REC_AUDIO_ENABLE(this.config)&&(this.constraints.audio.deviceId="@default"===this.audioDevice.deviceId?void 0:this.audioDevice.deviceId,this.constraints.audio.groupId="@default"===this.audioDevice.deviceId?void 0:this.audioDevice.groupId),this.videoDevice&&this.constraints.video&&l.REC_VIDEO_ENABLE(this.config)&&(this.constraints.video.deviceId="@default"===this.videoDevice.deviceId?void 0:this.videoDevice.deviceId,this.constraints.video.groupId="@default"===this.videoDevice.deviceId?void 0:this.videoDevice.groupId),m.log.debug("request to get user media",this.constraints),this.constraints.audio||this.constraints.video){t.next=5;break}return t.abrupt("return",null);case 5:if(!(v.isChrome&&l.REC_SCREEN_ENABLE(this.config)&&l.REC_AUDIO_ENABLE(this.config))){t.next=11;break}return t.next=8,this.mergeChromeScreenAudioStream();case 8:r=t.sent,t.next=14;break;case 11:return t.next=13,navigator.mediaDevices.getUserMedia(this.constraints);case 13:r=t.sent;case 14:if(!this.stream||this.stream.isDestroyed||e){t.next=19;break}return this.stream.releaseTrack(),m.log.debug("set media stream",this.stream,r),t.next=19,this.stream.setMediaStream(r,!0);case 19:return t.abrupt("return",r);case 20:case"end":return t.stop()}},t,this)}))}},{key:"mergeChromeScreenAudioStream",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.constraints.audio&&this.constraints.video&&!(!this.constraints.video).mandatory){e.next=4;break}return e.next=3,navigator.mediaDevices.getUserMedia(this.constraints);case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,navigator.mediaDevices.getUserMedia({audio:this.constraints.audio});case 6:return t=e.sent,e.next=9,navigator.mediaDevices.getUserMedia({video:this.constraints.video});case 9:return(r=e.sent).addTrack(t.getAudioTracks()[0]),e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)}))}},{key:"updateDeivceInfo",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:this.deviceInfo=e.sent,t=this.deviceInfo.map(function(e){return e.deviceId}),r=Object.keys(this.deviceMap),n=[],i=[],o=!1,r.forEach(function(e){-1===t.indexOf(e)&&"@default"!==e?(m.log.log("device-remove",s.deviceMap[e].device),s.emit("device-remove",s.deviceMap[e].device),s.deviceMap[e].device.kind.startsWith("audio")?p.qos.addEvent(16,{device_type:"audioinput"===s.deviceMap[e].device.kind?0:1,device_state:0}):p.qos.addEvent(17,{device_state:0}),delete s.deviceMap[e],n.push(e),o=!0):s.deviceMap[e].tick+=1}),t.forEach(function(e,t){-1===r.indexOf(e)&&"@default"!==e&&(s.deviceMap[e]={device:s.deviceInfo[t],tick:0},m.log.log("device-add",s.deviceMap[e].device),s.emit("device-add",s.deviceMap[e].device),s.deviceMap[e].device.kind.startsWith("audio")?p.qos.addEvent(16,{device_type:"audioinput"===s.deviceMap[e].device.kind?0:1,device_state:1}):p.qos.addEvent(17,{device_state:1}),i.push(e),o=!0)}),o&&(m.log.log("device-update",this.deviceInfo),this.emit("device-update",this.deviceInfo)),a=!1,this.autoSwitch&&this.stream&&o&&!this.stream.isDestroyed&&this.onDeviceRemove(n)&&(a=!0),this.autoSwitch&&this.stream&&o&&!this.stream.isDestroyed&&this.onDeviceAdd(i)&&(a=!0),a&&this.getUserMedia().catch(function(e){s.emit("error",g.AUTO_SWITCH_ERROR(e.toString())),m.log.warning("audo switch faild",e)});case 15:case"end":return e.stop()}},e,this)}))}},{key:"onDeviceAdd",value:function(e){var t=this,r=!1;return e.forEach(function(e){var n=t.deviceMap[e].device;"audioinput"===n.kind&&l.REC_AUDIO_ENABLE(t.config)&&(t.audioDevice=n,r=!0),"videoinput"===n.kind&&l.REC_VIDEO_ENABLE(t.config)&&(t.videoDevice=n,r=!0)}),r}},{key:"onDeviceRemove",value:function(e){var t=this,r=!1;if(this.audioDevice&&-1!==e.indexOf(this.audioDevice.deviceId)&&l.REC_AUDIO_ENABLE(this.config)&&(this.audioDevice=void 0,r=!0),l.REC_AUDIO_ENABLE(this.config)&&this.audioDevice&&"@default"===this.audioDevice.deviceId&&(this.audioDevice=void 0,r=!0),this.videoDevice&&-1!==e.indexOf(this.videoDevice.deviceId)&&l.REC_VIDEO_ENABLE(this.config)&&(this.videoDevice=void 0,r=!0),l.REC_VIDEO_ENABLE(this.config)&&this.videoDevice&&"@default"===this.videoDevice.deviceId&&(this.videoDevice=void 0,r=!0),r)for(var n=Object.keys(this.deviceMap).map(function(e){return t.deviceMap[e]}).sort(function(e,t){return-(e.tick-t.tick)}),i=0;i<n.length;i+=1){var o=n[i];l.REC_AUDIO_ENABLE&&"audioinput"===o.device.kind&&!this.audioDevice&&(this.audioDevice=o.device),l.REC_VIDEO_ENABLE&&"videoinput"===o.device.kind&&!this.videoDevice&&(this.videoDevice=o.device)}return r}}]),t}();t.DeviceManager=w,t.deviceManager=new w},function(e,t,r){"use strict";var n=r(2),i=r(27),o=r(21),a=r(4),s=[].sort,c=[1,2,3];n(n.P+n.F*(a(function(){c.sort(void 0)})||!a(function(){c.sort(null)})||!r(54)(s)),"Array",{sort:function(e){return void 0===e?s.call(o(this)):s.call(o(this),i(e))}})},function(e,t,r){"use strict";var n=r(2),i=r(15),o=r(188),a="".startsWith;n(n.P+n.F*r(189)("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),r=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),n=String(e);return a?a.call(t,n,r):t.slice(r,r+n.length)===n}})},function(e,t,r){var n=r(81),i=r(39);e.exports=function(e,t,r){if(n(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},function(e,t,r){var n=r(3)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,!"/./"[e](t)}catch(e){}}return!0}}]);
//# sourceMappingURL=pili-rtc-web-1.2.4.js.map