var QNRTC=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=153)}([function(e,t,r){"use strict";var n,i,o,a,s=r(35),c=r(3),u=r(24),d=r(71),f=r(2),p=r(8),l=r(39),h=r(51),v=r(72),m=r(89),y=r(90).set,g=r(123)(),b=r(92),k=r(124),w=r(125),T=r(126),S=c.TypeError,_=c.process,C=_&&_.versions,x=C&&C.v8||"",R=c.Promise,P="process"==d(_),E=function(){},O=i=b.f,I=!!function(){try{var e=R.resolve(1),t=(e.constructor={})[r(4)("species")]=function(e){e(E,E)};return(P||"function"==typeof PromiseRejectionEvent)&&e.then(E)instanceof t&&0!==x.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),j=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},M=function(e,t){if(!e._n){e._n=!0;var r=e._c;g(function(){for(var n=e._v,i=1==e._s,o=0,a=function(t){var r,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{s?(i||(2==e._h&&D(e),e._h=1),!0===s?r=n:(d&&d.enter(),r=s(n),d&&(d.exit(),a=!0)),r===t.promise?u(S("Promise-chain cycle")):(o=j(r))?o.call(r,c,u):c(r)):u(n)}catch(e){d&&!a&&d.exit(),u(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&A(e)})}},A=function(e){y.call(c,function(){var t,r,n,i=e._v,o=L(e);if(o&&(t=k(function(){P?_.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=P||L(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){y.call(c,function(){var t;P?_.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),M(t,!0))},F=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw S("Promise can't be resolved itself");(t=j(e))?g(function(){var n={_w:r,_d:!1};try{t.call(e,u(F,n,1),u(N,n,1))}catch(e){N.call(n,e)}}):(r._v=e,r._s=1,M(r,!1))}catch(e){N.call({_w:r,_d:!1},e)}}};I||(R=function(e){h(this,R,"Promise","_h"),l(e),n.call(this);try{e(u(F,this,1),u(N,this,1))}catch(e){N.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(52)(R.prototype,{then:function(e,t){var r=O(m(this,R));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=P?_.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&M(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=u(F,e,1),this.reject=u(N,e,1)},b.f=O=function(e){return e===R||e===a?new o(e):i(e)}),f(f.G+f.W+f.F*!I,{Promise:R}),r(45)(R,"Promise"),r(75)("Promise"),a=r(32).Promise,f(f.S+f.F*!I,"Promise",{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!I),"Promise",{resolve:function(e){return T(s&&this===a?R:this,e)}}),f(f.S+f.F*!(I&&r(61)(function(e){R.all(e).catch(E)})),"Promise",{all:function(e){var t=this,r=O(t),n=r.resolve,i=r.reject,o=k(function(){var r=[],o=0,a=1;v(e,!1,function(e){var s=o++,c=!1;r.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,r[s]=e,--a||n(r))},i)}),--a||n(r)});return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=O(t),n=r.reject,i=k(function(){v(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},function(e,t,r){(function(e,r){var n=200,i="Expected a function",o="__lodash_hash_undefined__",a=1,s=2,c=1/0,u=9007199254740991,d="[object Arguments]",f="[object Array]",p="[object Boolean]",l="[object Date]",h="[object Error]",v="[object Function]",m="[object GeneratorFunction]",y="[object Map]",g="[object Number]",b="[object Object]",k="[object RegExp]",w="[object Set]",T="[object String]",S="[object Symbol]",_="[object ArrayBuffer]",C="[object DataView]",x=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,R=/^\w*$/,P=/^\./,E=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,O=/\\(\\)?/g,I=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,M={};M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M[d]=M[f]=M[_]=M[p]=M[C]=M[l]=M[h]=M[v]=M[y]=M[g]=M[b]=M[k]=M[w]=M[T]=M["[object WeakMap]"]=!1;var A="object"==typeof e&&e&&e.Object===Object&&e,L="object"==typeof self&&self&&self.Object===Object&&self,D=A||L||Function("return this")(),N="object"==typeof t&&t&&!t.nodeType&&t,F=N&&"object"==typeof r&&r&&!r.nodeType&&r,B=F&&F.exports===N&&A.process,U=function(){try{return B&&B.binding("util")}catch(e){}}(),G=U&&U.isTypedArray;function W(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function V(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function H(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function J(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var z=Array.prototype,$=Function.prototype,q=Object.prototype,Q=D["__core-js_shared__"],K=function(){var e=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Y=$.toString,X=q.hasOwnProperty,Z=q.toString,ee=RegExp("^"+Y.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=D.Symbol,re=D.Uint8Array,ne=q.propertyIsEnumerable,ie=z.splice,oe=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),ae=De(D,"DataView"),se=De(D,"Map"),ce=De(D,"Promise"),ue=De(D,"Set"),de=De(D,"WeakMap"),fe=De(Object,"create"),pe=Je(ae),le=Je(se),he=Je(ce),ve=Je(ue),me=Je(de),ye=te?te.prototype:void 0,ge=ye?ye.valueOf:void 0,be=ye?ye.toString:void 0;function ke(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function we(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Te(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Se(e){var t=-1,r=e?e.length:0;for(this.__data__=new Te;++t<r;)this.add(e[t])}function _e(e){this.__data__=new we(e)}function Ce(e,t){var r=Ke(e)||Qe(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!t&&!X.call(e,o)||i&&("length"==o||Fe(o,n))||r.push(o);return r}function xe(e,t){for(var r=e.length;r--;)if(qe(e[r][0],t))return r;return-1}function Re(e,t){for(var r=0,n=(t=Be(t,e)?[t]:Me(t)).length;null!=e&&r<n;)e=e[He(t[r++])];return r&&r==n?e:void 0}function Pe(e,t){return null!=e&&t in Object(e)}function Ee(e,t,r,n,i){return e===t||(null==e||null==t||!et(e)&&!tt(t)?e!=e&&t!=t:function(e,t,r,n,i,o){var c=Ke(e),u=Ke(t),v=f,m=f;c||(v=(v=Ne(e))==d?b:v);u||(m=(m=Ne(t))==d?b:m);var x=v==b&&!V(e),R=m==b&&!V(t),P=v==m;if(P&&!x)return o||(o=new _e),c||nt(e)?Ae(e,t,r,n,i,o):function(e,t,r,n,i,o,c){switch(r){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case _:return!(e.byteLength!=t.byteLength||!n(new re(e),new re(t)));case p:case l:case g:return qe(+e,+t);case h:return e.name==t.name&&e.message==t.message;case k:case T:return e==t+"";case y:var u=H;case w:var d=o&s;if(u||(u=J),e.size!=t.size&&!d)return!1;var f=c.get(e);if(f)return f==t;o|=a,c.set(e,t);var v=Ae(u(e),u(t),n,i,o,c);return c.delete(e),v;case S:if(ge)return ge.call(e)==ge.call(t)}return!1}(e,t,v,r,n,i,o);if(!(i&s)){var E=x&&X.call(e,"__wrapped__"),O=R&&X.call(t,"__wrapped__");if(E||O){var I=E?e.value():e,j=O?t.value():t;return o||(o=new _e),r(I,j,n,i,o)}}if(!P)return!1;return o||(o=new _e),function(e,t,r,n,i,o){var a=i&s,c=it(e),u=c.length,d=it(t).length;if(u!=d&&!a)return!1;for(var f=u;f--;){var p=c[f];if(!(a?p in t:X.call(t,p)))return!1}var l=o.get(e);if(l&&o.get(t))return l==t;var h=!0;o.set(e,t),o.set(t,e);for(var v=a;++f<u;){p=c[f];var m=e[p],y=t[p];if(n)var g=a?n(y,m,p,t,e,o):n(m,y,p,e,t,o);if(!(void 0===g?m===y||r(m,y,n,i,o):g)){h=!1;break}v||(v="constructor"==p)}if(h&&!v){var b=e.constructor,k=t.constructor;b!=k&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof k&&k instanceof k)&&(h=!1)}return o.delete(e),o.delete(t),h}(e,t,r,n,i,o)}(e,t,Ee,r,n,i))}function Oe(e){return!(!et(e)||function(e){return!!K&&K in e}(e))&&(Xe(e)||V(e)?ee:I).test(Je(e))}function Ie(e){return"function"==typeof e?e:null==e?ot:"object"==typeof e?Ke(e)?function(e,t){if(Be(e)&&Ue(t))return Ge(He(e),t);return function(r){var n=function(e,t,r){var n=null==e?void 0:Re(e,t);return void 0===n?r:n}(r,e);return void 0===n&&n===t?function(e,t){return null!=e&&function(e,t,r){var n,i=-1,o=(t=Be(t,e)?[t]:Me(t)).length;for(;++i<o;){var a=He(t[i]);if(!(n=null!=e&&r(e,a)))break;e=e[a]}if(n)return n;return!!(o=e?e.length:0)&&Ze(o)&&Fe(a,o)&&(Ke(e)||Qe(e))}(e,t,Pe)}(r,e):Ee(t,n,void 0,a|s)}}(e[0],e[1]):function(e){var t=function(e){var t=it(e),r=t.length;for(;r--;){var n=t[r],i=e[n];t[r]=[n,i,Ue(i)]}return t}(e);if(1==t.length&&t[0][2])return Ge(t[0][0],t[0][1]);return function(r){return r===e||function(e,t,r,n){var i=r.length,o=i,c=!n;if(null==e)return!o;for(e=Object(e);i--;){var u=r[i];if(c&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<o;){var d=(u=r[i])[0],f=e[d],p=u[1];if(c&&u[2]){if(void 0===f&&!(d in e))return!1}else{var l=new _e;if(n)var h=n(f,p,d,e,t,l);if(!(void 0===h?Ee(p,f,n,a|s,l):h))return!1}}return!0}(r,e,t)}}(e):function(e){return Be(e)?function(e){return function(t){return null==t?void 0:t[e]}}(He(e)):function(e){return function(t){return Re(t,e)}}(e)}(e)}function je(e){if(!function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||q;return e===r}(e))return oe(e);var t=[];for(var r in Object(e))X.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Me(e){return Ke(e)?e:Ve(e)}function Ae(e,t,r,n,i,o){var c=i&s,u=e.length,d=t.length;if(u!=d&&!(c&&d>u))return!1;var f=o.get(e);if(f&&o.get(t))return f==t;var p=-1,l=!0,h=i&a?new Se:void 0;for(o.set(e,t),o.set(t,e);++p<u;){var v=e[p],m=t[p];if(n)var y=c?n(m,v,p,t,e,o):n(v,m,p,e,t,o);if(void 0!==y){if(y)continue;l=!1;break}if(h){if(!W(t,function(e,t){if(!h.has(t)&&(v===e||r(v,e,n,i,o)))return h.add(t)})){l=!1;break}}else if(v!==m&&!r(v,m,n,i,o)){l=!1;break}}return o.delete(e),o.delete(t),l}function Le(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function De(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Oe(r)?r:void 0}ke.prototype.clear=function(){this.__data__=fe?fe(null):{}},ke.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ke.prototype.get=function(e){var t=this.__data__;if(fe){var r=t[e];return r===o?void 0:r}return X.call(t,e)?t[e]:void 0},ke.prototype.has=function(e){var t=this.__data__;return fe?void 0!==t[e]:X.call(t,e)},ke.prototype.set=function(e,t){return this.__data__[e]=fe&&void 0===t?o:t,this},we.prototype.clear=function(){this.__data__=[]},we.prototype.delete=function(e){var t=this.__data__,r=xe(t,e);return!(r<0||(r==t.length-1?t.pop():ie.call(t,r,1),0))},we.prototype.get=function(e){var t=this.__data__,r=xe(t,e);return r<0?void 0:t[r][1]},we.prototype.has=function(e){return xe(this.__data__,e)>-1},we.prototype.set=function(e,t){var r=this.__data__,n=xe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},Te.prototype.clear=function(){this.__data__={hash:new ke,map:new(se||we),string:new ke}},Te.prototype.delete=function(e){return Le(this,e).delete(e)},Te.prototype.get=function(e){return Le(this,e).get(e)},Te.prototype.has=function(e){return Le(this,e).has(e)},Te.prototype.set=function(e,t){return Le(this,e).set(e,t),this},Se.prototype.add=Se.prototype.push=function(e){return this.__data__.set(e,o),this},Se.prototype.has=function(e){return this.__data__.has(e)},_e.prototype.clear=function(){this.__data__=new we},_e.prototype.delete=function(e){return this.__data__.delete(e)},_e.prototype.get=function(e){return this.__data__.get(e)},_e.prototype.has=function(e){return this.__data__.has(e)},_e.prototype.set=function(e,t){var r=this.__data__;if(r instanceof we){var i=r.__data__;if(!se||i.length<n-1)return i.push([e,t]),this;r=this.__data__=new Te(i)}return r.set(e,t),this};var Ne=function(e){return Z.call(e)};function Fe(e,t){return!!(t=null==t?u:t)&&("number"==typeof e||j.test(e))&&e>-1&&e%1==0&&e<t}function Be(e,t){if(Ke(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!rt(e))||(R.test(e)||!x.test(e)||null!=t&&e in Object(t))}function Ue(e){return e==e&&!et(e)}function Ge(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function We(e,t){return 1==t.length?e:Re(e,function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o}(t,0,-1))}(ae&&Ne(new ae(new ArrayBuffer(1)))!=C||se&&Ne(new se)!=y||ce&&"[object Promise]"!=Ne(ce.resolve())||ue&&Ne(new ue)!=w||de&&"[object WeakMap]"!=Ne(new de))&&(Ne=function(e){var t=Z.call(e),r=t==b?e.constructor:void 0,n=r?Je(r):void 0;if(n)switch(n){case pe:return C;case le:return y;case he:return"[object Promise]";case ve:return w;case me:return"[object WeakMap]"}return t});var Ve=$e(function(e){e=function(e){return null==e?"":function(e){if("string"==typeof e)return e;if(rt(e))return be?be.call(e):"";var t=e+"";return"0"==t&&1/e==-c?"-0":t}(e)}(e);var t=[];return P.test(e)&&t.push(""),e.replace(E,function(e,r,n,i){t.push(n?i.replace(O,"$1"):r||e)}),t});function He(e){if("string"==typeof e||rt(e))return e;var t=e+"";return"0"==t&&1/e==-c?"-0":t}function Je(e){if(null!=e){try{return Y.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ze(e){var t=e?e.length:0;return t?e[t-1]:void 0}function $e(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(i);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new($e.Cache||Te),r}function qe(e,t){return e===t||e!=e&&t!=t}function Qe(e){return function(e){return tt(e)&&Ye(e)}(e)&&X.call(e,"callee")&&(!ne.call(e,"callee")||Z.call(e)==d)}$e.Cache=Te;var Ke=Array.isArray;function Ye(e){return null!=e&&Ze(e.length)&&!Xe(e)}function Xe(e){var t=et(e)?Z.call(e):"";return t==v||t==m}function Ze(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function et(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function tt(e){return!!e&&"object"==typeof e}function rt(e){return"symbol"==typeof e||tt(e)&&Z.call(e)==S}var nt=G?function(e){return function(t){return e(t)}}(G):function(e){return tt(e)&&Ze(e.length)&&!!M[Z.call(e)]};function it(e){return Ye(e)?Ce(e):je(e)}function ot(e){return e}r.exports=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],o=e.length;for(t=Ie(t);++n<o;){var a=e[n];t(a,n,e)&&(r.push(a),i.push(n))}return function(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==o){var o=i;if(Fe(i))ie.call(e,i,1);else if(Be(i,e))delete e[He(i)];else{var a=Me(i),s=We(e,a);null!=s&&delete s[He(ze(a))]}}}}(e,i),r}}).call(this,r(80),r(107)(e))},function(e,t,r){var n=r(3),i=r(32),o=r(21),a=r(23),s=r(24),c=function(e,t,r){var u,d,f,p,l=e&c.F,h=e&c.G,v=e&c.S,m=e&c.P,y=e&c.B,g=h?n:v?n[t]||(n[t]={}):(n[t]||{}).prototype,b=h?i:i[t]||(i[t]={}),k=b.prototype||(b.prototype={});for(u in h&&(r=t),r)f=((d=!l&&g&&void 0!==g[u])?g:r)[u],p=y&&d?s(f,n):m&&"function"==typeof f?s(Function.call,f):f,g&&a(g,u,f,e&c.U),b[u]!=f&&o(b,u,p),m&&k[u]!=f&&(k[u]=f)};n.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(66)("wks"),i=r(33),o=r(3).Symbol,a="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},function(e,t,r){var n=r(2);n(n.S+n.F*!r(13),"Object",{defineProperty:r(12).f})},function(e,t,r){r(94)("asyncIterator")},function(e,t,r){"use strict";var n=r(3),i=r(28),o=r(13),a=r(2),s=r(23),c=r(78).KEY,u=r(19),d=r(66),f=r(45),p=r(33),l=r(4),h=r(95),v=r(94),m=r(127),y=r(83),g=r(18),b=r(8),k=r(43),w=r(57),T=r(38),S=r(44),_=r(128),C=r(76),x=r(12),R=r(50),P=C.f,E=x.f,O=_.f,I=n.Symbol,j=n.JSON,M=j&&j.stringify,A=l("_hidden"),L=l("toPrimitive"),D={}.propertyIsEnumerable,N=d("symbol-registry"),F=d("symbols"),B=d("op-symbols"),U=Object.prototype,G="function"==typeof I,W=n.QObject,V=!W||!W.prototype||!W.prototype.findChild,H=o&&u(function(){return 7!=S(E({},"a",{get:function(){return E(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=P(U,t);n&&delete U[t],E(e,t,r),n&&e!==U&&E(U,t,n)}:E,J=function(e){var t=F[e]=S(I.prototype);return t._k=e,t},z=G&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},$=function(e,t,r){return e===U&&$(B,t,r),g(e),t=w(t,!0),g(r),i(F,t)?(r.enumerable?(i(e,A)&&e[A][t]&&(e[A][t]=!1),r=S(r,{enumerable:T(0,!1)})):(i(e,A)||E(e,A,T(1,{})),e[A][t]=!0),H(e,t,r)):E(e,t,r)},q=function(e,t){g(e);for(var r,n=m(t=k(t)),i=0,o=n.length;o>i;)$(e,r=n[i++],t[r]);return e},Q=function(e){var t=D.call(this,e=w(e,!0));return!(this===U&&i(F,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(F,e)||i(this,A)&&this[A][e])||t)},K=function(e,t){if(e=k(e),t=w(t,!0),e!==U||!i(F,t)||i(B,t)){var r=P(e,t);return!r||!i(F,t)||i(e,A)&&e[A][t]||(r.enumerable=!0),r}},Y=function(e){for(var t,r=O(k(e)),n=[],o=0;r.length>o;)i(F,t=r[o++])||t==A||t==c||n.push(t);return n},X=function(e){for(var t,r=e===U,n=O(r?B:k(e)),o=[],a=0;n.length>a;)!i(F,t=n[a++])||r&&!i(U,t)||o.push(F[t]);return o};G||(s((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===U&&t.call(B,r),i(this,A)&&i(this[A],e)&&(this[A][e]=!1),H(this,e,T(1,r))};return o&&V&&H(U,e,{configurable:!0,set:t}),J(e)}).prototype,"toString",function(){return this._k}),C.f=K,x.f=$,r(62).f=_.f=Y,r(77).f=Q,r(96).f=X,o&&!r(35)&&s(U,"propertyIsEnumerable",Q,!0),h.f=function(e){return J(l(e))}),a(a.G+a.W+a.F*!G,{Symbol:I});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Z.length>ee;)l(Z[ee++]);for(var te=R(l.store),re=0;te.length>re;)v(te[re++]);a(a.S+a.F*!G,"Symbol",{for:function(e){return i(N,e+="")?N[e]:N[e]=I(e)},keyFor:function(e){if(!z(e))throw TypeError(e+" is not a symbol!");for(var t in N)if(N[t]===e)return t},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+a.F*!G,"Object",{create:function(e,t){return void 0===t?S(e):q(S(e),t)},defineProperty:$,defineProperties:q,getOwnPropertyDescriptor:K,getOwnPropertyNames:Y,getOwnPropertySymbols:X}),j&&a(a.S+a.F*(!G||u(function(){var e=I();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!z(e))return y(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!z(t))return t}),n[1]=t,M.apply(j,n)}}),I.prototype[L]||r(21)(I.prototype,L,I.prototype.valueOf),f(I,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof e,d=t.regeneratorRuntime;if(d)u&&(e.exports=d);else{(d=t.regeneratorRuntime=u?e.exports:{}).wrap=k;var f="suspendedStart",p="suspendedYield",l="executing",h="completed",v={},m={};m[a]=function(){return this};var y=Object.getPrototypeOf,g=y&&y(y(I([])));g&&g!==n&&i.call(g,a)&&(m=g);var b=_.prototype=T.prototype=Object.create(m);S.prototype=b.constructor=_,_.constructor=S,_[c]=S.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},d.awrap=function(e){return{__await:e}},C(x.prototype),x.prototype[s]=function(){return this},d.AsyncIterator=x,d.async=function(e,t,r,n){var i=new x(k(e,t,r,n));return d.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},C(b),b[c]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},d.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function k(e,t,r,n){var i=t&&t.prototype instanceof T?t:T,o=Object.create(i.prototype),a=new O(n||[]);return o._invoke=function(e,t,r){var n=f;return function(i,o){if(n===l)throw new Error("Generator is already running");if(n===h){if("throw"===i)throw o;return j()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=l;var c=w(e,t,r);if("normal"===c.type){if(n=r.done?h:p,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=h,r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function w(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function T(){}function S(){}function _(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function x(e){var t;this._invoke=function(r,n){function o(){return new Promise(function(t,o){!function t(r,n,o,a){var s=w(e[r],e,n);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},function(e){return t("throw",e,o,a)})}a(s.arg)}(r,n,t,o)})}return t=t?t.then(o,o):o()}}function R(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,R(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=w(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,v;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function I(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return o.next=o}}return{next:j}}function j(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){"use strict";var n=r(67),i=r(84),o=r(42),a=r(43);e.exports=r(68)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t,r){for(var n=r(10),i=r(50),o=r(23),a=r(3),s=r(21),c=r(42),u=r(4),d=u("iterator"),f=u("toStringTag"),p=c.Array,l={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},h=i(l),v=0;v<h.length;v++){var m,y=h[v],g=l[y],b=a[y],k=b&&b.prototype;if(k&&(k[d]||s(k,d,p),k[f]||s(k,f,y),c[y]=p,g))for(m in n)k[m]||o(k,m,n[m],!0)}},function(e,t,r){var n=r(18),i=r(81),o=r(57),a=Object.defineProperty;t.f=r(13)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(19)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(2);n(n.S,"Object",{create:r(44)})},function(e,t,r){var n=r(2);n(n.S,"Object",{setPrototypeOf:r(93).set})},function(e,t,r){(function(r){var n;t=e.exports=q,n="object"==typeof r&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],s=t.src=[],c=0,u=c++;s[u]="0|[1-9]\\d*";var d=c++;s[d]="[0-9]+";var f=c++;s[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=c++;s[p]="("+s[u]+")\\.("+s[u]+")\\.("+s[u]+")";var l=c++;s[l]="("+s[d]+")\\.("+s[d]+")\\.("+s[d]+")";var h=c++;s[h]="(?:"+s[u]+"|"+s[f]+")";var v=c++;s[v]="(?:"+s[d]+"|"+s[f]+")";var m=c++;s[m]="(?:-("+s[h]+"(?:\\."+s[h]+")*))";var y=c++;s[y]="(?:-?("+s[v]+"(?:\\."+s[v]+")*))";var g=c++;s[g]="[0-9A-Za-z-]+";var b=c++;s[b]="(?:\\+("+s[g]+"(?:\\."+s[g]+")*))";var k=c++,w="v?"+s[p]+s[m]+"?"+s[b]+"?";s[k]="^"+w+"$";var T="[v=\\s]*"+s[l]+s[y]+"?"+s[b]+"?",S=c++;s[S]="^"+T+"$";var _=c++;s[_]="((?:<|>)?=?)";var C=c++;s[C]=s[d]+"|x|X|\\*";var x=c++;s[x]=s[u]+"|x|X|\\*";var R=c++;s[R]="[v=\\s]*("+s[x]+")(?:\\.("+s[x]+")(?:\\.("+s[x]+")(?:"+s[m]+")?"+s[b]+"?)?)?";var P=c++;s[P]="[v=\\s]*("+s[C]+")(?:\\.("+s[C]+")(?:\\.("+s[C]+")(?:"+s[y]+")?"+s[b]+"?)?)?";var E=c++;s[E]="^"+s[_]+"\\s*"+s[R]+"$";var O=c++;s[O]="^"+s[_]+"\\s*"+s[P]+"$";var I=c++;s[I]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var j=c++;s[j]="(?:~>?)";var M=c++;s[M]="(\\s*)"+s[j]+"\\s+",a[M]=new RegExp(s[M],"g");var A=c++;s[A]="^"+s[j]+s[R]+"$";var L=c++;s[L]="^"+s[j]+s[P]+"$";var D=c++;s[D]="(?:\\^)";var N=c++;s[N]="(\\s*)"+s[D]+"\\s+",a[N]=new RegExp(s[N],"g");var F=c++;s[F]="^"+s[D]+s[R]+"$";var B=c++;s[B]="^"+s[D]+s[P]+"$";var U=c++;s[U]="^"+s[_]+"\\s*("+T+")$|^$";var G=c++;s[G]="^"+s[_]+"\\s*("+w+")$|^$";var W=c++;s[W]="(\\s*)"+s[_]+"\\s*("+T+"|"+s[R]+")",a[W]=new RegExp(s[W],"g");var V=c++;s[V]="^\\s*("+s[R]+")\\s+-\\s+("+s[R]+")\\s*$";var H=c++;s[H]="^\\s*("+s[P]+")\\s+-\\s+("+s[P]+")\\s*$";var J=c++;s[J]="(<|>)?=?\\s*\\*";for(var z=0;z<c;z++)n(z,s[z]),a[z]||(a[z]=new RegExp(s[z]));function $(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof q)return e;if("string"!=typeof e)return null;if(e.length>i)return null;if(!(t.loose?a[S]:a[k]).test(e))return null;try{return new q(e,t)}catch(e){return null}}function q(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof q){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof q))return new q(e,t);n("SemVer",e,t),this.options=t,this.loose=!!t.loose;var r=e.trim().match(t.loose?a[S]:a[k]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}t.parse=$,t.valid=function(e,t){var r=$(e,t);return r?r.version:null},t.clean=function(e,t){var r=$(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null},t.SemVer=q,q.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},q.prototype.toString=function(){return this.version},q.prototype.compare=function(e){return n("SemVer.compare",this.version,this.options,e),e instanceof q||(e=new q(e,this.options)),this.compareMain(e)||this.comparePre(e)},q.prototype.compareMain=function(e){return e instanceof q||(e=new q(e,this.options)),K(this.major,e.major)||K(this.minor,e.minor)||K(this.patch,e.patch)},q.prototype.comparePre=function(e){if(e instanceof q||(e=new q(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return K(r,i)}while(++t)},q.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,r,n){"string"==typeof r&&(n=r,r=void 0);try{return new q(e,r).inc(t,n).version}catch(e){return null}},t.diff=function(e,t){if(ee(e,t))return null;var r=$(e),n=$(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},t.compareIdentifiers=K;var Q=/^[0-9]+$/;function K(e,t){var r=Q.test(e),n=Q.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function Y(e,t,r){return new q(e,r).compare(new q(t,r))}function X(e,t,r){return Y(e,t,r)>0}function Z(e,t,r){return Y(e,t,r)<0}function ee(e,t,r){return 0===Y(e,t,r)}function te(e,t,r){return 0!==Y(e,t,r)}function re(e,t,r){return Y(e,t,r)>=0}function ne(e,t,r){return Y(e,t,r)<=0}function ie(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=ee(e,r,n);break;case"!=":i=te(e,r,n);break;case">":i=X(e,r,n);break;case">=":i=re(e,r,n);break;case"<":i=Z(e,r,n);break;case"<=":i=ne(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function oe(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof oe){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ae?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return K(t,e)},t.major=function(e,t){return new q(e,t).major},t.minor=function(e,t){return new q(e,t).minor},t.patch=function(e,t){return new q(e,t).patch},t.compare=Y,t.compareLoose=function(e,t){return Y(e,t,!0)},t.rcompare=function(e,t,r){return Y(t,e,r)},t.sort=function(e,r){return e.sort(function(e,n){return t.compare(e,n,r)})},t.rsort=function(e,r){return e.sort(function(e,n){return t.rcompare(e,n,r)})},t.gt=X,t.lt=Z,t.eq=ee,t.neq=te,t.gte=re,t.lte=ne,t.cmp=ie,t.Comparator=oe;var ae={};function se(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof se)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new se(e.raw,t);if(e instanceof oe)return new se(e.value,t);if(!(this instanceof se))return new se(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ce(e){return!e||"x"===e.toLowerCase()||"*"===e}function ue(e,t,r,n,i,o,a,s,c,u,d,f,p){return((t=ce(r)?"":ce(n)?">="+r+".0.0":ce(i)?">="+r+"."+n+".0":">="+t)+" "+(s=ce(c)?"":ce(u)?"<"+(+c+1)+".0.0":ce(d)?"<"+c+"."+(+u+1)+".0":f?"<="+c+"."+u+"."+d+"-"+f:"<="+s)).trim()}function de(e,t,r){for(var i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(r||(r={}),t.prerelease.length&&!r.includePrerelease){for(i=0;i<e.length;i++)if(n(e[i].semver),e[i].semver!==ae&&e[i].semver.prerelease.length>0){var o=e[i].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}function fe(e,t,r){try{t=new se(t,r)}catch(e){return!1}return t.test(e)}function pe(e,t,r,n){var i,o,a,s,c;switch(e=new q(e,n),t=new se(t,n),r){case">":i=X,o=ne,a=Z,s=">",c=">=";break;case"<":i=Z,o=re,a=X,s="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(fe(e,t,n))return!1;for(var u=0;u<t.set.length;++u){var d=null,f=null;if(t.set[u].forEach(function(e){e.semver===ae&&(e=new oe(">=0.0.0")),d=d||e,f=f||e,i(e.semver,d.semver,n)?d=e:a(e.semver,f.semver,n)&&(f=e)}),d.operator===s||d.operator===c)return!1;if((!f.operator||f.operator===s)&&o(e,f.semver))return!1;if(f.operator===c&&a(e,f.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.options.loose?a[U]:a[G],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new q(r[2],this.options.loose):this.semver=ae},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.options.loose),this.semver===ae||("string"==typeof e&&(e=new q(e,this.options)),ie(e,this.operator,this.semver,this.options))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var r;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return r=new se(e.value,t),fe(this.value,r,t);if(""===e.operator)return r=new se(this.value,t),fe(e.semver,r,t);var n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=ie(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=ie(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||o&&a||s||c},t.Range=se,se.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},se.prototype.toString=function(){return this.range},se.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var r=t?a[H]:a[V];e=e.replace(r,ue),n("hyphen replace",e),e=e.replace(a[W],"$1$2$3"),n("comparator trim",e,a[W]),e=(e=(e=e.replace(a[M],"$1~")).replace(a[N],"$1^")).split(/\s+/).join(" ");var i=t?a[U]:a[G],o=e.split(" ").map(function(e){return function(e,t){return n("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t),t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?a[B]:a[F];return e.replace(r,function(t,r,i,o,a){var s;return n("caret",e,t,r,i,o,a),ce(r)?s="":ce(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ce(o)?s="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":a?(n("replaceCaret pr",a),"-"!==a.charAt(0)&&(a="-"+a),s="0"===r?"0"===i?">="+r+"."+i+"."+o+a+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+a+" <"+(+r+1)+".0.0"):(n("no pr"),s="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",s),s})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?a[L]:a[A];return e.replace(r,function(t,r,i,o,a){var s;return n("tilde",e,t,r,i,o,a),ce(r)?s="":ce(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ce(o)?s=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":a?(n("replaceTilde pr",a),"-"!==a.charAt(0)&&(a="-"+a),s=">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0"):s=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",s),s})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim(),t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?a[O]:a[E];return e.replace(r,function(t,r,i,o,a,s){n("xRange",e,t,r,i,o,a,s);var c=ce(i),u=c||ce(o),d=u||ce(a),f=d;return"="===r&&f&&(r=""),c?t=">"===r||"<"===r?"<0.0.0":"*":r&&f?(u&&(o=0),d&&(a=0),">"===r?(r=">=",u?(i=+i+1,o=0,a=0):d&&(o=+o+1,a=0)):"<="===r&&(r="<",u?i=+i+1:o=+o+1),t=r+i+"."+o+"."+a):u?t=">="+i+".0.0 <"+(+i+1)+".0.0":d&&(t=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(a[J],"")}(e,t),n("stars",e),e}(e,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(o=o.filter(function(e){return!!e.match(i)})),o=o.map(function(e){return new oe(e,this.options)},this)},se.prototype.intersects=function(e,t){if(!(e instanceof se))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(r){return e.set.some(function(e){return e.every(function(e){return r.intersects(e,t)})})})})},t.toComparators=function(e,t){return new se(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},se.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new q(e,this.options));for(var t=0;t<this.set.length;t++)if(de(this.set[t],e,this.options))return!0;return!1},t.satisfies=fe,t.maxSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&-1!==i.compare(e)||(i=new q(n=e,r)))}),n},t.minSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&1!==i.compare(e)||(i=new q(n=e,r)))}),n},t.validRange=function(e,t){try{return new se(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,r){return pe(e,t,"<",r)},t.gtr=function(e,t,r){return pe(e,t,">",r)},t.outside=pe,t.prerelease=function(e,t){var r=$(e,t);return r&&r.prerelease.length?r.prerelease:null},t.intersects=function(e,t,r){return e=new se(e,r),t=new se(t,r),e.intersects(t)},t.coerce=function(e){if(e instanceof q)return e;if("string"!=typeof e)return null;var t=e.match(a[I]);return null==t?null:$((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,r(113))},function(e,t,r){"use strict";var n=r(2),i=r(48)(0),o=r(58)([].forEach,!0);n(n.P+n.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,r){var n=r(8);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){var n;
/*!
 * EventEmitter v5.2.5 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function i(){}var o=i.prototype,a=t.EventEmitter;function s(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},o.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},o.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===s(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=s(i[n],t))&&i[n].splice(r,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):a.call(this,n,i));return this},o.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var r,n,i,o,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(r=a[o].slice(0),i=0;i<r.length;i++)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=a,i},void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n)}("undefined"!=typeof window?window:this||{})},function(e,t,r){var n=r(12),i=r(38);e.exports=r(13)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){"use strict";var n=r(2),i=r(48)(1);n(n.P+n.F*!r(58)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,r){var n=r(3),i=r(21),o=r(28),a=r(33)("src"),s=Function.toString,c=(""+s).split("toString");r(32).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var u="function"==typeof r;u&&(o(r,"name")||i(r,"name",t)),e[t]!==r&&(u&&(o(r,a)||i(r,a,e[t]?""+e[t]:c.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||s.call(this)})},function(e,t,r){var n=r(39);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(41),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){"use strict";var n=!0,i=!0;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}e.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},function(e,t,r){var n=r(151),i=r(152);t.write=i,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(34),i=r(50);r(122)("keys",function(){return function(e){return i(n(e))}})},function(e,t,r){"use strict";var n=r(2),i=r(48)(2);n(n.P+n.F*!r(58)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,r){(function(e,r){var n=200,i="Expected a function",o="__lodash_hash_undefined__",a=1,s=2,c=1/0,u=9007199254740991,d="[object Arguments]",f="[object Array]",p="[object Boolean]",l="[object Date]",h="[object Error]",v="[object Function]",m="[object GeneratorFunction]",y="[object Map]",g="[object Number]",b="[object Object]",k="[object RegExp]",w="[object Set]",T="[object String]",S="[object Symbol]",_="[object ArrayBuffer]",C="[object DataView]",x=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,R=/^\w*$/,P=/^\./,E=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,O=/\\(\\)?/g,I=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,M={};M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M[d]=M[f]=M[_]=M[p]=M[C]=M[l]=M[h]=M[v]=M[y]=M[g]=M[b]=M[k]=M[w]=M[T]=M["[object WeakMap]"]=!1;var A="object"==typeof e&&e&&e.Object===Object&&e,L="object"==typeof self&&self&&self.Object===Object&&self,D=A||L||Function("return this")(),N="object"==typeof t&&t&&!t.nodeType&&t,F=N&&"object"==typeof r&&r&&!r.nodeType&&r,B=F&&F.exports===N&&A.process,U=function(){try{return B&&B.binding("util")}catch(e){}}(),G=U&&U.isTypedArray;function W(e,t){return!!(e?e.length:0)&&function(e,t,r){if(t!=t)return function(e,t,r,n){var i=e.length,o=r+(n?1:-1);for(;n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,J,r);var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,0)>-1}function V(e,t,r){for(var n=-1,i=e?e.length:0;++n<i;)if(r(t,e[n]))return!0;return!1}function H(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function J(e){return e!=e}function z(e,t){return e.has(t)}function $(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function q(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function Q(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var K=Array.prototype,Y=Function.prototype,X=Object.prototype,Z=D["__core-js_shared__"],ee=function(){var e=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),te=Y.toString,re=X.hasOwnProperty,ne=X.toString,ie=RegExp("^"+te.call(re).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oe=D.Symbol,ae=D.Uint8Array,se=X.propertyIsEnumerable,ce=K.splice,ue=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),de=Ge(D,"DataView"),fe=Ge(D,"Map"),pe=Ge(D,"Promise"),le=Ge(D,"Set"),he=Ge(D,"WeakMap"),ve=Ge(Object,"create"),me=Qe(de),ye=Qe(fe),ge=Qe(pe),be=Qe(le),ke=Qe(he),we=oe?oe.prototype:void 0,Te=we?we.valueOf:void 0,Se=we?we.toString:void 0;function _e(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Re(e){var t=-1,r=e?e.length:0;for(this.__data__=new xe;++t<r;)this.add(e[t])}function Pe(e){this.__data__=new Ce(e)}function Ee(e,t){var r=Ze(e)||Xe(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!t&&!re.call(e,o)||i&&("length"==o||Ve(o,n))||r.push(o);return r}function Oe(e,t){for(var r=e.length;r--;)if(Ye(e[r][0],t))return r;return-1}function Ie(e,t){for(var r=0,n=(t=He(t,e)?[t]:Ne(t)).length;null!=e&&r<n;)e=e[qe(t[r++])];return r&&r==n?e:void 0}function je(e,t){return null!=e&&t in Object(e)}function Me(e,t,r,n,i){return e===t||(null==e||null==t||!nt(e)&&!it(t)?e!=e&&t!=t:function(e,t,r,n,i,o){var c=Ze(e),u=Ze(t),v=f,m=f;c||(v=(v=We(e))==d?b:v);u||(m=(m=We(t))==d?b:m);var x=v==b&&!$(e),R=m==b&&!$(t),P=v==m;if(P&&!x)return o||(o=new Pe),c||at(e)?Be(e,t,r,n,i,o):function(e,t,r,n,i,o,c){switch(r){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case _:return!(e.byteLength!=t.byteLength||!n(new ae(e),new ae(t)));case p:case l:case g:return Ye(+e,+t);case h:return e.name==t.name&&e.message==t.message;case k:case T:return e==t+"";case y:var u=q;case w:var d=o&s;if(u||(u=Q),e.size!=t.size&&!d)return!1;var f=c.get(e);if(f)return f==t;o|=a,c.set(e,t);var v=Be(u(e),u(t),n,i,o,c);return c.delete(e),v;case S:if(Te)return Te.call(e)==Te.call(t)}return!1}(e,t,v,r,n,i,o);if(!(i&s)){var E=x&&re.call(e,"__wrapped__"),O=R&&re.call(t,"__wrapped__");if(E||O){var I=E?e.value():e,j=O?t.value():t;return o||(o=new Pe),r(I,j,n,i,o)}}if(!P)return!1;return o||(o=new Pe),function(e,t,r,n,i,o){var a=i&s,c=st(e),u=c.length,d=st(t).length;if(u!=d&&!a)return!1;for(var f=u;f--;){var p=c[f];if(!(a?p in t:re.call(t,p)))return!1}var l=o.get(e);if(l&&o.get(t))return l==t;var h=!0;o.set(e,t),o.set(t,e);for(var v=a;++f<u;){p=c[f];var m=e[p],y=t[p];if(n)var g=a?n(y,m,p,t,e,o):n(m,y,p,e,t,o);if(!(void 0===g?m===y||r(m,y,n,i,o):g)){h=!1;break}v||(v="constructor"==p)}if(h&&!v){var b=e.constructor,k=t.constructor;b!=k&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof k&&k instanceof k)&&(h=!1)}return o.delete(e),o.delete(t),h}(e,t,r,n,i,o)}(e,t,Me,r,n,i))}function Ae(e){return!(!nt(e)||function(e){return!!ee&&ee in e}(e))&&(tt(e)||$(e)?ie:I).test(Qe(e))}function Le(e){return"function"==typeof e?e:null==e?ct:"object"==typeof e?Ze(e)?function(e,t){if(He(e)&&Je(t))return ze(qe(e),t);return function(r){var n=function(e,t,r){var n=null==e?void 0:Ie(e,t);return void 0===n?r:n}(r,e);return void 0===n&&n===t?function(e,t){return null!=e&&function(e,t,r){var n,i=-1,o=(t=He(t,e)?[t]:Ne(t)).length;for(;++i<o;){var a=qe(t[i]);if(!(n=null!=e&&r(e,a)))break;e=e[a]}if(n)return n;return!!(o=e?e.length:0)&&rt(o)&&Ve(a,o)&&(Ze(e)||Xe(e))}(e,t,je)}(r,e):Me(t,n,void 0,a|s)}}(e[0],e[1]):function(e){var t=function(e){var t=st(e),r=t.length;for(;r--;){var n=t[r],i=e[n];t[r]=[n,i,Je(i)]}return t}(e);if(1==t.length&&t[0][2])return ze(t[0][0],t[0][1]);return function(r){return r===e||function(e,t,r,n){var i=r.length,o=i,c=!n;if(null==e)return!o;for(e=Object(e);i--;){var u=r[i];if(c&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<o;){var d=(u=r[i])[0],f=e[d],p=u[1];if(c&&u[2]){if(void 0===f&&!(d in e))return!1}else{var l=new Pe;if(n)var h=n(f,p,d,e,t,l);if(!(void 0===h?Me(p,f,n,a|s,l):h))return!1}}return!0}(r,e,t)}}(e):function(e){return He(e)?function(e){return function(t){return null==t?void 0:t[e]}}(qe(e)):function(e){return function(t){return Ie(t,e)}}(e)}(e)}function De(e){if(!function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||X;return e===r}(e))return ue(e);var t=[];for(var r in Object(e))re.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Ne(e){return Ze(e)?e:$e(e)}_e.prototype.clear=function(){this.__data__=ve?ve(null):{}},_e.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},_e.prototype.get=function(e){var t=this.__data__;if(ve){var r=t[e];return r===o?void 0:r}return re.call(t,e)?t[e]:void 0},_e.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:re.call(t,e)},_e.prototype.set=function(e,t){return this.__data__[e]=ve&&void 0===t?o:t,this},Ce.prototype.clear=function(){this.__data__=[]},Ce.prototype.delete=function(e){var t=this.__data__,r=Oe(t,e);return!(r<0||(r==t.length-1?t.pop():ce.call(t,r,1),0))},Ce.prototype.get=function(e){var t=this.__data__,r=Oe(t,e);return r<0?void 0:t[r][1]},Ce.prototype.has=function(e){return Oe(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var r=this.__data__,n=Oe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},xe.prototype.clear=function(){this.__data__={hash:new _e,map:new(fe||Ce),string:new _e}},xe.prototype.delete=function(e){return Ue(this,e).delete(e)},xe.prototype.get=function(e){return Ue(this,e).get(e)},xe.prototype.has=function(e){return Ue(this,e).has(e)},xe.prototype.set=function(e,t){return Ue(this,e).set(e,t),this},Re.prototype.add=Re.prototype.push=function(e){return this.__data__.set(e,o),this},Re.prototype.has=function(e){return this.__data__.has(e)},Pe.prototype.clear=function(){this.__data__=new Ce},Pe.prototype.delete=function(e){return this.__data__.delete(e)},Pe.prototype.get=function(e){return this.__data__.get(e)},Pe.prototype.has=function(e){return this.__data__.has(e)},Pe.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Ce){var i=r.__data__;if(!fe||i.length<n-1)return i.push([e,t]),this;r=this.__data__=new xe(i)}return r.set(e,t),this};var Fe=le&&1/Q(new le([,-0]))[1]==c?function(e){return new le(e)}:function(){};function Be(e,t,r,n,i,o){var c=i&s,u=e.length,d=t.length;if(u!=d&&!(c&&d>u))return!1;var f=o.get(e);if(f&&o.get(t))return f==t;var p=-1,l=!0,h=i&a?new Re:void 0;for(o.set(e,t),o.set(t,e);++p<u;){var v=e[p],m=t[p];if(n)var y=c?n(m,v,p,t,e,o):n(v,m,p,e,t,o);if(void 0!==y){if(y)continue;l=!1;break}if(h){if(!H(t,function(e,t){if(!h.has(t)&&(v===e||r(v,e,n,i,o)))return h.add(t)})){l=!1;break}}else if(v!==m&&!r(v,m,n,i,o)){l=!1;break}}return o.delete(e),o.delete(t),l}function Ue(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function Ge(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Ae(r)?r:void 0}var We=function(e){return ne.call(e)};function Ve(e,t){return!!(t=null==t?u:t)&&("number"==typeof e||j.test(e))&&e>-1&&e%1==0&&e<t}function He(e,t){if(Ze(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ot(e))||(R.test(e)||!x.test(e)||null!=t&&e in Object(t))}function Je(e){return e==e&&!nt(e)}function ze(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}(de&&We(new de(new ArrayBuffer(1)))!=C||fe&&We(new fe)!=y||pe&&"[object Promise]"!=We(pe.resolve())||le&&We(new le)!=w||he&&"[object WeakMap]"!=We(new he))&&(We=function(e){var t=ne.call(e),r=t==b?e.constructor:void 0,n=r?Qe(r):void 0;if(n)switch(n){case me:return C;case ye:return y;case ge:return"[object Promise]";case be:return w;case ke:return"[object WeakMap]"}return t});var $e=Ke(function(e){e=function(e){return null==e?"":function(e){if("string"==typeof e)return e;if(ot(e))return Se?Se.call(e):"";var t=e+"";return"0"==t&&1/e==-c?"-0":t}(e)}(e);var t=[];return P.test(e)&&t.push(""),e.replace(E,function(e,r,n,i){t.push(n?i.replace(O,"$1"):r||e)}),t});function qe(e){if("string"==typeof e||ot(e))return e;var t=e+"";return"0"==t&&1/e==-c?"-0":t}function Qe(e){if(null!=e){try{return te.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ke(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(i);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new(Ke.Cache||xe),r}function Ye(e,t){return e===t||e!=e&&t!=t}function Xe(e){return function(e){return it(e)&&et(e)}(e)&&re.call(e,"callee")&&(!se.call(e,"callee")||ne.call(e)==d)}Ke.Cache=xe;var Ze=Array.isArray;function et(e){return null!=e&&rt(e.length)&&!tt(e)}function tt(e){var t=nt(e)?ne.call(e):"";return t==v||t==m}function rt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function nt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function it(e){return!!e&&"object"==typeof e}function ot(e){return"symbol"==typeof e||it(e)&&ne.call(e)==S}var at=G?function(e){return function(t){return e(t)}}(G):function(e){return it(e)&&rt(e.length)&&!!M[ne.call(e)]};function st(e){return et(e)?Ee(e):De(e)}function ct(e){return e}r.exports=function(e,t){return e&&e.length?function(e,t,r){var i=-1,o=W,a=e.length,s=!0,c=[],u=c;if(r)s=!1,o=V;else if(a>=n){var d=t?null:Fe(e);if(d)return Q(d);s=!1,o=z,u=new Re}else u=t?[]:c;e:for(;++i<a;){var f=e[i],p=t?t(f):f;if(f=r||0!==f?f:0,s&&p==p){for(var l=u.length;l--;)if(u[l]===p)continue e;t&&u.push(p),c.push(f)}else o(u,p,r)||(u!==c&&u.push(p),c.push(f))}return c}(e,Le(t)):[]}}).call(this,r(80),r(107)(e))},function(e,t){var r=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=r)},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(49);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=!1},function(e,t,r){var n=r(2);n(n.P,"Function",{bind:r(100)})},function(e,t,r){"use strict";var n=r(2),i=r(59)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(a||!r(58)(o)),"Array",{indexOf:function(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports={}},function(e,t,r){var n=r(82),i=r(49);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(18),i=r(121),o=r(70),a=r(69)("IE_PROTO"),s=function(){},c=function(){var e,t=r(65)("iframe"),n=o.length;for(t.style.display="none",r(86).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(12).f,i=r(28),o=r(4)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){"use strict";var n=r(2),i=r(48)(5),o=!0;"find"in[]&&Array(1).find(function(){o=!1}),n(n.P+n.F*o,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(67)("find")},function(e,t,r){"use strict";var n=r(133)(!0);r(68)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t,r){var n=r(24),i=r(82),o=r(34),a=r(25),s=r(118);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,d=4==e,f=6==e,p=5==e||f,l=t||s;return function(t,s,h){for(var v,m,y=o(t),g=i(y),b=n(s,h,3),k=a(g.length),w=0,T=r?l(t,k):c?l(t,0):void 0;k>w;w++)if((p||w in g)&&(m=b(v=g[w],w,y),e))if(r)T[w]=m;else if(m)switch(e){case 3:return!0;case 5:return v;case 6:return w;case 2:T.push(v)}else if(d)return!1;return f?-1:u||d?d:T}}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(85),i=r(70);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(23);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){"use strict";var n=r(24),i=r(2),o=r(34),a=r(88),s=r(73),c=r(25),u=r(129),d=r(74);i(i.S+i.F*!r(61)(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,f,p=o(e),l="function"==typeof this?this:Array,h=arguments.length,v=h>1?arguments[1]:void 0,m=void 0!==v,y=0,g=d(p);if(m&&(v=n(v,h>2?arguments[2]:void 0,2)),void 0==g||l==Array&&s(g))for(r=new l(t=c(p.length));t>y;y++)u(r,y,m?v(p[y],y):p[y]);else for(f=g.call(p),r=new l;!(i=f.next()).done;y++)u(r,y,m?a(f,v,[i.value,y],!0):i.value);return r.length=y,r}})},function(e,t,r){"use strict";r(149);var n=r(18),i=r(111),o=r(13),a=/./.toString,s=function(e){r(23)(RegExp.prototype,"toString",e,!0)};r(19)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?s(function(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)}):"toString"!=a.name&&s(function(){return a.call(this)})},function(e,t,r){var n=Date.prototype,i=n.toString,o=n.getTime;new Date(NaN)+""!="Invalid Date"&&r(23)(n,"toString",function(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"})},function(e,t,r){var n=r(12).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(13)&&n(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,r){var n=r(8);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){"use strict";var n=r(19);e.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,r){var n=r(43),i=r(25),o=r(60);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),d=o(a,u);if(e&&r!=r){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}}},function(e,t,r){var n=r(41),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){var n=r(4)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(e){}return r}},function(e,t,r){var n=r(85),i=r(70).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){"use strict";var n=r(98),i=r(79);e.exports=r(99)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){r(146)("Uint8",1,function(e){return function(t,r,n){return e(this,t,r,n)}})},function(e,t,r){var n=r(8),i=r(3).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){var n=r(32),i=r(3),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(35)?"pure":"global",copyright:" 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(4)("unscopables"),i=Array.prototype;void 0==i[n]&&r(21)(i,n,{}),e.exports=function(e){i[n][e]=!0}},function(e,t,r){"use strict";var n=r(35),i=r(2),o=r(23),a=r(21),s=r(42),c=r(120),u=r(45),d=r(87),f=r(4)("iterator"),p=!([].keys&&"next"in[].keys()),l=function(){return this};e.exports=function(e,t,r,h,v,m,y){c(r,t,h);var g,b,k,w=function(e){if(!p&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},T=t+" Iterator",S="values"==v,_=!1,C=e.prototype,x=C[f]||C["@@iterator"]||v&&C[v],R=x||w(v),P=v?S?w("entries"):R:void 0,E="Array"==t&&C.entries||x;if(E&&(k=d(E.call(new e)))!==Object.prototype&&k.next&&(u(k,T,!0),n||"function"==typeof k[f]||a(k,f,l)),S&&x&&"values"!==x.name&&(_=!0,R=function(){return x.call(this)}),n&&!y||!p&&!_&&C[f]||a(C,f,R),s[t]=R,s[T]=l,v)if(g={values:S?R:w("values"),keys:m?R:w("keys"),entries:P},y)for(b in g)b in C||o(C,b,g[b]);else i(i.P+i.F*(p||_),t,g);return g}},function(e,t,r){var n=r(66)("keys"),i=r(33);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(40),i=r(4)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,r){var n=r(24),i=r(88),o=r(73),a=r(18),s=r(25),c=r(74),u={},d={};(t=e.exports=function(e,t,r,f,p){var l,h,v,m,y=p?function(){return e}:c(e),g=n(r,f,t?2:1),b=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(o(y)){for(l=s(e.length);l>b;b++)if((m=t?g(a(h=e[b])[0],h[1]):g(e[b]))===u||m===d)return m}else for(v=y.call(e);!(h=v.next()).done;)if((m=i(v,g,h.value,t))===u||m===d)return m}).BREAK=u,t.RETURN=d},function(e,t,r){var n=r(42),i=r(4)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(71),i=r(4)("iterator"),o=r(42);e.exports=r(32).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){"use strict";var n=r(3),i=r(12),o=r(13),a=r(4)("species");e.exports=function(e){var t=n[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(77),i=r(38),o=r(43),a=r(57),s=r(28),c=r(81),u=Object.getOwnPropertyDescriptor;t.f=r(13)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(33)("meta"),i=r(8),o=r(28),a=r(12).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(19)(function(){return c(Object.preventExtensions({}))}),d=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},f=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return u&&f.NEED&&c(e)&&!o(e,n)&&d(e),e}}},function(e,t,r){var n=r(8);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports=!r(13)&&!r(19)(function(){return 7!=Object.defineProperty(r(65)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(40);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(40);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(28),i=r(43),o=r(59)(!1),a=r(69)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(3).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(28),i=r(34),o=r(69)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){var n=r(18);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(18),i=r(39),o=r(4)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||void 0==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n,i,o,a=r(24),s=r(91),c=r(86),u=r(65),d=r(3),f=d.process,p=d.setImmediate,l=d.clearImmediate,h=d.MessageChannel,v=d.Dispatch,m=0,y={},g=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},b=function(e){g.call(e.data)};p&&l||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return y[++m]=function(){s("function"==typeof e?e:Function(e),t)},n(m),m},l=function(e){delete y[e]},"process"==r(40)(f)?n=function(e){f.nextTick(a(g,e,1))}:v&&v.now?n=function(e){v.now(a(g,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=b,n=a(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+"","*")},d.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(a(g,e,1),0)}),e.exports={set:p,clear:l}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){"use strict";var n=r(39);e.exports.f=function(e){return new function(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)}(e)}},function(e,t,r){var n=r(8),i=r(18),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(24)(Function.call,r(76).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return o(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:o}},function(e,t,r){var n=r(3),i=r(32),o=r(35),a=r(95),s=r(12).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,r){t.f=r(4)},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){"use strict";var n=r(98),i=r(79);e.exports=r(99)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},function(e,t,r){"use strict";var n=r(12).f,i=r(44),o=r(52),a=r(24),s=r(51),c=r(72),u=r(68),d=r(84),f=r(75),p=r(13),l=r(78).fastKey,h=r(79),v=p?"_s":"size",m=function(e,t){var r,n=l(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,u){var d=e(function(e,n){s(e,d,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,void 0!=n&&c(n,r,e[u],e)});return o(d.prototype,{clear:function(){for(var e=h(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var r=h(this,t),n=m(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[v]--}return!!n},forEach:function(e){h(this,t);for(var r,n=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!m(h(this,t),e)}}),p&&n(d.prototype,"size",{get:function(){return h(this,t)[v]}}),d},def:function(e,t,r){var n,i,o=m(e,t);return o?o.v=r:(e._l=o={i:i=l(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:m,setStrong:function(e,t,r){u(e,t,function(e,r){this._t=h(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))},r?"entries":"values",!r,!0),f(t)}}},function(e,t,r){"use strict";var n=r(3),i=r(2),o=r(23),a=r(52),s=r(78),c=r(72),u=r(51),d=r(8),f=r(19),p=r(61),l=r(45),h=r(130);e.exports=function(e,t,r,v,m,y){var g=n[e],b=g,k=m?"set":"add",w=b&&b.prototype,T={},S=function(e){var t=w[e];o(w,e,"delete"==e?function(e){return!(y&&!d(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(y&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return y&&!d(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof b&&(y||w.forEach&&!f(function(){(new b).entries().next()}))){var _=new b,C=_[k](y?{}:-0,1)!=_,x=f(function(){_.has(1)}),R=p(function(e){new b(e)}),P=!y&&f(function(){for(var e=new b,t=5;t--;)e[k](t,t);return!e.has(-0)});R||((b=t(function(t,r){u(t,b,e);var n=h(new g,t,b);return void 0!=r&&c(r,m,n[k],n),n})).prototype=w,w.constructor=b),(x||P)&&(S("delete"),S("has"),m&&S("get")),(P||C)&&S(k),y&&w.clear&&delete w.clear}else b=v.getConstructor(t,e,m,k),a(b.prototype,r),s.NEED=!0;return l(b,e),T[e]=b,i(i.G+i.W+i.F*(b!=g),T),y||v.setStrong(b,e,m),b}},function(e,t,r){"use strict";var n=r(39),i=r(8),o=r(91),a=[].slice,s={};e.exports=Function.bind||function(e){var t=n(this),r=a.call(arguments,1),c=function(){var n=r.concat(a.call(arguments));return this instanceof c?function(e,t,r){if(!(t in s)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";s[t]=Function("F,a","return new F("+n.join(",")+")")}return s[t](e,r)}(t,n.length,n):o(t,n,e)};return i(t.prototype)&&(c.prototype=t.prototype),c}},function(e,t,r){r(102)("match",1,function(e,t,r){return[function(r){"use strict";var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))},r]})},function(e,t,r){"use strict";var n=r(21),i=r(23),o=r(19),a=r(49),s=r(4);e.exports=function(e,t,r){var c=s(e),u=r(a,c,""[e]),d=u[0],f=u[1];o(function(){var t={};return t[c]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,d),n(RegExp.prototype,c,2==t?function(e,t){return f.call(e,this,t)}:function(e){return f.call(e,this)}))}},function(e,t,r){"use strict";var n=r(2),i=r(59)(!0);n(n.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(67)("includes")},function(e,t,r){"use strict";var n=r(2),i=r(131);n(n.P+n.F*r(132)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(8),i=r(40),o=r(4)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=n.parseRtpMap(a),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?n.parseFmtp(c[0]):{},s.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,o=void 0!==t?t:2;return i=e||n.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){for(var n,i=r(3),o=r(21),a=r(33),s=a("typed_array"),c=a("view"),u=!(!i.ArrayBuffer||!i.DataView),d=u,f=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(n=i[p[f++]])?(o(n.prototype,s,!0),o(n.prototype,c,!0)):d=!1;e.exports={ABV:u,CONSTR:d,TYPED:s,VIEW:c}},function(e,t,r){var n=r(41),i=r(25);e.exports=function(e){if(void 0===e)return 0;var t=n(e),r=i(t);if(t!==r)throw RangeError("Wrong length!");return r}},function(e,t,r){"use strict";var n=r(34),i=r(60),o=r(25);e.exports=function(e){for(var t=n(this),r=o(t.length),a=arguments.length,s=i(a>1?arguments[1]:void 0,r),c=a>2?arguments[2]:void 0,u=void 0===c?r:i(c,r);u>s;)t[s++]=e;return t}},function(e,t,r){"use strict";var n=r(18);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){r(102)("split",2,function(e,t,n){"use strict";var i=r(105),o=n,a=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var s=void 0===/()??/.exec("")[1];n=function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!i(e))return o.call(r,e,t);var n,c,u,d,f,p=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,v=void 0===t?4294967295:t>>>0,m=new RegExp(e.source,l+"g");for(s||(n=new RegExp("^"+m.source+"$(?!\\s)",l));(c=m.exec(r))&&!((u=c.index+c[0].length)>h&&(p.push(r.slice(h,c.index)),!s&&c.length>1&&c[0].replace(n,function(){for(f=1;f<arguments.length-2;f++)void 0===arguments[f]&&(c[f]=void 0)}),c.length>1&&c.index<r.length&&a.apply(p,c.slice(1)),d=c[0].length,h=u,p.length>=v));)m.lastIndex===c.index&&m.lastIndex++;return h===r.length?!d&&m.test("")||p.push(""):p.push(r.slice(h)),p.length>v?p.slice(0,v):p}}else"0".split(void 0,0).length&&(n=function(e,t){return void 0===e&&0===t?[]:o.call(this,e,t)});return[function(r,i){var o=e(this),a=void 0==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},n]})},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],d=!1,f=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):f=-1,u.length&&l())}function l(){if(!d){var e=s(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||d||s(l)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){var n=r(2);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,r){(function(t){function r(e){var t=o([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]]).filter(function(t){return t.rule&&t.rule.test(e)})[0];return t?t.name:null}function n(){return void 0!==t&&t.version&&{name:"node",version:t.version.slice(1),os:t.platform}}function i(e){var t=o([["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/]]);if(!e)return null;var n=t.map(function(t){var r=t.rule.exec(e),n=r&&r[1].split(/[._]/).slice(0,3);return n&&n.length<3&&(n=n.concat(1==n.length?[0,0]:[0])),r&&{name:t.name,version:n.join(".")}}).filter(Boolean)[0]||null;return n&&(n.os=r(e)),/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/i.test(e)&&((n=n||{}).bot=!0),n}function o(e){return e.map(function(e){return{name:e[0],rule:e[1]}})}e.exports={detect:function(){return"undefined"!=typeof navigator?i(navigator.userAgent):n()},detectOS:r,getNodeVersion:n,parseUserAgent:i}}).call(this,r(113))},function(e,t,r){"use strict";window.getStats=function(e,t,r){var n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var i={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:((navigator.connection||{}).type||"unknown").toString().toLowerCase(),systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){s=!0}},o={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(i.isOfferer=e.googInitiator)}},a=this;if(arguments[0]instanceof n){if(a=arguments[0],navigator.mozGetUserMedia&&(e=arguments[1],t=arguments[2],r=arguments[3]),!(e instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack."}else if(!(e instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";var s=!1;o.datachannel=function(e){"datachannel"===e.type&&(i.datachannel={state:e.state})},o.googCertificate=function(e){"googCertificate"==e.type&&(i.encryption=e.googFingerprintAlgorithm)};var c=["opus","isac","ilbc"];o.checkAudioTracks=function(e){if(e.googCodecName&&"audio"===e.mediaType&&-1!==c.indexOf(e.googCodecName.toLowerCase())){var t=e.id.split("_").pop();if(-1===i.audio[t].codecs.indexOf(e.googCodecName)&&i.audio[t].codecs.push(e.googCodecName),e.bytesSent){var r=0;if(e.bytesSent){i.internal.audio[t].prevBytesSent||(i.internal.audio[t].prevBytesSent=e.bytesSent);var n=e.bytesSent-i.internal.audio[t].prevBytesSent;i.internal.audio[t].prevBytesSent=e.bytesSent,r=n/1024}i.audio[t].availableBandwidth=r.toFixed(1)}if(e.bytesReceived){r=0;if(e.bytesReceived){i.internal.audio[t].prevBytesReceived||(i.internal.audio[t].prevBytesReceived=e.bytesReceived);n=e.bytesReceived-i.internal.audio[t].prevBytesReceived;i.internal.audio[t].prevBytesReceived=e.bytesReceived,r=n/1024}i.audio[t].availableBandwidth=r.toFixed(1)}-1===i.audio[t].tracks.indexOf(e.googTrackId)&&i.audio[t].tracks.push(e.googTrackId)}};var u=["vp9","vp8","h264"];o.checkVideoTracks=function(e){if(e.googCodecName&&"video"===e.mediaType&&-1!==u.indexOf(e.googCodecName.toLowerCase())){var t=e.id.split("_").pop();if(-1===i.video[t].codecs.indexOf(e.googCodecName)&&i.video[t].codecs.push(e.googCodecName),e.bytesSent){var r=0;i.internal.video[t].prevBytesSent||(i.internal.video[t].prevBytesSent=e.bytesSent);var n=e.bytesSent-i.internal.video[t].prevBytesSent;i.internal.video[t].prevBytesSent=e.bytesSent,r=n/1024}if(e.bytesReceived){r=0;i.internal.video[t].prevBytesReceived||(i.internal.video[t].prevBytesReceived=e.bytesReceived);n=e.bytesReceived-i.internal.video[t].prevBytesReceived;i.internal.video[t].prevBytesReceived=e.bytesReceived,r=n/1024}i.video[t].availableBandwidth=r.toFixed(1),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(i.resolutions[t].width=e.googFrameWidthReceived,i.resolutions[t].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(i.resolutions[t].width=e.googFrameWidthSent,i.resolutions[t].height=e.googFrameHeightSent),-1===i.video[t].tracks.indexOf(e.googTrackId)&&i.video[t].tracks.push(e.googTrackId)}},o.bweforvideo=function(e){"VideoBwe"===e.type&&(i.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,i.bandwidth.googActualEncBitrate=e.googActualEncBitrate,i.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,i.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,i.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,i.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,i.bandwidth.googBucketDelay=e.googBucketDelay,i.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},o.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type){if("true"==e.googActiveConnection)Object.keys(i.internal.candidates).forEach(function(t){var r=i.internal.candidates[t];-1!==r.ipAddress.indexOf(e.googLocalAddress)&&(i.connectionType.local.candidateType=r.candidateType,i.connectionType.local.ipAddress=r.ipAddress,i.connectionType.local.networkType=r.networkType,i.connectionType.local.transport=r.transport),-1!==r.ipAddress.indexOf(e.googRemoteAddress)&&(i.connectionType.remote.candidateType=r.candidateType,i.connectionType.remote.ipAddress=r.ipAddress,i.connectionType.remote.networkType=r.networkType,i.connectionType.remote.transport=r.transport)}),i.connectionType.transport=e.googTransportType,(t=i.internal.candidates[e.localCandidateId])&&t.ipAddress&&(i.connectionType.systemIpAddress=t.ipAddress),(r=i.internal.candidates[e.remoteCandidateId])&&r.ipAddress&&(i.connectionType.systemIpAddress=r.ipAddress);if("candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=i.internal.candidates[e.remoteCandidateId],r=i.internal.candidates[e.remoteCandidateId]}};var d={},f={},p={},l={};o.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(d[e.id]||(d[e.id]=[]),f[e.id]||(f[e.id]=[]),p[e.id]||(p[e.id]=[]),l[e.id]||(l[e.id]=[]),e.candidateType&&-1===d[e.id].indexOf(e.candidateType)&&d[e.id].push(e.candidateType),e.transport&&-1===f[e.id].indexOf(e.transport)&&f[e.id].push(e.transport),e.ipAddress&&-1===p[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&p[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===l[e.id].indexOf(e.networkType)&&l[e.id].push(e.networkType),i.internal.candidates[e.id]={candidateType:d[e.id],ipAddress:p[e.id],portNumber:e.portNumber,networkType:l[e.id],priority:e.priority,transport:f[e.id],timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.local.candidateType=d[e.id],i.connectionType.local.ipAddress=p[e.id],i.connectionType.local.networkType=l[e.id],i.connectionType.local.transport=f[e.id])};var h={},v={},m={},y={};o.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(h[e.id]||(h[e.id]=[]),v[e.id]||(v[e.id]=[]),m[e.id]||(m[e.id]=[]),y[e.id]||(y[e.id]=[]),e.candidateType&&-1===h[e.id].indexOf(e.candidateType)&&h[e.id].push(e.candidateType),e.transport&&-1===v[e.id].indexOf(e.transport)&&v[e.id].push(e.transport),e.ipAddress&&-1===m[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&m[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===y[e.id].indexOf(e.networkType)&&y[e.id].push(e.networkType),i.internal.candidates[e.id]={candidateType:h[e.id],ipAddress:m[e.id],portNumber:e.portNumber,networkType:y[e.id],priority:e.priority,transport:v[e.id],timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.remote.candidateType=h[e.id],i.connectionType.remote.ipAddress=m[e.id],i.connectionType.remote.networkType=y[e.id],i.connectionType.remote.transport=v[e.id])},o.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(i[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(i[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))};var g={audio:{send:[],recv:[]},video:{send:[],recv:[]}};o.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===g[e.mediaType][t].indexOf(e.ssrc)&&g[e.mediaType][t].push(e.ssrc),i[e.mediaType][t].streams=g[e.mediaType][t].length}},function n(){!function(t){void 0!==window.InstallTrigger?a.getStats(e,function(e){var r=[];e.forEach(function(e){r.push(e)}),t(r)},t):a.getStats(function(e){var r=[];e.result().forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),t(r)})}(function(e){e.forEach(function(e){Object.keys(o).forEach(function(t){"function"==typeof o[t]&&o[t](e)}),"local-candidate"!==e.type&&"remote-candidate"!==e.type&&e.type});try{-1!==a.iceConnectionState.search(/failed/gi)&&(s=!0)}catch(e){s=!0}!0===s&&(i.datachannel&&(i.datachannel.state="close"),i.ended=!0),i.results=e,i.audio&&i.video&&(i.bandwidth.speed=i.audio.bytesSent-i.bandwidth.helper.audioBytesSent+(i.video.bytesSent-i.bandwidth.helper.videoBytesSent),i.bandwidth.helper.audioBytesSent=i.audio.bytesSent,i.bandwidth.helper.videoBytesSent=i.video.bytesSent),t(i),s||void 0!=typeof r&&r&&setTimeout(n,r||1e3)})}()}},function(e,t,r){var n=r(119);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(8),i=r(83),o=r(4)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){"use strict";var n=r(44),i=r(38),o=r(45),a={};r(21)(a,r(4)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(12),i=r(18),o=r(50);e.exports=r(13)?Object.defineProperties:function(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n=r(2),i=r(32),o=r(19);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",a)}},function(e,t,r){var n=r(3),i=r(90).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==r(40)(a);e.exports=function(){var e,t,r,u=function(){var n,i;for(c&&(n=a.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);r=function(){d.then(u)}}else r=function(){i.call(n,u)};else{var f=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),r=function(){p.data=f=!f}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(3).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(18),i=r(8),o=r(92);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(50),i=r(96),o=r(77);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(43),i=r(62).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){"use strict";var n=r(12),i=r(38);e.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},function(e,t,r){var n=r(8),i=r(93).set;e.exports=function(e,t,r){var o,a=t.constructor;return a!==r&&"function"==typeof a&&(o=a.prototype)!==r.prototype&&n(o)&&i&&i(e,o),e}},function(e,t,r){var n=r(105),i=r(49);e.exports=function(e,t,r){if(n(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},function(e,t,r){var n=r(4)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,r){var n=r(41),i=r(49);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,r){"use strict";(function(t){var n=r(135);e.exports=n({window:t.window})}).call(this,r(80))},function(e,t,r){"use strict";var n=r(26);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=n.log,c=n.detectBrowser(i),u=r(136)||null,d=r(138)||null,f=r(142)||null,p=r(144)||null,l=r(145)||null,h={browserDetails:c,commonShim:l,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),h;s("adapter.js shimming chrome."),h.browserShim=u,l.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimMediaStream(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimAddTrackRemoveTrack(i),u.shimGetSendersWithDtmf(i),u.shimSenderReceiverGetStats(i),u.fixNegotiationNeeded(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"firefox":if(!f||!f.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),h;s("adapter.js shimming firefox."),h.browserShim=f,l.shimCreateObjectURL(i),f.shimGetUserMedia(i),f.shimSourceObject(i),f.shimPeerConnection(i),f.shimOnTrack(i),f.shimRemoveStream(i),f.shimSenderGetStats(i),f.shimReceiverGetStats(i),f.shimRTCDataChannel(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),h;s("adapter.js shimming edge."),h.browserShim=d,l.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i),d.shimGetDisplayMedia(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"safari":if(!p||!o.shimSafari)return s("Safari shim is not included in this adapter release."),h;s("adapter.js shimming safari."),h.browserShim=p,l.shimCreateObjectURL(i),p.shimRTCIceServerUrls(i),p.shimCreateOfferLegacy(i),p.shimCallbacksAPI(i),p.shimLocalStreamsAPI(i),p.shimRemoteStreamsAPI(i),p.shimTrackEventTransceiver(i),p.shimGetUserMedia(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return h}},function(e,t,r){"use strict";var n=r(26),i=n.log;function o(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(i){i.endsWith("Id")?e(t,t.get(r[i]),n):i.endsWith("Ids")&&r[i].forEach(function(r){e(t,t.get(r),n)})}))}(e,r,i)})}),i}e.exports={shimGetUserMedia:r(137),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(t?n=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(r?n=!0:r=e),e.track===i}),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n,r._reverseStreams[n.id]=t,t=n}i.apply(r,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var o=n._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);n._streams[r.id]=a,n._reverseStreams[a.id]=r,n.addStream(a)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=c(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return c(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,r){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return r.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){r.apply(i,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||("function"==typeof t?(e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})},e.navigator.getDisplayMedia=function(t){return n.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(e,t,r){"use strict";var n=r(26),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),(o={})[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,u=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==c.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),n(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){a(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(s(e))})})};var c=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return c(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,r){"use strict";var n=r(26),i=r(139),o=r(140);e.exports={shimGetUserMedia:r(141),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,t){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var r=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(t){return r.call(e.navigator,t)},e.navigator.getDisplayMedia=function(t){return n.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),r.call(e.navigator,t)}}}}},function(e,t,r){"use strict";var n=r(26);e.exports=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},function(e,t,r){"use strict";var n=r(106);function i(e,t,r,i,o){var a=n.writeRtpDescription(e.kind,t);if(a+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),a}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function a(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var d=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},d.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},d.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},d.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},d.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},d.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var u=n.writeCandidate(s);a.candidate=Object.assign(a.candidate,n.parseCandidate(u)),a.candidate.candidate=u,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=n.getMediaSections(i._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+d.join("");var f=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),f&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,r,i){var a=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},d.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var s=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,d=a.dtlsTransport,f=a.localCapabilities,p=a.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var l=n.getIceParameters(e,r),h=n.getDtlsParameters(e,r);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,l,s?"controlling":"controlled"),"new"===d.state&&d.start(h));var v=o(f,p);i._transceive(a,v.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var d=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,d.signalingState)||d._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+d.signalingState));var f={};d.remoteStreams.forEach(function(e){f[e.id]=e});var p=[],l=n.splitSections(i.sdp),h=l.shift(),v=n.matchPrefix(h,"a=ice-lite").length>0,m=n.matchPrefix(h,"a=group:BUNDLE ").length>0;d.usingBundle=m;var y=n.matchPrefix(h,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,l.forEach(function(a,c){var u=n.splitLines(a),l=n.getKind(a),y=n.isRejected(a)&&0===n.matchPrefix(a,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],b=n.getDirection(a,h),k=n.parseMsid(a),w=n.getMid(a)||n.generateIdentifier();if(y||"application"===l&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))d.transceivers[c]={mid:w,kind:l,protocol:g,rejected:!0};else{var T,S,_,C,x,R,P,E,O;!y&&d.transceivers[c]&&d.transceivers[c].rejected&&(d.transceivers[c]=d._createTransceiver(l,!0));var I,j,M=n.parseRtpParameters(a);y||(I=n.getIceParameters(a,h),(j=n.getDtlsParameters(a,h)).role="client"),P=n.parseRtpEncodingParameters(a);var A=n.parseRtcpParameters(a),L=n.matchPrefix(a,"a=end-of-candidates",h).length>0,D=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!y&&m&&c>0&&d.transceivers[c]&&(d._disposeIceAndDtlsTransports(c),d.transceivers[c].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[c].iceTransport=d.transceivers[0].iceTransport,d.transceivers[c].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[c].rtpSender&&d.transceivers[c].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[c].rtpReceiver&&d.transceivers[c].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==i.type||y){if("answer"===i.type&&!y){S=(T=d.transceivers[c]).iceGatherer,_=T.iceTransport,C=T.dtlsTransport,x=T.rtpReceiver,R=T.sendEncodingParameters,E=T.localCapabilities,d.transceivers[c].recvEncodingParameters=P,d.transceivers[c].remoteCapabilities=M,d.transceivers[c].rtcpParameters=A,D.length&&"new"===_.state&&(!v&&!L||m&&0!==c?D.forEach(function(e){s(T.iceTransport,e)}):_.setRemoteCandidates(D)),m&&0!==c||("new"===_.state&&_.start(S,I,"controlling"),"new"===C.state&&C.start(j)),!o(T.localCapabilities,T.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,d._transceive(T,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!x||"sendrecv"!==b&&"sendonly"!==b?delete T.rtpReceiver:(O=x.track,k?(f[k.stream]||(f[k.stream]=new e.MediaStream),r(O,f[k.stream]),p.push([O,x,f[k.stream]])):(f.default||(f.default=new e.MediaStream),r(O,f.default),p.push([O,x,f.default])))}}else{(T=d.transceivers[c]||d._createTransceiver(l)).mid=w,T.iceGatherer||(T.iceGatherer=d._createIceGatherer(c,m)),D.length&&"new"===T.iceTransport.state&&(!L||m&&0!==c?D.forEach(function(e){s(T.iceTransport,e)}):T.iceTransport.setRemoteCandidates(D)),E=e.RTCRtpReceiver.getCapabilities(l),t<15019&&(E.codecs=E.codecs.filter(function(e){return"rtx"!==e.name})),R=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,F=!1;if("sendrecv"===b||"sendonly"===b){if(F=!T.rtpReceiver,x=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,l),F)O=x.track,k&&"-"===k.stream||(k?(f[k.stream]||(f[k.stream]=new e.MediaStream,Object.defineProperty(f[k.stream],"id",{get:function(){return k.stream}})),Object.defineProperty(O,"id",{get:function(){return k.track}}),N=f[k.stream]):(f.default||(f.default=new e.MediaStream),N=f.default)),N&&(r(O,N),T.associatedRemoteMediaStreams.push(N)),p.push([O,x,N])}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===T.rtpReceiver.track.id});r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),T.associatedRemoteMediaStreams=[]);T.localCapabilities=E,T.remoteCapabilities=M,T.rtpReceiver=x,T.rtcpParameters=A,T.sendEncodingParameters=R,T.recvEncodingParameters=P,d._transceive(d.transceivers[c],!1,F)}}}),void 0===d._dtlsRole&&(d._dtlsRole="offer"===i.type?"active":"passive"),d._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(f).forEach(function(t){var r=f[t];if(r.getTracks().length){if(-1===d.remoteStreams.indexOf(r)){d.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){d._dispatchEvent("addstream",n)})}p.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&u(d,t,n,[r])})}}),p.forEach(function(e){e[2]||u(d,e[0],e[1],[])}),e.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},d.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=r.transceivers.filter(function(e){return"audio"===e.kind}).length,a=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(r._createTransceiver("audio"),o--),a>0&&(r._createTransceiver("video"),a--);var u=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(u+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(d)},d.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var a=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},d.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<r.transceivers.length;u++)if(r.transceivers[u].mid===e.sdpMid){a=u;break}var d=r.transceivers[a];if(!d)return o(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var f=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return i();if(f.component&&1!==f.component)return i();if((0===a||a>0&&d.iceTransport!==r.transceivers[0].iceTransport)&&!s(d.iceTransport,f))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(f.type?p:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var l=0;l<r.transceivers.length&&(r.transceivers[l].rejected||(r.transceivers[l].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[l]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));l++);i()})},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[r]),t.set(r,e[r])}),t})}}});var f=["createOffer","createAnswer"];return f.forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),d}},function(e,t,r){"use strict";e.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,r){"use strict";var n=r(26);e.exports={shimGetUserMedia:r(143),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],o=0;o<r.iceServers.length;o++){var a=r.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(r.iceServers[o])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return o.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,n)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)},e.navigator.getDisplayMedia=function(t){return n.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)})}}},function(e,t,r){"use strict";var n=r(26),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,n,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){o(a(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){s(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var d=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},o&&o.prototype.getSettings){var p=o.prototype.getSettings;o.prototype.getSettings=function(){var e=p.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var l=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}r.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(i,o)}}},function(e,t,r){"use strict";var n=r(26);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}}},function(e,t,r){"use strict";var n=r(106),i=r(26);e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,function(e){var t=n.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=n.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var e,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),o=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(i),a=function(e,r){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=n.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i}(arguments[0],i);e=0===o&&0===a?Number.POSITIVE_INFINITY:0===o||0===a?Math.max(o,a):Math.min(o,a);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return e}}),this._sctp=s}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}}},function(e,t,r){"use strict";if(r(13)){var n=r(35),i=r(3),o=r(19),a=r(2),s=r(108),c=r(147),u=r(24),d=r(51),f=r(38),p=r(21),l=r(52),h=r(41),v=r(25),m=r(109),y=r(60),g=r(57),b=r(28),k=r(71),w=r(8),T=r(34),S=r(73),_=r(44),C=r(87),x=r(62).f,R=r(74),P=r(33),E=r(4),O=r(48),I=r(59),j=r(89),M=r(10),A=r(42),L=r(61),D=r(75),N=r(110),F=r(148),B=r(12),U=r(76),G=B.f,W=U.f,V=i.RangeError,H=i.TypeError,J=i.Uint8Array,z=Array.prototype,$=c.ArrayBuffer,q=c.DataView,Q=O(0),K=O(2),Y=O(3),X=O(4),Z=O(5),ee=O(6),te=I(!0),re=I(!1),ne=M.values,ie=M.keys,oe=M.entries,ae=z.lastIndexOf,se=z.reduce,ce=z.reduceRight,ue=z.join,de=z.sort,fe=z.slice,pe=z.toString,le=z.toLocaleString,he=E("iterator"),ve=E("toStringTag"),me=P("typed_constructor"),ye=P("def_constructor"),ge=s.CONSTR,be=s.TYPED,ke=s.VIEW,we=O(1,function(e,t){return xe(j(e,e[ye]),t)}),Te=o(function(){return 1===new J(new Uint16Array([1]).buffer)[0]}),Se=!!J&&!!J.prototype.set&&o(function(){new J(1).set({})}),_e=function(e,t){var r=h(e);if(r<0||r%t)throw V("Wrong offset!");return r},Ce=function(e){if(w(e)&&be in e)return e;throw H(e+" is not a typed array!")},xe=function(e,t){if(!(w(e)&&me in e))throw H("It is not a typed array constructor!");return new e(t)},Re=function(e,t){return Pe(j(e,e[ye]),t)},Pe=function(e,t){for(var r=0,n=t.length,i=xe(e,n);n>r;)i[r]=t[r++];return i},Ee=function(e,t,r){G(e,t,{get:function(){return this._d[r]}})},Oe=function(e){var t,r,n,i,o,a,s=T(e),c=arguments.length,d=c>1?arguments[1]:void 0,f=void 0!==d,p=R(s);if(void 0!=p&&!S(p)){for(a=p.call(s),n=[],t=0;!(o=a.next()).done;t++)n.push(o.value);s=n}for(f&&c>2&&(d=u(d,arguments[2],2)),t=0,r=v(s.length),i=xe(this,r);r>t;t++)i[t]=f?d(s[t],t):s[t];return i},Ie=function(){for(var e=0,t=arguments.length,r=xe(this,t);t>e;)r[e]=arguments[e++];return r},je=!!J&&o(function(){le.call(new J(1))}),Me=function(){return le.apply(je?fe.call(Ce(this)):Ce(this),arguments)},Ae={copyWithin:function(e,t){return F.call(Ce(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return X(Ce(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return N.apply(Ce(this),arguments)},filter:function(e){return Re(this,K(Ce(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return Z(Ce(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Ce(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Q(Ce(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return re(Ce(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Ce(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ue.apply(Ce(this),arguments)},lastIndexOf:function(e){return ae.apply(Ce(this),arguments)},map:function(e){return we(Ce(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(Ce(this),arguments)},reduceRight:function(e){return ce.apply(Ce(this),arguments)},reverse:function(){for(var e,t=Ce(this).length,r=Math.floor(t/2),n=0;n<r;)e=this[n],this[n++]=this[--t],this[t]=e;return this},some:function(e){return Y(Ce(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return de.call(Ce(this),e)},subarray:function(e,t){var r=Ce(this),n=r.length,i=y(e,n);return new(j(r,r[ye]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,v((void 0===t?n:y(t,n))-i))}},Le=function(e,t){return Re(this,fe.call(Ce(this),e,t))},De=function(e){Ce(this);var t=_e(arguments[1],1),r=this.length,n=T(e),i=v(n.length),o=0;if(i+t>r)throw V("Wrong length!");for(;o<i;)this[t+o]=n[o++]},Ne={entries:function(){return oe.call(Ce(this))},keys:function(){return ie.call(Ce(this))},values:function(){return ne.call(Ce(this))}},Fe=function(e,t){return w(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return Fe(e,t=g(t,!0))?f(2,e[t]):W(e,t)},Ue=function(e,t,r){return!(Fe(e,t=g(t,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(e,t,r):(e[t]=r.value,e)};ge||(U.f=Be,B.f=Ue),a(a.S+a.F*!ge,"Object",{getOwnPropertyDescriptor:Be,defineProperty:Ue}),o(function(){pe.call({})})&&(pe=le=function(){return ue.call(this)});var Ge=l({},Ae);l(Ge,Ne),p(Ge,he,Ne.values),l(Ge,{slice:Le,set:De,constructor:function(){},toString:pe,toLocaleString:Me}),Ee(Ge,"buffer","b"),Ee(Ge,"byteOffset","o"),Ee(Ge,"byteLength","l"),Ee(Ge,"length","e"),G(Ge,ve,{get:function(){return this[be]}}),e.exports=function(e,t,r,c){var u=e+((c=!!c)?"Clamped":"")+"Array",f="get"+e,l="set"+e,h=i[u],y=h||{},g=h&&C(h),b=!h||!s.ABV,T={},S=h&&h.prototype,R=function(e,r){G(e,r,{get:function(){return function(e,r){var n=e._d;return n.v[f](r*t+n.o,Te)}(this,r)},set:function(e){return function(e,r,n){var i=e._d;c&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),i.v[l](r*t+i.o,n,Te)}(this,r,e)},enumerable:!0})};b?(h=r(function(e,r,n,i){d(e,h,u,"_d");var o,a,s,c,f=0,l=0;if(w(r)){if(!(r instanceof $||"ArrayBuffer"==(c=k(r))||"SharedArrayBuffer"==c))return be in r?Pe(h,r):Oe.call(h,r);o=r,l=_e(n,t);var y=r.byteLength;if(void 0===i){if(y%t)throw V("Wrong length!");if((a=y-l)<0)throw V("Wrong length!")}else if((a=v(i)*t)+l>y)throw V("Wrong length!");s=a/t}else s=m(r),o=new $(a=s*t);for(p(e,"_d",{b:o,o:l,l:a,e:s,v:new q(o)});f<s;)R(e,f++)}),S=h.prototype=_(Ge),p(S,"constructor",h)):o(function(){h(1)})&&o(function(){new h(-1)})&&L(function(e){new h,new h(null),new h(1.5),new h(e)},!0)||(h=r(function(e,r,n,i){var o;return d(e,h,u),w(r)?r instanceof $||"ArrayBuffer"==(o=k(r))||"SharedArrayBuffer"==o?void 0!==i?new y(r,_e(n,t),i):void 0!==n?new y(r,_e(n,t)):new y(r):be in r?Pe(h,r):Oe.call(h,r):new y(m(r))}),Q(g!==Function.prototype?x(y).concat(x(g)):x(y),function(e){e in h||p(h,e,y[e])}),h.prototype=S,n||(S.constructor=h));var P=S[he],E=!!P&&("values"==P.name||void 0==P.name),O=Ne.values;p(h,me,!0),p(S,be,u),p(S,ke,!0),p(S,ye,h),(c?new h(1)[ve]==u:ve in S)||G(S,ve,{get:function(){return u}}),T[u]=h,a(a.G+a.W+a.F*(h!=y),T),a(a.S,u,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*o(function(){y.of.call(h,1)}),u,{from:Oe,of:Ie}),"BYTES_PER_ELEMENT"in S||p(S,"BYTES_PER_ELEMENT",t),a(a.P,u,Ae),D(u),a(a.P+a.F*Se,u,{set:De}),a(a.P+a.F*!E,u,Ne),n||S.toString==pe||(S.toString=pe),a(a.P+a.F*o(function(){new h(1).slice()}),u,{slice:Le}),a(a.P+a.F*(o(function(){return[1,2].toLocaleString()!=new h([1,2]).toLocaleString()})||!o(function(){S.toLocaleString.call([1,2])})),u,{toLocaleString:Me}),A[u]=E?P:O,n||E||p(S,he,O)}}else e.exports=function(){}},function(e,t,r){"use strict";var n=r(3),i=r(13),o=r(35),a=r(108),s=r(21),c=r(52),u=r(19),d=r(51),f=r(41),p=r(25),l=r(109),h=r(62).f,v=r(12).f,m=r(110),y=r(45),g="prototype",b="Wrong index!",k=n.ArrayBuffer,w=n.DataView,T=n.Math,S=n.RangeError,_=n.Infinity,C=k,x=T.abs,R=T.pow,P=T.floor,E=T.log,O=T.LN2,I=i?"_b":"buffer",j=i?"_l":"byteLength",M=i?"_o":"byteOffset";function A(e,t,r){var n,i,o,a=new Array(r),s=8*r-t-1,c=(1<<s)-1,u=c>>1,d=23===t?R(2,-24)-R(2,-77):0,f=0,p=e<0||0===e&&1/e<0?1:0;for((e=x(e))!=e||e===_?(i=e!=e?1:0,n=c):(n=P(E(e)/O),e*(o=R(2,-n))<1&&(n--,o*=2),(e+=n+u>=1?d/o:d*R(2,1-u))*o>=2&&(n++,o/=2),n+u>=c?(i=0,n=c):n+u>=1?(i=(e*o-1)*R(2,t),n+=u):(i=e*R(2,u-1)*R(2,t),n=0));t>=8;a[f++]=255&i,i/=256,t-=8);for(n=n<<t|i,s+=t;s>0;a[f++]=255&n,n/=256,s-=8);return a[--f]|=128*p,a}function L(e,t,r){var n,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,c=r-1,u=e[c--],d=127&u;for(u>>=7;s>0;d=256*d+e[c],c--,s-=8);for(n=d&(1<<-s)-1,d>>=-s,s+=t;s>0;n=256*n+e[c],c--,s-=8);if(0===d)d=1-a;else{if(d===o)return n?NaN:u?-_:_;n+=R(2,t),d-=a}return(u?-1:1)*n*R(2,d-t)}function D(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function N(e){return[255&e]}function F(e){return[255&e,e>>8&255]}function B(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function U(e){return A(e,52,8)}function G(e){return A(e,23,4)}function W(e,t,r){v(e[g],t,{get:function(){return this[r]}})}function V(e,t,r,n){var i=l(+r);if(i+t>e[j])throw S(b);var o=e[I]._b,a=i+e[M],s=o.slice(a,a+t);return n?s:s.reverse()}function H(e,t,r,n,i,o){var a=l(+r);if(a+t>e[j])throw S(b);for(var s=e[I]._b,c=a+e[M],u=n(+i),d=0;d<t;d++)s[c+d]=u[o?d:t-d-1]}if(a.ABV){if(!u(function(){k(1)})||!u(function(){new k(-1)})||u(function(){return new k,new k(1.5),new k(NaN),"ArrayBuffer"!=k.name})){for(var J,z=(k=function(e){return d(this,k),new C(l(e))})[g]=C[g],$=h(C),q=0;$.length>q;)(J=$[q++])in k||s(k,J,C[J]);o||(z.constructor=k)}var Q=new w(new k(2)),K=w[g].setInt8;Q.setInt8(0,2147483648),Q.setInt8(1,2147483649),!Q.getInt8(0)&&Q.getInt8(1)||c(w[g],{setInt8:function(e,t){K.call(this,e,t<<24>>24)},setUint8:function(e,t){K.call(this,e,t<<24>>24)}},!0)}else k=function(e){d(this,k,"ArrayBuffer");var t=l(e);this._b=m.call(new Array(t),0),this[j]=t},w=function(e,t,r){d(this,w,"DataView"),d(e,k,"DataView");var n=e[j],i=f(t);if(i<0||i>n)throw S("Wrong offset!");if(i+(r=void 0===r?n-i:p(r))>n)throw S("Wrong length!");this[I]=e,this[M]=i,this[j]=r},i&&(W(k,"byteLength","_l"),W(w,"buffer","_b"),W(w,"byteLength","_l"),W(w,"byteOffset","_o")),c(w[g],{getInt8:function(e){return V(this,1,e)[0]<<24>>24},getUint8:function(e){return V(this,1,e)[0]},getInt16:function(e){var t=V(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=V(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return D(V(this,4,e,arguments[1]))},getUint32:function(e){return D(V(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return L(V(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return L(V(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){H(this,1,e,N,t)},setUint8:function(e,t){H(this,1,e,N,t)},setInt16:function(e,t){H(this,2,e,F,t,arguments[2])},setUint16:function(e,t){H(this,2,e,F,t,arguments[2])},setInt32:function(e,t){H(this,4,e,B,t,arguments[2])},setUint32:function(e,t){H(this,4,e,B,t,arguments[2])},setFloat32:function(e,t){H(this,4,e,G,t,arguments[2])},setFloat64:function(e,t){H(this,8,e,U,t,arguments[2])}});y(k,"ArrayBuffer"),y(w,"DataView"),s(w[g],a.VIEW,!0),t.ArrayBuffer=k,t.DataView=w},function(e,t,r){"use strict";var n=r(34),i=r(60),o=r(25);e.exports=[].copyWithin||function(e,t){var r=n(this),a=o(r.length),s=i(e,a),c=i(t,a),u=arguments.length>2?arguments[2]:void 0,d=Math.min((void 0===u?a:i(u,a))-c,a-s),f=1;for(c<s&&s<c+d&&(f=-1,c+=d-1,s+=d-1);d-- >0;)c in r?r[s]=r[c]:delete r[s],s+=f,c+=f;return r}},function(e,t,r){r(13)&&"g"!=/./g.flags&&r(12).f(RegExp.prototype,"flags",{configurable:!0,get:r(111)})},function(e,t,r){var n=r(2),i=r(44),o=r(39),a=r(18),s=r(8),c=r(19),u=r(100),d=(r(3).Reflect||{}).construct,f=c(function(){function e(){}return!(d(function(){},[],e)instanceof e)}),p=!c(function(){d(function(){})});n(n.S+n.F*(f||p),"Reflect",{construct:function(e,t){o(e),a(t);var r=arguments.length<3?e:o(arguments[2]);if(p&&!f)return d(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(u.apply(e,n))}var c=r.prototype,l=i(s(c)?c:Object.prototype),h=Function.apply.call(e,l,t);return s(h)?h:l}})},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=n(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=r(115),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return i(c,n,a)}}),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},function(e,t,r){var n=r(115),i=/%[sdv%]/g,o=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?n.push(r[t.name][a]):n.push(r[t.names[o]])}else n.push(r[t.name]);return function(e){var t=1,r=arguments,n=r.length;return e.replace(i,function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||a,i=t.innerOrder||s,c=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(o(t,r,e))})})}),e.media.forEach(function(e){c.push(o("m",n.m[0],e)),i.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(o(t,r,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,t,r){"use strict";r.r(t);r(117),r(17),r(10),r(29),r(0),r(5),r(14),r(15),r(46),r(30),r(6),r(7),r(11),r(22),r(9),r(53),r(97),r(36),r(101),r(103),r(104),r(37),r(47),r(63),r(134);var n=r(20),i=r.n(n),o=r(31),a=r.n(o),s=r(1),c=r.n(s);r(64),r(54),r(55),r(112),r(150);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function h(e){var t="function"==typeof Map?new Map:void 0;return(h=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return v(e,arguments,y(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),m(r,e)})(e)}function v(e,t,r){return(v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&m(i,r.prototype),i}).apply(null,arguments)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){function t(e,r){var n;return d(this,t),(n=f(this,y(t).call(this,r))).code=e,n.error=r,n}return l(t,h(Error)),t}(),b=function(e){return new g(11e3,"piliRTC: unexpected error ".concat(e))},k=function(e){return new g(11001,"enterRoom error, can not get accessToken. Error: ".concat(e,"\n please check enterRoom arguments"))},w=function(e,t){return new g(e,"publish error, signaling code: ".concat(e,", msg: ").concat(t))},T=function(e,t){return new g(e,"create merge job error, signaling code: ".concat(e,", msg: ").concat(t))},S=function(e){return new g(11007,"media format not support, ".concat(e))},_=function(e,t){return new g(e,"subscribe error, signaling code: ".concat(e,", msg: ").concat(t))},C=function(e,t){return new g(e,"send control error, code: ".concat(e,", msg: ").concat(t))},x=function(e){return new g(11008,"not support! ".concat(e))},R=function(){return new g(10052,"server unavailable")},P=function(e){return new g(11009,"plugin not avaliable! ".concat(e))},E=function(e){return new g(11010,"NotAllowedError: no permission to access media device. ".concat(e))},O=function(e){return new g(11012,"can not set merge layout stream, no merge job id ".concat(e))},I=function(){return new g(11013,"can not sharing screen/window on chrome")},j=function(){return new g(11014,"subscribe/publish operation is aborted")},M=function(){return new g(30001,"websocket abort")},A=function(e){function t(e){var r;return d(this,t),(r=f(this,y(t).call(this,e))).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(p(p(r)),t):r.stack=new Error(e).stack,r}return l(t,h(Error)),t}();function L(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function D(e){return N.apply(this,arguments)}function N(){return(N=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){L(o,n,i,a,s,"next",e)}function s(e){L(o,n,i,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(!((r=e.sent).status>=400&&r.status<500)){e.next=5;break}throw{retry:!1,message:r.status.toString()};case 5:if(200===r.status){e.next=7;break}throw{retry:!0,message:r.status.toString()};case 7:return e.next=9,r.json();case 9:return n=e.sent,e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}r(56);var F=r(116),B=r(16),U=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,G=!!window.chrome,W=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),V=Object(F.detect)()||{};function H(){try{return!!RTCPeerConnection&&(!!WebSocket&&!!navigator.mediaDevices.getUserMedia)}catch(e){return!1}}var J=function(){if(!V)return{support:H(),supportRestartICE:!0};switch(V.name){case"chrome":return{support:B.gte(V.version,"55.0.0"),mediaStreamDest:B.gte(V.version,"55.0.0"),replaceTrack:B.gte(V.version,"65.0.0"),screenSharing:B.gte(V.version,"55.0.0"),connectionState:!1,stats:B.gte(V.version,"67.0.0"),ondevicechange:B.gte(V.version,"57.0.0"),minMaxWithIdeal:B.gte(V.version,"56.0.0"),unifiedPlan:!1,supportRestartICE:!0};case"safari":return{support:B.gte(V.version,"11.0.0"),replaceTrack:B.gte(V.version,"11.0.0"),stats:!1,ondevicechange:!1,connectionState:!0,mediaStreamDest:!1,screenSharing:!1,minMaxWithIdeal:!1,supportRestartICE:!0};case"firefox":return{support:H()&&B.gte(V.version,"59.0.0"),replaceTrack:!0,stats:!0,ondevicechange:B.gte(V.version,"52.0.0"),connectionState:!0,mediaStreamDest:!0,screenSharing:!0,minMaxWithIdeal:!0,unifiedPlan:B.gte(V.version,"59.0.0"),supportRestartICE:!1};default:return{support:H(),supportRestartICE:!0}}}();r(114);function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t}return function(e,t,r){t&&z(e.prototype,t),r&&z(e,r)}(e,[{key:"setLevel",value:function(e){this.level=e}},{key:"log",value:function(){var e;if("log"===this.level){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).info.apply(e,["%cLOG-QNRTC","color: #66ccff; font-weight: bold;"].concat(r))}}},{key:"debug",value:function(){var e;if("log"===this.level||"debug"===this.level){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).info.apply(e,["%cDEBUG-QNRTC","color: #A28148; font-weight: bold;"].concat(r))}}},{key:"warning",value:function(){var e;if("disable"!==this.level){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).warn.apply(e,["%cWARNING-QNRTC","color: #E44F44; font-weight: bold;"].concat(r))}}}]),e}())("log");function q(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}Date.now();var Q={packetLossRate:0,bitrate:0,bytes:0,packets:0,packetLoss:0,timestamp:Date.now()};function K(e,t,r){return Y.apply(this,arguments)}function Y(){return(Y=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){q(o,n,i,a,s,"next",e)}function s(e){q(o,n,i,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t,r,n){var i,o,a,s,c,u,d,f,p,l,h,v,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=Q).timestamp=Date.now(),e.prev=2,e.next=5,t.getStats(r);case 5:o=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),$.debug("get stats error, fallback to default",e.t0),e.abrupt("return",Q);case 12:if(o){e.next=15;break}return $.debug("get null stats, fallback to default"),e.abrupt("return",Q);case 15:for(a=!0,s=!1,c=void 0,e.prev=18,u=o.values()[Symbol.iterator]();!(a=(d=u.next()).done);a=!0)f=d.value,("send"===n&&"outbound-rtp"===f.type&&!f.isRemote||"recv"===n&&"inbound-rtp"===f.type&&!f.isRemote)&&(p=o.get(f.remoteId),l="send"===n?f.packetsSent:f.packetsReceived,h="send"===n?f.bytesSent:f.bytesReceived,v=0,p&&(m="send"===n?p.packetsReceived:p.packetsSent,v="send"===n?p.packetsLost:m-l),i.bytes=h,i.packets=l,i.packetLoss=v);e.next=26;break;case 22:e.prev=22,e.t1=e.catch(18),s=!0,c=e.t1;case 26:e.prev=26,e.prev=27,a||null==u.return||u.return();case 29:if(e.prev=29,!s){e.next=32;break}throw c;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.abrupt("return",i);case 35:case"end":return e.stop()}},e,this,[[2,8],[18,22,26,34],[27,,29,33]])}))).apply(this,arguments)}function X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function ee(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Z(o,n,i,a,s,"next",e)}function s(e){Z(o,n,i,a,s,"throw",e)}a(void 0)})}}function te(){var e={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return J.unifiedPlan?e.sdpSemantics="unified-plan":e.sdpSemantics="plan-b",new RTCPeerConnection(e)}function re(e,t){return ne.apply(this,arguments)}function ne(){return(ne=ee(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=r.getTransceivers().find(function(e){return"inactive"===e.direction&&e.receiver.track.kind===t.kind}))){e.next=8;break}return n.direction="sendonly",e.next=5,n.sender.replaceTrack(t);case 5:return e.abrupt("return",n);case 8:return e.next=10,r.addTransceiver(t,{direction:"sendonly"});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function ie(e,t,r,n){return oe.apply(this,arguments)}function oe(){return(oe=ee(regeneratorRuntime.mark(function e(t,r,n,i){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!J.stats){e.next=7;break}return e.next=3,K(t,r,n);case 3:return o=e.sent,e.abrupt("return",ae(o,i));case 7:return $.warning("your browser does not support getStats"),e.abrupt("return",Q);case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function ae(e,t){if(!t)return e;var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){X(e,t,r[t])})}return e}({},e),n=e.packets-t.packets,i=e.packetLoss-t.packetLoss;i>0&&(r.packetLossRate=i/n,r.packetLossRate>1&&(r.packetLossRate=1));var o=(e.timestamp-t.timestamp)/1e3;return o<=0?e:(r.bitrate=8*(e.bytes-t.bytes)/o,r.bitrate<0?t:r)}var se,ce=function(e){return!!e&&!!e.audio&&e.audio.enabled},ue=function(e){return!!e&&!!e.video&&e.video.enabled},de=function(e){return!!e&&!!e.screen&&e.screen.enabled};!function(e){e[e.Idle=0]="Idle",e[e.Connecting=1]="Connecting",e[e.Connect=2]="Connect"}(se||(se={}));var fe={publishUrl:"",height:720,width:1080,fps:25,kbps:1e3,audioOnly:!1,stretchMode:"aspectFill"};function pe(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function le(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){pe(o,n,i,a,s,"next",e)}function s(e){pe(o,n,i,a,s,"throw",e)}a(void 0)})}}window.addEventListener("message",function(e){e.origin===window.location.origin&&function(e){if("PermissionDeniedError"===e){if(me="PermissionDeniedError",ve)return ve("PermissionDeniedError");throw I()}"qnrtc:rtcmulticonnection-extension-loaded"===e&&(me="desktop");"rtcmulticonnection-extension-loaded"===e&&($.warning("your chrome screen sharing plugin is not the latest version, or you have other screen sharing plugins."),!1);e.sourceId&&ve&&ve(he=e.sourceId,!0===e.canRequestAudioTrack)}(e.data)});var he,ve,me="screen";function ye(){return ge.apply(this,arguments)}function ge(){return(ge=le(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){return new Promise(function(e,t){"desktop"!==me?(window.postMessage("qnrtc:are-you-there","*"),setTimeout(function(){e("screen"!==me)},2e3)):e(!0)})},e.next=3,t();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function be(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ve=e,t?window.postMessage("qnrtc:get-sourceId-screen","*"):r?window.postMessage("qnrtc:get-sourceId-window","*"):window.postMessage("qnrtc:get-sourceId","*")}function ke(e){if(he)return e(he);ve=e,window.postMessage("qnrtc:audio-plus-tab","*")}function we(e,t){return Te.apply(this,arguments)}function Te(){return(Te=le(regeneratorRuntime.mark(function e(t,r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.source,i=function(){return new Promise(function(e,i){var o={mozMediaSource:n||"window",mediaSource:n||"window",height:r.height,width:r.width};if(U)e(o);else{var a={mandatory:{chromeMediaSource:me,maxWidth:Le(r.width),maxHeight:Le(r.height)},optional:[]};"desktop"!==me?e(a):t?ke(function(t,r){a.mandatory.chromeMediaSourceId=t,r&&(a.canRequestAudioTrack=!0),"PermissionDeniedError"!==t?e(a):i(I())}):be(function(t){a.mandatory.chromeMediaSourceId=t,"PermissionDeniedError"!==t?e(a):i(I())},"screen"===n,"window"===n)}})},e.next=4,i();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function Se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _e=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tracks=[],this.publishedTrackInfo=[],this.userId=t}return function(e,t,r){t&&Se(e.prototype,t),r&&Se(e,r)}(e,[{key:"addTracks",value:function(e){var t=this;this.tracks=this.tracks.concat(e),this.tracks=a()(this.tracks,"mediaTrack");var r=!0,n=!1,i=void 0;try{for(var o,s=function(){var e=o.value;e.once("release",function(){c()(t.tracks,function(t){return t===e})})},u=this.tracks[Symbol.iterator]();!(r=(o=u.next()).done);r=!0)s()}catch(e){n=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(n)throw i}}}},{key:"removeTracksByTrackId",value:function(e){c()(this.tracks,function(t){return!!t.info.trackId&&-1!==e.indexOf(t.info.trackId)})}},{key:"addPublishedTrackInfo",value:function(e){this.publishedTrackInfo=this.publishedTrackInfo.concat(e),this.publishedTrackInfo=a()(this.publishedTrackInfo,"trackId")}},{key:"removePublishedTrackInfo",value:function(e){c()(this.publishedTrackInfo,function(t){return-1!==e.indexOf(t.trackId)})}},{key:"published",get:function(){return this.publishedTrackInfo.length>0}}]),e}();function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Re(e){return{trackId:e.trackid,tag:e.tag,kind:e.kind,userId:e.playerid,muted:e.muted,versionid:e.versionid}}function Pe(e,t){return{trackid:e.trackId,kind:e.kind,master:t,muted:!!e.muted,playerid:e.userId,tag:e.tag||"",versionid:e.versionid}}function Ee(e){return{localid:e.mediaTrack.id,master:e.master,kind:e.info.kind,kbps:e.info.kbps,tag:e.info.tag}}function Oe(e){return new _e(e.playerid)}function Ie(e){return je.apply(this,arguments)}function je(){return(je=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){xe(o,n,i,a,s,"next",e)}function s(e){xe(o,n,i,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{audio:!0,video:!0});case 2:if(!de(t)){e.next=13;break}if(!ue(t)){e.next=5;break}throw b("can not get mediaStream with video and screen are all enabled");case 5:if(J.screenSharing){e.next=7;break}throw x("your browser can not share screen");case 7:if(!G){e.next=13;break}return e.next=10,ye();case 10:if(e.sent){e.next=13;break}throw P("");case 13:if(r=!(!t.audio||!t.audio.enabled||t.audio.buffer)&&{deviceId:t.audio.deviceId,sampleRate:t.audio.sampleRate,sampleSize:t.audio.sampleSize,channelCount:t.audio.channelCount,autoGainControl:t.audio.autoGainControl,echoCancellation:t.audio.echoCancellation,noiseSuppression:t.audio.noiseSuppression},!t.audio||!t.audio.buffer||J.mediaStreamDest){e.next=16;break}throw x("not support audio buffer input");case 16:if(n=!(!t.video||!t.video.enabled)&&{frameRate:t.video.frameRate,height:t.video.height,width:t.video.width,deviceId:t.video.deviceId},!t.screen){e.next=22;break}return e.next=20,we(!1,t.screen);case 20:return i=e.sent,e.abrupt("return",Ae(Me(Qe({audio:r,video:i}))));case 22:return e.abrupt("return",Ae(Me(Qe({audio:r,video:n}))));case 23:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function Me(e){if(J.minMaxWithIdeal)return e;return["video","screen"].forEach(function(t){"object"===Ce(e[t])&&"object"===Ce(e[t].width)&&e[t].width.ideal&&delete e[t].width.ideal,"object"===Ce(e[t])&&"object"===Ce(e[t].height)&&e[t].height.ideal&&delete e[t].height.ideal}),e}function Ae(e){return 0===Object.keys(e.audio).length&&"boolean"!=typeof e.audio&&(e.audio=!0),0===Object.keys(e.video).length&&"boolean"!=typeof e.video&&(e.video=!0),e}function Le(e){if(e)return"number"==typeof e?e:e.exact?e.exact:e.max?e.max:e.ideal?e.ideal:e.min?e.min:void 0}var De=r(27),Ne=r.n(De);function Fe(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ue="qiniu-rtc-client";var Ge=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastSubMids=[],this.sessionVersion=0,this.direction=t,this.extendedRtpCapabilities=r}return function(e,t,r){t&&Be(e.prototype,t),r&&Be(e,r)}(e,[{key:"createRemoteAnswer",value:function(e){if(!this.transportRemoteParameters)throw b("no transportRemoteParameters!");return J.unifiedPlan?function(e,t,r){var n=Ne.a.parse(r),i=(n.media||[]).filter(function(e){return e.hasOwnProperty("mid")}).map(function(e){return String(e.mid)}),o={version:0};o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344376",sessionVersion:2,username:Ue},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceParameters.iceLite?"ice-lite":void 0,o.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(o.groups=[{type:"BUNDLE",mids:i.join(" ")}]);o.media=[],o.fingerprint={type:t.dtlsParameters.fingerprints[0].algorithm,hash:t.dtlsParameters.fingerprints[0].value};var a=!0,s=!1,c=void 0;try{for(var u,d=function(){var r=u.value,n=(r.direction,r.type),i="audio"===n?e.codecs[0]:e.codecs[1],a=e.headerExtensions.filter(function(e){return e.kind===n}),s={type:r.type,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},mid:r.mid,iceUfrag:t.iceParameters.usernameFragment,icePwd:t.iceParameters.password,candidates:[{component:1,foundation:t.iceCandidate.foundation,ip:t.iceCandidate.ip,port:t.iceCandidate.port,priority:t.iceCandidate.priority,transport:t.iceCandidate.protocol,type:t.iceCandidate.type}],endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===t.dtlsParameters.role?"actpass":"active",direction:"sendonly"===r.direction||"sendrecv"===r.direction?"recvonly":"inactive",rtp:[{payload:i.sendPayloadType,codec:i.name,rate:i.clockRate,encoding:i.channels>1?i.channels:void 0}],rtcpFb:[],fmtp:[{payload:i.sendPayloadType,config:Object.keys(i.parameters).map(function(e){return"".concat(e,"=").concat(i.parameters[e],";")}).join("")}],payloads:i.sendPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ext:a.map(function(e){return{uri:e.uri,value:e.sendId}})};i.rtcpFeedback&&i.rtcpFeedback.length>0&&i.rtcpFeedback.forEach(function(e){s.rtcpFb.push({payload:i.sendPayloadType,type:e.type,subtype:e.parameter})}),i.sendRtxPayloadType&&(s.rtp.push({payload:i.sendRtxPayloadType,codec:"rtx",rate:i.clockRate,encoding:i.channels>1?i.channels:void 0}),s.fmtp.push({payload:i.sendRtxPayloadType,config:"apt=".concat(i.sendPayloadType,";")}),s.payloads="".concat(i.sendPayloadType," ").concat(i.sendRtxPayloadType)),o.media.push(s)},f=n.media[Symbol.iterator]();!(a=(u=f.next()).done);a=!0)d()}catch(e){s=!0,c=e}finally{try{a||null==f.return||f.return()}finally{if(s)throw c}}return Ne.a.write(o)}(this.extendedRtpCapabilities,this.transportRemoteParameters,e):function(e,t,r){var n=Ne.a.parse(r);n.version=0,n.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344376",sessionVersion:2,username:Ue},n.name="-",n.timing={start:0,stop:0},n.icelite=t.iceParameters.iceLite?"ice-lite":void 0,n.msidSemantic={semantic:"WMS",token:"*"},n.fingerprint={type:t.dtlsParameters.fingerprints[0].algorithm,hash:t.dtlsParameters.fingerprints[0].value};var i=[],o=!0,a=!1,s=void 0;try{for(var c,u=function(){var r=c.value,n=r.type,o=e.codecs.find(function(e){return e.kind===n}),a=(e.headerExtensions||[]).filter(function(e){return e.kind===n});if(!o)throw b("can not find codec"+n);var s={type:n,mid:n,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},iceUfrag:t.iceParameters.usernameFragment,icePwd:t.iceParameters.password,candidates:[{component:1,foundation:t.iceCandidate.foundation,ip:t.iceCandidate.ip,port:t.iceCandidate.port,priority:t.iceCandidate.priority,transport:t.iceCandidate.protocol,type:t.iceCandidate.type}],endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===t.dtlsParameters.role?"actpass":"active",direction:"recvonly",rtp:[{payload:o.sendPayloadType,codec:o.name,rate:o.clockRate,encoding:o.channels>1?o.channels:void 0}],rtcpFb:[],fmtp:[{payload:o.sendPayloadType,config:Object.keys(o.parameters).map(function(e){return"".concat(e,"=").concat(o.parameters[e],";")}).join("")}],payloads:o.sendPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ext:a.map(function(e){return{uri:e.uri,value:e.sendId}})};o.rtcpFeedback&&o.rtcpFeedback.length>0&&o.rtcpFeedback.forEach(function(e){s.rtcpFb.push({payload:o.sendPayloadType,type:e.type,subtype:e.parameter})}),o.sendRtxPayloadType&&(s.rtp.push({payload:o.sendRtxPayloadType,codec:"rtx",rate:o.clockRate,encoding:o.channels>1?o.channels:void 0}),s.fmtp.push({payload:o.sendRtxPayloadType,config:"apt=".concat(o.sendPayloadType,";")}),s.payloads="".concat(o.sendPayloadType," ").concat(o.sendRtxPayloadType)),i.push(s)},d=n.media[Symbol.iterator]();!(o=(c=d.next()).done);o=!0)u()}catch(e){a=!0,s=e}finally{try{o||null==d.return||d.return()}finally{if(a)throw s}}return n.media=i,Ne.a.write(n)}(this.extendedRtpCapabilities,this.transportRemoteParameters,e)}},{key:"createRemoteOffer",value:function(e){if(!this.transportRemoteParameters)throw b("no transportRemoteParameters!");if(J.unifiedPlan){var t=function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=function(){var t=a.value,n=c()(e,function(e){return e.mid===t})[0];if(!n)return"continue";r.push(n)},u=t[Symbol.iterator]();!(n=(a=u.next()).done);n=!0)s()}catch(e){i=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r=r.concat(e),t=r.map(function(e){return e.mid}),r}(e,this.lastSubMids);return this.lastSubMids=t.map(function(e){return e.mid}),this.sessionVersion+=1,function(e,t,r,n){$.debug("consumerInfos",e);var i={},o=e.map(function(e){return e.mid});i.version=0,i.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344377",sessionVersion:n,username:Ue},i.name="-",i.timing={start:0,stop:0},i.icelite=r.iceParameters.iceLite?"ice-lite":void 0,i.msidSemantic={semantic:"WMS",token:"*"},o.length>0&&(i.groups=[{type:"BUNDLE",mids:o.join(" ")}]);i.media=[],i.fingerprint={type:r.dtlsParameters.fingerprints[0].algorithm,hash:r.dtlsParameters.fingerprints[0].value};var a=!0,s=!1,c=void 0;try{for(var u,d=function(){var e=u.value,n="audio"===e.kind?t.codecs[0]:t.codecs[1],o=t.headerExtensions.filter(function(t){return t.kind===e.kind}),a={type:e.kind,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},mid:e.mid,msid:"".concat(e.streamId," ").concat(e.trackId),iceUfrag:r.iceParameters.usernameFragment,icePwd:r.iceParameters.password,candidates:[{component:1,foundation:r.iceCandidate.foundation,ip:r.iceCandidate.ip,port:r.iceCandidate.port,priority:r.iceCandidate.priority,transport:r.iceCandidate.protocol,type:r.iceCandidate.type}],endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===r.dtlsParameters.role?"actpass":"active",direction:e.closed?"inactive":"sendonly",rtp:[{payload:n.recvPayloadType,codec:n.name,rate:n.clockRate,encoding:n.channels>1?n.channels:void 0}],rtcpFb:[],fmtp:[{payload:n.recvPayloadType,config:Object.keys(n.parameters).map(function(e){return"".concat(e,"=").concat(n.parameters[e],";")}).join("")}],payloads:n.recvPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ext:e.closed?[]:o.map(function(e){return{uri:e.uri,value:e.recvId}}),ssrcs:!e.closed&&e.ssrc?[{id:e.ssrc,attribute:"cname",value:e.cname}]:[],ssrcGroups:[]};n.rtcpFeedback&&n.rtcpFeedback.length>0&&n.rtcpFeedback.forEach(function(e){a.rtcpFb.push({payload:n.recvPayloadType,type:e.type,subtype:e.parameter})}),n.recvRtxPayloadType&&(a.rtp.push({payload:n.recvRtxPayloadType,codec:"rtx",rate:n.clockRate,encoding:n.channels>1?n.channels:void 0}),a.fmtp.push({payload:n.recvRtxPayloadType,config:"apt=".concat(n.recvPayloadType,";")}),a.payloads="".concat(n.recvPayloadType," ").concat(n.recvRtxPayloadType)),e.rtxSsrc&&!e.closed&&(a.ssrcs.push({id:e.rtxSsrc,attribute:"cname",value:e.cname}),a.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(e.ssrc," ").concat(e.rtxSsrc)})),i.media.push(a)},f=e[Symbol.iterator]();!(a=(u=f.next()).done);a=!0)d()}catch(e){s=!0,c=e}finally{try{a||null==f.return||f.return()}finally{if(s)throw c}}return Ne.a.write(i)}(t,this.extendedRtpCapabilities,this.transportRemoteParameters,this.sessionVersion)}var r=new Set;return e.forEach(function(e){return r.add(e.kind)}),0===e.length&&(r.add("audio"),r.add("video")),function(e,t,r,n){e=["audio","video"];var i={version:0};i.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344377",sessionVersion:2,username:Ue},i.name="-",i.timing={start:0,stop:0},i.icelite=n.iceParameters.iceLite?"ice-lite":void 0,i.msidSemantic={semantic:"WMS",token:"*"},i.groups=[{type:"BUNDLE",mids:e.join(" ")}],i.media=[],i.fingerprint={type:n.dtlsParameters.fingerprints[0].algorithm,hash:n.dtlsParameters.fingerprints[0].value};var o=!0,a=!1,s=void 0;try{for(var c,u=function(){var e=c.value,o=t.filter(function(t){return t.kind===e}),a=r.codecs.find(function(t){return t.kind===e}),s=(r.headerExtensions||[]).filter(function(t){return t.kind===e});if(!a)throw b("no codec"+e);var u={type:e,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},mid:e,iceUfrag:n.iceParameters.usernameFragment,icePwd:n.iceParameters.password,candidates:[{component:1,foundation:n.iceCandidate.foundation,ip:n.iceCandidate.ip,port:n.iceCandidate.port,priority:n.iceCandidate.priority,transport:n.iceCandidate.protocol,type:n.iceCandidate.type}],endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===n.dtlsParameters.role?"actpass":"active",direction:"sendonly",rtp:[{payload:a.recvPayloadType,codec:a.name,rate:a.clockRate,encoding:a.channels>1?a.channels:void 0}],rtcpFb:[],fmtp:[{payload:a.recvPayloadType,config:Object.keys(a.parameters).map(function(e){return"".concat(e,"=").concat(a.parameters[e],";")}).join("")}],payloads:a.recvPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ssrcs:[],ssrcGroups:[],ext:s.map(function(e){return{uri:e.uri,value:e.recvId}})};a.rtcpFeedback&&a.rtcpFeedback.length>0&&a.rtcpFeedback.forEach(function(e){u.rtcpFb.push({payload:a.recvPayloadType,type:e.type,subtype:e.parameter})}),a.recvRtxPayloadType&&(u.rtp.push({payload:a.recvRtxPayloadType,codec:"rtx",rate:a.clockRate,encoding:a.channels>1?a.channels:void 0}),u.fmtp.push({payload:a.recvRtxPayloadType,config:"apt=".concat(a.recvPayloadType,";")}),u.payloads="".concat(a.recvPayloadType," ").concat(a.recvRtxPayloadType));var d=!0,f=!1,p=void 0;try{for(var l,h=o[Symbol.iterator]();!(d=(l=h.next()).done);d=!0){var v=l.value;u.ssrcs.push({id:v.ssrc,attribute:"msid",value:"".concat(v.streamId," ").concat(v.trackId)}),u.ssrcs.push({id:v.ssrc,attribute:"mslabel",value:"".concat(v.streamId)}),u.ssrcs.push({id:v.ssrc,attribute:"label",value:"".concat(v.trackId)}),u.ssrcs.push({id:v.ssrc,attribute:"cname",value:"".concat(v.cname)}),v.rtxSsrc&&(u.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(v.ssrc," ").concat(v.rtxSsrc)}),u.ssrcs.push({id:v.rtxSsrc,attribute:"msid",value:"".concat(v.streamId," ").concat(v.trackId)}),u.ssrcs.push({id:v.rtxSsrc,attribute:"mslabel",value:"".concat(v.streamId)}),u.ssrcs.push({id:v.rtxSsrc,attribute:"label",value:"".concat(v.trackId)}),u.ssrcs.push({id:v.rtxSsrc,attribute:"cname",value:"".concat(v.cname)}))}}catch(e){f=!0,p=e}finally{try{d||null==h.return||h.return()}finally{if(f)throw p}}i.media.push(u)},d=e[Symbol.iterator]();!(o=(c=d.next()).done);o=!0)u()}catch(e){a=!0,s=e}finally{try{o||null==d.return||d.return()}finally{if(a)throw s}}return Ne.a.write(i)}(Array.from(r),e,this.extendedRtpCapabilities,this.transportRemoteParameters)}},{key:"updateICE",value:function(e,t){this.transportRemoteParameters&&(this.transportRemoteParameters.iceCandidate=t,this.transportRemoteParameters.iceParameters=e)}}]),e}();function We(){return Ve.apply(this,arguments)}function Ve(){return(Ve=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Fe(o,n,i,a,s,"next",e)}function s(e){Fe(o,n,i,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=te(),r={offerToReceiveAudio:!0,offerToReceiveVideo:!0},e.next=4,t.createOffer(r);case 4:return n=e.sent,i={capsdp:n.sdp,agent:navigator.userAgent},t.close(),e.abrupt("return",i);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e){var t=e.split(".")[1];if(!t)throw new Error("parse jwt error, can not find payload string.");var r=atob(t);return JSON.parse(r)}function ze(e){try{var t=e.split(":")[2],r=atob(t);return JSON.parse(r)}catch(e){throw b("can not parse roomToken, ".concat(e))}}function $e(e,t,r){if(!r)return null;for(var n=0;n<e.length;n+=1){var i=e[n];if(i[t]===r)return i}return null}function qe(e,t,r,n){return e.sendWsMsg(t,r),new Promise(function(t){e.once(n,t)})}function Qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>=4)return e;for(var r in e)void 0===e[r]&&delete e[r],"object"===He(e[r])&&(e[r]=Qe(e[r],t+1));return e}function Ke(e){Promise.resolve().then(e)}function Ye(e,t){var r=new Promise(function(e,r){window.setTimeout(function(){return r("timeout")},t)});return Promise.race([e,r])}function Xe(e,t,r,n,i){var o={join:[],leave:[],add:[],remove:[],mute:[]},a=t.map(function(e){return e.trackid}),s=r.map(function(e){return e.trackid});return a.forEach(function(n,i){if(t[i].playerid!==e)if(-1===s.indexOf(n))o.remove.push(t[i]);else{var a=r.find(function(e){return e.trackid===n}),c=t[i];a.versionid!==c.versionid&&(o.remove.push(c),o.add.push(a))}}),s.forEach(function(n,i){if(r[i].playerid!==e){var s=a.indexOf(n);-1===s?(o.add.push(r[i]),o.mute.push({trackid:n,muted:r[i].muted})):r[i].muted!==t[s].muted&&o.mute.push({trackid:n,muted:r[i].muted})}}),n.forEach(function(t){t!==e&&-1===i.indexOf(t)&&o.leave.push({playerid:t})}),i.forEach(function(t){t!==e&&-1===n.indexOf(t)&&o.join.push({playerid:t})}),o}function Ze(e){return("0"+e.toString(16)).substr(-2)}function et(e){return new Promise(function(t){setTimeout(function(){t()},e)})}var tt="2.0.0-patch.1";function rt(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}var nt="https://rtc.qiniuapi.com";function it(e,t){return ot.apply(this,arguments)}function ot(){return(ot=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){rt(o,n,i,a,s,"next",e)}function s(e){rt(o,n,i,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.appId,i=t.roomName,o=t.userId,a="".concat(nt,"/v3/apps/").concat(n,"/rooms/").concat(i,"/auth?user=").concat(o,"&token=").concat(r);case 2:return e.prev=3,e.next=6,D(a);case 6:return s=e.sent,e.abrupt("return",s.accessToken);case 10:if(e.prev=10,e.t0=e.catch(3),!1!==e.t0.retry){e.next=14;break}throw k(e.t0.message);case 14:return e.next=16,et(1e3);case 16:$.warning("can not get accessToken, retry.",k(e.t0));case 17:e.next=2;break;case 19:case"end":return e.stop()}},e,this,[[3,10]])}))).apply(this,arguments)}function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ft,pt=function(e,t){return new g(e,"joinRoom error, code: ".concat(e,", ").concat(t))};!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(ft||(ft={}));var lt=function(e){function t(e,r,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==at(t)&&"function"!=typeof t?dt(e):t}(this,ct(t).call(this))).mergeJobIndex=0,i.mergeJobResIndex=0,i.initWs=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t,r){i.ws&&i.ws.readyState===WebSocket.OPEN&&(i.ws.close(),i.ws.onclose=null);try{i.ws=new WebSocket(i.url),i._state=ft.CONNECTING}catch(e){throw b("init signaling websocket faild!\nError: ".concat(e))}i.ws.onerror=i.onWsError,i.ws.onclose=i.onWsClose.bind(dt(dt(i)),t,r),i.ws.onopen=function(){i.emit("ws:onopen"),$.log("signaling: websocket open",i.url),i.ws.onmessage=i.onWsMsg;var n={token:i.accessToken,reconntoken:i.reconnectToken,agent:"".concat(V.name).concat(V.version),sdkversion:tt,capsdp:i.capsdp};i.request("auth",n).then(function(n){switch(n.code){case 0:i.ws.onclose=i.onWsClose.bind(dt(dt(i)),null,null),i.reconnectToken=n.reconntoken,$.log("signaling: websocket authed"),i.emit("@signalingauth",n),i._state=ft.OPEN,t(n);break;case 10001:case 10002:case 10011:case 10022:i.emit("@error",n),r(pt(n.code,n.error));break;case 10004:case 10012:i.emit("@error",n),r(pt(10004,n.error));break;case 10052:if($.debug("10052 auth, retry",e),i.reconnectToken=void 0,e){r(pt(n.code,n.error));break}return void i.emit("@error",n);case 10053:r(n);break;case 10054:r(S(n.error));break;default:r(b(n.error))}0!==n.code&&(i.reconnectToken=void 0,i._state=ft.CLOSED,i.release())})}})},i.onWsMsg=function(e){var t=e.data;i.emit("ws:onmessage",t);var r=t.indexOf("=");if(!(r>0))throw b("signaling model can not parse message: ".concat(t));var n=t.substring(0,r),o=JSON.parse(t.substring(r+1));i.receiveWsMsg(n,o)},i.onWsError=function(e){$.warning("signaling: websocket error",e),i.emit("@ws:error",e)},i.sendWsMsg=function(e,t){var r=JSON.stringify(t);try{i.ws.send("".concat(e,"=").concat(r)),i.emit("send",e,t)}catch(e){throw $.warning("signaling: websocket send error",e),i.reconnect().catch(function(e){$.warning("signaling: reconnect error",e)}),M()}},i.handlePing=function(){i.sendWsMsg("pong",{}),i.reconnectTimeoutID&&clearTimeout(i.reconnectTimeoutID),i.reconnectTimeoutID=setTimeout(function(){$.debug("signaling: websocket heartbeat timeout"),i.reconnect().catch(function(e){$.debug(e)})},9e3)},i.receiveWsMsg=function(e,t){switch(i.emit("receive",e,t),e){case"ping":i.handlePing();break;case"auth-res":i.emit("@auth-res",t);case"pubpc-res":case"subpc-res":case"pub-tracks":case"webrtc-candidate":case"on-player-in":case"on-player-out":case"disconnect":case"mute-tracks":case"on-add-tracks":case"on-remove-tracks":i.emit(e,t);break;case"create-merge-job-res":i.mergeJobResIndex+=1,i.emit("".concat(e,"-").concat(i.mergeJobResIndex),t);case"webrtc-answer":i.emit(e,t),i.emit("".concat(e,"-streamid-").concat(t.streamid,"-connid-").concat(t.connid),t);case"webrtc-icestate":i.emit(e,t),t.connid?i.emit("".concat(e,"-connid-").concat(t.connid),t):i.emit("".concat(e,"-stream-").concat(t.streamid),t);break;case"sub-res":case"unsub-res":i.emit(e,t),i.emit("".concat(e,"-").concat(t.streamid),t);break;case"control-res":i.emit(e,t),i.emit("".concat(e,"-").concat(t.command,"-").concat(t.playerid),t);break;case"on-pubpc-connected":case"on-pubpc-disconnected":i.emit("on-pubpc-state",{pcid:t.pcid,connected:"on-pubpc-connected"===e}),i.emit("".concat(e,"-").concat(t.pcid),t);break;case"on-subpc-disconnected":case"on-subpc-connected":i.emit("on-subpc-state",{pcid:t.pcid,connected:"on-subpc-connected"===e}),i.emit(e,t);break;case"pub-tracks-res":i.emit(e,t);break;case"unpub-tracks-res":case"sub-tracks-res":case"unsub-tracks-res":case"on-pubpc-restart-notify":case"on-subpc-restart-notify":case"pubpc-restart-res":case"subpc-restart-res":i.emit(e,t)}},i.url=e,i.accessToken=r,i.capsdp=n,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(t,i.a),function(e,t,r){t&&st(e.prototype,t),r&&st(e,r)}(t,[{key:"onWsClose",value:function(e,t,r){this._state=ft.CLOSED,$.warning("signaling: websocket onclose",r);var n=this.reconnectPromise;switch(r.code){case 1e3:this.emit("@closed");break;case 1001:case 1005:case 1006:n=this.reconnect();break;case 1007:case 1008:case 1009:case 1010:break;case 1011:n=this.reconnect();break;case 1012:n=this.reconnect(5e3);break;case 1013:n=this.reconnect();break;case 1014:n=this.reconnect(5e3)}e&&t&&(n?e(n):t(r))}},{key:"reconnect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.reconnectTimeoutID&&clearTimeout(this.reconnectTimeoutID),this.reconnectPromise&&this._state===ft.CONNECTING?this.reconnectPromise:(this._state=ft.CONNECTING,$.debug("signaling: websocket reconnecting"),this.reconnectPromise=et(t).then(function(){return e.initWs()}).then(function(t){return e.reconnectPromise=void 0,t}).catch(function(t){return e._state=ft.CLOSED,e.emit("error",t),Promise.reject(t)}),this.reconnectPromise)}},{key:"request",value:function(e,t){var r=this,n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=new Uint8Array((e||40)/2);return window.crypto.getRandomValues(t),Array.from(t,Ze).join("")}(8);return t.rpcid=n,$.log("ws request",n,e,t),this.sendWsMsg(e,t),new Promise(function(t){r.on("".concat(e,"-res"),function i(o){o.rpcid===n&&($.log("ws response",n,e,o),r.off("".concat(e,"-res"),i),t(o))})})}},{key:"release",value:function(){this.reconnectTimeoutID&&clearTimeout(this.reconnectTimeoutID),this.removeEvent(),this.ws.onclose=null,this.ws.onerror=null,this.ws.close()}},{key:"_state",set:function(e){this.emit("@ws-state-change",this.__state,e),this.__state=e}},{key:"state",get:function(){return this.__state}}]),t}();function ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var mt=function(){function e(t,r,n,i){var o=this;vt(this,e),this.videoTrackInfo=[],this.audioTrackInfo=[],this.layoutLevel=0,this.width=t,this.height=r,this.jobId=i,this.controller=n,this.controller.getCurrentTracks().forEach(function(e){"audio"===e.kind?o.audioTrackInfo.push(e):o.videoTrackInfo.push(e)}),this.controller.addMergeTrack(this.audioTrackInfo.map(function(e){return{trackId:e.trackId}}),this.jobId),this.initLayout(),this.controller.onAddTracks=function(e){var t=e.filter(function(e){return"audio"===e.kind}),r=e.filter(function(e){return"video"===e.kind});o.controller.addMergeTrack(t.map(function(e){return{trackId:e.trackId}}),o.jobId),r.forEach(o.handleAddVideoTrack.bind(o))},this.controller.onRemoveTracks=function(e){e.filter(function(e){return"video"===e.kind}).forEach(o.handleRemoveVideoTrack.bind(o))},$.log("init default merger, init layout: ",this.layout)}return function(e,t,r){t&&ht(e.prototype,t),r&&ht(e,r)}(e,[{key:"initLayout",value:function(){var e=this.videoTrackInfo.length;this.layoutLevel=0,this.layout={"level-0":{items:{"item-0":{x:0,y:0,isExpand:!1,isExpanded:!1,index:0}},itemWidth:this.width,itemHeight:this.height,maxItems:1,currentItems:0,splitWidthFlag:this.width<this.height}};var t=this.width>=this.height;if(0!==e){for(;Math.pow(2,this.layoutLevel)<e;)this.updateLayoutLevel(t),t=!t;this.setLevelLayoutStream()}}},{key:"updateLayoutLevel",value:function(e){var t=this,r=this.layout["level-".concat(this.layoutLevel)],n=r.itemWidth,i=r.itemHeight;this.layoutLevel+=1;var o=Math.pow(2,this.layoutLevel),a=e?n/2:n,s=e?i:i/2;if(1===this.layoutLevel)this.layout["level-".concat(this.layoutLevel)]={items:{"item-0":{x:0,y:0,isExpand:!1,isExpanded:!1,index:0},"item-1":{x:this.width>=this.height?a:0,y:this.width<this.height?s:0,isExpand:!1,isExpanded:!1,index:1}},maxItems:o,currentItems:0,itemWidth:a,itemHeight:s,splitWidthFlag:e};else{this.layout["level-".concat(this.layoutLevel)]={items:{},maxItems:o,currentItems:0,itemWidth:a,itemHeight:s,splitWidthFlag:e};var c=this.layout["level-".concat(this.layoutLevel)].items;Object.keys(this.layout["level-".concat(this.layoutLevel-1)].items).forEach(function(r){var n=t.layout["level-".concat(t.layoutLevel-1)].items[r],i=2*n.index;c["item-".concat(i)]={x:n.x,y:n.y,isExpand:!1,isExpanded:!1,index:i},c["item-".concat(i+1)]=e?{x:n.x+a,y:n.y,isExpand:!1,isExpanded:!1,index:i+1}:{x:n.x,y:n.y+s,isExpand:!1,isExpanded:!1,index:i+1}})}$.log("merger: increase layout level, current level: ".concat(this.layoutLevel),this.layout)}},{key:"setLevelLayoutStream",value:function(){for(var e=this.videoTrackInfo.length,t=this.layout["level-".concat(this.layoutLevel)],r=t.maxItems-e,n=0,i=0;i<t.maxItems;i+=1)r>0?i%2==0?(t.items["item-".concat(i)].isExpand=!0,t.items["item-".concat(i)].trackId=this.videoTrackInfo[n].trackId,this.sendMergeOpt(this.layoutLevel,i),n+=1):(t.items["item-".concat(i)].isExpanded=!0,r-=1):(t.items["item-".concat(i)].trackId=this.videoTrackInfo[n].trackId,this.sendMergeOpt(this.layoutLevel,i),n+=1);t.currentItems=e}},{key:"sendMergeOpt",value:function(e,t){var r=this.layout["level-".concat(e)],n=r.items["item-".concat(t)];if(n.trackId&&!n.isExpanded){var i=r.itemWidth,o=r.itemHeight;n.isExpand&&(r.splitWidthFlag?i*=2:o*=2);var a={x:n.x,y:n.y,w:i,h:o,z:0,trackId:n.trackId};this.controller.addMergeTrack([a],this.jobId)}}},{key:"handleRemoveVideoTrack",value:function(e){c()(this.videoTrackInfo,function(t){return t.trackId===e.trackId});var t=this.layout["level-".concat(this.layoutLevel)];if(this.layoutLevel>0&&this.videoTrackInfo.length<=this.layout["level-".concat(this.layoutLevel-1)].maxItems)this.layoutLevel-=1,$.log("merger: reduce layout level, current level: ".concat(this.layoutLevel),this.layout),this.setLevelLayoutStream();else for(var r in t.items){var n=t.items[r];if(n.trackId===e.trackId){n.index%2==0?(t.items["item-".concat(n.index+1)]?(n.isExpand=!0,n.trackId=t.items["item-".concat(n.index+1)].trackId,t.items["item-".concat(n.index+1)].isExpanded=!0,t.items["item-".concat(n.index+1)].trackId=void 0):n.trackId=void 0,this.sendMergeOpt(this.layoutLevel,n.index)):(n.isExpanded=!0,n.trackId=void 0,t.items["item-".concat(n.index-1)].isExpand=!0,this.sendMergeOpt(this.layoutLevel,n.index-1));break}}}},{key:"handleAddVideoTrack",value:function(e){this.videoTrackInfo.push(e),this.videoTrackInfo=a()(this.videoTrackInfo,"trackId");var t=this.layout["level-".concat(this.layoutLevel)];if(this.videoTrackInfo.length<=t.maxItems){for(var r in t.items){var n=t.items[r];if(!n.trackId){n.trackId=e.trackId,n.isExpanded&&(n.isExpanded=!1,t.items["item-".concat(n.index-1)].isExpand=!1,this.sendMergeOpt(this.layoutLevel,n.index-1)),this.sendMergeOpt(this.layoutLevel,n.index);break}}t.currentItems=this.videoTrackInfo.length}else this.updateLayoutLevel(!t.splitWidthFlag),this.setLevelLayoutStream()}},{key:"release",value:function(){this.controller.release()}}]),e}();function yt(e){var t=document.createElement("audio"),r=new MediaStream([e]);return t.style.visibility="hidden",t.className="qnrtc-audio-player qnrtc-stream-player",t.dataset.localid=e.id,t.autoplay=!0,t.srcObject=r,t}function gt(e){var t=document.createElement("video"),r=new MediaStream([e]);return t.style.width="100%",t.style.height="100%",t.style.objectFit="contain",t.muted=!0,t.className="qnrtc-video-player qnrtc-stream-player",t.dataset.localid=e.id,t.setAttribute("playsinline",!0),t.autoplay=!0,t.srcObject=r,W&&(t.setAttribute("controls",!0),Ke(function(){t&&t.srcObject&&t.removeAttribute("controls")})),t}function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function St(e,t){return(St=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _t=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),wt(this,Tt(t).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&St(e,t)}(t,i.a),function(e,t,r){t&&kt(e.prototype,t),r&&kt(e,r)}(t,[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){$.warning("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new Promise(function(r,i){var o=r;t.safeEmit.apply(t,[e].concat(n,[o,function(t){$.warning("safeEmitAsPromise() | errback called [event:%s]:%o",e,t),i(t)}]))})}}]),t}();function Ct(e){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xt(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Rt(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){xt(o,n,i,a,s,"next",e)}function s(e){xt(o,n,i,a,s,"throw",e)}a(void 0)})}}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Et(e,t,r[t])})}return e}function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ot(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function It(e,t){return!t||"object"!==Ct(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jt(e){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var At=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=It(this,jt(t).call(this))).master=!1,n.stats=Q,n.mediaTrack=e,n.userId=r,n.info={kind:e.kind,muted:!e.enabled,userId:n.userId,versionid:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(t,_t),function(e,t,r){t&&Ot(e.prototype,t),r&&Ot(e,r)}(t,[{key:"play",value:function(e,t){this.removeMediaElement();var r="video"===this.info.kind?gt:yt;this.mediaElement=r(this.mediaTrack),"audio"===this.info.kind&&t&&(this.mediaElement.muted=!0),e.appendChild(this.mediaElement)}},{key:"resume",value:function(e){if(this.mediaTrack=e,this.mediaElement){var t=new MediaStream([e]);this.mediaElement.dataset.localid=e.id,this.mediaElement.srcObject=t}this.removeEvent("@get-stats")}},{key:"getStats",value:function(){return this.statsInterval||this.startGetStatsInterval(),this.stats}},{key:"onAudioBuffer",value:function(e,t){}},{key:"setVolume",value:function(e){}},{key:"getCurrentTimeDomainData",value:function(){return new Uint8Array}},{key:"getCurrentFrequencyData",value:function(){return new Uint8Array}},{key:"setAudioBuffer",value:function(e){}},{key:"playAudioBuffer",value:function(e){}},{key:"stopAudioBuffer",value:function(){}},{key:"setMaster",value:function(e){this.master=e}},{key:"setMute",value:function(e){this.info.muted=e,this.mediaTrack.enabled=!e,this.emit("mute",e)}},{key:"setKbps",value:function(e){this.info.kbps=e}},{key:"setInfo",value:function(e){this.info=Pt({},this.info,e)}},{key:"removeMediaElement",value:function(){this.mediaElement&&(this.mediaElement.remove(),this.mediaElement=void 0)}},{key:"release",value:function(){this.emit("release"),this.removeEvent(),this.statsInterval&&window.clearInterval(this.statsInterval),this.mediaTrack.stop(),this.removeMediaElement()}},{key:"reset",value:function(){this.info.trackId=void 0,this.info.userId=void 0,this.info.versionid=0,this.userId=void 0}},{key:"startGetStatsInterval",value:function(){var e=Rt(regeneratorRuntime.mark(function e(){var t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=function(){var e=Rt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r.getListeners("@get-stats"))&&0!==t.length){e.next=3;break}return e.abrupt("return",Q);case 3:return e.next=5,r.safeEmitAsPromise("@get-stats",r.lastStats);case 5:r.stats=e.sent,r.lastStats=Pt({},r.stats);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),this.statsInterval=window.setInterval(t,1e3);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}();var Lt=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.kind=r,this.rtpParameters=n,this.track=null};function Dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Nt=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._connectStatus=se.Idle,this.track=n,this.trackId=i,this.transport=t,this.direction=r}return function(e,t,r){t&&Dt(e.prototype,t),r&&Dt(e,r)}(e,[{key:"startConnect",value:function(){var e=this;return this.connectStatus=se.Connecting,new Promise(function(t,r){e.onConnectStatusChange=function(e,n){n===se.Connect&&t(),n===se.Idle&&r()}})}},{key:"appendConsumner",value:function(e,t){this.consumer=new Lt(this.trackId,t,e),this.transport.appendConsumer(this.consumer)}},{key:"setMute",value:function(e){this.track&&this.track.setMute(e)}},{key:"addTrackId",value:function(e){this.track&&(this.trackId=e,this.track.setInfo({trackId:e}))}},{key:"release",value:function(){this.consumer&&this.transport?(this.transport.recvHandler.isPcReady&&this.transport.removeConsumers([this.consumer]),this.track&&this.track.release()):this.track&&this.track.reset()}},{key:"connectStatus",get:function(){return this._connectStatus},set:function(e){var t=this;if(e!==this._connectStatus){var r=this._connectStatus;this._connectStatus=e,Ke(function(){t.onConnectStatusChange&&t.onConnectStatusChange(r,t._connectStatus)})}}}]),e}();function Ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Bt(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Ut(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Bt(o,n,i,a,s,"next",e)}function s(e){Bt(o,n,i,a,s,"throw",e)}a(void 0)})}}var Gt=new(window.AudioContext||window.webkitAudioContext||window.Object)({latencyHint:"interactive"});Gt.sampleRate;function Wt(e){return Vt.apply(this,arguments)}function Vt(){return(Vt=Ut(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("suspended"!==Gt.state){e.next=3;break}return e.next=3,Gt.resume();case 3:return r=function(){return new Promise(function(e,r){Gt.decodeAudioData(t,function(t){e(t)},function(e){r(e)})})},e.next=6,r();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var Ht=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&Ft(e.prototype,t),r&&Ft(e,r)}(e,[{key:"onAudioBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;this.audioBufferCallback=e,this.audioBufferSize=t}},{key:"initAudioContext",value:function(){var e=Ut(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("suspended"!==Gt.state){e.next=9;break}return e.prev=1,e.next=4,Ye(Gt.resume(),1e3);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),$.warning("resume audiocontext timeout");case 9:this.analyserNode=Gt.createAnalyser(),this.analyserNode.fftSize=2048,this.gainNode=Gt.createGain(),J.mediaStreamDest&&(this.audioStream=Gt.createMediaStreamDestination()),this.initScriptNode(4096);case 14:case"end":return e.stop()}},e,this,[[1,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"setMediaStreamSource",value:function(e){this.audioSource=Gt.createMediaStreamSource(e),this.connect()}},{key:"setAudioBufferSource",value:function(){this.audioSource=Gt.createBufferSource(),this.connect()}},{key:"setAudioBuffer",value:function(e){this.audioSource instanceof AudioBufferSourceNode&&(this.audioSource.buffer&&this.audioSource.stop(),this.audioSource.buffer=e)}},{key:"playAudioBuffer",value:function(e){var t=this;this.audioSource instanceof AudioBufferSourceNode&&(this.audioSource.loop=!!e,this.audioSource.start(),this.audioSource.onended=function(){t.audioBufferSourceEnd&&t.audioBufferSourceEnd()})}},{key:"stopAudioBuffer",value:function(){this.audioSource instanceof AudioBufferSourceNode&&this.audioSource.stop()}},{key:"release",value:function(){this.audioSource instanceof MediaStreamAudioSourceNode&&this.audioSource.mediaStream&&this.audioSource.mediaStream.getTracks().map(function(e){return e.stop()}),this.audioSource.disconnect(),this.gainNode.disconnect()}},{key:"connect",value:function(){this.audioSource.connect(this.analyserNode),this.audioSource.connect(this.scriptNode),this.audioSource.connect(this.gainNode),this.audioStream&&this.gainNode.connect(this.audioStream)}},{key:"handleAudioBuffer",value:function(e){var t=e.inputBuffer;this.audioBufferCallback&&this.audioBufferCallback(t)}},{key:"initScriptNode",value:function(e){this.scriptNode=Gt.createScriptProcessor(e),this.scriptNode.onaudioprocess=this.handleAudioBuffer.bind(this),this.scriptNode.connect(Gt.destination)}}]),e}();function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zt(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function $t(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){zt(o,n,i,a,s,"next",e)}function s(e){zt(o,n,i,a,s,"throw",e)}a(void 0)})}}function qt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qt(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yt(e,t){return(Yt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xt=function(e){function t(e,r){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"audio"!==e.kind)throw new Error("audio track only!");return(n=Qt(this,Kt(t).call(this,e,r))).mediaStream=new MediaStream,n.mediaStream.addTrack(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yt(e,t)}(t,At),function(e,t,r){t&&qt(e.prototype,t),r&&qt(e,r)}(t,[{key:"resume",value:function(e){this.mediaTrack=e,this.removeEvent("@get-stats");var t=new MediaStream([e]);this.mediaStream=t,this.mediaElement&&(this.mediaElement.dataset.localid=e.id,this.mediaElement.srcObject=t),this.audioManager&&(this.audioManager.release(),this.initAudioManager())}},{key:"initAudioManager",value:function(){var e=$t(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.sourceType="mic",this.audioManager=new Ht,e.next=4,this.audioManager.initAudioContext();case 4:this.audioManager.setMediaStreamSource(this.mediaStream),t&&J.mediaStreamDest&&(this.mediaStream=this.audioManager.audioStream.stream,this.mediaTrack=this.mediaStream.getTracks()[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onAudioBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;this.audioManager?this.audioManager.onAudioBuffer(e,t):$.warning("can not find audio manager")}},{key:"setVolume",value:function(e){this.audioManager&&this.audioManager.gainNode.gain.setValueAtTime(e,Gt.currentTime)}},{key:"getCurrentTimeDomainData",value:function(){if(!this.audioManager)return new Uint8Array(0);var e=new Uint8Array(2048);return this.audioManager.analyserNode.getByteTimeDomainData(e),e}},{key:"getCurrentFrequencyData",value:function(){if(!this.audioManager)return new Uint8Array(0);var e=new Uint8Array(2048);return this.audioManager.analyserNode.getByteFrequencyData(e),e}},{key:"setAudioBuffer",value:function(e){this.audioManager&&"buffer"===this.sourceType&&this.audioManager.setAudioBuffer(e)}},{key:"playAudioBuffer",value:function(e){this.audioManager&&"buffer"===this.sourceType&&this.audioManager.playAudioBuffer(e)}},{key:"stopAudioBuffer",value:function(){this.audioManager&&"buffer"===this.sourceType&&this.audioManager.stopAudioBuffer()}},{key:"release",value:function(){this.emit("release"),this.removeEvent(),this.statsInterval&&window.clearInterval(this.statsInterval),this.mediaTrack.stop(),this.removeMediaElement(),this.audioManager&&this.audioManager.release()}}]),t}();function Zt(){return er.apply(this,arguments)}function er(){return(er=$t(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ht,e.next=3,t.initAudioContext();case 3:return t.setAudioBufferSource(),r=t.audioStream.stream,n=r.getTracks()[0],(i=new Xt(n)).sourceType="buffer",i.audioManager=t,e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function tr(e){return(tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rr(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function nr(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){rr(o,n,i,a,s,"next",e)}function s(e){rr(o,n,i,a,s,"throw",e)}a(void 0)})}}function ir(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function or(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ar(e,t,r){return t&&or(e.prototype,t),r&&or(e,r),e}function sr(e,t){return!t||"object"!==tr(t)&&"function"!=typeof t?cr(e):t}function cr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ur(e){return(ur=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fr(e,t)}function fr(e,t){return(fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pr=function(e){function t(e,r,n){var i;return ir(this,t),(i=sr(this,ur(t).call(this)))._isRestartingICE=!1,i.isPcReady=!1,i._direction=e,i._pc=te(),i._extendedRtpCapabilities=r,i._remoteSdp=new Ge(e,r),i._pc.addEventListener("iceconnectionstatechange",function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}}),i}return dr(t,_t),ar(t,[{key:"getStats",value:function(){var e=nr(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie(this._pc,t,this._direction,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getCurrentIceConnectionState",value:function(){return this._pc.iceConnectionState}},{key:"close",value:function(){$.log("handle",this._direction,"close"),this.removeEvent(),this._pc.close(),this.isPcReady=!1}}]),t}(),lr=function(e){function t(e,r,n){var i;return ir(this,t),i=sr(this,ur(t).call(this,"send",e,n)),$.log("init send handler"),i._transportReady=!1,i._stream=new MediaStream,i._signaling=r,r.on("on-pubpc-state",function(e){i._remoteSdp.transportRemoteParameters&&e.pcid===i._remoteSdp.transportRemoteParameters.pcid&&(e.connected||i.emit("@connectionstatechange","disconnected"))}),i}return dr(t,pr),ar(t,[{key:"getReady",value:function(e){var t=this;return new Promise(function(r,n){t._signaling.on("on-pubpc-state",function i(o){o.pcid===e.pcid&&(t._signaling.off("on-pubpc-state",i),o.connected?(t.isPcReady=!0,r()):n())})})}},{key:"addProducerTracks",value:function(e){var t=this;$.debug("add producer",e);var r,n=e.map(function(e){return e.mediaTrack}).filter(function(e){return!t._stream.getTrackById(e.id)});if(0===n.length)return Promise.reject(new Error("track already added"));var i,o=[],a=!0;return Promise.resolve().then(nr(regeneratorRuntime.mark(function e(){var i,a,s,c,u,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.forEach(t._stream.addTrack,t._stream),!J.unifiedPlan){e.next=33;break}i=!0,a=!1,s=void 0,e.prev=5,c=n[Symbol.iterator]();case 7:if(i=(u=c.next()).done){e.next=17;break}return d=u.value,e.next=11,re(d,t._pc);case 11:f=e.sent,$.debug("add transceiver",f,f.mid),o.push(f);case 14:i=!0,e.next=7;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(5),a=!0,s=e.t0;case 23:e.prev=23,e.prev=24,i||null==c.return||c.return();case 26:if(e.prev=26,!a){e.next=29;break}throw s;case 29:return e.finish(26);case 30:return e.finish(23);case 31:e.next=34;break;case 33:r=n.map(function(e){return t._pc.addTrack(e,t._stream)});case 34:return e.abrupt("return",t._pc.createOffer());case 35:case"end":return e.stop()}},e,this,[[5,19,23,31],[24,,26,30]])}))).then(function(e){var r;return r=J.unifiedPlan?{type:"offer",sdp:function(e,t,r){for(var n=Ne.a.parse(e),i=function(e){var i=t[e],o=r[e],a=n.media.find(function(e){return e.mid.toString()===o});if(!a)return"continue";var s=(a.ssrcGroups||[]).find(function(e){return"FID"===e.semantics}),c=a.msid?a.msid.split(" ")[0]:void 0,u=(a.ssrcs||[]).find(function(e){return"msid"===e.attribute}),d=(a.ssrcs||[]).find(function(e){return"cname"===e.attribute}),f=(a.ssrcs||[]).find(function(e){return"label"===e.attribute});if(a.ssrcs=[],a.ssrcGroups=[],c&&(a.msid="".concat(c," ").concat(i.id)),u){var p=u.id,l=u.value.split(" ")[0];a.ssrcs.push({id:p,attribute:"msid",value:"".concat(l," ").concat(i.id)})}if(d&&a.ssrcs.push({id:d.id,attribute:"cname",value:d.value}),f&&a.ssrcs.push({id:f.id,attribute:"label",value:i.id}),s){var h=s.ssrcs.split(/\s+/)[1],v=s.ssrcs.split(/\s+/)[0];if(a.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(v," ").concat(h)}),d&&a.ssrcs.push({id:h,attribute:"cname",value:d.value}),u){var m=u.value.split(" ")[0];a.ssrcs.push({id:h,attribute:"msid",value:"".concat(m," ").concat(i.id)})}a.ssrcs.push({id:h,attribute:"label",value:i.id})}},o=0;o<t.length;o+=1)i(o);return Ne.a.write(n)}(e.sdp,n,o.map(function(e){return e.mid}))}:e,i=r.sdp,$.log("publish: set local offer",r),t._pc.setLocalDescription(r)}).then(function(){if(!t._transportReady)return a=!1,t._setupTransport(e)}).then(function(){return t._remoteSdp.createRemoteAnswer(i)}).then(function(e){var r={type:"answer",sdp:e};return $.debug("addProducer answer",r),t._pc.setRemoteDescription(r)}).then(function(){return t._pcReady}).then(function(){return a?t.safeEmitAsPromise("@needpubtracks",e,i):Promise.resolve(t._remoteSdp.transportRemoteParameters)}).catch(function(e){$.log("add producer error",e);try{var i=!0,a=!1,s=void 0;try{for(var c,u=r[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value;t._pc.removeTrack(d)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}for(var f=0;f<o.length;f++){o[f].direction="inactive"}}catch(e){}var p=!0,l=!1,h=void 0;try{for(var v,m=n[Symbol.iterator]();!(p=(v=m.next()).done);p=!0){var y=v.value;t._stream.removeTrack(y)}}catch(e){l=!0,h=e}finally{try{p||null==m.return||m.return()}finally{if(l)throw h}}throw e instanceof g?e:b(e)})}},{key:"removeProducerTracks",value:function(e){var t=this;$.debug("removeProducerTracks",e);var r,n=e.filter(function(e){return!!e.track}).map(function(e){return e.track.mediaTrack}).filter(function(e){return t._stream.getTrackById(e.id)});return Promise.resolve().then(function(){var e=t._pc.getSenders().filter(function(e){return e.track&&n.includes(e.track)});if(0===e.length)return $.warning("removeProducerTracks [nothing to remove]"),Promise.reject();var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;t._pc.removeTrack(c)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}var u=!0,d=!1,f=void 0;try{for(var p,l=n[Symbol.iterator]();!(u=(p=l.next()).done);u=!0){var h=p.value;t._stream.removeTrack(h)}}catch(e){d=!0,f=e}finally{try{u||null==l.return||l.return()}finally{if(d)throw f}}return t._pc.createOffer()}).then(function(e){var n=new RTCSessionDescription(e);return r=n.sdp,$.log("unpublish: set local offer",n),t._pc.setLocalDescription(n)}).then(function(){var e={type:"answer",sdp:t._remoteSdp.createRemoteAnswer(r)};return $.log("unpublish: set remote answer",e),t._pc.setRemoteDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e instanceof g?e:b(e);$.debug("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){return t.safeEmitAsPromise("@needunpubtracks",e)})}},{key:"restartICE",value:function(e,t){var r=this;return $.log("restart send ice"),this._remoteSdp.updateICE(e,t),this._isRestartingICE=!0,Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return r._pc.setLocalDescription(e)}).then(function(){var e={type:"answer",sdp:r._remoteSdp.createRemoteAnswer(r._pc.localDescription.sdp)};return r._pc.setRemoteDescription(e)})}},{key:"_setupTransport",value:function(e){var t=this;return Promise.resolve().then(function(){return t._pc.localDescription?t._pc.localDescription:t._pc.createOffer()}).then(function(r){return t.safeEmitAsPromise("@needpubpc",r.sdp,e)}).then(function(e){t._remoteSdp.transportRemoteParameters=e,t.pcid=e.pcid,t._transportReady=!0,t._pcReady=t.getReady(e)})}}]),t}(),hr=function(e){function t(e,r,n){var i;return ir(this,t),(i=sr(this,ur(t).call(this,"recv",e,n)))._transportCreated=!1,i._consumerInfos=new Map,i._signaling=r,r.on("on-subpc-state",function(e){i._remoteSdp.transportRemoteParameters&&e.pcid===i._remoteSdp.transportRemoteParameters.pcid&&(e.connected||i.emit("@connectionstatechange","disconnected"))}),$.log("init recvhandler",cr(cr(i))),i}return dr(t,pr),ar(t,[{key:"getReady",value:function(e){var t=this;return new Promise(function(r,n){t._signaling.on("on-subpc-state",function i(o){o.pcid===e.pcid&&(t._signaling.off("on-subpc-state",i),o.connected?(t.isPcReady=!0,r()):n())})})}},{key:"addConsumerTracks",value:function(){var e=nr(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,c,u,d,f,p,l,h,v,m,y,g=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!J.unifiedPlan){e.next=31;break}r=[],n=!0,i=!1,o=void 0,e.prev=5,a=t[Symbol.iterator]();case 7:if(n=(s=a.next()).done){e.next=16;break}return c=s.value,e.next=11,this.addConsumerTrack(c);case 11:u=e.sent,r.push(u);case 13:n=!0,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),i=!0,o=e.t0;case 22:e.prev=22,e.prev=23,n||null==a.return||a.return();case 25:if(e.prev=25,!i){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return e.abrupt("return",r);case 31:for($.log("add consumers",t),d=[],f=Array.from(this._consumerInfos.values()),p=!0,l=!1,h=void 0,e.prev=37,v=function(){var e=y.value,t=f.find(function(t){return t.consumerId===e.id});if(t&&!t.closed)d.push(t);else{var r=g.genNewConsumerInfo(e);if(J.unifiedPlan){var n=f.length.toString();r.mid=n,g._consumerInfos.set(n,r)}else g._consumerInfos.set(e.id,r);d.push(r)}},m=t[Symbol.iterator]();!(p=(y=m.next()).done);p=!0)v();e.next=46;break;case 42:e.prev=42,e.t1=e.catch(37),l=!0,h=e.t1;case 46:e.prev=46,e.prev=47,p||null==m.return||m.return();case 49:if(e.prev=49,!l){e.next=52;break}throw h;case 52:return e.finish(49);case 53:return e.finish(46);case 54:return e.abrupt("return",Promise.resolve().then(function(){var e={type:"offer",sdp:g._remoteSdp.createRemoteOffer(Array.from(g._consumerInfos.values()))};return $.debug("subscribe: set remote offer",e),g._pc.setRemoteDescription(e)}).then(function(){return J.unifiedPlan,g._pc.createAnswer()}).then(function(e){return $.debug("subscribe, set local answer",e),g._pc.setLocalDescription(e)}).then(function(){return g._pcReady}).then(function(){for(var e=function(e){var r=d[e],n=t[e];if(n.track)return"continue";if(J.unifiedPlan){var i=g._pc.getTransceivers().find(function(e){return!!e.receiver.track&&(e.receiver.track.id===r.trackId||e.mid===r.mid)});i&&(n.track=i.receiver.track)}else{var o=g._pc.getReceivers().find(function(e){var t=e.track;return!!t&&r.trackId===t.id});o&&(n.track=o.track)}if(!n.track)throw b("remote track not found");$.log("subscribe: get new track",n.track)},r=0;r<d.length;r+=1)e(r);return t.map(function(e){return e.track})}));case 55:case"end":return e.stop()}},e,this,[[5,18,22,30],[23,,25,29],[37,42,46,54],[47,,49,53]])}));return function(t){return e.apply(this,arguments)}}()},{key:"genNewConsumerInfo",value:function(e){var t=Array.from(this._consumerInfos.values()),r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,i=t.length.toString();return{kind:e.kind,streamId:"mid".concat(i,"-stream-").concat(e.id),trackId:"mid".concat(i,"-").concat(e.kind,"-").concat(r.ssrc),ssrc:r.ssrc,rtxSsrc:r.rtx?r.rtx.ssrc:void 0,cname:n,consumerId:e.id,closed:!1}}},{key:"addConsumerTrack",value:function(){var e=nr(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $.log("add consumer",t),r=null,n=Array.from(this._consumerInfos.values()),(i=n.find(function(e){return e.consumerId===t.id}))&&!i.closed?r=i:(o=this.genNewConsumerInfo(t),J.unifiedPlan?(a=n.length.toString(),o.mid=a,this._consumerInfos.set(a,o)):this._consumerInfos.set(t.id,o),r=o),e.abrupt("return",Promise.resolve().then(function(){var e={type:"offer",sdp:s._remoteSdp.createRemoteOffer(Array.from(s._consumerInfos.values()))};return $.debug("subscribe: set remote offer",e),s._pc.setRemoteDescription(e)}).then(function(){return J.unifiedPlan,s._pc.createAnswer()}).then(function(e){return $.debug("subscribe, set local answer",e),s._pc.setLocalDescription(e)}).then(function(){return s._pcReady}).then(function(){var e=null;if(J.unifiedPlan&&t&&r){var n=s._pc.getTransceivers().find(function(e){return!!e.receiver.track&&((e.receiver.track.id===r.trackId||e.mid===r.mid)&&(t.track=e.receiver.track,!0))});n&&(e=n.receiver.track)}else if(t&&r){var i=s._pc.getReceivers().find(function(e){var n=e.track;return!!n&&(r.trackId===n.id&&(t.track=n,!0))});i&&(e=i.track)}if(!e&&t)throw b("remote track not found");return $.log("subscribe: get new track",e),e}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeConsumerTracks",value:function(e){var t=this;$.log("remove consumer",e);var r=!1,n=!0,i=!1,o=void 0;try{for(var a,s=function(){var e=a.value,n=Array.from(t._consumerInfos.values()).find(function(t){return t.consumerId===e.id&&!t.closed});if(!n)return $.log("can not find unpublish track target, ignore"),"continue";r=!0,J.unifiedPlan?(e.track=null,n.closed=!0):t._consumerInfos.delete(e.id)},c=e[Symbol.iterator]();!(n=(a=c.next()).done);n=!0)s()}catch(e){i=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}return r?Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createRemoteOffer(Array.from(t._consumerInfos.values()))};return $.log("unsubscribe set remote offer",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return $.log("unsubscribe set local answer",e),t._pc.setLocalDescription(e)}):Promise.resolve()}},{key:"restartICE",value:function(e,t){var r=this;return $.log("recv restart ice"),this._remoteSdp.updateICE(e,t),this._isRestartingICE=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:r._remoteSdp.createRemoteOffer(Array.from(r._consumerInfos.values()))};return r._pc.setRemoteDescription(e)}).then(function(){return r._pc.createAnswer()}).then(function(e){r._pc.setLocalDescription(e)})}},{key:"setupTransport",value:function(){var e=nr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._transportCreated){e.next=4;break}return e.next=3,this._pcReady;case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,this.safeEmitAsPromise("@needsubpc",t);case 6:return r=e.sent,this._remoteSdp.transportRemoteParameters=r,this.pcid=r.pcid,this._transportCreated=!0,this._pcReady=this.getReady(r),$.log("init subscribe, get transport remote",r),e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}();function vr(e,t,r,n){switch(e){case"send":return new lr(t,r,n);case"recv":return new hr(t,r,n)}}function mr(e){return(mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gr(e,t){return!t||"object"!==mr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function br(e){return(br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kr(e,t){return(kr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wr,Tr=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=gr(this,br(t).call(this)))._closed=!1,r._busy=!1,r._queue=[],r.name=e||"TaskQueue",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kr(e,t)}(t,i.a),function(e,t,r){t&&yr(e.prototype,t),r&&yr(e,r)}(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this;return $.debug("".concat(this.name," push()"),e,t),new Promise(function(n,i){r._queue.push({method:e,data:t,resolve:n,reject:i}),r._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(e){var t=this;if($.debug("".concat(this.name," _handleCommand() "),e.method,e.data),this._closed)return e.reject(new A("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then(function(){return r.promise}).then(function(r){$.debug("".concat(t.name," _handleCommand() | command succeeded"),e.method),t._closed?e.reject(new A("closed")):e.resolve(r)}).catch(function(r){$.warning("".concat(t.name," _handleCommand() | command failed [method:%s]: %o"),e.method,r),e.reject(r)})}}]),t}();function Sr(e){return(Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _r(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Cr(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){_r(o,n,i,a,s,"next",e)}function s(e){_r(o,n,i,a,s,"throw",e)}a(void 0)})}}function xr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rr(e){return(Rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pr(e,t){return(Pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}!function(e){e.SEND_TRACKS="@transport:send-tracks",e.RESTART_SEND_ICE="@transport:send-restart-ice",e.REMOVE_TRACKS="@transport:remove-tracks",e.INIT_RECV="@transport:init-recv",e.RESTART_RECV_ICE="@transport:recv-restart-ice",e.ADD_CONUMERS="@transport:add-consumers",e.REMOVE_CONSUMERS="@transport:remove-consumers"}(wr||(wr={}));var Or,Ir=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Sr(t)&&"function"!=typeof t?Er(e):t}(this,Rr(t).call(this))).sendCommandQueue=new Tr("SendQueue"),n.recvCommandQueue=new Tr("RecvQueue"),n.recvInitCommandQueue=new Tr("RecvInitQueue"),n.sendTrackQueue=[],n.consumerQueue=[],n._publishTracks=new Map,n.extendedRtpCapabilities=e,n.signaling=r,n.sendHandler=vr("send",e,r,{}),n.recvHandler=vr("recv",e,r,{}),n.handleSendHandler(),n.handleRecvHandler(),n.sendCommandQueue.on("exec",n.handleSendCommandTask.bind(Er(Er(n)))),n.recvCommandQueue.on("exec",n.handleRecvCommandTask.bind(Er(Er(n)))),n.recvInitCommandQueue.on("exec",n.handleRecvInitCommandTask.bind(Er(Er(n)))),n.initSubPcPromise=new Promise(function(e){n.initSubPcPromiseResolve=e}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pr(e,t)}(t,_t),function(e,t,r){t&&xr(e.prototype,t),r&&xr(e,r)}(t,[{key:"resolveInitSubPcPromise",value:function(){this.initSubPcPromiseResolve&&(this.initSubPcPromiseResolve(),this.initSubPcPromiseResolve=void 0)}},{key:"handleSendHandler",value:function(){var e=this;this.sendHandler.on("@needpubpc",function(t,r,n,i){e.safeEmitAsPromise("@needpubpc",t,r).then(n).catch(i)}).on("@connectionstatechange",function(t){switch($.log("pubpc connectionstatechange",t),t){case"closed":case"failed":e.signaling.state===ft.OPEN?e.reconnectProducer():e.sendHandler.close();break;case"disconnected":if(e.sendHandler._isRestartingICE||!e.sendHandler.pcid)return;e.signaling.state===ft.OPEN?e.restartSendICE(e.sendHandler.pcid):e.signaling.once("@signalingauth",function(t){"disconnected"===e.sendHandler.getCurrentIceConnectionState()&&(e.extendedRtpCapabilities=t.rtpcaps,e.restartSendICE(e.sendHandler.pcid))})}}).on("@needpubtracks",function(t,r,n,i){var o=t.map(Ee);e.signaling.request("pub-tracks",{tracks:o,sdp:r}).then(function(t){switch(t.code){case 0:break;case 10052:return i(R());case 10061:return e.reconnectProducer(),i(w(10061,t.error));default:return i(w(t.code,t.error))}var r=!0,o=!1,a=void 0;try{for(var s,c=t.tracks[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){if(!s.value.status)return void i(w(t.code,t.error))}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}n(t)},i)}).on("@needunpubtracks",function(t,r,n){e.signaling.request("unpub-tracks",{tracks:t.map(function(e){return{trackid:e.trackId}})}).then(function(e){r(e)})})}},{key:"sendTracks",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",this.sendCommandQueue.push(wr.SEND_TRACKS,t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeTracks",value:function(e){return 0===e.length?Promise.resolve():this.sendCommandQueue.push(wr.REMOVE_TRACKS,e)}},{key:"restartSendICE",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(J.supportRestartICE){e.next=2;break}return e.abrupt("return",this.reconnectProducer());case 2:return e.abrupt("return",this.sendCommandQueue.push(wr.RESTART_SEND_ICE,t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleSendCommandTask",value:function(e,t){switch(e.method){case wr.SEND_TRACKS:return void(t.promise=this._execAddProducerTracks(e.data));case wr.REMOVE_TRACKS:return void(t.promise=this._execRemoveTracks(e.data));case wr.RESTART_SEND_ICE:return void(t.promise=this._execRestartSendICE(e.data))}}},{key:"addTrackToPublishTracks",value:function(e){var t=this,r=e.map(function(e){return new Nt(t,"send",e)}),n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;this._publishTracks.set(c.track.mediaTrack.id,c)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}},{key:"removeTrackFromPublishTracks",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._publishTracks.delete(a.mediaTrack.id)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"_execAddProducerTracks",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendHandler.addProducerTracks(t.map(function(e){return e.track}));case 2:for(r=e.sent,n=!0,i=!1,o=void 0,e.prev=6,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)c=s.value,(u=$e(r.tracks,"localid",c.track.mediaTrack.id))&&(c.addTrackId(u.trackid),c.track.setInfo({versionid:u.versionid}));e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),i=!0,o=e.t0;case 14:e.prev=14,e.prev=15,n||null==a.return||a.return();case 17:if(e.prev=17,!i){e.next=20;break}throw o;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return t.map(function(e){return e.connectStatus=se.Connect}),e.abrupt("return",r);case 24:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_execRemoveTracks",value:function(e){return this.removeTrackFromPublishTracks(e.map(function(e){return e.track})),e.map(function(e){return e.release()}),this.sendHandler.removeProducerTracks(e)}},{key:"_execRestartSendICE",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.sendHandler._isRestartingICE=!0,e.next=3,this.signaling.request("pubpc-restart",{pcid:t});case 3:if(0===(r=e.sent).code){e.next=9;break}return this.sendHandler._isRestartingICE=!1,$.debug("restart ice faild",r.code,r.error),this.reconnectProducer(),e.abrupt("return");case 9:return e.prev=9,e.next=12,this.sendHandler.restartICE(r.iceParameters,r.iceCandidate);case 12:this.sendHandler._isRestartingICE=!1,e.next=20;break;case 15:e.prev=15,e.t0=e.catch(9),$.debug("restart ice faild",r.code,r.error),this.sendHandler._isRestartingICE=!1,this.reconnectProducer();case 20:case"end":return e.stop()}},e,this,[[9,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"reconnectProducer",value:function(){var e=Cr(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.resetSendCommandQueue(),this.sendHandler.close(),t=this.publishTracks,this.sendHandler=vr("send",this.extendedRtpCapabilities,this.signaling,{}),this.handleSendHandler(),t.forEach(function(e){e.connectStatus=se.Connecting}),e.prev=6,e.next=9,this.sendTracks(t);case 9:e.next=20;break;case 11:if(e.prev=11,e.t0=e.catch(6),10052!==e.t0.code){e.next=19;break}return e.next=16,et(1e3);case 16:return e.next=18,this.reconnectProducer();case 18:return e.abrupt("return",e.sent);case 19:throw e.t0;case 20:case"end":return e.stop()}},e,this,[[6,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"handleRecvHandler",value:function(){var e=this;this.recvHandler.on("@needsubpc",function(t,r,n){e.safeEmitAsPromise("@needsubpc",t).then(r,n)}).on("@connectionstatechange",function(t){switch($.log("sub pc connection state change",t),t){case"closed":case"failed":e.signaling.state===ft.OPEN?e.resetRecvHandler():e.recvHandler.close();break;case"disconnected":if(e.recvHandler._isRestartingICE||!e.recvHandler.pcid)return;e.signaling.state===ft.OPEN?e.restartRecvICE(e.recvHandler.pcid):e.signaling.once("@signalingauth",function(t){"disconnected"===e.recvHandler.getCurrentIceConnectionState()&&(e.extendedRtpCapabilities=t.rtpcaps,e.restartRecvICE(e.recvHandler.pcid))})}})}},{key:"appendConsumer",value:function(e){this.consumerQueue.push(e)}},{key:"addConsumers",value:function(){var e=Cr(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.consumerQueue,this.consumerQueue=[],e.abrupt("return",this.recvCommandQueue.push(wr.ADD_CONUMERS,t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initRecvHandler",value:function(e){return this.recvInitCommandQueue.push(wr.INIT_RECV,e)}},{key:"removeConsumers",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.recvCommandQueue.push(wr.REMOVE_CONSUMERS,t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartRecvICE",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(J.supportRestartICE){e.next=2;break}return e.abrupt("return",this.resetRecvHandler());case 2:return e.abrupt("return",this.recvCommandQueue.push(wr.RESTART_RECV_ICE,t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_removeConsumers",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.recvHandler.removeConsumerTracks(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_initRecvHandler",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvHandler.isPcReady){e.next=4;break}return e.next=3,this.recvHandler.setupTransport(t);case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,this.initSubPcPromise;case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_addConsumers",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",Promise.resolve([]));case 2:return e.next=4,this.recvHandler.addConsumerTracks(t);case 4:for(r=e.sent,n=function(e){var n=r[e],i=t[e];n.onended=function(){$.warning("track end",n,i)}},i=0;i<r.length;i+=1)n(i);return e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_execRestartRecvICE",value:function(){var e=Cr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.recvHandler._isRestartingICE=!0,e.next=3,this.signaling.request("subpc-restart",{pcid:t});case 3:if(0===(r=e.sent).code){e.next=9;break}return this.recvHandler._isRestartingICE=!1,$.debug("restart ice faild",r.code,r.error),this.resetRecvHandler(),e.abrupt("return");case 9:return e.prev=9,e.next=12,this.recvHandler.restartICE(r.iceParameters,r.iceCandidate);case 12:this.recvHandler._isRestartingICE=!1,e.next=20;break;case 15:e.prev=15,e.t0=e.catch(9),this.recvHandler._isRestartingICE=!1,$.debug("restart ice faild",r.code,r.error),this.resetRecvHandler();case 20:case"end":return e.stop()}},e,this,[[9,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"handleRecvCommandTask",value:function(e,t){switch(e.method){case wr.ADD_CONUMERS:return void(t.promise=this._addConsumers(e.data));case wr.REMOVE_CONSUMERS:return void(t.promise=this._removeConsumers(e.data));case wr.RESTART_RECV_ICE:return void(t.promise=this._execRestartRecvICE(e.data))}}},{key:"handleRecvInitCommandTask",value:function(e,t){switch(e.method){case wr.INIT_RECV:return void(t.promise=this._initRecvHandler(e.data))}}},{key:"resetSendCommandQueue",value:function(){$.log("reset send queue"),this.sendCommandQueue=new Tr("SendQueue"),this.sendCommandQueue.on("exec",this.handleSendCommandTask.bind(this))}},{key:"resetRecvCommandQueue",value:function(){$.log("reset recv queue"),this.recvCommandQueue=new Tr("RecvQueue"),this.recvInitCommandQueue=new Tr("RecvInitQueue"),this.recvCommandQueue.on("exec",this.handleRecvCommandTask.bind(this)),this.recvInitCommandQueue.on("exec",this.handleRecvInitCommandTask.bind(this))}},{key:"resetRecvHandler",value:function(){var e=this;this.resetRecvCommandQueue(),this.recvHandler.close(),this.recvHandler=vr("recv",this.extendedRtpCapabilities,this.signaling,{}),this.initSubPcPromise=new Promise(function(t){e.initSubPcPromiseResolve=t}),this.handleRecvHandler(),this.emit("@needresub")}},{key:"release",value:function(){this.recvHandler.close(),this.sendHandler.close(),this.publishTracks.forEach(function(e){return e.release()})}},{key:"publishTracks",get:function(){return Array.from(this._publishTracks.values())}}]),t}();function jr(e){return(jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Ar(e,t,r[t])})}return e}function Ar(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lr(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Dr(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Lr(o,n,i,a,s,"next",e)}function s(e){Lr(o,n,i,a,s,"throw",e)}a(void 0)})}}function Nr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fr(e,t){return!t||"object"!==jr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Br(e){return(Br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ur(e,t){return(Ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e[e.Idle=0]="Idle",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.Reconnecting=3]="Reconnecting"}(Or||(Or={}));var Gr=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Fr(this,Br(t).call(this)))._trackInfo=[],e.subscribeTracks=[],e._users=new Map,e._roomState=Or.Idle,e.mergeJobMerger={},e.defaultMergeJobTracks=[],e.mergeJobTracks={},e._publish=function(t,r){return new Promise(function(){var n=Dr(regeneratorRuntime.mark(function n(i,o){var a,s,c,u,d,f,p;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.roomState===Or.Connected){n.next=3;break}return o(b("not connected to the room, please run joinRoom first")),n.abrupt("return");case 3:if(0===t.length&&i(),t.forEach(function(t){return t.userId=e.userId}),a=e.connectionTransport,s=e.signaling,!r){n.next=12;break}u=t.map(function(e){return e.mediaTrack.id}),c=a.publishTracks.filter(function(e){return-1!==u.indexOf(e.track.mediaTrack.id)}),n.next=18;break;case 12:if(d=a.publishTracks.map(function(e){return e.track.mediaTrack.id}),t.filter(function(e){return-1===d.indexOf(e.mediaTrack.id)}).length===t.length){n.next=17;break}return o(b("there are already published tracks in the provided tracks")),n.abrupt("return");case 17:c=a.addTrackToPublishTracks(t);case 18:return $.debug("start publish",c,r),r||(f=c.map(function(e){return e.startConnect()}),Promise.all(f).then(function(){return i()}).catch(function(){o(j())})),n.prev=20,n.next=23,a.sendTracks(c);case 23:s.sendWsMsg("mute-tracks",{tracks:c.map(function(e){return{trackid:e.trackId,muted:!!e.track.info.muted}})}),(p=$e(e.users,"userId",e.userId))&&(p.addTracks(c.map(function(e){return e.track})),p.addPublishedTrackInfo(c.map(function(t){return{trackId:t.trackId,muted:!!t.track.info.muted,kind:t.track.info.kind,tag:t.track.info.tag,userId:e.userId,versionid:t.track.info.versionid}}))),t.forEach(function(t){t.on("@get-stats",function(r,n,i){if(!e.connectionTransport)return n(Q);e.connectionTransport.sendHandler.getStats(t.mediaTrack,r).then(n,i)})}),e.getAllMerger().forEach(function(e){return e.controller.onAddTracks(t.map(function(e){return e.info}))}),n.next=45;break;case 30:if(n.prev=30,n.t0=n.catch(20),!(n.t0 instanceof g)){n.next=43;break}n.t1=n.t0.code,n.next=10061===n.t1?36:30001===n.t1?36:10052===n.t1?37:39;break;case 36:return n.abrupt("return");case 37:$.warning(n.t0,"republish"),setTimeout(function(){return e._publish(t,!0)},1e3);case 39:a.removeTrackFromPublishTracks(t),o(n.t0);case 41:n.next=45;break;case 43:$.warning(n.t0,"republish"),setTimeout(function(){return e._publish(t,!0)},1e3);case 45:case"end":return n.stop()}},n,this,[[20,30]])}));return function(e,t){return n.apply(this,arguments)}}())},e._subscribe=function(t,r){return new Promise(function(){var n=Dr(regeneratorRuntime.mark(function n(i,o){var a,s,u,d,f,p,l,h,v,m,y,k,w,T,S,C,x,P,E,O,I,M,A,L,D,N;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.roomState===Or.Connected){n.next=3;break}return o(b("can not connected to the room, please joinRoom first")),n.abrupt("return");case 3:if(0!==t.length){n.next=6;break}return i([]),n.abrupt("return");case 6:if($.debug("subscribe",t,r),(a=e._trackInfo.filter(function(e){return t.includes(e.trackid)})).length===t.length){n.next=11;break}return o(_(10041,"can not find track in room ".concat(t))),n.abrupt("return");case 11:return u=e.connectionTransport,d=e.signaling,r?s=e.subscribeTracks.filter(function(e){return-1!==t.indexOf(e.trackId)}):(f=e.subscribeTracks.map(function(e){return e.trackId}),p=a.filter(function(e){return!f.includes(e.trackid)}),s=p.map(function(e){return new Nt(u,"recv",void 0,e.trackid)}),e.subscribeTracks=e.subscribeTracks.concat(s)),$.log("sub tracks",s),n.prev=15,r||(l=s.map(function(e){return e.startConnect()}),Promise.all(l).then(function(){return i(s.map(function(e){return e.track}))}).catch(function(){o(j())})),n.next=19,u.initRecvHandler(s.map(function(e){return e.trackId}));case 19:if(h=n.sent){n.next=24;break}return n.next=23,d.request("sub-tracks",{tracks:s.map(function(e){return{trackid:e.trackId}})});case 23:h=n.sent;case 24:$.log("get sub res data",h),n.t0=h.code,n.next=0===n.t0?28:10052===n.t0?29:10062===n.t0?30:32;break;case 28:return n.abrupt("break",33);case 29:throw R();case 30:throw u.resetRecvHandler(),_(10062,h.error);case 32:throw _(h.code,h.error);case 33:v=!0,m=!1,y=void 0,n.prev=36,k=(h.tracks||[])[Symbol.iterator]();case 38:if(v=(w=k.next()).done){n.next=45;break}if(w.value.status){n.next=42;break}throw _(h.code,h.error);case 42:v=!0,n.next=38;break;case 45:n.next=51;break;case 47:n.prev=47,n.t1=n.catch(36),m=!0,y=n.t1;case 51:n.prev=51,n.prev=52,v||null==k.return||k.return();case 54:if(n.prev=54,!m){n.next=57;break}throw y;case 57:return n.finish(54);case 58:return n.finish(51);case 59:T=!0,S=!1,C=void 0,n.prev=62,x=function(){var e=E.value,t=s.find(function(t){return t.trackId===e.trackid}),r=a.find(function(t){return t.trackid===e.trackid});if(!t||!r)return"continue";var n=e.rtpparams;t.appendConsumner(n,r.kind)},P=(h.tracks||[])[Symbol.iterator]();case 65:if(T=(E=P.next()).done){n.next=72;break}if("continue"!==x()){n.next=69;break}return n.abrupt("continue",69);case 69:T=!0,n.next=65;break;case 72:n.next=78;break;case 74:n.prev=74,n.t2=n.catch(62),S=!0,C=n.t2;case 78:n.prev=78,n.prev=79,T||null==P.return||P.return();case 81:if(n.prev=81,!S){n.next=84;break}throw C;case 84:return n.finish(81);case 85:return n.finish(78);case 86:return n.next=88,u.addConsumers();case 88:u.resolveInitSubPcPromise(),O=!0,I=!1,M=void 0,n.prev=92,A=regeneratorRuntime.mark(function t(){var r,n,i,o,s,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=D.value,(n=r.consumer)&&n.track){t.next=4;break}return t.abrupt("return","continue");case 4:if(i=n.track,o=r.track,s=a.find(function(e){return e.trackid===n.id})){t.next=9;break}return t.abrupt("return","continue");case 9:if(o){t.next=19;break}if("audio"!==i.kind){t.next=16;break}return o=new Xt(i,s.playerid),t.next=14,o.initAudioManager();case 14:t.next=17;break;case 16:o=new At(i,s.playerid);case 17:t.next=20;break;case 19:o.resume(i);case 20:o.setInfo({trackId:s.trackid,userId:s.playerid,tag:s.tag,kind:s.kind,muted:s.muted,versionid:s.versionid}),o.setMaster(s.master),o.on("@get-stats",function(t,r,n){if(!e.connectionTransport)return r(Q);e.connectionTransport.recvHandler.getStats(o.mediaTrack,t).then(r,n)}),r.track=o,(c=e.users.find(function(e){return e.userId===s.playerid}))&&c.addTracks([o]);case 26:case"end":return t.stop()}},t,this)}),L=s[Symbol.iterator]();case 95:if(O=(D=L.next()).done){n.next=103;break}return n.delegateYield(A(),"t3",97);case 97:if("continue"!==n.t3){n.next=100;break}return n.abrupt("continue",100);case 100:O=!0,n.next=95;break;case 103:n.next=109;break;case 105:n.prev=105,n.t4=n.catch(92),I=!0,M=n.t4;case 109:n.prev=109,n.prev=110,O||null==L.return||L.return();case 112:if(n.prev=112,!I){n.next=115;break}throw M;case 115:return n.finish(112);case 116:return n.finish(109);case 117:s.forEach(function(e){return e.connectStatus=se.Connect}),n.next=142;break;case 120:return n.prev=120,n.t5=n.catch(15),$.log(n.t5),N=[],s.forEach(function(e){e.consumer&&N.push(e.consumer)}),n.next=127,u.removeConsumers(N);case 127:if(!(n.t5 instanceof g)){n.next=139;break}n.t6=n.t5.code,n.next=10062===n.t6?131:30001===n.t6?131:10052===n.t6?132:135;break;case 131:return n.abrupt("return");case 132:return $.warning(n.t5,"resubscribe"),setTimeout(function(){return e._subscribe(t,!0)},1e3),n.abrupt("return");case 135:c()(e.subscribeTracks,function(e){return-1!==t.indexOf(e.trackId)}),o(n.t5);case 137:n.next=142;break;case 139:return $.warning(n.t5,"resubscribe"),setTimeout(function(){return e._subscribe(t,!0)},1e3),n.abrupt("return");case 142:i(s.map(function(e){return e.track}));case 143:case"end":return n.stop()}},n,this,[[15,120],[36,47,51,59],[52,,54,58],[62,74,78,86],[79,,81,85],[92,105,109,117],[110,,112,116]])}));return function(e,t){return n.apply(this,arguments)}}())},$.log("version",tt),$.log("browser report",J,V),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ur(e,t)}(t,i.a),function(e,t,r){t&&Nr(e.prototype,t),r&&Nr(e,r)}(t,[{key:"joinRoomWithToken",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.roomState===Or.Reconnecting){e.next=4;break}if(this.roomState===Or.Idle){e.next=3;break}throw b("roomState is not idle! Do not repeat join room, please run leaveRoom first");case 3:this.roomState=Or.Connecting;case 4:if(e.prev=4,this.roomToken=t,r=ze(t),this.userId=r.userId,this.roomName=r.roomName,this.appId=r.appId,$.log("join room, token:",t),$.debug("join room, roomName: ".concat(this.roomName,", userId: ").concat(this.userId)),this.roomName.match(/^[a-zA-Z0-9_-]{3,64}$/)){e.next=15;break}throw this.roomState=Or.Idle,b("invalid roomname. roomname must match /^[a-zA-Z0-9_-]{3,64}$/");case 15:if(this.userId.match(/^[a-zA-Z0-9_-]{3,50}$/)){e.next=18;break}throw this.roomState=Or.Idle,b("invalid userId. userId must match /^[a-zA-Z0-9_-]{3,50}$/");case 18:return e.prev=18,e.next=21,it(r,t);case 21:this.accessToken=e.sent,e.next=27;break;case 24:throw e.prev=24,e.t0=e.catch(18),e.t0;case 27:return e.next=29,this.joinRoomWithAccess(this.accessToken);case 29:return e.abrupt("return",e.sent);case 32:throw e.prev=32,e.t1=e.catch(4),this.roomState=Or.Idle,e.t1;case 36:case"end":return e.stop()}},e,this,[[4,32],[18,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"joinRoomWithAccess",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Je(t),e.next=3,We();case 3:return n=e.sent,i=n.capsdp,(o=new lt(r.signalingurl2,t,i)).on("@error",this.handleDisconnect.bind(this)).on("@ws-state-change",function(e,t){switch(t){case ft.CONNECTING:s.roomState===Or.Connected?s.roomState=Or.Reconnecting:s.roomState!==Or.Reconnecting&&(s.roomState=Or.Connecting)}}).on("on-player-in",this.handlePlayerIn.bind(this)).on("on-player-out",this.handlePlayerOut.bind(this)).on("on-add-tracks",function(e){s.filterSignalTracks(e),s.handleAddTracks(e)}).on("on-remove-tracks",function(e){s.filterSignalTracks(e),s.handleRemoveTracks(e)}).on("mute-tracks",function(e){s.filterSignalTracks(e),s.handleMute(e)}).on("on-pubpc-restart-notify",function(e){var t=s.connectionTransport;t&&J.supportRestartICE&&t.restartSendICE(e.pcid).catch($.debug)}).on("on-subpc-restart-notify",function(e){var t=s.connectionTransport;t&&J.supportRestartICE&&t.restartRecvICE(e.pcid).catch($.debug)}).on("disconnect",this.handleDisconnect.bind(this)),$.log("init signaling websocket"),this.signaling=o,e.prev=9,e.next=12,o.initWs(!0);case 12:return a=e.sent,o.on("@signalingauth",this.handleAuth.bind(this)),e.next=16,this.handleAuth(a);case 16:e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.signaling&&(this.signaling.release(),this.signaling=void 0),10052!==e.t0.code){e.next=25;break}return e.next=24,et(1e3);case 24:return e.abrupt("return",this.joinRoomWithToken(this.roomToken));case 25:throw e.t0;case 26:return e.abrupt("return",this.users);case 27:case"end":return e.stop()}},e,this,[[9,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_unpublish",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.roomState===Or.Connected){e.next=2;break}throw b("not connected to the room");case 2:if(0!==t.length){e.next=4;break}return e.abrupt("return");case 4:if($.debug("unpublish",t),r=this.connectionTransport,(n=r.publishTracks.filter(function(e){return-1!==t.indexOf(e.trackId)})).length===t.length){e.next=9;break}throw b("can not find target trackid to unpublish");case 9:return e.next=11,r.removeTracks(n);case 11:this.getAllMerger().forEach(function(e){return e.controller.onRemoveTracks(n.map(function(e){return e.track.info}))}),(i=$e(this.users,"userId",this.userId))&&(i.removeTracksByTrackId(t),i.removePublishedTrackInfo(t)),this.cleanTrackIdsFromMergeJobs(t);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createMergeJob",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t,r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.roomState===Or.Connected){e.next=2;break}throw b("can not createMergeJob, room state is not connected");case 2:return n=Mr({},fe,r,{id:t}),$.debug("send create merge job",n,t),this.signaling.mergeJobIndex+=1,e.next=7,qe(this.signaling,"create-merge-job",n,"create-merge-job-res-".concat(this.signaling.mergeJobIndex));case 7:if(0===(i=e.sent).code){e.next=10;break}throw T(i.code,i.error);case 10:this.mergeJobTracks[t]?$.warning("merge job id already exist",t):this.mergeJobTracks[t]=[];case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setDefaultMergeStream",value:function(e,t,r){if(r&&!this.mergeJobTracks[r])throw O(r);this.merger&&!r&&(this.merger.release(),this.merger=void 0),r&&this.mergeJobMerger[r]&&(this.mergeJobMerger[r].release(),delete this.mergeJobMerger[r]);var n=this.CreateMergerSessionController();r?this.mergeJobMerger[r]=new mt(e,t,n,r):this.merger=new mt(e,t,n,r)}},{key:"_stopMerge",value:function(e){if(this.roomState!==Or.Connected)throw b("can not addMergeTracks, room state is not connected");if(e&&!this.mergeJobTracks[e])throw O(e);this.signaling.sendWsMsg("stop-merge",{id:e}),e?(delete this.mergeJobTracks[e],this.mergeJobMerger[e]&&(this.mergeJobMerger[e].release(),delete this.mergeJobMerger[e])):(this.defaultMergeJobTracks=[],this.merger&&(this.merger.release(),this.merger=void 0))}},{key:"_addMergeTracks",value:function(e,t){if(this.roomState!==Or.Connected)throw b("can not addMergeTracks, room state is not connected");if(t&&!this.mergeJobTracks[t])throw O(t);var r=e.map(function(e){return{trackid:e.trackId,x:e.x,y:e.y,w:e.w,h:e.h,z:e.z}});this.signaling.sendWsMsg("update-merge-tracks",{id:t,add:r}),t?(this.mergeJobTracks[t]=this.mergeJobTracks[t].concat(e.map(function(e){return e.trackId})),this.mergeJobTracks[t]=a()(this.mergeJobTracks[t],function(e){return e})):(this.defaultMergeJobTracks=this.defaultMergeJobTracks.concat(e.map(function(e){return e.trackId})),this.defaultMergeJobTracks=a()(this.defaultMergeJobTracks,function(e){return e}))}},{key:"_removeMergeTracks",value:function(e,t){if(this.roomState!==Or.Connected)throw b("can not addMergeTracks, room state is not connected");if(t&&!this.mergeJobTracks[t])throw O(t);this.signaling.sendWsMsg("update-merge-tracks",{id:t,remove:e.map(function(e){return{trackid:e}})}),t?c()(this.mergeJobTracks[t],function(t){return-1!==e.indexOf(t)}):c()(this.defaultMergeJobTracks,function(t){return-1!==e.indexOf(t)})}},{key:"_unsubscribe",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.roomState===Or.Connected){e.next=2;break}throw b("no signaling model, please run joinRoomWithToken first");case 2:if(r=this.subscribeTracks.filter(function(e){return-1!==t.indexOf(e.trackId)}),$.debug("unsubscribe",r),0!==r.length){e.next=6;break}return e.abrupt("return");case 6:return this.signaling.request("unsub-tracks",{tracks:r.map(function(e){return{trackid:e.trackId}})}),r.forEach(function(e){return e.release()}),c()(this.subscribeTracks,function(e){return-1!==t.indexOf(e.trackId)}),e.next=11,this.connectionTransport.removeConsumers(r.map(function(e){return e.consumer}));case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_muteTracks",value:function(e){if(this.roomState!==Or.Connected)throw b("no signaling model, please run joinRoomWithToken first");var t=this.connectionTransport,r={};e.forEach(function(e){r[e.trackId]=e.muted}),t.publishTracks.filter(function(e){return void 0!==r[e.trackId]}).forEach(function(e){e.setMute(r[e.trackId])}),this.signaling.sendWsMsg("mute-tracks",{tracks:e.map(function(e){return{trackid:e.trackId,muted:e.muted}})})}},{key:"kickoutUser",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $.log("kickoutUser",t),e.next=3,this.control("kickplayer",t);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"leaveRoom",value:function(){$.log("leave room"),this.signaling&&this.signaling.sendWsMsg("disconnect",{}),this.releaseRoom()}},{key:"_releasePublishTracks",value:function(){}},{key:"control",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.roomState===Or.Connected){e.next=2;break}throw b("can not connected to the room, please run joinRoom first");case 2:return e.next=4,this.signaling.request("control",{command:t,playerid:r});case 4:if(!(n=e.sent).error){e.next=7;break}throw C(n.code,n.error);case 7:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"handlePlayerOut",value:function(e){var t=this,r=this._users.get(e.playerid);r&&(this._users.delete(e.playerid),c()(this._trackInfo,function(t){return t.playerid===e.playerid}),c()(this.subscribeTracks,function(e){return e.track.userId===r.userId}).forEach(function(e){return e.release()}),Ke(function(){$.debug("user-leave",r),t.emit("user-leave",r)}))}},{key:"handlePlayerIn",value:function(e){var t=this,r=Oe(e);this._users.set(r.userId,r),Ke(function(){$.debug("user-join",r),t.emit("user-join",r)})}},{key:"handleAddTracks",value:function(e){var t=this,r=e.tracks;$.log("receive track-add",r,Mr({},this._trackInfo));var n=new Set,i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,d=$e(this.users,"userId",u.playerid);if(d)if(d.published&&!n.has(d.userId)&&"stream"===this.sessionMode){var f=d.publishedTrackInfo.map(function(e){return Pe(e,!0)});this.handleRemoveTracks({tracks:f}),f.push(u),this.handleAddTracks({tracks:f})}else this._trackInfo.push(u),d.addPublishedTrackInfo([Re(u)]),n.add(d.userId)}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}if("stream"===this.sessionMode)for(var p=Array.from(n),l=function(){var e=p[h];Ke(function(){$.debug("user-publish",t._users.get(e)),t.emit("user-publish",t._users.get(e))})},h=0;h<p.length;h++)l();Ke(function(){$.debug("track-add",r.map(Re)),t.emit("track-add",r.map(Re))})}},{key:"handleRemoveTracks",value:function(e){var t=this,r=e.tracks;$.log("receive track-remove",r,Mr({},this._trackInfo));var n=c()(this._trackInfo,function(e){return r.map(function(e){return e.trackid}).includes(e.trackid)}),i=new Set,o=!0,a=!1,s=void 0;try{for(var u,d=function(){var e=u.value,r=t._users.get(e.playerid);if(!r)return"continue";r.removePublishedTrackInfo([e.trackid]),r.removeTracksByTrackId([e.trackid]),i.add(r.userId);var n=c()(t.subscribeTracks,function(t){return t.trackId===e.trackid})[0];n&&n.release()},f=n[Symbol.iterator]();!(o=(u=f.next()).done);o=!0)d()}catch(e){a=!0,s=e}finally{try{o||null==f.return||f.return()}finally{if(a)throw s}}if(this.cleanTrackIdsFromMergeJobs(r.map(function(e){return e.trackid})),"stream"===this.sessionMode)for(var p=Array.from(i),l=function(){var e=p[h],r=t._users.get(e);if(r.published){var n=r.publishedTrackInfo.map(function(e){return Pe(e,!0)});t.handleRemoveTracks({tracks:n}),t.handleAddTracks({tracks:n})}else Ke(function(){$.debug("user-unpublish",r),t.emit("user-unpublish",r)})},h=0;h<p.length;h++)l();Ke(function(){$.debug("track-remove",n.map(Re)),t.emit("track-remove",n.map(Re))})}},{key:"handleMute",value:function(e){var t=this,r=e.tracks,n=!0,i=!1,o=void 0;try{for(var a,s=function(){var e=a.value,r=e.trackid,n=e.muted,i=$e(t._trackInfo,"trackid",r);if(!i)return{v:void 0};var o=t._users.get(i.playerid);if(!o)return{v:void 0};var s=o.publishedTrackInfo.find(function(e){return e.trackId===r});s&&(s.muted=n);var c=o.tracks.find(function(e){return e.info.trackId===r});c&&(c.info.muted=n,c.setMute(n)),i.muted=n;var u=t.subscribeTracks.filter(function(e){return e.trackId===r})[0];u&&u.setMute(n);for(var d=void 0,f=0;f<t._trackInfo.length;f+=1)t._trackInfo[f].playerid===i.playerid&&t._trackInfo[f].kind!==i.kind&&(d=t._trackInfo[f]);var p={userId:i.playerid,muteAudio:!1,muteVideo:!1};"audio"===i.kind?(p.muteAudio=n,p.muteVideo=!!d&&d.muted):(p.muteVideo=n,p.muteAudio=!!d&&d.muted),"stream"===t.sessionMode&&Ke(function(){$.log("user-mute",p),t.emit("user-mute",p)})},c=r[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var u=s();if("object"===jr(u))return u.v}}catch(e){i=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}Ke(function(){$.log("mute-tracks",r.map(function(e){return{trackId:e.trackid,muted:e.muted}})),t.emit("mute-tracks",r.map(function(e){return{trackId:e.trackid,muted:e.muted}}))})}},{key:"handleDisconnect",value:function(e){var t=this;if($.log("handle disconnect",e),10052===e.code&&this.roomToken)return this.roomState=Or.Reconnecting,void setTimeout(function(){return t.signaling.initWs()},1e3);switch(this.releaseRoom(),e.code){case 10006:this.emit("disconnect",{code:e.code,data:{userId:e.kickedid}});break;default:this.emit("disconnect",{code:e.code})}}},{key:"handleAuth",value:function(){var e=Dr(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,c,u,d,f,p,l,h=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.filterSignalTracks(t),$.debug("handleAuth",t),!t.error){e.next=6;break}return e.next=5,this.joinRoomWithToken(this.roomToken);case 5:return e.abrupt("return");case 6:if(t.tracks=t.tracks||[],t.tracks=t.tracks.filter(function(e){return e.playerid!==h.userId}),t.players=t.players||[],r=this.roomState===Or.Reconnecting,n={join:[],leave:[],add:[],remove:[],mute:[]},i=Array.from(this._users.keys()),o=t.players.map(function(e){return e.playerid}),n=Xe(this.userId,this._trackInfo,t.tracks,i,o),this.roomState=Or.Connected,r){e.next=40;break}for(this._trackInfo=t.tracks,this._users.clear(),a=!0,s=!1,c=void 0,e.prev=21,u=function(){var e=Oe(f.value),t=h._trackInfo.filter(function(t){return t.playerid===e.userId});e.addPublishedTrackInfo(t.map(Re)),h._users.set(e.userId,e)},d=(t.players||[])[Symbol.iterator]();!(a=(f=d.next()).done);a=!0)u();e.next=30;break;case 26:e.prev=26,e.t0=e.catch(21),s=!0,c=e.t0;case 30:e.prev=30,e.prev=31,a||null==d.return||d.return();case 33:if(e.prev=33,!s){e.next=36;break}throw c;case 36:return e.finish(33);case 37:return e.finish(30);case 38:e.next=46;break;case 40:$.debug("get missing events",n),n.remove.length>0&&this.handleRemoveTracks({tracks:n.remove}),n.leave.length>0&&n.leave.forEach(this.handlePlayerOut.bind(this)),n.join.length>0&&n.join.forEach(this.handlePlayerIn.bind(this)),n.add.length>0&&this.handleAddTracks({tracks:n.add}),n.mute.length>0&&this.handleMute({tracks:n.mute});case 46:this.connectionTransport?(this.connectionTransport.extendedRtpCapabilities=t.rtpcaps,!this.connectionTransport.sendHandler.isPcReady||this.connectionTransport.sendHandler._isRestartingICE?this.connectionTransport.reconnectProducer():0!==(p=this.connectionTransport.publishTracks.filter(function(e){return e.connectStatus===se.Connecting}).map(function(e){return e.track})).length&&this._publish(p,!0),!this.connectionTransport.recvHandler.isPcReady||this.connectionTransport.recvHandler._isRestartingICE?this.connectionTransport.resetRecvHandler():0!==(l=this.subscribeTracks.filter(function(e){return e.connectStatus===se.Connecting}).map(function(e){return e.trackId})).length&&this._subscribe(l,!0)):this.connectionTransport=this.createConnectionTransport(t.rtpcaps);case 47:case"end":return e.stop()}},e,this,[[21,26,30,38],[31,,33,37]])}));return function(t){return e.apply(this,arguments)}}()},{key:"createConnectionTransport",value:function(e){var t=this,r=this.signaling,n=new Ir(e,r);return n.on("@needpubpc",function(e,t,n,i){r.request("pubpc",{sdp:e,tracks:t.map(Ee)}).then(function(e){switch(e.code){case 0:return void n(e);case 10052:throw R();default:throw function(e){return new g(11006,"publish faild, can not create p2p connection, ".concat(e))}(e.error)}}).catch(i)}),n.on("@needsubpc",function(e,t,n){r.request("subpc",{tracks:e.map(function(e){return{trackid:e}})}).then(function(e){switch(e.code){case 0:return void t(e);case 10052:throw R();default:throw function(e){return new g(11005,"subscribe faild, can not create p2p connection, ".concat(e))}(e.error)}}).catch(n)}).on("@needresub",function(){var e=t.subscribeTracks.map(function(e){return e.trackId});t.subscribeTracks.forEach(function(e){return e.connectStatus=se.Connecting}),t._subscribe(e,!0)}),n}},{key:"cleanTrackIdsFromMergeJobs",value:function(e){for(var t in c()(this.defaultMergeJobTracks,function(t){return-1!==e.indexOf(t)}),this.mergeJobTracks)c()(t,function(t){return-1!==e.indexOf(t)})}},{key:"CreateMergerSessionController",value:function(){var e=this,t=new function e(){vt(this,e)},r=function(e){t.onAddTracks(e)},n=function(e){t.onRemoveTracks(e)};return this.on("track-add",r),this.on("track-remove",n),t.getCurrentTracks=function(){if(!e.connectionTransport)return[];var t=e._trackInfo.map(Re),r=e.connectionTransport.publishTracks.map(function(e){return e.track.info});return t.concat(r)},t.addMergeTrack=function(t,r){e._addMergeTracks(t,r)},t.release=function(){e.off("track-add",r),e.off("track-remove",n)},t}},{key:"getAllMerger",value:function(){var e=[];for(var t in this.merger&&e.push(this.merger),this.mergeJobMerger)e.push(this.mergeJobMerger[t]);return e}},{key:"releaseRoom",value:function(){this.releaseSession(),this.signaling&&(this.signaling.release(),this.signaling=void 0),this.connectionTransport&&(this.connectionTransport.release(),this.connectionTransport=void 0),this.getAllMerger().map(function(e){e.release()}),this.defaultMergeJobTracks=[],this.mergeJobTracks={},this.merger=void 0,this.mergeJobMerger={},this.roomState=Or.Idle,this._trackInfo=[],this._users.clear(),this.userId=void 0,this.subscribeTracks.forEach(function(e){e.release()}),this.subscribeTracks=[]}},{key:"users",get:function(){return Array.from(this._users.values())}},{key:"trackInfoList",get:function(){return this._trackInfo.map(Re)}},{key:"roomState",get:function(){return this._roomState},set:function(e){this._roomState!==e&&(this._roomState=e,$.debug("roomState change",this._roomState),this.emit("room-state-change",this._roomState))}}]),t}();function Wr(e){return(Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hr(e,t){return!t||"object"!==Wr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Jr(e){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zr(e,t){return(zr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $r=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"send",i=arguments.length>2?arguments[2]:void 0;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Hr(this,Jr(t).call(this))).trackList=[],r.isDestroyed=!1,r.enableAudio=!0,r.enableVideo=!0,r.muteAudio=!1,r.muteVideo=!1,r.direction=n,r.userId=i,e.forEach(function(e){e.on("mute",function(){r.updateTrackState()}),e.on("release",function(){c()(r.trackList,function(t){return t===e}),r.updateTrackState(),0===r.trackList.length&&r.release()}),r.trackList.push(e)}),r.updateTrackState(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zr(e,t)}(t,i.a),function(e,t,r){t&&Vr(e.prototype,t),r&&Vr(e,r)}(t,[{key:"setVolume",value:function(e){this._audioTrack&&this._audioTrack.setVolume(e)}},{key:"play",value:function(e,t){this.trackList.forEach(function(r){return r.play(e,t)}),this._audioTrack&&(this.audio=this._audioTrack.mediaElement),this._videoTrack&&(this.video=this._videoTrack.mediaElement)}},{key:"setAudioBufferData",value:function(e,t){this._audioTrack&&"buffer"===this._audioTrack.sourceType&&(this._audioTrack.setAudioBuffer(e),this._audioTrack.playAudioBuffer(t))}},{key:"onAudioBuffer",value:function(e,t){this._audioTrack&&this._audioTrack.onAudioBuffer(e,t)}},{key:"getCurrentTimeDomainData",value:function(){return this._audioTrack?this._audioTrack.getCurrentTimeDomainData():new Uint8Array(0)}},{key:"getCurrentFrequencyData",value:function(){return this._audioTrack?this._audioTrack.getCurrentFrequencyData():new Uint8Array(0)}},{key:"getStats",value:function(){var e=this._audioTrack?this._audioTrack.getStats():Q,t=this._videoTrack?this._videoTrack.getStats():Q;return{timestamp:Date.now(),videoBitrate:t.bitrate,audioBitrate:e.bitrate,videoPacketLoss:t.packetLoss,audioPacketLoss:e.packetLoss,videoPackets:t.packets,audioPackets:e.packets,videoPacketLossRate:t.packetLossRate,audioPacketLossRate:e.packetLossRate,videoBytes:t.bytes,audioBytes:e.bytes,pctype:this.direction}}},{key:"setKbps",value:function(e,t){e&&this._videoTrack&&this._videoTrack.setKbps(e),t&&this._audioTrack&&this._audioTrack.setKbps(t)}},{key:"updateTrackState",value:function(){var e=this;this.trackList.forEach(function(t){"audio"===t.info.kind?(e.audioTrack=t.mediaTrack,e._audioTrack=t):(e.videoTrack=t.mediaTrack,e._videoTrack=t)}),this.audioTrack?(this.enableAudio=!0,this.muteAudio=!this.audioTrack.enabled):this.enableAudio=!1,this.videoTrack?(this.enableVideo=!0,this.muteVideo=!this.videoTrack.enabled):this.enableVideo=!1}},{key:"release",value:function(){if(!this.isDestroyed){for(var e=0;e<this.trackList.length;e+=1){var t=this.trackList[e];t.removeAllListeners("release"),t.release()}this.trackList=[],this.isDestroyed=!0,this.emit("release"),this.removeEvent()}}},{key:"releaseTrack",value:function(e){var t=function(e,t,r){for(var n=[],i=null,o=0;o<e.length;o+=1)e[o][t]!==r?n.push(e[o]):i=e[o];return{removeElement:i,newArray:n}}(this.trackList,"mediaTrack",e.mediaTrack),r=t.removeElement,n=t.newArray;r&&(e.release(),this.trackList=n,0===this.trackList.length&&(this.isDestroyed=!0))}}]),t}();function qr(e){return(qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Kr(e,t,r[t])})}return e}function Kr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yr(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function Xr(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Yr(o,n,i,a,s,"next",e)}function s(e){Yr(o,n,i,a,s,"throw",e)}a(void 0)})}}function Zr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function en(e,t){return!t||"object"!==qr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rn(e,t){return(rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nn=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=en(this,tn(t).call(this))).subscribedUsers={},e.sessionMode="stream",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(t,Gr),function(e,t,r){t&&Zr(e.prototype,t),r&&Zr(e,r)}(t,[{key:"publish",value:function(){var e=Xr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.stream){e.next=3;break}return $.warning("repeat publish, please unpublish first!"),e.abrupt("return");case 3:return t.userId=this.userId,this.stream=t,e.next=7,this._publish(t.trackList);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Xr(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionTransport){e.next=2;break}return e.abrupt("return");case 2:return t=this.connectionTransport.publishTracks.map(function(e){return e.trackId}),e.next=5,this._unpublish(t);case 5:this.stream=void 0;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setMergeStreamLayout",value:function(e,t){if(!(t.id?this.mergeJobTracks[t.id]:this.defaultMergeJobTracks))throw O(t.id);var r=$e(this.users,"userId",e);if(r&&r.published){var n=t;!1===t.visible&&(n.hidden=!0);var i=n.id,o=!!n.hidden,a=!!n.muted;delete n.id,delete n.hidden,delete n.muted;var s=[],c=[],u=!0,d=!1,f=void 0;try{for(var p,l=r.publishedTrackInfo[Symbol.iterator]();!(u=(p=l.next()).done);u=!0){var h=p.value;"audio"===h.kind&&a?c.push(h.trackId):"audio"===h.kind&&s.push({trackId:h.trackId}),"video"===h.kind&&o?c.push(h.trackId):"video"===h.kind&&s.push(Qr({},n,{trackId:h.trackId}))}}catch(e){d=!0,f=e}finally{try{u||null==l.return||l.return()}finally{if(d)throw f}}this._addMergeTracks(s,i),this._removeMergeTracks(c,i)}else $.warning("can not setMergeOption, user ".concat(e," is published ?"))}},{key:"stopMergeStream",value:function(e){this._stopMerge(e)}},{key:"subscribe",value:function(){var e=Xr(regeneratorRuntime.mark(function e(t){var r,n,i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.userId){e.next=2;break}throw _(10044,"can not subscribe yourself");case 2:if(0!==(r=this._trackInfo.filter(function(e){return e.playerid===t&&e.master})).length){e.next=5;break}throw _(10041,"subscribe user ".concat(t," is not published"));case 5:return n=r.map(function(e){return e.trackid}),e.next=8,this._subscribe(n);case 8:return i=e.sent,this.subscribedUsers[t]=new $r(i,"recv",t),this.subscribedUsers[t].once("release",function(){delete o.subscribedUsers[t]}),e.abrupt("return",this.subscribedUsers[t]);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=Xr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.subscribedUsers[t]){e.next=3;break}return $.warning("user",t,"is not in subscribedUsers"),e.abrupt("return");case 3:return e.next=5,this._unsubscribe(this.subscribedUsers[t].trackList.map(function(e){return e.info.trackId}));case 5:delete this.subscribedUsers[t];case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.stream){var r=[];this.stream._audioTrack&&this.stream._audioTrack.info.muted!==e&&r.push({trackId:this.stream._audioTrack.info.trackId,muted:e}),this.stream._videoTrack&&this.stream._videoTrack.info.muted!==t&&r.push({trackId:this.stream._videoTrack.info.trackId,muted:t}),this._muteTracks(r)}else $.warning("can not mute, please run publish first")}},{key:"filterSignalTracks",value:function(e){var t=this;e.tracks&&(e.tracks=e.tracks.filter(function(e){if(void 0!==e.master&&null!==e.master)return e.master;var r=t._trackInfo.find(function(t){return t.trackid===e.trackid});return!!r&&r.master}))}},{key:"releaseSession",value:function(){for(var e in this.stream&&(this.stream.release(),this.stream=void 0),this.subscribedUsers)this.subscribedUsers[e].release();this.subscribedUsers={}}}]),t}();function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function sn(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){an(o,n,i,a,s,"next",e)}function s(e){an(o,n,i,a,s,"throw",e)}a(void 0)})}}function cn(e,t){return!t||"object"!==on(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function un(e){return(un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fn(e,t,r){return t&&dn(e.prototype,t),r&&dn(e,r),e}function pn(e,t){return(pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ln=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=cn(this,un(t).call(this))).sessionMode="track",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pn(e,t)}(t,Gr),fn(t,[{key:"publishedTracks",get:function(){return this.connectionTransport?this.connectionTransport.publishTracks.filter(function(e){return e.connectStatus===se.Connect}).map(function(e){return e.track}):[]}},{key:"subscribedTracks",get:function(){return this.subscribeTracks.filter(function(e){return e.connectStatus===se.Connect}).map(function(e){return e.track})}},{key:"mergeStreamTracks",get:function(){return this.defaultMergeJobTracks}},{key:"mergeStreamJobTracks",get:function(){return this.mergeJobTracks}}]),fn(t,[{key:"publish",value:function(){var e=sn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._publish(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=sn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._unpublish(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(){var e=sn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=sn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._unsubscribe(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"muteTracks",value:function(e){this._muteTracks(e)}},{key:"addMergeStreamTracks",value:function(e,t){this._addMergeTracks(e,t)}},{key:"removeMergeStreamTracks",value:function(e,t){this._removeMergeTracks(e,t)}},{key:"stopMergeStream",value:function(e){this._stopMerge(e)}},{key:"filterSignalTracks",value:function(){}},{key:"releaseSession",value:function(){}}]),t}();function hn(e){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function mn(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){vn(o,n,i,a,s,"next",e)}function s(e){vn(o,n,i,a,s,"throw",e)}a(void 0)})}}function yn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gn(e,t){return!t||"object"!==hn(t)&&"function"!=typeof t?wn(e):t}function bn(e){return(bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kn(e,t){return(kn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Tn={audio:{enabled:!0},video:{enabled:!0,bitrate:600}},Sn=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=gn(this,bn(t).call(this))).deviceMap={},J.support?(e.updateDeivceInfo(),J.ondevicechange||window.setInterval(e.updateDeivceInfo.bind(wn(wn(e))),1e3),J.ondevicechange&&(navigator.mediaDevices.ondevicechange=e.updateDeivceInfo.bind(wn(wn(e)))),e):gn(e)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kn(e,t)}(t,i.a),function(e,t,r){t&&yn(e.prototype,t),r&&yn(e,r)}(t,[{key:"getLocalTracks",value:function(){var e=mn(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,c,u,d,f,p,l,h,v,m,y,g,b,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config=t||Tn,$.debug("get local tracks",this.config),r=null,!de(this.config)||!ue(this.config)){e.next=11;break}return n={screen:this.config.screen},e.next=7,this.getLocalTracks(n);case 7:i=e.sent,this.config=t||Tn,r=i[0],this.config={video:this.config.video,audio:this.config.audio};case 11:return e.next=13,Ie(this.config);case 13:return o=e.sent,e.prev=14,e.next=17,this.getUserMedia(o,!0);case 17:a=e.sent,e.next=27;break;case 20:if(e.prev=20,e.t0=e.catch(14),"NotAllowedError"!==e.t0.name){e.next=26;break}throw E("");case 26:throw e.t0;case 27:s=void 0,c=void 0,u=void 0,d=void 0,ce(this.config)&&(c=this.config.audio.bitrate,d=this.config.audio.tag),de(this.config)&&(s=this.config.screen.bitrate,u=this.config.screen.tag),ue(this.config)&&(s=this.config.video.bitrate,u=this.config.video.tag),f=a?a.getTracks():[],p=[],l=!0,h=!1,v=void 0,e.prev=39,m=f[Symbol.iterator]();case 41:if(l=(y=m.next()).done){e.next=59;break}if(g=y.value,b=void 0,"audio"!==g.kind){e.next=51;break}return(b=new Xt(g)).setInfo({tag:d}),e.next=49,b.initAudioManager(!0);case 49:e.next=53;break;case 51:(b=new At(g)).setInfo({tag:u});case 53:"audio"===g.kind&&c&&b.setKbps(c),"video"===g.kind&&s&&b.setKbps(s),p.push(b);case 56:l=!0,e.next=41;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(39),h=!0,v=e.t1;case 65:e.prev=65,e.prev=66,l||null==m.return||m.return();case 68:if(e.prev=68,!h){e.next=71;break}throw v;case 71:return e.finish(68);case 72:return e.finish(65);case 73:if(!this.config.audio||!this.config.audio.buffer){e.next=80;break}return e.next=76,Zt();case 76:k=e.sent,c&&k.setKbps(c),k.setInfo({tag:this.config.audio.tag}),p.push(k);case 80:return r&&p.push(r),e.abrupt("return",p);case 82:case"end":return e.stop()}},e,this,[[14,20],[39,61,65,73],[66,,68,72]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getLocalStream",value:function(){var e=mn(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&de(t)&&ue(t))){e.next=2;break}throw b("can not get local stream with video and screen");case 2:return e.next=4,this.getLocalTracks(t);case 4:return(r=e.sent).forEach(function(e){return e.setMaster(!0)}),e.abrupt("return",new $r(r,"send"));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserMedia",value:function(){var e=mn(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if($.debug("request to get user media",t),t.audio||t.video){e.next=3;break}return e.abrupt("return",null);case 3:if(!(G&&de(this.config)&&ce(this.config))){e.next=9;break}return e.next=6,this.mergeChromeScreenAudioStream(t);case 6:n=e.sent,e.next=12;break;case 9:return e.next=11,navigator.mediaDevices.getUserMedia(t);case 11:n=e.sent;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"mergeChromeScreenAudioStream",value:function(){var e=mn(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.audio&&t.video&&!(!t.video).mandatory){e.next=4;break}return e.next=3,navigator.mediaDevices.getUserMedia(t);case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,navigator.mediaDevices.getUserMedia({audio:t.audio});case 6:return r=e.sent,e.next=9,navigator.mediaDevices.getUserMedia({video:t.video});case 9:return(n=e.sent).addTrack(r.getAudioTracks()[0]),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateDeivceInfo",value:function(){var e=mn(regeneratorRuntime.mark(function e(){var t,r,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:this.deviceInfo=e.sent,t=this.deviceInfo.map(function(e){return e.deviceId}),r=Object.keys(this.deviceMap),n=!1,r.forEach(function(e){-1===t.indexOf(e)&&"@default"!==e?(i.emit("device-remove",i.deviceMap[e].device),delete i.deviceMap[e],n=!0):i.deviceMap[e].tick+=1}),t.forEach(function(e,t){-1===r.indexOf(e)&&"@default"!==e&&(i.deviceMap[e]={device:i.deviceInfo[t],tick:0},i.emit("device-add",i.deviceMap[e].device),n=!0)}),n&&this.emit("device-update",this.deviceInfo);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(),_n=new Sn;r.d(t,"StreamModeSession",function(){return nn}),r.d(t,"TrackModeSession",function(){return ln}),r.d(t,"version",function(){return tt}),r.d(t,"REC_AUDIO_ENABLE",function(){return ce}),r.d(t,"REC_VIDEO_ENABLE",function(){return ue}),r.d(t,"REC_SCREEN_ENABLE",function(){return de}),r.d(t,"TrackConnectStatus",function(){return se}),r.d(t,"defaultMergeJob",function(){return fe}),r.d(t,"DeviceManager",function(){return Sn}),r.d(t,"deviceManager",function(){return _n}),r.d(t,"Stream",function(){return $r}),r.d(t,"Track",function(){return At}),r.d(t,"AudioTrack",function(){return Xt}),r.d(t,"createAudioTrackWithAudioBuffer",function(){return Zt}),r.d(t,"RoomState",function(){return Or}),r.d(t,"log",function(){return $}),r.d(t,"User",function(){return _e}),r.d(t,"browserReport",function(){return J}),r.d(t,"decodeAudioData",function(){return Wt}),r.d(t,"isChromeExtensionAvailable",function(){return ye})}]);
//# sourceMappingURL=pili-rtc-web-2.0.0-patch.1.js.map